{"version":3,"sources":["components/edit/LocaleSelect.js","components/SidebarContent.module.css","components/BlockTree.module.css","components/BlockTree.js","components/BlocksLoader.js","components/SidebarContent.js"],"names":["locales","_","en","de","es","pt","fr","it","nl","da","sv","nb","fi","se","mt","pl","ru","bg","tr","ar","el","ro","sl","localesArray","Object","entries","map","code","nativeName","defaultOptions","keys","LocaleSelect","defaultValue","onChange","options","style","undefined","hasOwnProperty","length","useState","changedLocale","setChangedLocale","handleLocaleChange","useCallback","newLocale","trigger","triggerProps","isOpen","className","margin","flexShrink","width","textAlign","path","mdiTranslate","toUpperCase","marginLeft","lineHeight","verticalAlign","paperProps","sx","maxHeight","close","padding","filter","includes","onClick","selected","module","exports","treeWalker","blockTypeIcons","page","person","redirect","getViewportHeight","Math","max","document","documentElement","clientHeight","window","innerHeight","treeRoots","stack","treeRootsSorted","sort","a","b","block","metadata","modified","europaIndex","findIndex","root","properties","slug","slice","unshift","nestingLevel","node","f","pop","children","_id","isLeaf","childrenSorted","i","push","BlockRow","index","data","items","props","createBlock","toggleOpenById","refetchData","showBlockMenu","setItemSize","itemRef","useRef","useEffect","current","height","getBoundingClientRect","blockMenuIsOpen","setBlockMenuIsOpen","onBlockMenuToogle","newValue","setTimeout","toggleOpen","onReloadContext","force","rowContent","ViewerAuto","dragable","size","flexGrow","classes","blockRowActions","BlockMenu","onToogle","inset","ref","display","alignItems","flexDirection","minWidth","blockRow","fakeHover","getFilteredTypes","types","BlockTree","scrollContainer","getString","useLocalization","loggedIn","useUser","searchButtonRef","searchButtonSize","target","mountedRef","React","setSize","useLayoutEffect","useResizeObserver","entry","contentRect","useSize","outerTreeRef","innerTreeRef","outerHeight","setOuterHeight","bottomMargin","setBottomMargin","nodes","setNodes","openById","setOpenById","treeNodes","setTreeNodes","prevFetchArguments","treeType","setTreeType","setTypes","filteredTypes","archived","setArchived","viewportHeight","setHeight","timeoutId","resizeListener","clearTimeout","addEventListener","removeEventListener","useViewportHeight","updateHeight","outerBounds","top","fullHeight","isNaN","newHeight","min","useScrollPosition","updateTree","parentBlock","parent","find","n","buildTree","JSON","parse","stringify","flatTree","walker","done","next","new_done","value","getFlatTree","loadBlocks","useLoadBlocks","roots","roles","then","loadedBlocks","catch","error","console","toggleType","type2toggle","newTypes","values","every","listRef","itemSizes","sizes","resetAfterIndex","getItemSize","refetchDataWithFilter","isMacLike","test","navigator","userAgent","toLowerCase","MultiButton","title","justifyContent","flexWrap","gap","buttonProps","MenuItem","event","CustomEvent","dispatchEvent","boxShadow","background","borderRadius","ListItemIcon","Search","ListItemText","secondary","Localized","id","PopoverMenu","FilterList","marginTop","type","marginBottom","Divider","opacity","oldArchived","Archive","marginRight","overflowY","overflowX","itemSize","itemData","itemCount","innerRef","estimatedItemSize","itemKey","fontWeight","BlocksLoader","slugs","blocks","setBlocks","apollo_client","useApolloClient","Array","isArray","query","getBlocks_Query","variables","errors","Error","e","message","join","SidebarContent","mounted","favoriteBlocks","setFavoriteBlocks","loadFavoriteBlocks","loadFavoriteBlockIds","icon","emoji","reactionFor","log","ids","userLocales","showBlockTree","setShowBlockTree","efficientSetShowBlockTree","func","wait","immediate","timeout","context","this","args","arguments","later","apply","callNow","debounce","toggleSidebar","useSidebarContext","matchesStartpage","useMatch","saveBlock","useSaveBlock","navigate","useNavigate","gottenBlock","scrollContainerRef","newEvent","detail","locale","bubbles","cancelable","ui_locales","choose_locale_information_string","content","header","headerBar","MenuOpen","AddMenu","Add","MenuList","maxWidth","href","domains","backend","encodeURIComponent","location","toString","Logout","primary","Login","fontSize","Boolean","Twemoji","emojiClassName"],"mappings":"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","file":"static/js/8.fc03b0ca.chunk.js","sourcesContent":["import { useState, useCallback } from 'react'\n\nimport {\n  MenuItem,\n} from '@mui/material'\n\nimport PopoverMenu from '../PopoverMenu.js'\n\nimport MdiIcon from '@mdi/react'\nimport {\n  mdiTranslate,\n} from '@mdi/js'\n\nconst locales = {\n  _: '??',\n  en: 'English',\n  de: 'Deutsch',\n  es: 'Español',\n  pt: 'Português',\n  fr: 'Français',\n  it: 'Italiano',\n  nl: 'Nederlands', // Dutch\n  da: 'Dansk', // Danish\n  sv: 'Svenska', // Swedish\n  nb: 'Norsk bokmål', // Norwegian\n  fi: 'Suomi', // Finish\n  se: 'Davvisámegiella (Northern Sami)', // Northern Sami\n  mt: 'Malti', // Maltese\n  pl: 'Język polski', // Polish\n  ru: 'русский язык', // Russian\n  bg: 'български език', // Bulgarian\n  tr: 'Türkçe',\n  ar: 'اَلْعَرَبِيَّة', // Arabic\n  el: 'ελληνικά', // Greek\n  ro: 'limba română', // Romanian\n  sl: 'slovenščina', // Slovenian\n  // uk: 'украї́нська мо́ва', // Ukrainian\n  // cy: 'Cymraeg', // Welsh\n}\n\nconst localesArray = Object.entries(locales)\n.map(([code, nativeName]) => ({code, nativeName}))\n\nconst defaultOptions = Object.keys(locales)\n\nfunction LocaleSelect({\n  defaultValue,\n  onChange,\n  options = defaultOptions,\n  style,\n}) {\n  if (\n    defaultValue === null\n    || defaultValue === undefined\n    || defaultValue === ''\n    || locales.hasOwnProperty(defaultValue) === false\n  ) {\n    if (options.length > 0) {\n      defaultValue = options[0]\n    } else {\n      defaultValue = '_'\n    }\n  }\n\n  const [changedLocale, setChangedLocale] = useState(defaultValue)\n\n  const handleLocaleChange = useCallback(newLocale => {\n    // TODO: get best match with fluent\n\n    setChangedLocale(newLocale)\n    \n    if (newLocale === '_') {\n      newLocale = null\n    }\n\n    if (onChange) {\n      onChange(newLocale)\n    }\n  }, [ setChangedLocale, onChange ])\n\n  return (\n    <PopoverMenu\n      trigger={(triggerProps, { isOpen }) => (\n        <button\n          {...triggerProps}\n          className=\"default hasIcon\"\n          style={{\n            margin: '0',\n            flexShrink: '0',\n            ...style,\n          }}\n        >\n          <span style={{ width: '100%', textAlign: 'start' }}>\n          {\n            changedLocale === '_'\n            ? <MdiIcon\n              path={mdiTranslate}\n              className=\"icon\"\n            />\n            : changedLocale.toUpperCase()\n          }\n          </span>\n          <span style={{\n            marginLeft: 'var(--basis)',\n            lineHeight: '1',\n            verticalAlign: 'text-top',\n          }}>\n            { isOpen ? '▴' : '▾' }\n          </span>\n        </button>\n      )}\n      paperProps={{\n        sx: {\n          maxHeight: '300px',\n        }\n      }}\n    >\n      {({ close }) => (\n        <div style={{\n          padding: 'var(--basis_x2) 0',\n        }}>\n          {\n            localesArray\n            .filter(({ code }) => options.includes(code))\n            .map(({ code, nativeName }) => (\n              <MenuItem\n                key={code}\n                onClick={() => {\n                  handleLocaleChange(code)\n                  close()\n                }}\n                className=\"roundMenuItem\"\n                selected={code === changedLocale}\n              >\n                {code === '_' ? nativeName : `${code.toUpperCase()} — ${nativeName}`}\n              </MenuItem>\n            ))\n          }\n        </div>\n      )}\n    </PopoverMenu>    \n  )\n}\n\nexport default LocaleSelect\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"SidebarContent_content__RAi8X\",\"header\":\"SidebarContent_header__1pYRG\",\"headerBar\":\"SidebarContent_headerBar__2xkje\",\"scrollContainer\":\"SidebarContent_scrollContainer__2eS9U\",\"emoji\":\"SidebarContent_emoji__3twKX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"blockRow\":\"BlockTree_blockRow__80Vim\",\"blockRowActions\":\"BlockTree_blockRowActions__GDOGf\",\"fakeHover\":\"BlockTree_fakeHover__TKaWl\"};","import React, { useCallback, useEffect, useState, useRef } from 'react'\nimport { VariableSizeList } from 'react-window'\n\nimport { useScrollPosition } from '@n8tb1t/use-scroll-position'\n\nimport BlockMenu from './edit/BlockMenu.js'\nimport ViewerAuto from './view/ViewerAuto.js'\nimport MultiButton from './MultiButton.js'\n\nimport { useLocalization, Localized } from '../fluent/Localized.js'\n\nimport classes from './BlockTree.module.css'\n\nimport {\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  Divider,\n} from '@mui/material'\n\nimport {\n  MoreVertSharp as BlockMenuIcon,\n  ArrowDropDownSharp as ExpandLessIcon,\n  ArrowRightSharp as ExpandMoreIcon,\n\n  Replay as RequeryIcon,\n  FilterList as FilterListIcon,\n  Archive as ArchiveIcon,\n\n  InsertDriveFileSharp as PageIcon,\n  // AutoAwesomeSharp as ActionIcon,\n  LinkSharp as RedirectIcon,\n  PersonSharp as PersonIcon,\n  // Crop75Sharp as ButtonIcon,\n  // TitleSharp as HeadlineIcon,\n  // NotesSharp as TextIcon,\n  // Remove as DividerIcon,\n  // EditSharp as EditIcon,\n\n  Search as SearchIcon,\n} from '@mui/icons-material'\n\nimport useLoadBlocks from '../hooks/useLoadBlocks.js'\nimport useUser from '../hooks/useUser.js'\n\nimport PopoverMenu from './PopoverMenu.js'\n\nimport useResizeObserver from '@react-hook/resize-observer'\n\nconst useSize = target => {\n  const mountedRef = React.useRef(false)\n  useEffect(() => {\n    mountedRef.current = true\n    return () => {\n      mountedRef.current = false\n    }\n  }, [])\n\n  const [size, setSize] = React.useState()\n\n  React.useLayoutEffect(() => {\n    if (mountedRef.current === true) {\n      setSize(target.current.getBoundingClientRect())\n    }\n  }, [target])\n\n  // Where the magic happens\n  useResizeObserver(target, (entry) => {\n    if (mountedRef.current === true) {\n      setSize(entry.contentRect)\n    }\n  })\n  return size\n}\n\nconst blockTypeIcons = {\n  page: <PageIcon />,\n  person: <PersonIcon />,\n  redirect: <RedirectIcon />,\n}\n\n\nconst minItemSize = 41\n\n// const getWidth = () => window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth\n// const getHeight = () => window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight\n\n// const getViewportWidth = () => Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)\nconst getViewportHeight = () => Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0)\n\nfunction useViewportHeight() {\n  // save current window width in the state object\n  let [height, setHeight] = useState(getViewportHeight())\n\n  // in this case useEffect will execute only once because\n  // it does not have any dependencies.\n  useEffect(() => {\n    // timeoutId for debounce mechanism\n    let timeoutId = null\n    const resizeListener = () => {\n      // prevent execution of previous setTimeout\n      clearTimeout(timeoutId)\n      // change width from the state object after 150 milliseconds\n      timeoutId = setTimeout(() => {\n        setHeight(getViewportHeight())\n      }, 150)\n    }\n    // set resize listener\n    window.addEventListener('resize', resizeListener)\n\n    // clean up function\n    return () => {\n      // remove resize listener\n      window.removeEventListener('resize', resizeListener)\n    }\n  }, [])\n\n  return { height }\n}\n\nfunction buildTree(nodes){\n  // Build a tree from the blocks.\n  // Where each block has a parentId property.\n  // Each tree item should have the block itself, a list of children and a nesting level.\n  \n  const treeRoots = []\n\n  for (let node of nodes) {\n    let parentBlock = null\n    if (node.block.parent) {\n      parentBlock = nodes.find(n => n._id === node.block.parent)\n      // if (!parentBlock) {\n      //   console.error('Invalid parent:')\n      //   console.error('parentBlockt', parentBlock)\n      //   console.error('node.block.parent', node.block.parent)\n      // }\n    }\n\n    if (!parentBlock) {\n      treeRoots.push(node)\n    } else {\n      // If the parentBlock has no children, create the children array.\n      if (!parentBlock.children) {\n        parentBlock.children = []\n      }\n      parentBlock.children.push(node)\n    }\n  }\n\n  return treeRoots\n}\n\nfunction* treeWalker(treeRoots) {\n  const stack = []\n \n  let treeRootsSorted = treeRoots\n    .sort((a, b) => b.block.metadata.modified > a.block.metadata.modified ? 1 : -1)\n\n  // find the index of the root with block.properties.slug === 'europa'\n  const europaIndex = treeRootsSorted.findIndex(root => root?.block?.properties?.slug === 'europa')\n\n  // remove the root at index europaIndex\n  if (europaIndex > -1) {\n    treeRootsSorted[europaIndex] = {\n      ...treeRootsSorted[europaIndex],\n      isOpen: true,\n    }\n\n    treeRootsSorted = [\n      treeRootsSorted[europaIndex],\n      ...treeRootsSorted.slice(0, europaIndex),\n      ...treeRootsSorted.slice(europaIndex + 1)\n    ]\n  }\n      \n  // Remember all the necessary data of the first node in the stack.\n  for (const root of treeRootsSorted) {\n    stack.unshift({\n      nestingLevel: 0,\n      node: root,\n    })\n  }\n \n  // Walk through the tree until we have no nodes available.\n  while (stack.length !== 0) {\n    const {\n      node: {children = [], _id, block, isOpen},\n      nestingLevel,\n    } = stack.pop()\n\n    yield {\n      _id,\n      isLeaf: children.length === 0,\n      isOpen,\n      block,\n      nestingLevel,\n    }\n \n    // Basing on the node openness state we are deciding if we need to render\n    // the child nodes (if they exist).\n    if (children.length !== 0 && isOpen) {\n      // Since it is a stack structure, we need to put nodes we want to render\n      // first to the end of the stack.\n\n      const childrenSorted = children\n        .sort((a, b) => b.block.metadata.modified > a.block.metadata.modified ? 1 : -1)\n\n      for (let i = childrenSorted.length - 1; i >= 0; i--) {\n        stack.push({\n          nestingLevel: nestingLevel + 1,\n          node: childrenSorted[i],\n        });\n      }\n    }\n  }\n}\n\nfunction getFlatTree(treeRoots){\n  const flatTree = []\n\n  const walker = treeWalker(treeRoots)\n\n  let done = false\n  while (!done) {\n    const { done: new_done, value } = walker.next()\n    done = new_done\n    if (!done) {\n      flatTree.push(value)\n    }\n  }\n\n  return flatTree\n}\n\nconst BlockRow = ({\n  index,\n  style,\n  data,\n}) => {\n  const {\n    items,\n    props,\n  } = data || []\n\n  const {\n    createBlock,\n    toggleOpenById,\n    refetchData,\n    showBlockMenu,\n    setItemSize,\n  } = props || {}\n\n  const {\n    _id,\n    isLeaf,\n    isOpen,\n    block,\n    nestingLevel,\n  } = items[index] || {}\n\n  const itemRef = useRef()\n  useEffect(() => {\n    if (typeof setItemSize === 'function' && itemRef.current) {\n      const height = itemRef.current.getBoundingClientRect().height\n      if (height > 0) {\n        setItemSize(index, ~~height)\n      }\n    }\n  }, [index, block, setItemSize]) // mention block here, to recalc the height on new data\n  \n  const [blockMenuIsOpen, setBlockMenuIsOpen] = useState(false)\n\n  const onBlockMenuToogle = useCallback(newValue => {\n    if (newValue === false) {\n      setTimeout(() => {\n        setBlockMenuIsOpen(newValue)\n      }, 200) // The fade-out animation is 200ms. Only rerender after it, for it not to loose the element.\n    } else {\n      setBlockMenuIsOpen(newValue)\n    }\n  }, [ setBlockMenuIsOpen ])\n\n  const toggleOpen = useCallback(() => {\n    if (typeof toggleOpenById === 'function') {\n      toggleOpenById(_id)\n    }\n  }, [toggleOpenById, _id])\n  \n  const onReloadContext = useCallback(() => {\n    if (typeof refetchData === 'function') {\n      setTimeout(() => {\n        refetchData({ force: true })\n      }, 200) // The fade-out animation is 200ms. Only rerender after it, for it not to loose the element.\n    }\n  }, [ refetchData ])\n\n  const rowContent = <>\n    <ViewerAuto\n      dragable={true}\n      size=\"line\"\n      block={block}\n      style={{\n        flexGrow: '1',\n        width: '100%',\n      }}\n    />\n\n    {\n      showBlockMenu === true\n      && (\n        <div className={classes.blockRowActions}>\n          <BlockMenu\n            onToogle={onBlockMenuToogle}\n            onReloadContext={onReloadContext}\n            {...{\n              block,\n              createBlock,\n              // saveType,\n            }}\n            trigger={props => (\n              <button\n                {...props}\n                className={`text hasIcon ${blockMenuIsOpen ? 'fakeHover' : ''}`}\n                style={{\n                  margin: '0',\n                  padding: 'var(--basis) 0',\n                  flexShrink: '0',\n                }}\n              >\n                <BlockMenuIcon className=\"icon\" />\n              </button>\n            )}\n          />\n        </div>\n      )\n    }\n  </>\n\n  const inset = ~~(nestingLevel * 25 + (isLeaf ? 24 : 0))\n\n  return <div\n    ref={itemRef}\n    key={block._id}\n    style={{\n      display: 'flex',\n      alignItems: 'center',\n      flexDirection: 'row',\n      ...style,\n      height: 'auto',\n      marginLeft: inset,\n      minWidth: `calc(100% - ${(isLeaf ? 24 : 0)}px)`,\n      width: `calc(100% - ${inset}px)`,\n    }}\n    className={`${classes.blockRow} ${blockMenuIsOpen ? classes.fakeHover : ''}`}\n  >\n    {!isLeaf && (\n      <button\n        onClick={toggleOpen}\n        className=\"text hasIcon\"\n        style={{\n          margin: '0',\n          padding: 'var(--basis) 0',\n          flexShrink: '0',\n        }}\n      >\n        {\n          isOpen\n            ? <ExpandLessIcon style={{ verticalAlign: 'middle' }} />\n            : <ExpandMoreIcon style={{ verticalAlign: 'middle' }} />\n        }\n      </button>\n    )}\n    {rowContent}\n  </div>\n}\n\nconst getFilteredTypes = types => Object.entries(types)\n  .filter(([, value]) => value === true)\n  .map(([key, ]) => key)\n\nfunction BlockTree({\n  createBlock = ()=>{},\n  scrollContainer = window,\n  showBlockMenu = true,\n}) {\n  const { getString } = useLocalization()\n  const { loggedIn } = useUser()\n\n  const searchButtonRef = useRef(null)\n  const searchButtonSize = useSize(searchButtonRef)\n\n  const outerTreeRef = useRef(null)\n  const innerTreeRef = useRef(null)\n  const [outerHeight, setOuterHeight] = useState(minItemSize)\n  const [bottomMargin, setBottomMargin] = useState(0)\n  const [nodes, setNodes] = useState([])\n  const [openById, setOpenById] = useState({})\n  const [treeNodes, setTreeNodes] = useState([])\n\n  const prevFetchArguments = useRef({})\n\n  const [treeType, setTreeType] = useState('europa') // europa / people / own_blocks\n\n  const [types, setTypes] = useState({\n    person: true,\n    page: true,\n    redirect: true,\n  })\n  const filteredTypes = getFilteredTypes(types)\n  \n  const [archived, setArchived] = useState(false)\n  function toggleArchived() {\n    setArchived(oldArchived => !oldArchived)\n  }\n\n\n  const openSearch = () => {\n    const event = new CustomEvent('open_search')\n    window.dispatchEvent(event)\n  }\n  /*\n  const sizeMap = useRef({})\n  const setSize = useCallback((index, size) => {\n    sizeMap.current = {\n      ...sizeMap.current,\n      [index]: size,\n    }\n  }, [])\n  const getSize = useCallback(index => sizeMap.current[index] || minItemSize, [])\n  */\n\n\n  const { height: viewportHeight } = useViewportHeight()\n\n  const updateHeight = useCallback(() => {\n    if (innerTreeRef.current && outerTreeRef.current) {\n      setTimeout(() => { // TODO remove this timeout (it's used to update the initial height)\n        const outerBounds = outerTreeRef.current.getBoundingClientRect()      \n        const maxHeight = viewportHeight - outerBounds.top\n\n        const innerBounds = innerTreeRef.current.getBoundingClientRect()\n        const fullHeight = innerBounds.height\n        if (typeof fullHeight === 'number' && !isNaN(fullHeight) && fullHeight > minItemSize) {\n          const newHeight = Math.min(maxHeight, fullHeight)\n          setOuterHeight(~~(newHeight))\n          setBottomMargin(~~(Math.max(fullHeight - newHeight, 0)))\n        }\n      }, 100)\n    }\n  }, [ viewportHeight, innerTreeRef, outerTreeRef, setOuterHeight, setBottomMargin ])\n\n  useScrollPosition(updateHeight, [updateHeight], null, false, 300, scrollContainer)\n\n  const updateTree = useCallback(nodes => {\n    if (nodes.length > 0) {\n      nodes = nodes.map(node => ({\n        ...node,\n        isOpen: openById.hasOwnProperty(node._id) ? openById[node._id] : false,\n      }))\n      \n      const treeRoots = buildTree(JSON.parse(JSON.stringify(nodes)))\n      const flatTree = getFlatTree(treeRoots)\n      setTreeNodes(flatTree)\n    } else {\n      setTreeNodes([])\n    }\n    updateHeight()\n  }, [setTreeNodes, updateHeight, openById])\n\n  const loadBlocks = useLoadBlocks()\n  const refetchData = useCallback(options => {\n    let {\n      force = false,\n      filteredTypes,\n      archived,\n    } = options || {}\n\n    let roots = null\n    let roles = ['viewer','editor','owner']\n\n    if (treeType === 'europa') {\n      roots = ['6249c879fcaf12b124914396'] // TODO: don't hard code the id of europa \n      filteredTypes = [\n        'page',\n        'redirect',\n      ]\n      archived = false\n    } else if (treeType === 'people') {\n      filteredTypes = [\n        'person'\n      ]\n      archived = false\n    } else if (treeType === 'own_blocks') {\n      roles = ['editor', 'owner']\n    }\n\n    if (\n      force === true\n      || prevFetchArguments.current.archived !== archived\n      || prevFetchArguments.current.types !== filteredTypes\n    ) {\n      prevFetchArguments.current.types = filteredTypes\n      prevFetchArguments.current.archived = archived\n      \n      loadBlocks({ types: filteredTypes, archived, roots, roles })\n        .then(async loadedBlocks => {\n          const nodes = loadedBlocks\n          .map(block => ({\n            _id: block._id,\n            block,\n            children: [],\n            isOpen: false,\n          }))\n\n          setNodes(nodes)\n          updateTree(nodes)\n        })\n        .catch(error => console.error(error))\n    }\n  }, [treeType, loadBlocks, setNodes, updateTree])\n\n  // useEffect(() => {\n  //   refetchData()\n  // }, [ refetchData ])\n\n\n\n\n\n  // START Filter\n\n  const toggleType = useCallback(type2toggle => {\n    const newTypes = { ...types }\n    newTypes[type2toggle] = !newTypes[type2toggle]\n\n    const typesValues = Object.values(newTypes)\n    if (!typesValues.every(value => value === false)) {\n      setTypes(newTypes)\n    }\n  }, [ types, setTypes ])\n\n  useEffect(() => {\n    refetchData({\n      filteredTypes: getFilteredTypes(types),\n      archived,\n    })\n  }, [ types, archived, refetchData ])\n\n  // END Filter\n\n\n\n  const listRef = useRef(null)\n  const [itemSizes, setSize] = React.useState([])\n  const setItemSize = React.useCallback((index, size) => {\n    if (typeof setSize === 'function') {\n      setSize(sizes => ({\n        ...sizes,\n        [index]: size\n      }))\n      if (!!listRef.current && typeof listRef.current.resetAfterIndex === 'function') {\n        listRef.current.resetAfterIndex(index, false)\n      }\n    }\n  }, [])\n  const getItemSize = React.useCallback(index => {\n    return itemSizes[index] || minItemSize\n  }, [itemSizes])\n\n\n\n\n  const toggleOpenById = useCallback((_id) => {\n    openById[_id] = !openById[_id]\n    setOpenById(openById)\n    updateTree(nodes)\n  }, [setOpenById, openById, updateTree, nodes])\n\n  const refetchDataWithFilter = useCallback(options => {\n    refetchData({\n      ...options,\n      filteredTypes: getFilteredTypes(types),\n      archived,\n    })\n  }, [ types, archived, refetchData ])\n\n\n  // const isMacLike = /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform) // source: https://stackoverflow.com/questions/10527983/best-way-to-detect-mac-os-x-or-windows-computers-with-javascript-or-jquery?noredirect=1&lq=1\n  const isMacLike = /(macintosh|macintel|macppc|mac68k|macos|iphone|ipad|ipod)/i.test(window.navigator.userAgent.toLowerCase())\n  \n  return <>\n    <div>\n      <MultiButton\n        defaultValue={treeType}\n        items={\n          loggedIn\n            ? [\n              { value: 'europa', title: 'Volt Europa' },\n              { value: 'people', title: getString('block_menu_type_label_plural_person') },\n              { value: 'own_blocks', title: getString('block_tree_own_blocks') }\n            ]\n            : [\n              {value: 'europa', title: 'Volt Europa' },\n              {value: 'people', title: getString('block_menu_type_label_plural_person') },\n            ]\n        }\n        onChange={setTreeType}\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n          margin: 'calc(-2 * var(--basis)) 0 var(--basis_x4) 0',\n          justifyContent: 'stretch',\n          flexWrap: 'wrap',\n          gap: 'var(--basis_x2)',\n        }}\n        buttonProps={{\n          style: {\n            flexGrow: 1,\n            justifyContent: 'center',\n            flexShrink: 0,\n            margin: 0,\n          }\n        }}\n      />\n    </div>\n\n    <div style={{\n      display: 'flex',\n      alignItems: 'center',\n      margin: '0 0 var(--basis_x2) 0',\n      gap: 'var(--basis)',\n    }}>\n\n      <MenuItem\n        ref={searchButtonRef}\n        onClick={openSearch}\n        style={{\n          width: '100%',\n          justifyContent: 'space-between',\n          // boxShadow: 'inset 0 0 0 1px rgba(var(--background-rgb), var(--alpha))',\n          boxShadow: '0 0 0 1px var(--background)',\n          background: 'var(--background)',\n\n          // the following replaces the roundMenuItem-css-class\n          borderRadius: 'var(--basis)',\n          margin: '0',\n          padding: 'var(--basis) var(--basis_x2)',\n          // end of the roundMenuItem-css-class stuff\n\n        }}\n      >\n        <ListItemIcon>\n          <SearchIcon />\n        </ListItemIcon>\n        <ListItemText\n          secondary={<span style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n          }}>\n            <Localized id=\"search\" />\n\n            {\n              searchButtonSize?.width > 500\n                ? (\n                  isMacLike\n                    ? <kbd>⌘ K</kbd>\n                    : <kbd>Ctrl+K</kbd>\n                )\n                : null\n            }\n            {/*\n              Command / Cmd: ⌘\n              Shift: ⇧\n              Option / Alt: ⌥\n              Control / Ctrl: ⌃\n              Caps Lock: ⇪\n            */}\n          </span>}\n        />\n      </MenuItem>\n\n      {\n        loggedIn && treeType === 'own_blocks'\n        ? <PopoverMenu\n          trigger={triggerProps => (\n            <button\n              {...triggerProps}\n              className=\"text hasIcon\"\n              style={{\n                flexShrink: '0',\n                margin: '0',\n              }}\n            >\n              <FilterListIcon className=\"icon\" />\n              {/* <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}>Filter</span> */}\n            </button>\n          )}\n        >\n          {/*\n            { value: 'page', icon: <PageIcon className=\"icon\"/>, title: getString('block_menu_type_label_plural_page') },\n            { value: 'person', icon: <PersonIcon className=\"icon\" />, title: getString('block_menu_type_label_plural_person') },\n            { value: 'redirect', icon: <RedirectIcon className=\"icon\" />, title: getString('block_menu_type_label_plural_redirect') },\n          */}\n\n          <div style={{ marginTop: '8px' }}></div>\n\n          {\n            Object.keys(types)\n              .map(type => (\n                <MenuItem\n                  className=\"roundMenuItem\"\n                  key={type}\n                  onClick={() => toggleType(type)}\n                  selected={filteredTypes.includes(type)}\n                  sx={{\n                    marginTop: '2px !important',\n                    marginBottom: '2px !important',\n                  }}\n                >\n                  <ListItemIcon>\n                    {blockTypeIcons[type]}\n                  </ListItemIcon>\n                  <ListItemText>\n                    <Localized id={'block_menu_type_label_plural_'+type} />\n                  </ListItemText>\n                </MenuItem>\n              ))\n          }\n\n          <Divider style={{ opacity: 'var(--alpha-less)'}} />\n\n          <MenuItem\n            className=\"roundMenuItem\"\n            onClick={toggleArchived}\n            selected={archived === true}\n            sx={{\n              marginBottom: '2px !important',\n            }}\n          >\n            <ListItemIcon>\n              <ArchiveIcon className=\"icon\" />\n            </ListItemIcon>\n            <ListItemText>\n              <Localized id={archived === true ? 'filter_menu_showing_archiv' : 'filter_menu_show_archiv'} />\n            </ListItemText>\n          </MenuItem>\n\n        </PopoverMenu>\n        : null\n      }\n\n      <button\n        className=\"text hasIcon\"\n        onClick={refetchDataWithFilter}\n        style={{\n          flexShrink: '0',\n          margin: '0px',\n        }}\n      >\n        <RequeryIcon className=\"icon\" />\n        {/* <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}>Reload</span> */}\n      </button>\n    </div>\n\n    <div\n      style={{\n        height: outerHeight,\n        marginRight: '-12px',\n        marginLeft: '-12px',\n        marginBottom: bottomMargin,\n        overflowY: 'visible',\n        overflowX: 'auto',\n      }}\n      ref={outerTreeRef}\n    >\n      <VariableSizeList\n        ref={listRef}\n        itemSize={getItemSize}\n        itemData={{\n          items: treeNodes,\n          props: {\n            createBlock,\n            toggleOpenById,\n            refetchData: refetchDataWithFilter,\n            showBlockMenu,\n            setItemSize,\n          }\n        }}\n        itemCount={treeNodes.length}\n        innerRef={innerTreeRef}\n        // onScroll={updateHeight}\n        height={outerHeight}\n        width=\"auto\"\n        style={{\n          // overflow: 'visible',\n          overflowY: 'hidden',\n          overflowX: 'visible',\n          // overflowX: 'hidden',\n        }}\n        estimatedItemSize={minItemSize}\n        itemKey={(index, data) => data.items[index]._id}\n      >\n        {BlockRow}\n      </VariableSizeList>\n      {\n        treeNodes.length === 0\n          ? <p style={{\n            textAlign: 'center',\n            fontWeight: 'bold',\n          }}><Localized id=\"blocktree_no_nodes_to_show\" /></p>\n          : null\n      }\n    </div>\n  </>\n}\n\nexport default BlockTree\n\n\n\n// const defaultButtonStyle = { fontFamily: 'Courier New' }\n\n// Tree component can work with any possible tree structure because it uses an\n// iterator function that the user provides. Structure, approach, and iterator\n// function below is just one of many possible variants.\n// const defaultTree = {\n//   name: 'Root #1',\n//   id: 'root-1',\n//   children: [\n//     {\n//       children: [\n//         {id: 'child-2', name: 'Child #2'},\n//         {id: 'child-3', name: 'Child #3'},\n//         {id: 'child-5', name: 'Child #3'},\n//         {id: 'child-6', name: 'Child #3'},\n//         {id: 'child-7', name: 'Child #3'},\n//         {id: 'child-8', name: 'Child #3'},\n//         {id: 'child-9', name: 'Child #3'},\n//         {id: 'child-10', name: 'Child #3'},\n//         {id: 'child-11', name: 'Child #3'},\n//       ],\n//       id: 'child-1',\n//       name: 'Child #1',\n//     },\n//   ],\n// }\n\n  /*\nasync function* treeWalker(refresh) {\n  const stack = []\n \n  // Remember all the necessary data of the first node in the stack.\n  stack.push({\n    nestingLevel: 0,\n    node: tree,\n  })\n \n  // Walk through the tree until we have no nodes available.\n  while (stack.length !== 0) {\n    const {\n      node: {children = [], id, name},\n      nestingLevel,\n    } = stack.pop()\n \n    // Here we are sending the information about the node to the Tree component\n    // and receive an information about the openness state from it. The\n    // `refresh` parameter tells us if the full update of the tree is requested;\n    // basing on it we decide to return the full node data or only the node\n    // id to update the nodes order.\n    const isOpened = yield refresh\n      ? {\n          id,\n          isLeaf: children.length === 0,\n          isOpenByDefault: false,\n          name,\n          nestingLevel,\n        }\n      : id\n \n    // Basing on the node openness state we are deciding if we need to render\n    // the child nodes (if they exist).\n    if (children.length !== 0 && isOpened) {\n      // Since it is a stack structure, we need to put nodes we want to render\n      // first to the end of the stack.\n      for (let i = children.length - 1; i >= 0; i--) {\n        stack.push({\n          nestingLevel: nestingLevel + 1,\n          node: children[i],\n        });\n      }\n    }\n  }\n}\n*/\n\n  /*\n  // Node component receives all the data we created in the `treeWalker` +\n  // internal openness state (`isOpen`), function to change internal openness\n  // state (`toggle`) and `style` parameter that should be added to the root div.\n  const Node = ({data: {isLeaf, name, nestingLevel}, isOpen, style, toggle}) => {\n\n    const toogleAndUpdate = () => {\n      toggle()\n      setTimeout(updateHeight, 100)\n    }\n\n    return <div\n      style={{\n        ...style,\n        alignItems: 'center',\n        display: 'flex',\n        marginLeft: nestingLevel * 30 + (isLeaf ? 48 : 0),\n      }}\n    >\n      {!isLeaf && (\n        <div>\n          <button\n            type=\"button\"\n            onClick={toogleAndUpdate}\n            style={defaultButtonStyle}\n          >\n            {isOpen ? '-' : '+'}\n          </button>\n        </div>\n      )}\n      <div>{name}</div>\n    </div>\n  }\n*/\n","import { useRef, useState, useEffect } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlocks_Query } from '../graphql/queries'\n\nexport default function BlocksLoader({ slugs = [], children, ...props }) {\n  const mountedRef = useRef(false)\n  useEffect(() => {\n    mountedRef.current = true\n    return () => {\n      mountedRef.current = false\n    }\n  }, [])\n\n  const [blocks, setBlocks] = useState([])\n\n  const apollo_client = useApolloClient()\n\n  useEffect(() => {\n    if (Array.isArray(slugs) && slugs.length > 0) {\n      apollo_client.query({\n        query: getBlocks_Query,\n        variables: {\n          slugs,\n        },\n      })\n        .then(async ({ errors, data }) => {\n          if (mountedRef.current === true) {\n            if (Array.isArray(errors) || !Array.isArray(data.blocks)) {\n              throw new Error(errors.map(e => e.message).join('\\n'))\n            } else {\n              setBlocks(data.blocks)\n            }\n          }\n        })\n        .catch(async error => {\n          console.error('error', error)\n          setBlocks([])\n        })\n    } else {\n      setBlocks([])\n    }\n  }, [slugs, apollo_client])\n\n  if (blocks === null || blocks.length === 0) {\n    return null\n  }\n\n  if (typeof children !== 'function') {\n    return null\n  }\n\n  return children({...props, blocks, slugs})\n}\n","import { useState, useCallback, useRef, useEffect } from 'react'\nimport classes from './SidebarContent.module.css'\n\nimport {\n  MenuList,\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  Divider,\n} from '@mui/material'\n\nimport {\n  MenuOpen as MenuOpenIcon,\n  Add as AddIcon,\n\n  Login as LoginIcon,\n  Logout as LogoutIcon,\n\n  LanguageSharp as LocaleChooserIcon,\n  Search as SearchIcon,\n} from '@mui/icons-material'\n\nimport useSaveBlock from '../hooks/useSaveBlock.js'\n\nimport { useNavigate, useMatch } from 'react-router-dom'\n\nimport { Localized, useLocalization } from '../fluent/Localized.js'\nimport useUser from '../hooks/useUser.js'\nimport useLoadBlocks from '../hooks/useLoadBlocks.js'\nimport { useSidebarContext } from './Sidebar.js'\nimport AddMenu from './edit/AddMenu.js'\nimport BlockTree from './BlockTree.js'\nimport BlocksLoader from './BlocksLoader.js'\nimport Twemoji from './Twemoji.js'\nimport ViewerAuto from './view/ViewerAuto.js'\n\nimport LocaleSelect from './edit/LocaleSelect.js'\nimport { locales } from '../fluent/l10n.js'\n\nfunction debounce(func, wait, immediate) {\n  // Source: underscore.js\n\tvar timeout\n\treturn function() {\n\t\tvar context = this, args = arguments\n\t\tvar later = function() {\n\t\t\ttimeout = null\n\t\t\tif (!immediate) func.apply(context, args)\n\t\t}\n\t\tvar callNow = immediate && !timeout\n\t\tclearTimeout(timeout)\n\t\ttimeout = setTimeout(later, wait)\n\t\tif (callNow) func.apply(context, args)\n\t}\n}\n\nexport default function SidebarContent() {\n  const mounted = useRef(false)\n  useEffect(() => {\n    mounted.current = true\n    return () => {\n      mounted.current = false\n    }\n  }, [])\n\n  const [favoriteBlocks, setFavoriteBlocks] = useState([])\n  const loadBlocks = useLoadBlocks()\n  useEffect(() => {\n    if (mounted.current) {\n      const loadFavoriteBlocks = async () => {\n        const loadFavoriteBlockIds = (await loadBlocks({\n          types: ['reaction'],\n          roles: ['owner'],\n          archived: false,\n        }))\n          .filter(block => block.properties?.icon?.emoji === '⭐️')\n          .map(block => block.properties.reactionFor)\n        console.log('loadFavoriteBlockIds', loadFavoriteBlockIds)\n\n        const favoriteBlocks = await loadBlocks({\n          ids: loadFavoriteBlockIds\n        })\n        console.log('favoriteBlocks', favoriteBlocks)\n        setFavoriteBlocks(favoriteBlocks)\n      }\n      loadFavoriteBlocks()\n    }\n  }, [loadBlocks])\n\n  const {\n    getString,\n    userLocales = [],\n  } = useLocalization()\n\n  const [showBlockTree, setShowBlockTree] = useState(false)\n  var efficientSetShowBlockTree = useCallback(()=>{\n    if (mounted.current) {\n      debounce(() => {\n        if (mounted.current) {\n\t        setShowBlockTree(true)\n        }\n      }, 10)()\n    }\n  }, [ setShowBlockTree, mounted ])\n  useEffect(() => {\n    efficientSetShowBlockTree()\n  }, [ efficientSetShowBlockTree ])\n  \n  const { loggedIn } = useUser()\n  const { toggleSidebar } = useSidebarContext()\n\n  const matchesStartpage = useMatch('/')\n\n  const saveBlock = useSaveBlock()\n  const navigate = useNavigate()\n\n  const createBlock = useCallback(({ type }) => {\n    if (typeof type === 'string' && type.length > 0) {\n      saveBlock({\n        type,\n      })\n        .then(gottenBlock => {\n          navigate(`/${gottenBlock._id}/edit`)\n        })\n        .catch(error => {\n          console.error(error)\n        })\n    }\n  }, [saveBlock, navigate])\n\n  const scrollContainerRef = useRef(null)\n\n  const handleLocaleChange = useCallback(newLocale => {\n    const newEvent = new CustomEvent('change_locale', {\n      detail: {\n        locale: newLocale,\n      },\n      bubbles: true,\n      cancelable: false,\n    })\n    document.dispatchEvent(newEvent)\n  }, [])\n\n  const openSearch = () => {\n    const event = new CustomEvent('open_search')\n    window.dispatchEvent(event)\n  }\n\n  const ui_locales = [\n    '_',\n    ...Object.keys(locales),\n  ]\n\n  const choose_locale_information_string = getString('choose_locale_information')\n\n  return <div ref={scrollContainerRef} className={classes.scrollContainer}>\n    <div className={classes.content}>\n    <header className={classes.header}>\n      <div className={classes.headerBar}>\n        {\n          !matchesStartpage\n          ? <button onClick={toggleSidebar} className=\"text hasIcon\" style={{ margin: '0' }}>\n              <MenuOpenIcon className=\"icon\" />\n            </button>\n          : null\n        }\n\n          {\n            matchesStartpage\n              ? <h1>Volt.Link</h1>\n              : <h2 style={{ margin: 0 }}>Volt.Link</h2>\n          }\n\n          <div>\n            {\n              matchesStartpage\n                ? <button className=\"text hasIcon\" onClick={openSearch} title=\"Search (⌘K / Ctrl+K)\">\n                    <SearchIcon className=\"icon\" />\n                  </button>\n                : null\n            }\n\n\n            <AddMenu\n              trigger={triggerProps => (\n                <button className=\"default hasIcon\" {...triggerProps}>\n                  <AddIcon className=\"icon\" />\n                  {/* <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}>Add</span> */}\n                </button>\n              )}\n              createBlock={createBlock}\n            />\n          </div>\n      </div>\n    </header>\n\n      <MenuList style={{ maxWidth: '100%' }}>\n\n        {\n          loggedIn\n            ? <a href={`${window.domains.backend}logout?redirect_to=${encodeURIComponent(window.location.toString())}`}>\n                <MenuItem className=\"roundMenuItem\">\n                  <ListItemIcon>\n                    <LogoutIcon />\n                  </ListItemIcon>\n                  <ListItemText primary={<Localized id=\"logout\" />} />\n                </MenuItem>\n              </a>\n            : <a href={`${window.domains.backend}login?redirect_to=${encodeURIComponent(window.location.toString())}`}>\n                <MenuItem className=\"roundMenuItem\">\n                  <ListItemIcon>\n                    <LoginIcon />\n                  </ListItemIcon>\n                  <ListItemText primary={<Localized id=\"login\" />} />\n                </MenuItem>\n              </a>\n        }\n\n        <MenuItem\n          className=\"roundMenuItem\"\n        >\n          <ListItemIcon>\n            <LocaleChooserIcon />\n          </ListItemIcon>\n          <ListItemText\n            primary={<>\n              <span style={{\n                marginRight: 'var(--basis_x2)',\n                verticalAlign: 'middle',\n              }}>\n                <Localized id=\"choose_locale\" />\n              </span>\n              <LocaleSelect\n                onChange={handleLocaleChange}\n                defaultValue={userLocales[0]}\n                options={ui_locales}\n                style={{\n                  fontSize: 'inherit',\n                  padding: '4px 8px',\n                  verticalAlign: 'middle',\n                }}\n              />\n            </>}\n            secondary={<>\n              {\n                typeof choose_locale_information_string === 'string'\n                  && choose_locale_information_string !== ''\n                  ? <span style={{ marginBottom: '0' }}>\n                    <Localized id=\"choose_locale_information\" />\n                  </span>\n                  : null\n              }\n            </>}\n          />\n        </MenuItem>\n\n        <br />\n\n        <BlocksLoader slugs={[\n          'glossary',\n          'vip',\n          'tools',\n        ]}>\n          {({ blocks, slugs }) => {\n            return slugs\n              .map(slug => {\n                const block = blocks.find(block => block?.properties?.slug === slug)\n                if (block) {\n                  return <ViewerAuto key={block._id} block={block} />\n                }\n                return null\n              })\n              .filter(Boolean)\n          }}\n        </BlocksLoader>\n\n        <br />\n\n        <BlocksLoader slugs={[\n          'volt_link_workplace_group',\n          'stats',\n          'volt_link_source_code',\n          'volt_link_contact',\n          'imprint',\n          'privacy_policy',\n        ]}>\n          {({ blocks, slugs }) => {\n            return slugs\n              .map(slug => {\n                const block = blocks.find(block => block?.properties?.slug === slug)\n                if (block) {\n                  return <ViewerAuto key={block._id} block={block} />\n                }\n                return null\n              })\n              .filter(Boolean)\n          }}\n        </BlocksLoader>\n\n      </MenuList>\n\n\n      {\n        loggedIn\n          ? <>\n            <br />\n            <Divider style={{ opacity: 0.2, borderRadius: '10px' }} />\n            <br />\n            <h2 style={{ margin: '0 calc(1.85 * var(--basis)) var(--basis_x2) calc(1.85 * var(--basis))' }}>\n              <Twemoji emojiClassName={classes.emoji} emoji=\"⭐️\" /> <Localized id=\"favorites_heading\" />\n            </h2>\n            <p className=\"body2\" style={{ opacity: 0.8, margin: '0 calc(1.85 * var(--basis)) var(--basis_x2) calc(1.85 * var(--basis))' }}>\n              <Localized id=\"favorites_description\" />\n            </p>\n            {\n              favoriteBlocks.length > 0\n                ? favoriteBlocks\n                  .map(block => {\n                    if (block) {\n                      return <ViewerAuto key={block._id} block={block} />\n                    }\n                    return null\n                  })\n                  .filter(Boolean)\n              : null\n            }\n          </>\n          : null\n      }\n\n      <br />\n      <Divider style={{ opacity: 0.2, borderRadius: '10px' }} />\n      <br />\n      <br />\n\n      {/* All blocks: */}\n      {\n        showBlockTree\n        ? <BlockTree\n            showBlockMenu={true}\n            scrollContainer={scrollContainerRef}\n          />\n        : null\n      }\n    </div>\n  </div>\n}\n"],"sourceRoot":""}