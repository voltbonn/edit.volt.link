{"version":3,"sources":["components/SidebarContent.module.css","components/DataTransmat.module.css","pages/Editor.module.css","components/edit/TranslationEditor.module.css","components/BlockTree.module.css","components/Header.module.css","pages/App.module.css","fluent/fluentBy.js","components/Sidebar.module.css","components/apps/PageEditor.module.css","components/edit/HtmlInput.module.css","components/view/ViewerAuto.module.css","components/edit/InputWithLocal.module.css","components/edit/FancyInput.module.css","functions.js","locales lazy /^/.//.*/.ftl$/ groupOptions: {} namespace object","hooks/useMediaQuery.js","fluent/Localized.js","graphql/mutations.js","hooks/useSaveBlock.js","graphql/queries.js","hooks/useUser.js","components/Popover.js","components/PopoverMenu.js","components/edit/AddMenu.js","hooks/useArchiveBlock.js","components/SubMenu.js","components/edit/BlockMenu.js","components/DataTransmat.js","markdown.js","components/view/ViewerTextCard.js","components/view/ViewerButtonCard.js","components/view/ViewerDividerLine.js","components/view/ViewerCheckboxCard.js","components/view/ViewerLine.js","hooks/useBlockTrigger.js","hooks/useMutation.js","components/view/ViewerAuto.js","hooks/useLoadBlocks.js","components/BlockTree.js","components/SidebarContent.js","components/Sidebar.js","hooks/useLoadBlock.js","hooks/useBlockMatchesRoles.js","components/Header.js","components/ErrorPages.js","components/edit/HtmlInput.js","components/edit/SharingEditor.js","components/edit/LocaleSelect.js","components/edit/InputWithLocal.js","components/Repeater.js","components/edit/TranslationEditor.js","components/edit/FancyInput.js","components/edit/EmailInput.js","components/edit/PermissionsEditor.js","components/edit/CheckboxInput.js","components/MultiButton.js","components/edit/UrlInput.js","images/coverphotos/thumbs/20200912_Plakatschlange_Koeln_Matteo Sant_Unione_011.png","images/coverphotos/thumbs/Aktion.png","images/coverphotos/thumbs/tYADz4UyUAAcV5WlmWLlkXD9LG8W02U9LbQd8rxzQ2bt99lxwK.png","images/coverphotos/thumbs/Welcome-to-Volt.png","images/coverphotos/thumbs/portugal.jpg","components/edit/CoverphotoPicker.js","components/edit/IconPicker.js","components/edit/PathInput.js","hooks/useCheckPath.js","components/edit/TriggerInput.js","components/edit/ActionInput.js","components/edit/PropertiesEditor.js","components/edit/InlineEditorBlockText.js","components/edit/InlineEditorBlockButton.js","components/edit/InlineEditorBlockRedirect.js","components/edit/InlineEditorBlockDivider.js","components/edit/InlineEditorBlockCheckbox.js","components/edit/InlineEditorBlockPerson.js","components/edit/InlineEditorBlockPage.js","components/edit/InlineEditorBlock.js","components/edit/ContentEditor.js","components/apps/PageEditor.js","pages/Editor.js","pages/Viewer.js","pages/App.js","fluent/l10n.js","index.js","pages/Viewer.module.css","components/Repeater.module.css","components/view/ViewerLine.module.css","components/edit/PermissionsEditor.module.css","components/edit/IconPicker.module.css","Snackbar.module.css","components/edit/CoverphotoPicker.module.css","components/edit/PropertiesEditor.module.css","components/edit/SharingEditor.module.css","components/edit/InlineEditorBlock.module.css","components/edit/ContentEditor.module.css"],"names":["module","exports","negotiateLanguages","require","fluentByObject","object","userLocales","supportedLocales","Object","keys","length","lookupedLocale","defaultLocale","strategy","fluentByArray","array","key","map","item","filter","Boolean","fluentByAny","any","fallback","Array","isArray","result","value","hexToRGBArray","color","startsWith","substring","charAt","Error","rgb","i","parseInt","substr","getContrastingColor","luma","colorToHex","rgba","cvs","ctx","document","createElement","height","width","getContext","fillStyle","fillRect","getImageData","data","colorToRGBA","idx","toString","slice","join","getImageUrl","imageObj","type","url","getBlockColor","block","colors","colorRGB","contrastingColor","contrastingColorRGB","hasOwnProperty","properties","newColor","includes","parsedColor","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","code","ids","id","useMediaQuery","query","useState","matches","setMatches","useEffect","media","window","matchMedia","listener","addEventListener","removeEventListener","Localized","props","elems","br","Fragment","children","withLocalization","Inner","l10n","React","useContext","FluentContext","globalSupportedLocales","thisSupportedLocales","locale","currentLocales","getString","args","translateBlock","text","translations","correct_translations","fluentBy","useLocalization","saveBlock_Mutation","gql","archiveBlock_Mutation","unarchiveBlock_Mutation","moveBlock_Mutation","removeProperty","obj","prop","JSON","parse","stringify","useSaveBlock","apollo_client","useApolloClient","useSnackbar","enqueueSnackbar","closeSnackbar","handleSaveBlock","useCallback","initialBlock","final_resolve","snackbarKey","newBlock","content","contentConfig","blockId","loadingDataPromise","mutate","mutation","variables","a","error","variant","preventDuplicate","autoHideDuration","_id","saveBlock","catch","console","message","race","setTimeout","response","persist","getBlock_Query","getBlocks_Query","getSelf_Query","getParentBlocks_Query","blockMatchesRoles_Query","checkPath_Query","useUser","forceRefetch","mountedRef","useRef","current","user","setUser","loggedIn","setLoggedIn","self","logged_in","Popover","trigger","onToogle","setOpenBlockMenuRef","anchorRef","open","setOpen","setOpenExternal","newOpen","closePopover","Math","random","undefined","ref","onClick","prevOpen","style","pointerEvents","isOpen","Portal","display","position","top","right","bottom","left","zIndex","cursor","Popper","anchorEl","transition","placement","disablePortal","modifiers","name","enabled","options","altBoundary","rootBoundary","padding","TransitionProps","Fade","transformOrigin","PopoverMenu","paperProps","popoverProps","sx","paperPropsRest","Paper","maxWidth","maxHeight","overflow","background","elevation","MenuList","autoFocus","marginTop","close","Divider","opacity","marginBottom","MenuItem","className","ListItemIcon","Close","ListItemText","blockTypeIcons","button","divider","checkbox","page","person","redirect","default_types","AddMenuContent","createBlock","types","AddMenu","useArchiveBlock","archive","SubMenu","disabled","parentMenuIsOpen","label","triggerProps","header","MenuListProps","onOpen","triggerRef","isSubMenuOpen","setIsSubMenuOpen","toggleSubmenu","closeSubmenu","justifyContent","ArrowRight","marginRight","Menu","anchorOrigin","vertical","horizontal","disableAutoFocus","disableEnforceFocus","onClose","ListSubheader","whiteSpace","lineHeight","margin","backgroundColor","typeIcons","defaultTypeOptions","colorOptions","default","yellow","green","red","blue","colorOptionsKeys","getColor","renderedColor","setProperty","setType","typeOptions","onRemoveRow","addRowBefore","onArchivedToggle","onReloadContext","computed","active","text_style","roles","canEdit","archived","setArchived","archiveBlock","createChildBlock","parent","toggleArchiveBlock","newArchived","toggleActive","metadata","typeName","selected","thisColor","placeholder","defaultValue","onBlur","target","thisStyle","Add","VisibilityOff","Visibility","Unarchive","Archive","component","Link","to","ListItem","paddingTop","paddingBottom","primary","secondary","modified","replace","DataBothWays","onTransmit","onReceive","draggable","bothwayRef","unlistenTransmit","addListeners","event","transmat","Transmat","setData","unlistenReceive","hasType","accept","payload","getData","preventDefault","obs","TransmatObserver","entries","entry","classList","toggle","classes","drag_over","isTarget","drag_active","isActive","observe","disconnect","tabIndex","getMD","md","mdit","html","xhtmlOut","linkify","typographer","breaks","use","kbd","emoji","renderInlineMarkdown","renderInline","twemoji","folder","ext","base","ViewerTextCard","locales","__html","setHtml","textWithHtml","defaultProps","dir","dangerouslySetInnerHTML","ViewerButtonCard","actions","action","colorStyles","hasClickAction","href","click","ViewerDividerLine","styles","ViewerCheckboxCard","checked","checkboxStyle","verticalAlign","paddingInlineEnd","CheckBox","CheckBoxOutlineBlank","ViewerLine","link","setLink","newLink","triggerProperties","triggerType","actionProperties","actionType","path","useBlockTrigger","title","cron","isSquareIcon","icon_url","icon","coverphoto","iconComponent","square","round","backgroundImage","domains","backend","encodeURIComponent","alt","cardOnClick","cardLink","root","alignItems","onClickProps","useMutation","option","reject","ViewerAuto","size","dragable","mutationFunction","movingBlock","movingBlockId","newParentId","newIndex","useLoadBlocks","handleLoadBlocks","errors","blocks","treeWalker","getViewportHeight","max","documentElement","clientHeight","innerHeight","treeRoots","stack","unshift","nestingLevel","node","f","pop","isLeaf","push","BlockRow","index","toggleOpenById","refetchData","showBlockMenu","blockMenuIsOpen","setBlockMenuIsOpen","toggleOpen","onBlockMenuToogle","newValue","force","rowContent","flexGrow","blockRowActions","flexShrink","inset","flexDirection","marginLeft","minWidth","blockRow","fakeHover","getFilteredTypes","BlockTree","scrollContainer","outerTreeRef","innerTreeRef","treeRef","outerHeight","setOuterHeight","bottomMargin","setBottomMargin","nodes","setNodes","openById","setOpenById","treeNodes","setTreeNodes","treeNodesFiltered","setTreeNodesFiltered","searchString","setSearchString","prevFetchArguments","onlyShowWithEditPermissions","setOnlyShowWithEditPermissions","setTypes","filteredTypes","viewportHeight","setHeight","timeoutId","resizeListener","clearTimeout","useViewportHeight","updateHeight","outerBounds","getBoundingClientRect","fullHeight","isNaN","newHeight","min","useScrollPosition","updateTree","parentBlock","find","n","buildTree","flatTree","walker","done","next","new_done","getFlatTree","loadBlocks","loadedBlocks","filtered","searchStringLower","toLowerCase","handleSearch","toggleType","type2toggle","newTypes","values","every","refetchDataWithFilter","row","onChange","FilterList","oldArchived","oldOnlyShowWithEditPermissions","disableWidth","itemData","itemCount","innerRef","itemSize","overflowY","overflowX","itemKey","textAlign","fontWeight","SidebarContent","mounted","showBlockTree","setShowBlockTree","efficientSetShowBlockTree","func","wait","immediate","timeout","context","this","arguments","later","apply","callNow","debounce","toggleSidebar","useSidebarContext","matchesStartpage","useMatch","navigate","useNavigate","gottenBlock","scrollContainerRef","headerBar","MenuOpen","frontend","Help","location","Logout","Login","rel","SidebarContext","createContext","SidebarProvider","realOpen","oldOpen","Provider","Sidebar","iOS","navigator","test","userAgent","isDesktop","SwipeableDrawer","anchor","disableBackdropTransition","disableDiscovery","boxSizing","border","PaperProps","Main","main","sidebarWidth","useLoadBlock","handleLoadBlock","loadedBlock","useBlockMatchesRoles","handleLoadRoles","blockMatchesRoles","Header","rightActions","notificationBanner","parentId","parentBlocks","setParentBlocks","siblingBlocks","setSiblingBlocks","loadParentBlocks","loadSiblingBlocks","roots","leftActions","Home","MoreHoriz","ErrorPage","errorName","description","buttons","getInLineRangeLength","element","whichLine","normalize","getSelection","selection","range","rangeCount","getRangeAt","clonedRange","cloneRange","selectNodeContents","setEnd","endContainer","endOffset","cloneContents","rangeLength","childNodes","nodeType","detach","getCaretPosition","cs","getComputedStyle","paddingY","parseFloat","borderY","borderTopWidth","borderBottomWidth","elementHeight","offsetHeight","offset","getOffset","caretOffset","getCaretOffset","inFirstLine","inLastLine","caretPositionFromStart","textContent","nodeName","getRangeLengthWithLinebreaks","textLength","innerText","caretPositionFromEnd","positionFromLineStart","positionFromStart","positionFromEnd","HtmlInput","linebreaks","onError","onInputRef","onGoToPrevInput","onGoToNextInput","onSplitText","onMergeToPrevInput","onMergeFromNextInput","inputRef","textRef","textRefValue","fakeDefaultValue","setFakeDefaultValue","updateText","newHtmlValue","temporalDivElement","innerHTML","stripHtml","handleTextChange","trim","handleTextBlur","keyDownHandler","shiftKey","execCommand","caret","start","end","texts","handlePaste","originalEvent","clipboardData","onKeyDown","onInput","onPaste","rebuild_textarea","show_placeholder","contentEditable","copyTextToClipboard","clipboard","writeText","info","err","textArea","body","appendChild","focus","select","msg","removeChild","fallbackCopyTextToClipboard","SharingEditor","defaultBlock","setPath","initialPath","savePath","newPath","newProperties","Modal","hideBackdrop","backdrop","dialog","inputWrapper","paddingRight","linebreak","input","marginInlineStart","marginInlineEnd","_","en","de","es","pt","fr","it","nl","da","sv","nb","fi","mt","pl","ru","bg","tr","ar","el","ro","sl","localesArray","nativeName","defaultOptions","LocaleSelect","changedLocale","setChangedLocale","handleLocaleChange","newLocale","mdiTranslate","toUpperCase","InputWithLocal","reorderHandle","actionButton","dataset","changedValue","setChangedValue","handleBlur","changes","event_or_value","input_with_local","Row","subDefaultValue","render","handleRowChange","isReorderable","handleAddRow","handleRemoveRow","showReorderControls","reorderLabel","showActionButton","hasOnlyOneRow","addRowByIndex","draggableId","tmp_id","isDragDisabled","disableInteractiveElementBlocking","shouldRespectForcePress","provided","draggableProps","form","inlineRowButton","dragHandleButton","dragHandleProps","addRowAfter","getIndex","eventOrIndex","Repeater","addDefaultValue","addButtonText","hideAddButton","prependNewItems","rows","setRows","internalAddDefaultValue","tmp_defaultValue","uuidv4","new_rows","splice","rows_from_onChange","addButton","addRowButton","onDragEnd","destination","source","list","startIndex","endIndex","from","removed","reorder","droppableId","isDropDisabled","droppableProps","SimpleTranslationRepeater","onSaveProperty","isFirst","onRepeaterChange","newTranslations","translation","onBlockLocaleChange","block2display","gap","minHeight","repeater_props","other_repeater_props","InputWithLocal_props","TranslationEditor","setBlocks","ids2load","contentBlocks","loadContentBlocks","newBlocks","onSaveChildProperty","blockIndex","findIndex","flatMap","attr","FancyInput","setError","split","email_regex","emails_regex","EmailInput","multiple","isSubmittable","emails","match","LocalizedRole","role","RolesMenu","changeRole","removePermission","setAnchorEl","handleClose","currentTarget","Edit","Delete","sortPermissions","permissions","owner","p","sort","b","email","localeCompare","special","other","PermissionsEditor","defaultPermissions","user_data","user_email","inputRepaintKey","setInputRepaintKey","setPermissions","newEmails","setNewEmails","newRole","setNewRole","setNewPermission","newPermissions","obj_new","permission","blockPermissions","addPermissions","newEmail","addNewPermissionFromInput","oldInputRepaintKey","doesNotHaveVoltEuropa","doesNotHavePublic","menuButton","KeyboardArrowDown","permissionRow","ownerInfo","CheckboxInput","setChecked","publishChanges","checkBlock","uncheckBlock","MultiButton","ariaLabel","items","choosen","setChoosen","handleClick","url_regex","is_email_not_url_regex","UrlInput","setText","schema_parts","schema","shift","after_schema","coverphotoValue","iconValue","onUrlChange","newUrl","isAbsoluteUrlRegexp","RegExp","coverphotoValueUrl","coverphotoIsSet","iconIsSet","coverphotoIsNotSet","iconIsNotSet","button_wrapper","changeCoverphotoButton","volt_bonn_thumb","welcome_to_volt_thumb","plakatschlange_thumb","portugal_thumb","aktion_thumb","src","iconValueUrl","iconWrapper","no_image","changeIconButton","PathInput","onSubmit","allowExisting","checkPath","handleCheckPath","useCheckPath","newText","isOkay","TriggerInput","setProperties","updateProperty","propertyKey","newPropertyValue","propertyTypes","morePropsInput","flexWrap","ActionInput","defaultProperties","silent","imprint","privacy_policy","tags","pronouns","publishProperties","propertiesFrameContent","properties_row","main_headline","paddingLeft","propertiesFrame","InlineEditorBlockText","onSaveBlock","onAddRowAfter","publishTextChange","text_style_class","InlineEditorBlockButton","InlineEditorBlockRedirect","triggerPathRef","triggerPath","setTriggerPath","linkRef","paddingInlineStart","InlineEditorBlockDivider","InlineEditorBlockCheckbox","saveChecked","InlineEditorBlockPerson","InlineEditorBlockPage","InlineEditorBlockInbetweenComponent","InlineEditorBlock","onRemoveSelf","setBlock","saveBlockCallback","changeType","saveProperty","propertyName","handleBlockChange","callback","onArchiveToggle","newArchivedValue","block_input","form_active","form_deactivated","addTmpIds","getFirstLineStartNode","getLastLineStartNode","reverse","lastLineNode","childNode","thisChildNodes","moveCursorToOffsetInLine","contentEditableElement","lastLineStartNode","lastLineStartNodeLength","createRange","setStart","collapse","sel","removeAllRanges","addRange","ContentEditor","contentConfigs_Ref","contentConfigs","inputRefs_Ref","inputRefs","updateCounter","setUpdateCounter","setAutoFocus","firstLineStartNode","newContentConfigs","old","loadMissingBlocks","saveInputRef","newInputRefs","goToPrevInput","prevInputRef","thisIndex","goToNextInput","nextInputRef","focusLastLine","lastInputRef","newContentConfig","oldContentConfig","clonedContentConfigs","prev_index","prev_contentConfig","prev_tmp_id","this_block","prev_block","new_prev_block","savedPrevBlock","new_tmp_id","next_index","this_old_contentConfig","next_block","new_block","savedBlock","splitText","firstBlock","secondBlock","savedFirstBlock","savedSecondBlock","nextContentConfig","handleRemoveSelf","filteredContentConfigs","boxShadow","Tooltip","PageEditor","isSharingEditorOpen","setIsSharingEditorOpen","openSharingEditor","closeSharingEditor","isTranslationEditorOpen","setIsTranslationEditorOpen","openTranslationEditor","closeTranslationEditor","isPermissionsEditorOpen","setIsPermissionsEditorOpen","openPermissionsEditor","closePermissionsEditor","saveType","newType","saveProperties","saveContent","newContent","savePermissions","manuallySaveEverything","rightHeaderActions","editor","Helmet","Editor","loadBlock","loadedTheBlock","useParams","setBlockInternal","setCanEdit","matchesRoles","app","spine_aligned","contentWrapper","Viewer","loadingTheBlock","setContentBlocks","possibleLocales","setPossibleLocales","setLocales","canView","setCanView","newLoadedBlock","loadedContentBlocks","newPossibleLocales","Set","thisBlock","t","viewer","coverphoto_url","titleWithRenderedMarkdown","contentBlock","App","useLocation","customLocation","setCustomLocation","slugAndIdMatch","pathname","slugOrId","suffix","newPathname","isStartpage","_supportedLocales_","_defaultLocale_","fetchMessages","fetch","messages","FluentResource","createMessagesGenerator","all","fetched","reduce","cur","assign","generateBundles","bundle","FluentBundle","addResource","AppLocalizationProvider","onLocaleChange","ReactLocalization","getDefaultBundles","bundles","setBundles","new_bundles","loadBundles","process","env","client","ApolloClient","uri","cache","InMemoryCache","credentials","watchQuery","fetchPolicy","errorPolicy","Start","languages","setUserLocales","currentLocale","setCurrentLocale","umami","systemLocales","language","trackEvent","handleLanguageChange","handleCurrentLocalesChange","prefersDarkMode","theme","useMemo","createTheme","palette","mode","ApolloProvider","ThemeProvider","variantSuccess","snackbarClasses","snackbar","success","variantError","variantWarning","warning","variantInfo","domRoot","getElementById","onLanguageChange","ReactDOM"],"mappings":"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","file":"static/js/main.e68cec40.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"SidebarContent_content__RAi8X\",\"header\":\"SidebarContent_header__1pYRG\",\"headerBar\":\"SidebarContent_headerBar__2xkje\",\"scrollContainer\":\"SidebarContent_scrollContainer__2eS9U\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"drag_over\":\"DataTransmat_drag_over__3XVzh\",\"drag_active\":\"DataTransmat_drag_active__2nwCM\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"Editor_app__3WzMm\",\"spine_aligned\":\"Editor_spine_aligned__1h8Ra\",\"contentWrapper\":\"Editor_contentWrapper__1cY6-\",\"editor\":\"Editor_editor__2hX0g\",\"loadingContent\":\"Editor_loadingContent__2fqdK\",\"editor_form_row\":\"Editor_editor_form_row__17Pul\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"TranslationEditor_dialog__YL0sv\",\"backdrop\":\"TranslationEditor_backdrop__hfIzh\",\"inputWrapper\":\"TranslationEditor_inputWrapper__3aVMH\",\"input\":\"TranslationEditor_input__3U2bK\",\"actions\":\"TranslationEditor_actions__3dTaz\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"blockRow\":\"BlockTree_blockRow__80Vim\",\"blockRowActions\":\"BlockTree_blockRowActions__GDOGf\",\"fakeHover\":\"BlockTree_fakeHover__TKaWl\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__3mObx\",\"headerBar\":\"Header_headerBar__2YU41\",\"notificationBanner\":\"Header_notificationBanner__104SP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"App_app__3hbGO\",\"isStartpage\":\"App_isStartpage__1Q6rs\"};","const { negotiateLanguages } = require('@fluent/langneg')\n\nfunction fluentByObject(object = {}, userLocales = ['en']){\n  const supportedLocales = Object.keys(object)\n\n  if (supportedLocales.length === 0) {\n    return null\n  }\n\n  const lookupedLocale = negotiateLanguages(\n    userLocales,\n    supportedLocales,\n    {\n      defaultLocale: supportedLocales[0],\n      strategy: 'lookup',\n    }\n  )\n\n  if (lookupedLocale.length === 0) {\n    return null\n  }\n\n  return object[lookupedLocale[0]]\n}\n\nfunction fluentByArray(array = [], userLocales = ['en'], key = 'locale') {\n  const supportedLocales = array.map(item => item[key]).filter(Boolean)\n\n  if (supportedLocales.length === 0) {\n    return null\n  }\n\n  const lookupedLocale = negotiateLanguages(\n    userLocales,\n    supportedLocales,\n    {\n      defaultLocale: supportedLocales[0],\n      strategy: 'lookup',\n    }\n  )\n\n  if (lookupedLocale.length === 0) {\n    return null\n  }\n\n  return array.filter(item => item[key] === lookupedLocale[0])\n}\n\nfunction fluentByAny(any = '', userLocales = ['en'], fallback = '') {\n  if (Array.isArray(any)) {\n    const result = fluentByArray(any, userLocales)\n    if (Array.isArray(result) && result.length > 0) {\n      any = result[0].value\n    }\n  } else if (typeof any === 'object') {\n    any = fluentByObject(any, userLocales)\n  }\n  if (typeof any !== 'string') {\n    any = fallback\n  }\n  return any\n}\n\nmodule.exports = {\n  fluentByObject,\n  fluentByArray,\n  fluentByAny,\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"Sidebar_main__1MCX5\",\"open\":\"Sidebar_open__gnBQb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"PageEditor_app__26Zo3\",\"spine_aligned\":\"PageEditor_spine_aligned__2i6Wu\",\"contentWrapper\":\"PageEditor_contentWrapper__WlUIr\",\"editor\":\"PageEditor_editor__U1pPN\",\"type_redirect\":\"PageEditor_type_redirect__2KPht\",\"loadingContent\":\"PageEditor_loadingContent__1YK7g\",\"editor_form_row\":\"PageEditor_editor_form_row__j4vjp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"rebuild_textarea\":\"HtmlInput_rebuild_textarea__ZfRzZ\",\"show_placeholder\":\"HtmlInput_show_placeholder__hM8g2\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ViewerAuto_root__1p6KG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input_with_local\":\"InputWithLocal_input_with_local__3qqYa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"error\":\"FancyInput_error__2DFWE\"};","function getImageUrl(imageObj) {\n  if (\n    typeof imageObj === 'object'\n    && imageObj !== null\n    && !Array.isArray(imageObj)\n  ) {\n    if (imageObj.type === 'url') {\n      return imageObj.url || ''\n    }\n  }\n\n  return ''\n}\n\n\n\nfunction hexToRGBArray(color) {\n  if (color.startsWith('#')) {\n    color = color.substring(1)\n  }\n\n  if (color.length === 3) {\n    color = color.charAt(0) + color.charAt(0) + color.charAt(1) + color.charAt(1) + color.charAt(2) + color.charAt(2);\n  } else if (color.length !== 6) {\n    throw(new Error('Invalid hex color: ' + color));\n  }\n\n  let rgb = [];\n  for (var i = 0; i <= 2; i++) {\n    rgb[i] = parseInt(color.substr(i * 2, 2), 16);\n  }\n\n  return rgb;\n}\nfunction luma(color) { \n  // color can be a hex string or an array of RGB values 0-255\n  const rgb = (typeof color === 'string') ? hexToRGBArray(color) : color;\n  return (0.2126 * rgb[0]) + (0.7152 * rgb[1]) + (0.0722 * rgb[2]); // SMPTE C, Rec. 709 weightings\n}\nfunction getContrastingColor(color) {\n  // source: https://stackoverflow.com/questions/635022/calculating-contrasting-colours-in-javascript\n  // exact answer: https://stackoverflow.com/a/6511606/2387277\n  // example: https://jsfiddle.net/thomasrosen/9njo6t7s/20/\n  \n  return (luma(color) >= 165) ? '000' : 'fff';\n}\n\n\n\n// function randomHexColor () {\n//   let color = ''\n//   for (let i = 0; i < 6; i++){\n//     const random = Math.random()\n//     const bit = (random * 16) | 0\n//     color += (bit).toString(16)\n//   }\n//   return '#'+color\n// }\n\n\n\nfunction colorToRGBA(color) {\n  // source: https://stackoverflow.com/questions/1573053/javascript-function-to-convert-color-names-to-hex-codes\n  // source: https://stackoverflow.com/a/24390910/2387277\n\n  // Returns the color as an array of [r, g, b, a] -- all range from 0 - 255\n  // color must be a valid canvas fillStyle. This will cover most anything\n  // you'd want to use.\n  // Examples:\n  // colorToRGBA('red')  # [255, 0, 0, 255]\n  // colorToRGBA('#f00') # [255, 0, 0, 255]\n  var cvs, ctx;\n  cvs = document.createElement('canvas');\n  cvs.height = 1;\n  cvs.width = 1;\n  ctx = cvs.getContext('2d');\n  ctx.fillStyle = color;\n  ctx.fillRect(0, 0, 1, 1);\n  return ctx.getImageData(0, 0, 1, 1).data;\n}\nfunction byteToHex(num) {\n    // Turns a number (0-255) into a 2-character hex number (00-ff)\n    return ('0'+num.toString(16)).slice(-2);\n}\nfunction colorToHex(color) {\n    // Convert any CSS color to a hex representation\n    // Examples:\n    // colorToHex('red')            # '#ff0000'\n    // colorToHex('rgb(255, 0, 0)') # '#ff0000'\n    var rgba, hex;\n    rgba = colorToRGBA(color);\n    hex = [0,1,2].map(\n        function(idx) { return byteToHex(rgba[idx]); }\n        ).join('');\n    return \"#\"+hex;\n}\n\n\n\nfunction getBlockColor(block) {\n  const colors = {\n    color: null,\n    colorRGB: null,\n    contrastingColor: null,\n    contrastingColorRGB: null,\n  }\n\n  if (block.hasOwnProperty('properties') && block.properties.hasOwnProperty('color') && !!block.properties.color) {\n    const defaultColors = ['purple', 'red', 'green', 'blue', 'yellow']\n    let newColor = block.properties.color\n\n    if (defaultColors.includes(newColor)) {\n      colors.color = `var(--${newColor})`\n      colors.colorRGB = `var(--${newColor}-rgb)`\n      colors.contrastingColor = `var(--on-${newColor})`\n      colors.contrastingColorRGB = `var(--on-${newColor}-rgb)`\n    } else {\n      if (newColor.startsWith('#')) {\n        if (newColor.length !== 4 && newColor.length !== 7) {\n          newColor = null\n        }\n      } else {\n        const parsedColor = colorToHex(newColor)\n        if (parsedColor === '#000000' && newColor !== 'black') {\n          newColor = null\n        } else {\n          newColor = parsedColor\n        }\n      }\n\n      if (newColor) {\n        colors.color = newColor\n        const colorRGB = hexToRGBArray(newColor)\n        colors.colorRGB = colorRGB.join(', ')\n        colors.contrastingColor = '#'+getContrastingColor(newColor)\n        colors.contrastingColorRGB = hexToRGBArray(colors.contrastingColor)\n      }\n    }\n  }\n\n  return colors\n}\n\nmodule.exports = {\n  getImageUrl,\n  getBlockColor,\n}\n","var map = {\n\t\"./de.ftl\": [\n\t\t326,\n\t\t3\n\t],\n\t\"./en.ftl\": [\n\t\t327,\n\t\t4\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 315;\nmodule.exports = webpackAsyncContext;","import { useState, useEffect } from \"react\";\n\nconst useMediaQuery = (query) => {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    if (media.matches !== matches) {\n      setMatches(media.matches);\n    }\n    const listener = () => setMatches(media.matches);\n    window.addEventListener(\"resize\", listener);\n    return () => window.removeEventListener(\"resize\", listener);\n  }, [matches, query]);\n\n  return matches;\n}\n\nexport default useMediaQuery;\n","import React from 'react'\nimport {\n  Localized as LocalizedOriginal,\n  // withLocalization,\n} from '@fluent/react'\nimport { negotiateLanguages } from '@fluent/langneg'\n\nimport { FluentContext } from '../../node_modules/@fluent/react/esm/context.js'\nimport fluentBy from './fluentBy.js'\n\nconst Localized = props => (\n  <LocalizedOriginal\n    key={props.id}\n    {...props}\n    elems={{\n      br: <br />,\n      ...props.elems,\n    }}\n  >\n    <React.Fragment>{props.children}</React.Fragment>\n  </LocalizedOriginal>\n)\n\n// A custom withLocalization to have an empty fallback.\n// It is nearly identical to the original.\nfunction withLocalization(Inner) {\n  function WithLocalization(props) {\n    const l10n = React.useContext(FluentContext)\n\n    const getString = (id, args, fallback) => l10n.getString(id, args, fallback || ' ')\n\n    const fluentByObject = (object, fallback) => {\n      if (!(!!fallback)) {\n        fallback = null\n      }\n\n      if (!!object) {\n        const globalSupportedLocales = l10n.supportedLocales || []\n        const thisSupportedLocales = Object.keys(object).filter(locale => globalSupportedLocales.includes(locale))\n\n        const currentLocales = negotiateLanguages(\n          l10n.userLocales,\n          thisSupportedLocales,\n          { defaultLocale: l10n.defaultLocale }\n        )\n\n        for (const locale of currentLocales) {\n          if (!!object[locale]) {\n            return object[locale]\n          }\n        }\n\n        return fallback\n      }\n\n      return fallback\n    }\n\n    return React.createElement(Inner, { fluentByObject, getString, ...props })\n  }\n  return WithLocalization\n}\n\n\nfunction translateBlock (block, userLocales, fallback) {\n  const {\n    properties = {}\n  } = block || {}\n  \n  let locale = properties.locale || 'en'\n  let text = properties.text || fallback || ''\n\n  if (!userLocales || !Array.isArray(userLocales)) {\n    userLocales = [locale]\n  }\n    \n  let translations = properties.translations || []\n  if (Array.isArray(translations)) {\n    translations = [\n      {\n        locale,\n        text,\n      },\n      ...translations,\n    ]\n\n    const correct_translations = fluentBy.fluentByArray(translations, userLocales, 'locale')\n    if (correct_translations.length > 0) {\n      text = correct_translations[0].text\n    }\n  }\n\n  return text\n}\n\nfunction useLocalization() {\n  const l10n = React.useContext(FluentContext)\n\n  const getString = (id, args, fallback) => l10n.getString(id, args, fallback || ' ')\n  const fluentByAny = (any = [], fallback = '') => fluentBy.fluentByAny(any, l10n.userLocales, fallback)\n\n  return {\n    ...l10n,\n    getString,\n    fluentByAny,\n    translateBlock,\n  }\n}\n\nexport {\n  negotiateLanguages,\n  withLocalization,\n  Localized,\n  Localized as default,\n  useLocalization,\n}\n\n/*\n\nimport { Localized, withLocalization } from '../Localized/'\n\n<Localized id=\"translation_id\" />\nexport default withLocalization(componentName)\n\n\nimport Localized from '../Localized/'\n<Localized id=\"translation_id\" />\n\nimport { withLocalization } from '@fluent/react'\nexport default withLocalization(componentName)\n\n*/\n","import { gql } from '@apollo/client'\n\nexport const saveBlock_Mutation = gql`\n  mutation saveBlock ($block: InputBlock!) {\n    saveBlock (block: $block)\n  }\n`\n\nexport const archiveBlock_Mutation = gql`\n  mutation archiveBlock ($_id: ObjectID!) {\n    archiveBlock (_id: $_id)\n  }\n`\n\nexport const unarchiveBlock_Mutation = gql`\n  mutation unarchiveBlock ($_id: ObjectID!) {\n    unarchiveBlock (_id: $_id)\n  }\n`\n\nexport const moveBlock_Mutation = gql`\n  mutation moveBlock ($movingBlockId: ObjectID!, $newParentId: ObjectID!, $newIndex: Int!) {\n    moveBlock(movingBlockId: $movingBlockId, newParentId: $newParentId, newIndex: $newIndex)\n  }\n`\n","import { useCallback } from 'react'\n\nimport { useLocalization } from '../fluent/Localized.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { saveBlock_Mutation } from '../graphql/mutations.js'\n\nimport { useSnackbar } from 'notistack'\n\nfunction removeProperty(obj, prop) {\n  // remove property from objects, arrays and sub-objects\n\n  obj = JSON.parse(JSON.stringify(obj)) // clone object to make everything mutable\n\n  if (obj.hasOwnProperty(prop)) {\n    delete obj[prop]\n  }\n  for (const i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (typeof obj[i] == 'object' && obj[i] !== null) {\n        removeProperty(obj[i], prop)\n      }\n    }\n  }\n\n  return obj\n}\n\nfunction useSaveBlock() {\n  const { getString } = useLocalization()\n\n  const apollo_client = useApolloClient()\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\n\n  const handleSaveBlock = useCallback((initialBlock) => {\n    return new Promise(final_resolve => {\n      let snackbarKey = null\n\n      let newBlock = {...initialBlock}\n      newBlock = removeProperty(newBlock, '__typename')\n      if (newBlock.hasOwnProperty('content') && Array.isArray(newBlock.content)) {\n        newBlock.content = newBlock.content.map(contentConfig => ({\n          blockId: contentConfig.blockId,\n        }))\n      }\n\n      const loadingDataPromise = new Promise(resolve => {\n        apollo_client.mutate({\n          mutation: saveBlock_Mutation,\n          variables: {\n            block: newBlock\n          },\n        })\n          .then(async ({ data }) => {\n            resolve('got-data')\n\n            if (snackbarKey !== null) {\n              closeSnackbar(snackbarKey)\n            }\n\n            if (typeof data.error === 'string') {\n              if (data.error === 'no_edit_permission') {\n                enqueueSnackbar(getString('path_editor_edit_permission_error'), {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 2000,\n                })\n              } else {\n                enqueueSnackbar('' + data.error, {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 2000,\n                })\n              }\n            } else {\n              final_resolve({\n                ...initialBlock,\n                _id: data.saveBlock,\n              })\n\n              enqueueSnackbar(getString('path_editor_status_saved'), {\n                variant: 'success',\n                preventDuplicate: false,\n                autoHideDuration: 2000,\n              })\n            }\n          })\n          .catch(async error => {\n            console.error(error)\n            resolve('got-error')\n\n            if (snackbarKey !== null) {\n              closeSnackbar(snackbarKey)\n            }\n\n            enqueueSnackbar(getString('path_editor_status_error_while_saving', {\n              error: error.message,\n            }), {\n              variant: 'error',\n              preventDuplicate: true,\n              autoHideDuration: 2000,\n            })\n          })\n      })\n\n      // Show a loading-info-snackbar if loading the data takes too long.\n      Promise.race([\n        new Promise(resolve => {\n          setTimeout(() => {\n            resolve('show-loading')\n          }, 300)\n        }),\n        loadingDataPromise,\n      ])\n        .then(response => {\n          if (response === 'show-loading') {\n            snackbarKey = enqueueSnackbar(getString('path_editor_status_started_saving'), {\n              persist: true,\n              preventDuplicate: true,\n            })\n          }\n        })\n        .catch(error => console.error)\n\n    })\n  }, [\n    enqueueSnackbar,\n    closeSnackbar,\n    apollo_client,\n    getString,\n  ])\n\n  return handleSaveBlock\n}\n\nexport default useSaveBlock\n","import { gql } from '@apollo/client'\n\nexport const getBlock_Query = gql`\n  query getBlock ($_id: ObjectID!) {\n    block (_id: $_id) {\n\t\t  _id\n\t\t  type\n\t\t  properties\n\t\t  content {\n        blockId\n        block {\n          _id\n          type\n          properties\n          content {\n            blockId\n          }\n          parent\n          metadata {\n            modified\n            modified_by\n          }\n          permissions\n          computed {\n            roles\n          }\n        }\n      }\n\t\t  parent\n\t\t  metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n      }\n    }\n  }\n`\n\nexport const getBlocks_Query = gql`\n  query getBlocks ($ids: [ObjectID], $types: [String], $archived: Boolean, $roots: [ObjectID]) {\n    blocks (ids: $ids, types: $types, archived: $archived, roots: $roots) {\n      _id\n      type\n      properties\n      content {\n        blockId\n      }\n      parent\n      metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n      }\n    }\n  }\n`\n\nexport const getSelf_Query = gql`\n  query getSelf {\n    self {\n\t\t  logged_in\n\t\t  user\n\t\t  blockId\n    }\n  }\n`\n\nexport const getSiblingBlocks_Query = gql`\n  query getSiblingBlocks ($_id: ObjectID!, $types: [String]) {\n    blocks: siblingBlocks (_id: $_id, types: $types) {\n      _id\n      type\n      properties\n    }\n  }\n`\n\nexport const getParentBlocks_Query = gql`\n  query getParentBlocks ($_id: ObjectID!) {\n    blocks: parentBlocks (_id: $_id) {\n      _id\n      type\n      properties\n      computed {\n        sort\n      }\n    }\n  }\n`\n\nexport const blockMatchesRoles_Query = gql`\n  query blockMatchesRoles ($_id: ObjectID!, $roles: [String]) {\n    blockMatchesRoles (_id: $_id, roles: $roles)\n  }\n`\n\nexport const checkPath_Query = gql`\n  query checkPath ($path: String!) {\n    checkPath (path: $path) {\n      isOkay\n      errors\n    }\n  }\n`\n","import { useState, useEffect, useRef } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getSelf_Query } from '../graphql/queries'\n\nexport default function useUser(forceRefetch = false) {\n  const mountedRef = useRef(false)\n  useEffect(() => {\n    mountedRef.current = true\n    return () => {\n      mountedRef.current = false\n    }\n  }, [])\n\n  const [user, setUser] = useState({})\n  const [loggedIn, setLoggedIn] = useState(false)\n\n  const apollo_client = useApolloClient()\n\n  useEffect(() => {\n    apollo_client.query({\n      query: getSelf_Query,\n    })\n      .then(async ({ data }) => {\n        if (mountedRef.current === true) {\n          if (data.hasOwnProperty('self')) {\n            setUser(data.self)\n            setLoggedIn(data.self.logged_in)\n          } else {\n            setUser({})\n            setLoggedIn(false)\n          }\n        }\n      })\n      .catch(error => {\n        console.error(error)\n        if (mountedRef.current === true) {\n          setUser({})\n          setLoggedIn(false)\n        }\n      })\n  }, [forceRefetch, setUser, setLoggedIn, apollo_client])\n\n  return {\n    ...user,\n    loggedIn,\n  }\n}\n","import { useState, useRef, useEffect, useCallback } from 'react'\n\nimport {\n  Portal,\n  Fade,\n  Popper,\n} from '@mui/material'\n\nconst randomString = () => (Math.random() + 1).toString(36).substring(7)\n\nfunction Popover ({\n  trigger,\n  children = () => {},\n  onToogle = () => {},\n  setOpenBlockMenuRef,\n}) {\n  const anchorRef = useRef(null)\n  const [open, setOpen] = useState(false)\n\n  const setOpenExternal = useCallback((newOpen) => {\n    setOpen(newOpen)\n  }, [ setOpen ])\n\n  useEffect(() => {\n    if (!!setOpenBlockMenuRef) {\n      setOpenBlockMenuRef.current = setOpenExternal\n    }\n  }, [ setOpenExternal, setOpenBlockMenuRef ])\n\n  const handlePopoverToggleClick = () => {\n    setOpen((prevOpen) => {\n      onToogle(!prevOpen)\n      return !prevOpen\n    })\n  }\n\n  const closePopover = () => {\n    onToogle(false)\n    setOpen(false)\n  }\n\n  const id = open ? 'popover-'+randomString() : undefined\n\n  return <>\n\n    {trigger(\n      {\n        ref: anchorRef,\n        'aria-describedby': id,\n        onClick: handlePopoverToggleClick,\n        style: {\n          pointerEvents: open ? 'none' : 'all',\n        },\n      }, {\n        isOpen: open,\n      }\n    )}\n\n  <Portal>\n    <div\n      onClick={closePopover}\n      style={{\n        display: (open ? 'block' : 'none'),\n        position: 'fixed',\n        top: 0,\n        right: 0,\n        bottom: 0,\n        left: 0,\n        zIndex: 1299,\n        cursor: 'pointer',\n      }}\n    />\n\n    <Popper\n      id={id}\n      open={open}\n      anchorEl={anchorRef.current}\n      transition\n      placement=\"bottom-start\"\n      disablePortal={true}\n      modifiers={[\n        {\n          name: 'flip',\n          enabled: true,\n          options: {\n            altBoundary: true,\n            rootBoundary: 'viewport',\n            padding: 8,\n          },\n        },\n      ]}\n      style={{\n        zIndex: 1300,\n      }}\n    >\n      {({ TransitionProps }) => (\n        <Fade {...TransitionProps}>\n          <div>\n          {\n            !!children && typeof children === 'function'\n            ? children({\n              open,\n              style: {\n                transformOrigin: 'top left',\n              },\n              closePopover,\n            })\n            : null\n          }\n          </div>\n        </Fade>\n      )}\n    </Popper>\n\n    </Portal>\n  </>\n}\n\nexport default Popover\n","import {\n  Paper,\n  MenuList,\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  Divider,\n} from '@mui/material'\n\nimport {\n  Close as CloseIcon,\n} from '@mui/icons-material'\n\nimport { Localized } from '../fluent/Localized.js'\n\nimport Popover from './Popover.js'\n\nexport default function PopoverMenu ({\n  trigger,\n  children,\n  onToogle,\n  paperProps = {},\n}) {\n  return <Popover\n    trigger={trigger}\n    onToogle={onToogle}\n  >\n    {({closePopover, open, ...popoverProps}) => {\n      const {\n        sx = {},\n        ...paperPropsRest\n      } = paperProps || {}\n\n      return (\n        <Paper\n          {...popoverProps}\n          sx={{\n            maxWidth: 380,\n            // height: 325,\n            maxHeight: 'calc(100vh - 32px)',\n            overflow: 'auto',\n            background: 'var(--background-contrast)',\n            color: 'var(--on-background)',\n            ...sx,\n          }}\n          elevation={8}\n          {...paperPropsRest}\n        >\n          <MenuList\n            autoFocus={true}\n            style={{\n              width: '100%',\n              maxWidth: '100%',\n              marginTop: '-8px',\n            }}\n          >\n            <div>\n\n              {typeof children === 'function' ? children({ isOpen: open, close: closePopover }) : children}\n\n              <Divider style={{opacity: 0.2, marginBottom:'8px'}}  />\n\n              <MenuItem className=\"roundMenuItem\" onClick={closePopover}>\n                <ListItemIcon>\n                  <CloseIcon />\n                </ListItemIcon>\n                <ListItemText>\n                  <Localized id=\"block_menu_close_menu\" />\n                </ListItemText>\n              </MenuItem>\n\n            </div>\n          </MenuList>\n        </Paper>\n    )}}\n  </Popover>\n}\n","\nimport {\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n} from '@mui/material'\n\nimport {\n  InsertDriveFileSharp as PageIcon,\n  LinkSharp as RedirectIcon,\n  PersonSharp as PersonIcon,\n  Crop75Sharp as ButtonIcon,\n  NotesSharp as TextIcon,\n  Remove as DividerIcon,\n  CodeSharp as CodeIcon,\n  CheckBox as CheckboxIcon,\n  // EditSharp as EditIcon,\n} from '@mui/icons-material'\n\nimport useUser from '../../hooks/useUser.js'\nimport PopoverMenu from '../PopoverMenu.js'\nimport { Localized } from '../../fluent/Localized.js'\n\nconst blockTypeIcons = {\n  button: <ButtonIcon />,\n  text: <TextIcon />,\n  code: <CodeIcon />,\n  divider: <DividerIcon />,\n  checkbox: <CheckboxIcon />,\n  page: <PageIcon />,\n  person: <PersonIcon />,\n  redirect: <RedirectIcon />,\n}\n\nconst default_types = [\n  'page',\n  'redirect',\n]\n\nfunction AddMenuContent({ createBlock, types }) {\n  if (!types || !Array.isArray(types)) {\n    types = default_types\n  }\n\n  return <>\n    {\n      types\n        .map(type => (\n          <MenuItem className=\"roundMenuItem\" key={type} onClick={() => createBlock({ type })}>\n            <ListItemIcon>\n              {blockTypeIcons[type]}\n            </ListItemIcon>\n            <ListItemText>\n              <Localized id={'block_menu_type_label_'+type} />\n            </ListItemText>\n          </MenuItem>\n        ))\n    }\n  </>\n}\n\nfunction AddMenu ({ trigger, createBlock, types }) {\n  const { loggedIn } = useUser()\n\n  if (loggedIn) {\n    return <PopoverMenu trigger={trigger}>\n      <div style={{ marginTop: '8px' }}></div>\n      <AddMenuContent createBlock={createBlock} types={types} />\n    </PopoverMenu>\n  }\n\n  return null\n}\n\nexport {\n  AddMenuContent,\n  AddMenu as default,\n}\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { archiveBlock_Mutation, unarchiveBlock_Mutation } from '../graphql/mutations.js'\n\nfunction useArchiveBlock() {\n  const apollo_client = useApolloClient()\n\n  const handleArchiveBlock = useCallback(({ _id, archive }) => {\n    return apollo_client.mutate({\n      mutation: archive ? archiveBlock_Mutation : unarchiveBlock_Mutation,\n      variables: { _id }\n    })\n  }, [ apollo_client ])\n\n  return handleArchiveBlock\n}\n\nexport default useArchiveBlock\n","import { useRef, useState, useCallback } from 'react'\n\nimport {\n  Divider,\n  Menu,\n  MenuItem,\n  ListItemIcon,\n  ListSubheader,\n} from '@mui/material'\n\nimport {\n  Close as CloseIcon,\n  ArrowRight as ArrowRightIcon,\n} from '@mui/icons-material'\n\nimport { Localized } from '../fluent/Localized.js'\n\n// INFO: Some code is copied from: https://github.com/azmenak/material-ui-nested-menu-item/blob/master/src/index.tsx\n\nexport default function SubMenu ({\n  disabled = false,\n  parentMenuIsOpen = true,\n  label = '',\n  triggerProps = {},\n  header = null,\n  MenuListProps = {},\n  position = 'right',\n  onOpen = () => {},\n  children,\n}) {\n  const triggerRef = useRef(null)\n  const [isSubMenuOpen, setIsSubMenuOpen] = useState(false)\n  const open = isSubMenuOpen && parentMenuIsOpen\n\n  const toggleSubmenu = useCallback(() => {\n    if (disabled !== true) {\n      const newOpen = !open\n      setIsSubMenuOpen(newOpen)\n      if (newOpen === true) {\n        onOpen()\n      }\n    }\n  }, [ setIsSubMenuOpen, open, onOpen, disabled ])\n\n  const closeSubmenu = useCallback(() => {\n    setIsSubMenuOpen(false)\n  }, [ setIsSubMenuOpen ])\n\n  return <>\n    <MenuItem\n      {...triggerProps}\n\n      disabled={disabled}\n\n      ref={triggerRef}\n      onClick={toggleSubmenu}\n      className=\"roundMenuItem\"\n      style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        ...triggerProps.style,\n      }}\n    >\n      <div style={{ display: 'flex' }}>\n        {label}\n      </div>\n      <ArrowRightIcon style={{ marginRight: '-10px' }} />\n    </MenuItem>\n    <Menu\n      // Set pointer events to 'none' to prevent the invisible Popover div from capturing events for clicks and hovers\n      style={{ pointerEvents: 'none' }}\n      anchorEl={triggerRef.current}\n      anchorOrigin={{\n        vertical: 'top',\n        horizontal: (position === 'right' ? 'right' : 'left'),\n      }}\n      transformOrigin={{\n        vertical: 'top',\n        horizontal: (position === 'right' ? 'left' : 'right'),\n      }}\n      open={open}\n      autoFocus={false}\n      disableAutoFocus\n      disableEnforceFocus\n      onClose={closeSubmenu}\n      sx={{\n        marginTop: '-8px', // align with parent menu\n      }}\n      MenuListProps={{\n        ...MenuListProps,\n        sx: {\n          maxWidth: 380,\n          maxHeight: 'calc(100vh - 32px)',\n          overflow: 'auto',\n          background: 'var(--background-contrast)',\n          color: 'var(--on-background)',\n          ...MenuListProps.sx,\n        },\n      }}\n    >\n      <div style={{pointerEvents: 'auto'}}>\n        {\n          header !== null\n            ? <ListSubheader\n                style={{\n                  whiteSpace: 'nowrap',\n                  lineHeight: '1',\n                  margin: '0',\n                  padding: '4px 16px 12px',\n                  backgroundColor: 'var(--background-contrast)',\n                  color: 'var(--on-background)',\n                }}\n              >\n                {header}\n              </ListSubheader>\n            : null\n        }\n\n        {children}\n\n        <Divider style={{opacity: 0.2}} />\n\n        <MenuItem className=\"roundMenuItem\" style={{marginTop:'8px'}} onClick={closeSubmenu}>\n          <ListItemIcon>\n            <CloseIcon />\n          </ListItemIcon>\n          <Localized id=\"block_menu_close_menu\" />\n        </MenuItem>\n      </div>\n    </Menu>\n  </>\n}\n","import { useCallback, useState } from 'react'\n\nimport {\n  Link,\n} from 'react-router-dom'\n\nimport {\n  MenuItem,\n  Divider,\n  ListItemIcon,\n  ListItemText,\n  ListItem,\n} from '@mui/material'\n\nimport {\n  Archive as ArchiveIcon,\n  Unarchive as UnarchiveIcon,\n\n  Visibility as VisibilityIcon,\n  VisibilityOff as VisibilityOffIcon,\n  // Delete as DeleteIcon,\n  // VerticalAlignTop as VerticalAlignTopIcon,\n  // VerticalAlignBottom as VerticalAlignBottomIcon,\n  Add as AddIcon,\n  RepeatSharp as RepeatIcon,\n  // RemoveCircleSharp as RemoveCircleIcon,\n\n  InsertDriveFileSharp as PageIcon,\n  LinkSharp as RedirectIcon,\n  // PersonSharp as PersonIcon,\n  Crop75Sharp as ButtonIcon,\n  NotesSharp as TextIcon,\n  // CodeSharp as CodeIcon,\n  Remove as DividerIcon,\n  // CheckBox as CheckboxIcon,\n\n  PreviewSharp as ViewIcon,\n  EditSharp as EditIcon,\n\n  FormatSizeSharp as TextStyleIcon,\n  PaletteSharp as ColorIcon,\n  CircleSharp as ColorSwatchIcon,\n} from '@mui/icons-material'\n\nimport { Localized, withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport useArchiveBlock from '../../hooks/useArchiveBlock.js'\nimport useUser from '../../hooks/useUser.js'\n\nimport PopoverMenu from '../PopoverMenu.js'\nimport SubMenu from '../SubMenu.js'\nimport { AddMenuContent } from './AddMenu.js'\n\nconst typeIcons = {\n  button: <ButtonIcon />,\n  text: <TextIcon />,\n  // checkbox: <CheckboxIcon />,\n  // code: <CodeIcon />,\n  divider: <DividerIcon />,\n  page: <PageIcon />,\n  redirect: <RedirectIcon />,\n}\n\nconst defaultTypeOptions = [\n  'button',\n  'text',\n  // 'checkbox',\n  // 'code',\n  'divider',\n  'page',\n  'redirect',\n]\n\nconst colorOptions = {\n  default: 'var(--on-background)',\n  yellow: 'var(--yellow)',\n  green: 'var(--green)',\n  red: 'var(--red)',\n  blue: 'var(--blue)',\n}\nconst colorOptionsKeys = Object.keys(colorOptions)\nfunction getColor (color) {\n  if (colorOptions.hasOwnProperty(color)) {\n    return colorOptions[color]\n  } else {\n    const {\n      color: renderedColor\n    } = getBlockColor({\n      properties: {\n        color,\n      },\n    })\n\n    if (renderedColor) {\n      return renderedColor\n    }\n  }\n  \n  return color\n}\n\nfunction BlockMenu ({\n  block = {},\n  getString,\n\n  trigger,\n  onToogle,\n\n  setProperty,\n  setType,\n  typeOptions = defaultTypeOptions,\n  createBlock,\n\n  onRemoveRow = null,\n  addRowBefore = null,\n  // addRowAfter = null,\n  onArchivedToggle = null,\n  onReloadContext = null,\n}) {\n  const { loggedIn } = useUser()\n\n  const { _id = '', type = '', properties = {}, computed = {} } = block\n  const {\n    active = true,\n    text_style = null,\n    color = null,\n  } = properties\n  const {\n    roles = [],\n  } = (computed === null ? {} : computed)\n  const canEdit = loggedIn && (roles.includes('owner') || roles.includes('editor'))\n\n  const [archived, setArchived] = useState(properties.archived === true)\n  const archiveBlock = useArchiveBlock()\n\n  // const handleAddRowBefore = useCallback(() => {\n  //\n  //   // const newBlock = {\n  //   //   type,\n  //   // }\n  //\n  //   const newBlockId = ''\n  //\n  //   addRowBefore({\n  //     blockId: newBlockId,\n  //   })\n  // }, [ addRowBefore ])\n\n  const createChildBlock = useCallback(newBlock => {\n    if (typeof createBlock === 'function') {\n      createBlock({\n        ...newBlock,\n        parent: _id,\n      })\n      if (typeof onReloadContext === 'function') {\n        onReloadContext()\n      }\n    }\n  }, [createBlock, _id, onReloadContext])\n\n  const toggleArchiveBlock = useCallback(() => {\n    const newArchived = !archived\n    archiveBlock({ _id: block._id, archive: newArchived })\n      .then(() => {\n        setArchived(newArchived)\n        if (typeof onArchivedToggle === 'function') {\n          onArchivedToggle(newArchived)\n        }\n        if (typeof onReloadContext === 'function') {\n          onReloadContext()\n        }\n      })\n      .catch(console.error)\n  }, [archiveBlock, setArchived, archived, block, onArchivedToggle, onReloadContext])\n\n  const toggleActive = useCallback(() => {\n    if (typeof setProperty === 'function') {\n      setProperty('active', !active)\n    }\n  }, [ active, setProperty ])\n\n  const metadata = block.metadata || {}\n\n  let {\n    color: renderedColor\n  } = getBlockColor(block)\n\n  if (!renderedColor) {\n    renderedColor = 'transparent'\n  }\n\n  return <PopoverMenu\n    trigger={trigger}\n    onToogle={onToogle}\n  >\n    {({ open }) => (<div>\n\n      <div style={{ height: '8px' }}></div>\n\n      {\n        (\n          canEdit\n          && typeof setType === 'function'\n          && Array.isArray(typeOptions)\n          && typeOptions.length > 0\n        )\n        && <>\n          <SubMenu\n            disabled={type === 'person'}\n            parentMenuIsOpen={open}\n            label={<>\n              <ListItemIcon>\n                <RepeatIcon />\n              </ListItemIcon>\n              <Localized id=\"block_menu_choose_type_label\" />\n            </>}\n            header={<Localized id=\"block_menu_choose_type_label\" />}\n          >\n            {\n              typeOptions\n              .map(typeName => (\n                <MenuItem\n                  key={typeName}\n                  selected={typeName === type}\n                  onClick={() => setType(typeName)}\n                  className=\"roundMenuItem\"\n                >\n                  <ListItemIcon>\n                    {typeIcons[typeName]}\n                  </ListItemIcon>\n                  {getString(`block_menu_type_label_${typeName}`, typeName)}\n                </MenuItem>\n              ))\n            }\n          </SubMenu>\n          <Divider style={{ opacity: 0.2, marginTop: '8px', marginBottom: '8px' }} />\n        </>\n      }\n\n      {\n        (\n          canEdit\n          && typeof setProperty === 'function'\n        )\n        && <SubMenu\n          parentMenuIsOpen={open}\n          label={<>\n            <ListItemIcon>\n              <ColorIcon\n                style={{\n                  color: getColor(color),\n                }}\n              />\n            </ListItemIcon>\n            <Localized id=\"block_menu_choose_color_label\" />\n          </>}\n          header={<Localized id=\"block_menu_choose_color_label\" />}\n        >\n          {\n            colorOptionsKeys\n            .map(thisColor => (\n              <MenuItem\n                key={thisColor}\n                selected={thisColor === 'default' ? color === null : color === thisColor}\n                onClick={() => setProperty('color', thisColor === 'default' ? null : thisColor)}\n                className=\"roundMenuItem\"\n              >\n                <ListItemIcon>\n                  <ColorSwatchIcon\n                    style={{\n                      color: getColor(thisColor),\n                    }}\n                  />\n                </ListItemIcon>\n                {thisColor}\n              </MenuItem>\n            ))\n          }\n\n          <MenuItem\n            className=\"roundMenuItem\"\n            selected={color !== null && !colorOptionsKeys.includes(color)}\n          >\n            <ListItemIcon>\n              <ColorSwatchIcon\n                style={{\n                  color: renderedColor,\n                }}\n              />\n            </ListItemIcon>\n            <input\n              key={colorOptionsKeys.includes(color) ? color : 'custom'}\n              type=\"text\"\n              placeholder=\"#FFFFFF\"\n              defaultValue={color}\n              onBlur={e => setProperty('color', e.target.value)}\n              style={{\n                width: '160px',\n                margin: '0 calc(-1 * var(--basis)) 0 0',\n              }}\n            />\n          </MenuItem>\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof setProperty === 'function'\n          && type === 'text'\n        )\n        && <SubMenu\n          parentMenuIsOpen={open}\n          label={<>\n            <ListItemIcon>\n              <TextStyleIcon />\n            </ListItemIcon>\n            <Localized id=\"block_menu_choose_text_style_label\" />\n          </>}\n          header={<Localized id=\"block_menu_choose_text_style_label\" />}\n        >\n          {\n            [\n              // 'h1', // title\n              'h2', // heading\n              'h3', // subheading\n              'body', // body text. This is saved as null.\n              // 'caption',\n            ]\n            .map(thisStyle => (\n              <MenuItem\n                key={thisStyle}\n                selected={thisStyle === 'body' ? text_style === null : text_style === thisStyle}\n                onClick={() => setProperty('text_style', thisStyle === 'body' ? null : thisStyle)}\n                className=\"roundMenuItem\"\n              >\n                {getString(`block_menu_text_style_label_${thisStyle}`, thisStyle)}\n              </MenuItem>\n            ))\n          }\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof setProperty === 'function'\n        )\n        && <Divider style={{opacity: 0.2, marginTop:'8px', marginBottom:'8px'}} />\n      }\n\n      {/*\n        addRowBefore\n        && <MenuItem onClick={handleAddRowBefore}>\n          <ListItemIcon>\n            <VerticalAlignTopIcon />\n          </ListItemIcon>\n          <Localized id=\"block_menu_add_before\" />\n        </MenuItem>\n      */}\n\n      {/*\n        addRowAfter\n        && <MenuItem onClick={addRowAfter}>\n          <ListItemIcon>\n            <VerticalAlignBottomIcon />\n          </ListItemIcon>\n          <Localized id=\"block_menu_add_after\" />\n        </MenuItem>\n      */}\n\n      {\n        (\n          canEdit\n          && typeof createBlock === 'function' // It should be createBlock not createChildBlock as createBlock is the external function. createChildBlock does alsways exists.\n        )\n        && <SubMenu\n          parentMenuIsOpen={open}\n          label={<>\n            <ListItemIcon>\n              <AddIcon />\n            </ListItemIcon>\n            <Localized id=\"block_menu_create_child_block\" />\n          </>}\n        >\n          <AddMenuContent createBlock={createChildBlock} />\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof setProperty === 'function'\n        )\n        && <MenuItem className=\"roundMenuItem\" onClick={toggleActive}>\n          <ListItemIcon>\n            {\n              active\n              ? <VisibilityOffIcon />\n              : <VisibilityIcon />\n            }\n          </ListItemIcon>\n          {\n            active\n            ? <Localized id=\"block_menu_hide\" />\n            : <Localized id=\"block_menu_show\" />\n          }\n        </MenuItem>\n      }\n\n      {\n        (\n          canEdit\n          && typeof onArchivedToggle === 'function'\n        )\n        && <MenuItem className=\"roundMenuItem\" onClick={toggleArchiveBlock}>\n          <ListItemIcon>\n            {\n              archived === true\n              ? <UnarchiveIcon />\n              : <ArchiveIcon />\n            }\n          </ListItemIcon>\n          {\n            archived === true\n            ? <Localized id=\"block_menu_unarchive\" />\n            : <Localized id=\"block_menu_archive\" />\n          }\n        </MenuItem>\n      }\n            \n      {\n        canEdit\n        && <Divider style={{ opacity: 0.2, marginTop: '8px', marginBottom: '8px' }} />\n      }\n\n      {\n        (typeof _id === 'string' && _id !== '')\n        && <>\n          <MenuItem component={Link} to={`/${_id}/view`} className=\"roundMenuItem\" style={{ marginTop: '8px' }}>\n            <ListItemIcon>\n              <EditIcon />\n            </ListItemIcon>\n            <Localized id=\"view_block\" />\n          </MenuItem>\n\n          {\n            canEdit\n            && <MenuItem component={Link} to={`/${_id}/edit`} className=\"roundMenuItem\">\n              <ListItemIcon>\n                <ViewIcon />\n              </ListItemIcon>\n              <Localized id=\"edit_block\" />\n            </MenuItem>\n          }\n\n          <Divider style={{opacity: 0.2, marginTop:'8px', marginBottom:'8px' }} />\n        </>\n      }\n\n      {/*\n      <ListItem sx={{ paddingTop: '0', paddingBottom: '0' }}>\n        <ListItemText\n          primary={<Localized id=\"block_menu_info_created\" />}\n          secondary={(metadata.created || '').replace(/[TZ]/g, ' ')}\n        />\n      </ListItem>\n      */}\n      <ListItem sx={{ paddingTop: '0', paddingBottom: '0' }}>\n        <ListItemText\n          primary={<Localized id=\"block_menu_info_modified\" />}\n          secondary={(metadata.modified || '').replace(/[TZ]/g, ' ')}\n        />\n      </ListItem>\n      <ListItem sx={{ paddingTop: '0', paddingBottom: '0' }}>\n        <ListItemText\n          primary={<Localized id=\"block_menu_info_id\" />}\n          secondary={_id}\n        />\n      </ListItem>\n\n    </div>)}\n  </PopoverMenu>\n}\n\nexport default withLocalization(BlockMenu)\n","import { useRef, useEffect } from 'react'\n\nimport { Transmat, addListeners, TransmatObserver } from 'transmat'\nimport classes from './DataTransmat.module.css'\n\nexport function DataReceiver({ onReceive, style, className, children }){\n  const receiverRef = useRef(null)\n\n  useEffect(() => {\n    const unlisten = addListeners(receiverRef.current, 'receive', event => {\n      const transmat = new Transmat(event)\n      if (transmat.hasType('application/json') && transmat.accept()) {\n        const payload = transmat.getData('application/json')\n        if (typeof onReceive === 'function') {\n          onReceive({ data: JSON.parse(payload) })\n        }\n        event.preventDefault()\n      }\n    })\n\n    const obs = new TransmatObserver(entries => {\n      for (const entry of entries) {\n        const transmat = new Transmat(entry.event)\n        if (transmat.hasType('application/json')) { // TODO: accept more than just json\n          entry.target.classList.toggle(classes.drag_over, entry.isTarget)\n          entry.target.classList.toggle(classes.drag_active, entry.isActive)\n        }\n      }\n    })\n    obs.observe(receiverRef.current)\n\n    return () => {\n      unlisten()\n      obs.disconnect()\n    }\n  }, [ onReceive ])\n\n  return <div ref={receiverRef} style={style} className={className}>\n    {children}\n  </div>\n}\n\nexport function DataTransmiter({ onTransmit, draggable, style, className, children }){\n  const transmiterRef = useRef(null)\n\n  useEffect(() => {\n    return addListeners(transmiterRef.current, 'transmit', async event => {\n      const transmat = new Transmat(event)\n      if (typeof onTransmit === 'function') {\n        const options = await onTransmit(transmat)\n        if (\n          typeof options === 'object'\n          && options !== null\n          && !Array.isArray(options.data)\n          && typeof options.data === 'object'\n          && options.data !== null\n        ) {\n          transmat.setData(options.data)\n          // transmat.setData({\n          //   'text/plain': 'Hello world!',\n          //   'text/html': '<h1>Hello world!</h1>',\n          //   'text/uri-list': 'http://example.com',\n          //   'application/json': {foo:'bar'},\n          // })\n        }\n      }\n    })\n  }, [ onTransmit ])\n\n  return <div ref={transmiterRef} style={style} className={className} draggable={draggable ? 'true' : 'false'} tabIndex=\"0\">\n    {children}\n  </div>\n}\n\nexport function DataBothWays({ onTransmit, onReceive, draggable, style, className, children }){\n  const bothwayRef = useRef(null)\n\n  useEffect(() => {\n    const unlistenTransmit = addListeners(bothwayRef.current, 'transmit', async event => {\n      const transmat = new Transmat(event)\n      if (typeof onTransmit === 'function') {\n        const options = await onTransmit(transmat)\n        if (\n          typeof options === 'object'\n          && options !== null\n          && !Array.isArray(options.data)\n          && typeof options.data === 'object'\n          && options.data !== null\n        ) {\n          transmat.setData(options.data)\n          // transmat.setData({\n          //   'text/plain': 'Hello world!',\n          //   'text/html': '<h1>Hello world!</h1>',\n          //   'text/uri-list': 'http://example.com',\n          //   'application/json': {foo:'bar'},\n          // })\n        }\n      }\n    })\n\n    const unlistenReceive = addListeners(bothwayRef.current, 'receive', event => {\n      const transmat = new Transmat(event)\n      if (transmat.hasType('application/json') && transmat.accept()) {\n        const payload = transmat.getData('application/json')\n        if (typeof onReceive === 'function') {\n          onReceive({ data: JSON.parse(payload) })\n        }\n        event.preventDefault()\n      }\n    })\n\n    const obs = new TransmatObserver(entries => {\n      for (const entry of entries) {\n        const transmat = new Transmat(entry.event)\n        if (transmat.hasType('application/json')) { // TODO: accept more than just json\n          entry.target.classList.toggle(classes.drag_over, entry.isTarget)\n          entry.target.classList.toggle(classes.drag_active, entry.isActive)\n        }\n      }\n    })\n    obs.observe(bothwayRef.current)\n\n    return () => {\n      unlistenTransmit()\n      unlistenReceive()\n      obs.disconnect()\n    }\n  }, [ onTransmit, onReceive ])\n\n  return <div\n    ref={bothwayRef}\n    style={style}\n    className={className}\n    draggable={draggable ? 'true' : 'false'}\n    tabIndex=\"0\"\n  >\n    {children}\n  </div>\n}\n\n// Examples:\n//\n// <DataTransmiter\n//   draggable={true}\n//   style={{\n//     width: '100%',\n//     height: '200px',\n//     backgroundColor: 'blue',\n//   }}\n//   onTransmit={() => ({\n//     'text/plain': 'Hello world!',\n//     'text/html': '<h1>Hello world!</h1>',\n//     'text/uri-list': 'http://example.com',\n//     'application/json': {foo:'bar'},\n//   })}\n// >\n//   DataTransmiter\n// </DataTransmiter>\n//\n// <DataReceiver\n//   style={{\n//     width: '100%',\n//     height: '200px',\n//     backgroundColor: 'red',\n//   }}\n//   onReceive={data => console.info('received', data)}\n// >\n//   DataReceiver\n// </DataReceiver>\n","import mdit from 'markdown-it'\nimport kbd from 'markdown-it-kbd'\nimport emoji from 'markdown-it-emoji'\nimport twemoji from 'twemoji'\n\nfunction getMD(options){\n  // var hljs = require('highlight.js') // https://highlightjs.org/\n  const md = mdit({\n    html: false,\n    xhtmlOut: false,\n    linkify: true,\n    typographer: true,\n    breaks: false,\n    // highlight: function (str, lang) {\n    //   const language_obj = hljs.getLanguage(lang)\n    //   if (lang && language_obj) {\n    //     const language = language_obj.aliases[0]\n    //     return '<pre class=\"hljs language-'+language+'\"><code>' +\n    //       hljs.highlight(str, { language, ignoreIllegals: true }).value +\n    //     '</code></pre>';\n    //   } else {\n    //     const html = hljs.highlightAuto(str, { ignoreIllegals: true })\n    //     return '<pre class=\"hljs language-'+html.language+'\"><code>' +\n    //       html.value +\n    //     '</code></pre>';\n    //   }\n\n    //   return '<pre class=\"hljs\"><code>' + md.utils.escapeHtml(str) + '</code></pre>';\n    // }\n    ...options,\n  })\n\n  // md.disable([ 'heading', 'heading', 'lheading', 'paragraph', 'image' ])\n  md.use(kbd)\n  md.use(emoji)\n\n  return md\n}\n\nfunction renderInlineMarkdown(text, options = {}){\n  text = text || ''\n  // text = text.replace(/\\n/g, '<br>')\n  // text = text.replace(/\\t/g, '&emsp;')\n\n  text = text\n  .replace(/\\(TM\\)/gi, '™')\n  .replace(/\\(SM\\)/gi, '℠')\n  .replace(/\\(C\\)/gi, '©')\n  .replace(/\\(R\\)/gi, '®')\n\n  const md = getMD(options)\n  text = md.renderInline(text)\n\n  text = twemoji.parse(text, {\n    folder: 'svg',\n    ext: '.svg',\n    base: '/public/twemoji/assets/',\n    // callback: function(icon, options, variant) {\n    //   switch ( icon ) {\n    //     case 'a9':      // © copyright\n    //     case 'ae':      // ® registered trademark\n    //     case '2122':    // ™ trademark\n    //       return false\n    //     default:\n    //       return ''.concat(options.base, options.size, '/', icon, options.ext)\n    //   }\n    // }\n  })\n    \n  return text\n}\n\nexport {\n  renderInlineMarkdown,\n}\n","import { useState, useEffect } from 'react'\n\nimport { renderInlineMarkdown } from '../../markdown.js'\nimport { useLocalization } from '../../fluent/Localized.js'\n\nimport { getBlockColor } from '../../functions.js'\n\nfunction ViewerTextCard ({ block, style, locales }) {\n  const [html, setHtml] = useState({ __html: '' })\n\n  const { translateBlock } = useLocalization()\n  const text = translateBlock(block, locales, '')\n\n  useEffect(() => {\n    const textWithHtml = renderInlineMarkdown(text)\n    setHtml({ __html: textWithHtml })\n  }, [text, setHtml])\n  \n  const defaultProps = {\n    dir: 'auto',\n    style: {\n      whiteSpace: 'pre-wrap',\n      ...style,\n    },\n  }\n\n  const {\n    color,\n  } = getBlockColor(block)\n  if (color) {\n    defaultProps.style.color = color\n  }\n\n  let text_style = 'body'\n  if (block.properties.hasOwnProperty('text_style')) {\n    text_style = block.properties.text_style\n  }\n\n  let component = null\n  switch (text_style) {\n    case 'h1':\n      component = <h1\n        dangerouslySetInnerHTML={html}\n        {...defaultProps}\n      />\n      break\n    case 'h2':\n      component = <h2\n        dangerouslySetInnerHTML={html}\n        {...defaultProps}\n      />\n      break\n    case 'h3':\n      component = <h3\n        dangerouslySetInnerHTML={html}\n        {...defaultProps}\n      />\n      break\n    case 'caption':\n      component = <caption\n        dangerouslySetInnerHTML={html}\n        {...defaultProps}\n      />\n      break\n    default: // body\n      component = <p\n        dangerouslySetInnerHTML={html}\n        {...defaultProps}\n      />\n  }\n\n  return component\n}\n\nexport default ViewerTextCard\n","import { useState, useEffect } from 'react'\n\nimport { renderInlineMarkdown } from '../../markdown.js'\nimport { useLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nfunction ViewerButtonCard ({ block, actions = {}, locales }) {\n  const [html, setHtml] = useState({ __html: '' })\n\n  const { getString, translateBlock } = useLocalization()\n  const text = translateBlock(block, locales, getString('placeholder_main_headline'))\n\n  useEffect(() => {\n    const textWithHtml = renderInlineMarkdown(text, { linkify: false })\n    setHtml({ __html: textWithHtml })\n  }, [text, setHtml])\n\n  let url = ''\n  if (\n    block\n    && block.properties\n    && block.properties.trigger\n    && block.properties.action\n    && block.properties.action.url\n    && block.properties.trigger.type === 'click'\n    && block.properties.action.type === 'open_url'\n  ) {\n    url = block.properties.action.url\n  }\n\n  const {\n    color,\n    contrastingColor,\n  } = getBlockColor(block)\n\n  const colorStyles = {}\n  if (color) {\n    colorStyles['--button-background'] = color\n    colorStyles['--button-color'] = contrastingColor\n  }\n\n  const hasClickAction = actions.hasOwnProperty('click')\n\n  if (hasClickAction === false && url !== '') {\n    return <a href={url}>\n      <button\n        dir=\"auto\"\n        dangerouslySetInnerHTML={html}\n        className=\"default square\"\n        style={{\n          margin: '0',\n          whiteSpace: 'pre-wrap',\n          ...colorStyles,\n        }}\n      ></button>\n    </a>\n  }\n\n  if (hasClickAction === true && typeof actions.click === 'function') {\n    return <button\n      dir=\"auto\"\n      dangerouslySetInnerHTML={html}\n      className=\"default square\"\n      style={{\n        margin: '0',\n        whiteSpace: 'pre-wrap',\n        ...colorStyles,\n      }}\n      onClick={actions.click}\n    ></button>\n  }\n\n  return <button\n    dir=\"auto\"\n    dangerouslySetInnerHTML={html}\n    disabled=\"disabled\"\n    className=\"default square\"\n    style={{\n      margin: '0',\n      whiteSpace: 'pre-wrap',\n      ...colorStyles,\n    }}\n  ></button>\n}\n\nexport default ViewerButtonCard\n","import { getBlockColor } from '../../functions.js'\n\nexport default function ViewerDividerLine ({ block }) {\n  const {\n    color,\n  } = getBlockColor(block)\n\n  const styles = {}\n  if (color) {\n    styles['--on-background'] = color\n  }\n\n  return <hr style={styles} />\n}\n","import {\n  CheckBox as CheckBoxIcon,\n  CheckBoxOutlineBlank as CheckBoxOutlineBlankIcon,\n} from '@mui/icons-material'\n\nfunction ViewerCheckboxCard ({ block }) {\n  const text = block.properties.text || ''\n\n  const checked = Boolean(block.properties.checked)\n\n  const checkboxStyle = {\n    verticalAlign: 'middle',\n    paddingInlineEnd: 'var(--basis)',\n    height: 'calc(var(--font-add) + var(--basis))',\n    width: 'auto',\n  }\n\n  return <p dir=\"auto\">\n    {\n      checked\n      ? <CheckBoxIcon style={checkboxStyle} />\n      : <CheckBoxOutlineBlankIcon style={checkboxStyle} />\n    }\n    {text}\n  </p>\n}\n\nexport default ViewerCheckboxCard\n","import { useLocalization } from '../../fluent/Localized.js'\n\nimport { getImageUrl, getBlockColor } from '../../functions.js'\nimport useBlockTrigger from '../../hooks/useBlockTrigger.js'\n\nimport {\n  InsertDriveFile as PageIcon,\n  Face as PersonIcon,\n  LinkSharp as RedirectIcon,\n} from '@mui/icons-material'\n\nimport { Link } from 'react-router-dom'\n\nimport classes from './ViewerLine.module.css'\n\nfunction ViewerLine ({ block, actions = {}, locales }) {\n  const { getString, translateBlock } = useLocalization()\n\n  const { link } = useBlockTrigger({ block })\n\n  let title = translateBlock(block, locales, '')\n  if (title === '') {\n    const triggerProperties = ((block.properties || {}).trigger || {})\n    const triggerType = triggerProperties.type\n\n    if (triggerType === 'path') {\n      title = '/'+triggerProperties.path\n    } else if (block.type === 'redirect') {\n      if (triggerType === 'click') {\n        title = triggerProperties.blockId\n      } else if (triggerType === 'cron') {\n        title = triggerProperties.cron\n      } else if (triggerType === 'block_change') {\n        title = triggerProperties.blockId\n      } else if (Object.keys(triggerProperties).length > 0) {\n        title = JSON.stringify(triggerProperties)\n      } else {\n        title = getString('placeholder_main_headline')\n      }\n    } else {\n      title = getString('placeholder_main_headline')\n    }\n  }\n  \n  let isSquareIcon = false\n  let icon_url = getImageUrl(block.properties.icon)\n  if (!icon_url) {\n    isSquareIcon = true\n    icon_url = getImageUrl(block.properties.coverphoto)\n  }\n\n  let iconComponent = null\n  if (icon_url === '') {\n    switch (block.type) {\n      case 'person':\n        iconComponent = <PersonIcon className={classes.icon} />\n        break\n      case 'redirect':\n        iconComponent = <RedirectIcon className={classes.icon} />\n        break\n      default:\n      iconComponent = <PageIcon className={classes.icon} />\n    }\n  } else {\n    iconComponent = <div className={`${classes.icon} ${isSquareIcon ? classes.square : classes.round}`} style={{ backgroundImage: `url(${window.domains.backend}download_url?f=png&w=40&h=40&url=${encodeURIComponent(icon_url)})` }} alt={title}></div>\n  }\n\n\n\n  let cardOnClick = null\n  let cardLink = link\n\n  if (actions.hasOwnProperty('link')) {\n    if (typeof actions.link === 'string') {\n      cardLink = actions.link\n    }\n  } else if (actions.hasOwnProperty('click')) {\n    if (typeof actions.click === 'function') {\n      cardOnClick = actions.click\n    }\n  }\n\n  const {\n    color = 'inherit',\n    colorRGB = '--on-background-rgb',\n  } = getBlockColor(block)\n\n  if (typeof cardLink === 'string' && cardLink.length > 0) {\n    return <Link\n      to={cardLink}\n      title={title}\n      className={`clickable_card ${classes.root}`}\n      style={{\n        display: 'block',\n        cursor: 'pointer',\n        color,\n        '--on-background-rgb': colorRGB,\n      }}\n    >\n      <div style={{ display: 'flex', alignItems: 'center' }}>\n        {iconComponent}\n        <span dir=\"auto\" className={classes.title}>{title}</span>\n      </div>\n    </Link>\n  } else {\n    const onClickProps = {}\n    if (typeof cardOnClick === 'function') {\n      onClickProps.onClick = cardOnClick\n    }\n\n    return <div\n      {...onClickProps}\n      title={title}\n      className={`clickable_card ${classes.root}`}\n      style={{\n        cursor: typeof cardOnClick === 'function' ? 'pointer' : 'auto',\n        color,\n        '--on-background-rgb': colorRGB,\n      }}\n    >\n      <div style={{ display: 'flex', alignItems: 'center' }}>\n        {iconComponent}\n        <span dir=\"auto\" className={classes.title}>{title}</span>\n      </div>\n    </div>\n  }\n}\n\nexport default ViewerLine\n","import { useState, useEffect } from 'react' // useCallback\n// import { useNavigate } from 'react-router-dom'\n\nexport default function useBlockTrigger({ block = null }) {\n  const [link, setLink] = useState(null)\n  // const [onClick, setOnClick] = useState(null)\n\n  // let navigate = useNavigate()\n\n  useEffect(() => {\n    let newLink = null\n    // let newOnClick = null\n\n    if (block !== null) {\n      const blockId = block._id\n\n      const triggerProperties = ((block.properties || {}).trigger || {})\n      const triggerType = triggerProperties.type\n\n      const actionProperties = ((block.properties || {}).action || {})\n      const actionType = actionProperties.type\n\n      if (\n        triggerType === 'path'\n        || triggerType === 'click'\n      ) {\n        if (\n          actionType === 'open_url'\n          && typeof actionProperties.url === 'string'\n          && actionProperties.url.length > 0\n        ) {\n          const url = actionProperties.url || ''\n          newLink = url\n          // newOnClick = () => window.open(newLink, '_blank')\n        } else if (\n          actionType === 'render_block'\n          && typeof triggerProperties.path === 'string'\n          && triggerProperties.path.length > 0\n        ) {\n          if (\n            typeof actionProperties.blockId === 'string'\n            && actionProperties.blockId.length > 0\n          ) {\n            newLink = `/${triggerProperties.path}=${actionProperties.blockId}`\n            // newOnClick = () => navigate(newLink)\n          } else {\n            newLink = `/${triggerProperties.path}=${blockId}`\n            // newOnClick = () => navigate(newLink)\n          }\n        } else {\n          newLink = `/${blockId}/view`\n          // newOnClick = () => navigate(newLink)\n        }\n        // TODO: add support for other trigger types (run_script, ...)\n      } else {\n        newLink = `/${blockId}/view`\n        // newOnClick = () => navigate(newLink)\n      }\n    }\n\n    setLink(newLink)\n    // setOnClick(newOnClick)\n  }, [block, setLink]) // setOnClick, navigate\n\n  return { link } // onClick\n}\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\n\nfunction useMutation() {\n  const apollo_client = useApolloClient()\n\n  const handleMutation = useCallback(option => {\n    return new Promise((resolve,reject) => {\n      apollo_client.mutate(option)\n        .then(({ data }) => {\n          if (typeof data.error === 'string') {\n            reject(data.error)\n          } else {\n            resolve(data)\n          }\n        })\n        .catch(reject)\n    })\n  }, [ apollo_client ])\n\n  return handleMutation\n}\n\nexport default useMutation\n","import React, { useCallback } from 'react'\n\nimport { DataBothWays } from '../DataTransmat.js'\n\nimport ViewerTextCard from './ViewerTextCard.js'\nimport ViewerButtonCard from './ViewerButtonCard.js'\nimport ViewerDividerLine from './ViewerDividerLine.js'\nimport ViewerCheckboxCard from './ViewerCheckboxCard.js'\nimport ViewerLine from './ViewerLine.js'\n\nimport classes from './ViewerAuto.module.css'\n\nimport { moveBlock_Mutation } from '../../graphql/mutations.js'\nimport useMutation from '../../hooks/useMutation.js'\n\nfunction ViewerAuto ({ block = {}, actions = {}, size = 'card', dragable = false, ...props }) {\n  let component = null\n\n  const type = block.type || null\n\n  switch (type) {\n    case 'text':\n      component = <ViewerTextCard key={block._id} block={block} actions={actions} {...props} />\n      break\n    case 'button':\n      component = <ViewerButtonCard key={block._id} block={block} actions={actions} {...props} />\n      break\n    case 'divider':\n      component = <ViewerDividerLine key={block._id} block={block} actions={actions} {...props} />\n      break\n    case 'checkbox':\n      component = <ViewerCheckboxCard key={block._id} block={block} actions={actions} {...props} />\n      break\n    case 'page':\n      component = <ViewerLine key={block._id} block={block} actions={actions} {...props} />\n      break\n    case 'person':\n      component = <ViewerLine key={block._id} block={block} actions={actions} {...props} />\n      break\n    case 'redirect':\n      component = <ViewerLine key={block._id} block={block} actions={actions} {...props} />\n      break\n    default:\n      component = JSON.stringify(block) // <ViewerTextCard key={block._id} block={block} actions={actions} {...props} />\n  }\n\n  const mutationFunction = useMutation()\n\n  const onReceive = useCallback(({ data: movingBlock }) => {\n    if (movingBlock._id !== block._id) {\n      mutationFunction({\n        mutation: moveBlock_Mutation,\n        variables: {\n          movingBlockId: movingBlock._id,\n          newParentId: block._id,\n          newIndex: 0,\n        },\n      })\n        // .then(() => {\n        //   // TODO: reload sidebar\n        // })\n        .catch(console.error)\n    }\n  }, [ mutationFunction, block ])\n\n  return <DataBothWays\n    key={block._id}\n    draggable={dragable}\n    className={classes.root}\n    onTransmit={() => ({\n      data: {\n        // 'text/plain': 'Hello world!',\n        // 'text/html': '<h1>Hello world!</h1>',\n        // 'text/uri-list': 'http://example.com',\n        'application/json': block,\n      }\n    })}\n    onReceive={onReceive}\n  >\n    {component}\n  </DataBothWays>\n}\n\nexport default ViewerAuto\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlocks_Query } from '../graphql/queries'\n\nfunction useLoadBlocks() {\n  const apollo_client = useApolloClient()\n\n  const handleLoadBlocks = useCallback(variables => {\n    return new Promise(resolve => {\n      apollo_client.query({\n        query: getBlocks_Query,\n        variables,\n      })\n        .then(async ({ errors, data }) => {\n          if (Array.isArray(errors) && errors.length > 0) {\n            throw errors\n          } else if (Array.isArray(data.blocks)) {\n            resolve(data.blocks)\n          }else{\n            throw new Error('Unknown error while loading blocks.')\n          }\n        })\n        .catch(async error => {\n          console.error('error', error)\n          resolve([])\n        })\n    })\n  }, [apollo_client])\n\n  return handleLoadBlocks\n}\n\nexport default useLoadBlocks\n","import React, { useCallback, useEffect, useState, useRef } from 'react'\n// import { useLayoutEffect } from 'react'\nimport AutoSizer from 'react-virtualized-auto-sizer'\nimport { FixedSizeList } from 'react-window'\n\nimport { useScrollPosition } from '@n8tb1t/use-scroll-position'\n\nimport BlockMenu from './edit/BlockMenu.js'\nimport ViewerAuto from './view/ViewerAuto.js'\n\nimport { Localized, useLocalization } from '../fluent/Localized.js'\n\nimport classes from './BlockTree.module.css'\n\nimport {\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  Divider,\n} from '@mui/material'\n\nimport {\n  MoreHorizSharp as BlockMenuIcon,\n  ArrowDropDownSharp as ExpandLessIcon,\n  ArrowRightSharp as ExpandMoreIcon,\n\n  Replay as RequeryIcon,\n  FilterList as FilterListIcon,\n  Archive as ArchiveIcon,\n\n  // Search as SearchIcon,\n\n  InsertDriveFileSharp as PageIcon,\n  // AutoAwesomeSharp as ActionIcon,\n  LinkSharp as RedirectIcon,\n  PersonSharp as PersonIcon,\n  // Crop75Sharp as ButtonIcon,\n  // TitleSharp as HeadlineIcon,\n  // NotesSharp as TextIcon,\n  // Remove as DividerIcon,\n  EditSharp as EditIcon,\n} from '@mui/icons-material'\n\nimport useLoadBlocks from '../hooks/useLoadBlocks.js'\nimport useUser from '../hooks/useUser.js'\n\nimport PopoverMenu from './PopoverMenu.js'\n\nconst blockTypeIcons = {\n  page: <PageIcon />,\n  person: <PersonIcon />,\n  redirect: <RedirectIcon />,\n}\n\n\nconst minItemSize = 43\n\n// const getWidth = () => window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth\n// const getHeight = () => window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight\n\n// const getViewportWidth = () => Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)\nconst getViewportHeight = () => Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0)\n\nfunction useViewportHeight() {\n  // save current window width in the state object\n  let [height, setHeight] = useState(getViewportHeight())\n\n  // in this case useEffect will execute only once because\n  // it does not have any dependencies.\n  useEffect(() => {\n    // timeoutId for debounce mechanism\n    let timeoutId = null\n    const resizeListener = () => {\n      // prevent execution of previous setTimeout\n      clearTimeout(timeoutId)\n      // change width from the state object after 150 milliseconds\n      timeoutId = setTimeout(() => {\n        setHeight(getViewportHeight())\n      }, 150)\n    }\n    // set resize listener\n    window.addEventListener('resize', resizeListener)\n\n    // clean up function\n    return () => {\n      // remove resize listener\n      window.removeEventListener('resize', resizeListener)\n    }\n  }, [])\n\n  return { height }\n}\n\nfunction buildTree(nodes){\n  // Build a tree from the blocks.\n  // Where each block has a parentId property.\n  // Each tree item should have the block itself, a list of children and a nesting level.\n  \n  const treeRoots = []\n\n  for (let node of nodes) {\n    let parentBlock = null\n    if (node.block.parent) {\n      parentBlock = nodes.find(n => n._id === node.block.parent)\n      // if (!parentBlock) {\n      //   console.error('Invalid parent:')\n      //   console.error('parentBlockt', parentBlock)\n      //   console.error('node.block.parent', node.block.parent)\n      // }\n    }\n\n    if (!parentBlock) {\n      treeRoots.push(node)\n    } else {\n      // If the parentBlock has no children, create the children array.\n      if (!parentBlock.children) {\n        parentBlock.children = []\n      }\n      parentBlock.children.push(node)\n    }\n  }\n\n  return treeRoots\n}\n\nfunction* treeWalker(treeRoots) {\n  const stack = []\n \n  // Remember all the necessary data of the first node in the stack.\n  for (const root of treeRoots) {\n    stack.unshift({\n      nestingLevel: 0,\n      node: root,\n    })\n  }\n \n  // Walk through the tree until we have no nodes available.\n  while (stack.length !== 0) {\n    const {\n      node: {children = [], _id, block, isOpen},\n      nestingLevel,\n    } = stack.pop()\n\n    yield {\n      _id,\n      isLeaf: children.length === 0,\n      isOpen,\n      block,\n      nestingLevel,\n    }\n \n    // Basing on the node openness state we are deciding if we need to render\n    // the child nodes (if they exist).\n    if (children.length !== 0 && isOpen) {\n      // Since it is a stack structure, we need to put nodes we want to render\n      // first to the end of the stack.\n      for (let i = children.length - 1; i >= 0; i--) {\n        stack.push({\n          nestingLevel: nestingLevel + 1,\n          node: children[i],\n        });\n      }\n    }\n  }\n}\n\nfunction getFlatTree(treeRoots){\n  const flatTree = []\n\n  const walker = treeWalker(treeRoots)\n\n  let done = false\n  while (!done) {\n    const { done: new_done, value } = walker.next()\n    done = new_done\n    if (!done) {\n      flatTree.push(value)\n    }\n  }\n\n  return flatTree\n}\n\n// const useWindowSize = () => {\n//   let [size, setSize] = useState([0, 0])\n//   useLayoutEffect(() => {\n//     function updateSize() {\n//       setSize([window.innerWidth, window.innerHeight])\n//     }\n//     window.addEventListener(\"resize\", updateSize)\n//     updateSize()\n//     return () => window.removeEventListener(\"resize\", updateSize)\n//   }, [])\n//   return size\n// }\n\n\nconst BlockRow = ({\n  createBlock,\n  index,\n  style,\n  data,\n  toggleOpenById,\n  refetchData,\n  // onSetSize,\n  showBlockMenu = true,\n}) => {\n  const {\n    _id,\n    isLeaf,\n    isOpen,\n    block,\n    nestingLevel,\n  } = data[index]\n\n  // const rootRef = useRef()\n  // const [ windowWidth ] = useWindowSize()\n  // useEffect(() => {\n  //   if (typeof onSetSize === 'function') {\n  //     const height = rootRef.current.getBoundingClientRect().height\n  //     onSetSize(index, height)\n  //   }\n  // }, [ index, onSetSize, windowWidth ])\n\n  const [blockMenuIsOpen, setBlockMenuIsOpen] = useState(false)\n\n  const toggleOpen = useCallback(() => {\n    if (typeof toggleOpenById === 'function') {\n      toggleOpenById(_id)\n    }\n  }, [ toggleOpenById, _id ])\n\n  const onBlockMenuToogle = useCallback(newValue => {\n    if (newValue === false) {\n      setTimeout(() => {\n        setBlockMenuIsOpen(newValue)\n      }, 200) // The fade-out animation is 200ms. Only rerender after it, for it not to loose the element.\n    } else {\n      setBlockMenuIsOpen(newValue)\n    }\n  }, [ setBlockMenuIsOpen ])\n\n  const onReloadContext = useCallback(() => {\n    if (typeof refetchData === 'function') {\n      setTimeout(() => {\n        refetchData({ force: true })\n      }, 200) // The fade-out animation is 200ms. Only rerender after it, for it not to loose the element.\n    }\n  }, [ refetchData ])\n\n  const rowContent = <>\n    <ViewerAuto\n      dragable={true}\n      size=\"line\"\n      block={block}\n      style={{\n        flexGrow: '1',\n        width: '100%',\n      }}\n    />\n\n    {\n      showBlockMenu === true\n      && (\n        <div className={classes.blockRowActions}>\n          <BlockMenu\n            onToogle={onBlockMenuToogle}\n            onReloadContext={onReloadContext}\n            {...{\n              block,\n              createBlock,\n              // setType: saveType,\n            }}\n            trigger={props => (\n              <button\n                {...props}\n                className={`text hasIcon ${blockMenuIsOpen ? 'fakeHover' : ''}`}\n                style={{\n                  margin: '0',\n                  padding: 'var(--basis) 0',\n                  flexShrink: '0',\n                }}\n              >\n                <BlockMenuIcon className=\"icon\" />\n              </button>\n            )}\n          />\n        </div>\n      )\n    }\n  </>\n\n  const inset = ~~(nestingLevel * 25 + (isLeaf ? 24 : 0))\n\n  return <div\n    // ref={rootRef}\n    key={block._id}\n    style={{\n      display: 'flex',\n      alignItems: 'center',\n      flexDirection: 'row',\n      ...style,\n      // height: 'auto',\n      marginLeft: inset,\n      minWidth: `calc(100% - ${(isLeaf ? 24 : 0)}px)`,\n      width: `calc(100% - ${inset}px)`,\n    }}\n    className={`${classes.blockRow} ${blockMenuIsOpen ? classes.fakeHover : ''}`}\n  >\n    {!isLeaf && (\n      <button\n        onClick={toggleOpen}\n        className=\"text hasIcon\"\n        style={{\n          margin: '0',\n          padding: 'var(--basis) 0',\n          flexShrink: '0',\n        }}\n      >\n        {\n          isOpen\n            ? <ExpandLessIcon style={{ verticalAlign: 'middle' }} />\n            : <ExpandMoreIcon style={{ verticalAlign: 'middle' }} />\n        }\n      </button>\n    )}\n    {rowContent}\n  </div>\n}\n\nconst getFilteredTypes = types => Object.entries(types)\n  .filter(([, value]) => value === true)\n  .map(([key, ]) => key)\n\nfunction BlockTree({\n  createBlock = ()=>{},\n  scrollContainer = window,\n  showBlockMenu = true,\n}) {\n  const { getString } = useLocalization()\n  const { loggedIn } = useUser()\n\n  const outerTreeRef = useRef(null)\n  const innerTreeRef = useRef(null)\n  const treeRef = useRef(null)\n  const [outerHeight, setOuterHeight] = useState(minItemSize)\n  const [bottomMargin, setBottomMargin] = useState(0)\n  const [nodes, setNodes] = useState({})\n  const [openById, setOpenById] = useState({})\n  const [treeNodes, setTreeNodes] = useState([])\n\n  const [treeNodesFiltered, setTreeNodesFiltered] = useState([])\n  const [searchString, setSearchString] = useState('')\n  const prevFetchArguments = useRef({})\n\n  const [onlyShowWithEditPermissions, setOnlyShowWithEditPermissions] = useState(false) // false = show all, true = show only owning\n  function toggleOnlyShowWithEditPermissions() {\n    setOnlyShowWithEditPermissions(oldOnlyShowWithEditPermissions => !oldOnlyShowWithEditPermissions)\n  }\n\n  const [types, setTypes] = useState({\n    person: true,\n    page: true,\n    redirect: true,\n  })\n  const filteredTypes = getFilteredTypes(types)\n  \n  const [archived, setArchived] = useState(false)\n  function toggleArchived() {\n    setArchived(oldArchived => !oldArchived)\n  }\n\n\n  /*\n  const sizeMap = useRef({})\n  const setSize = useCallback((index, size) => {\n    sizeMap.current = {\n      ...sizeMap.current,\n      [index]: size,\n    }\n  }, [])\n  const getSize = useCallback(index => sizeMap.current[index] || minItemSize, [])\n  */\n\n\n  const { height: viewportHeight } = useViewportHeight()\n\n  const updateHeight = useCallback(() => {\n    if (innerTreeRef.current && outerTreeRef.current) {\n      setTimeout(() => {\n        const outerBounds = outerTreeRef.current.getBoundingClientRect()      \n        const maxHeight = viewportHeight - outerBounds.top\n\n        const innerBounds = innerTreeRef.current.getBoundingClientRect()\n        const fullHeight = innerBounds.height\n        if (typeof fullHeight === 'number' && !isNaN(fullHeight) && fullHeight > minItemSize) {\n          const newHeight = Math.min(maxHeight, fullHeight)\n          setOuterHeight(~~(newHeight))\n          setBottomMargin(~~(Math.max(fullHeight - newHeight, 0)))\n        }\n      }, 100)\n    }\n  }, [ viewportHeight, innerTreeRef, outerTreeRef, setOuterHeight, setBottomMargin ])\n\n  useScrollPosition(updateHeight, [ updateHeight ], null, false, 300, scrollContainer)\n\n  const updateTree = useCallback(nodes => {\n    if (nodes.length > 0) {\n      nodes = nodes.map(node => ({\n        ...node,\n        isOpen: openById[node._id] || false,\n      }))\n      const treeRoots = buildTree(JSON.parse(JSON.stringify(nodes)))\n      const flatTree = getFlatTree(treeRoots)\n      setTreeNodes(flatTree)\n    } else {\n      setTreeNodes([])\n    }\n    updateHeight()\n  }, [ setTreeNodes, updateHeight, openById ])\n\n  const loadBlocks = useLoadBlocks()\n  const refetchData = useCallback(options => {\n    const {\n      force = false,\n      filteredTypes,\n      archived,\n    } = options || {}\n\n    if (\n      force === true\n      || prevFetchArguments.current.archived !== archived\n      || prevFetchArguments.current.types !== filteredTypes\n    ) {\n      prevFetchArguments.current.types = filteredTypes\n      prevFetchArguments.current.archived = archived\n      \n      loadBlocks({ types: filteredTypes, archived })\n        .then(async loadedBlocks => {\n          const nodes = loadedBlocks\n          .map(block => ({\n            _id: block._id,\n            block,\n            children: [],\n            isOpen: false,\n          }))\n\n          setNodes(nodes)\n          updateTree(nodes)\n        })\n        .catch(error => console.error(error))\n    }\n  }, [ loadBlocks, setNodes, updateTree ])\n\n  // useEffect(() => {\n  //   refetchData()\n  // }, [ refetchData ])\n\n\n\n\n\n  // START Filter + Search\n\n  useEffect(() => {\n    let filtered = treeNodes\n\n    if (searchString.length > 0) {\n      const searchStringLower = searchString.toLowerCase()\n    \n      filtered = filtered\n        .filter(node => {\n          if (\n            !!node\n            && !!node.block\n            && !!node.block.properties\n            && !!node.block.properties.text\n            && node.block.properties.text.toLowerCase().includes(searchStringLower)\n          ) {\n            return true\n          } else if (\n            !!node\n            && !!node.block\n            && !!node.block.properties\n            && !!node.block.properties.trigger\n            && !!node.block.properties.trigger.path\n            && node.block.properties.trigger.path.toLowerCase().includes(searchStringLower)\n          ) {\n            return true\n          }\n          return false\n        })\n    }\n\n    if (onlyShowWithEditPermissions === true) {\n      filtered = filtered\n        .filter(node => (\n          !!node\n          && !!node.block\n          && !!node.block.computed\n          && !!node.block.computed.roles\n          && (\n            node.block.computed.roles.includes('owner')\n            || node.block.computed.roles.includes('editor')\n          )\n        ))\n    }\n\n    setTreeNodesFiltered(filtered)\n    updateHeight()\n  }, [ searchString, onlyShowWithEditPermissions, treeNodes, setTreeNodesFiltered, updateHeight ])\n\n  const handleSearch = useCallback(event => {\n    setSearchString(event.target.value || '')\n  }, [ setSearchString ])\n\n  const toggleType = useCallback(type2toggle => {\n    const newTypes = { ...types }\n    newTypes[type2toggle] = !newTypes[type2toggle]\n\n    const typesValues = Object.values(newTypes)\n    if (!typesValues.every(value => value === false)) {\n      setTypes(newTypes)\n    }\n  }, [ types, setTypes ])\n\n  useEffect(() => {\n    refetchData({\n      filteredTypes: getFilteredTypes(types),\n      archived,\n    })\n  }, [ types, archived, refetchData ])\n\n  // END Filter + Search\n\n\n\n\n\n\n\n\n\n\n  const toggleOpenById = useCallback((_id) => {\n    openById[_id] = !openById[_id]\n    setOpenById(openById)\n    updateTree(nodes)\n  }, [setOpenById, openById, updateTree, nodes])\n\n  const refetchDataWithFilter = useCallback(options => {\n    refetchData({\n      ...options,\n      filteredTypes: getFilteredTypes(types),\n      archived,\n    })\n  }, [ types, archived, refetchData ])\n\n  const row = (props) => {\n    return <BlockRow\n      createBlock={createBlock}\n      toggleOpenById={toggleOpenById}\n      refetchData={refetchDataWithFilter}\n      // onSetSize={setSize}\n      showBlockMenu={showBlockMenu}\n      {...props}\n    />\n  }\n\n  return <>\n    <div style={{\n      display: 'flex',\n      alignItems: 'center',\n      margin: '0 0 var(--basis_x2) 0',\n    }}>\n\n      <input\n        type=\"text\"\n        placeholder={getString('search')}\n        style={{\n          width: '100%',\n        }}\n        onChange={handleSearch}\n      />\n\n      <PopoverMenu\n        trigger={triggerProps => (\n          <button\n            {...triggerProps}\n            className=\"text hasIcon\"\n            style={{\n              flexShrink: '0',\n            }}\n          >\n            <FilterListIcon className=\"icon\" />\n            {/* <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}>Filter</span> */}\n          </button>\n        )}\n      >\n        {/*\n          { value: 'page', icon: <PageIcon className=\"icon\"/>, title: getString('block_menu_type_label_plural_page') },\n          { value: 'person', icon: <PersonIcon className=\"icon\" />, title: getString('block_menu_type_label_plural_person') },\n          { value: 'redirect', icon: <RedirectIcon className=\"icon\" />, title: getString('block_menu_type_label_plural_redirect') },\n        */}\n\n        <div style={{ marginTop: '8px' }}></div>\n\n        {\n          Object.keys(types)\n            .map(type => (\n              <MenuItem\n                className=\"roundMenuItem\"\n                key={type}\n                onClick={() => toggleType(type)}\n                selected={filteredTypes.includes(type)}\n                sx={{\n                  marginTop: '2px !important',\n                  marginBottom: '2px !important',\n                }}\n              >\n                <ListItemIcon>\n                  {blockTypeIcons[type]}\n                </ListItemIcon>\n                <ListItemText>\n                  <Localized id={'block_menu_type_label_plural_'+type} />\n                </ListItemText>\n              </MenuItem>\n            ))\n        }\n\n        {\n          loggedIn\n          && <>\n            <Divider style={{ opacity: 0.2 }} />\n\n            <MenuItem\n              className=\"roundMenuItem\"\n              onClick={toggleArchived}\n              selected={archived === true}\n              sx={{\n                marginBottom: '2px !important',\n              }}\n            >\n              <ListItemIcon>\n                <ArchiveIcon className=\"icon\" />\n              </ListItemIcon>\n              <ListItemText>\n                <Localized id={archived === true ? 'filter_menu_showing_archiv' : 'filter_menu_show_archiv'} />\n              </ListItemText>\n            </MenuItem>\n\n            <MenuItem\n              className=\"roundMenuItem\"\n              onClick={toggleOnlyShowWithEditPermissions}\n              selected={onlyShowWithEditPermissions === true}\n            >\n              <ListItemIcon>\n                <EditIcon className=\"icon\" />\n              </ListItemIcon>\n              <ListItemText>\n                <Localized id={onlyShowWithEditPermissions === true ? 'filter_menu_showing_editing' : 'filter_menu_show_editing'} />\n              </ListItemText>\n            </MenuItem>\n          </>\n        }\n\n      </PopoverMenu>\n\n      <button\n        className=\"text hasIcon\"\n        onClick={refetchDataWithFilter}\n        style={{\n          flexShrink: '0',\n        }}\n      >\n        <RequeryIcon className=\"icon\" />\n        {/* <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}>Reload</span> */}\n      </button>\n    </div>\n  <div\n    style={{\n      height: outerHeight,\n      marginRight: '-12px',\n      marginLeft: '-12px',\n      marginBottom: bottomMargin,\n    }}\n    ref={outerTreeRef}\n  >\n    <AutoSizer disableWidth>\n      {({ height }) => (\n        <FixedSizeList\n          itemData={treeNodesFiltered}\n          itemCount={treeNodesFiltered.length}\n          ref={treeRef}\n          innerRef={innerTreeRef}\n          // onScroll={updateHeight}\n          itemSize={minItemSize}\n          height={height}\n          width=\"100%\"\n          style={{\n            overflowY: 'hidden',\n            overflowX: 'auto',\n            // overflowX: 'hidden',\n          }}\n          itemKey={(index, data) => data[index]._id}\n        >\n          {row}\n        </FixedSizeList>\n      )}\n    </AutoSizer>\n      {\n        treeNodesFiltered.length === 0\n          ? <p style={{\n            textAlign: 'center',\n            fontWeight: 'bold',\n          }}><Localized id=\"blocktree_no_nodes_to_show\" /></p>\n          : null\n      }\n    </div>\n  </>\n}\n\nexport default BlockTree\n\n\n\n// const defaultButtonStyle = { fontFamily: 'Courier New' }\n\n// Tree component can work with any possible tree structure because it uses an\n// iterator function that the user provides. Structure, approach, and iterator\n// function below is just one of many possible variants.\n// const defaultTree = {\n//   name: 'Root #1',\n//   id: 'root-1',\n//   children: [\n//     {\n//       children: [\n//         {id: 'child-2', name: 'Child #2'},\n//         {id: 'child-3', name: 'Child #3'},\n//         {id: 'child-5', name: 'Child #3'},\n//         {id: 'child-6', name: 'Child #3'},\n//         {id: 'child-7', name: 'Child #3'},\n//         {id: 'child-8', name: 'Child #3'},\n//         {id: 'child-9', name: 'Child #3'},\n//         {id: 'child-10', name: 'Child #3'},\n//         {id: 'child-11', name: 'Child #3'},\n//       ],\n//       id: 'child-1',\n//       name: 'Child #1',\n//     },\n//   ],\n// }\n\n  /*\nasync function* treeWalker(refresh) {\n  const stack = []\n \n  // Remember all the necessary data of the first node in the stack.\n  stack.push({\n    nestingLevel: 0,\n    node: tree,\n  })\n \n  // Walk through the tree until we have no nodes available.\n  while (stack.length !== 0) {\n    const {\n      node: {children = [], id, name},\n      nestingLevel,\n    } = stack.pop()\n \n    // Here we are sending the information about the node to the Tree component\n    // and receive an information about the openness state from it. The\n    // `refresh` parameter tells us if the full update of the tree is requested;\n    // basing on it we decide to return the full node data or only the node\n    // id to update the nodes order.\n    const isOpened = yield refresh\n      ? {\n          id,\n          isLeaf: children.length === 0,\n          isOpenByDefault: false,\n          name,\n          nestingLevel,\n        }\n      : id\n \n    // Basing on the node openness state we are deciding if we need to render\n    // the child nodes (if they exist).\n    if (children.length !== 0 && isOpened) {\n      // Since it is a stack structure, we need to put nodes we want to render\n      // first to the end of the stack.\n      for (let i = children.length - 1; i >= 0; i--) {\n        stack.push({\n          nestingLevel: nestingLevel + 1,\n          node: children[i],\n        });\n      }\n    }\n  }\n}\n*/\n\n  /*\n  // Node component receives all the data we created in the `treeWalker` +\n  // internal openness state (`isOpen`), function to change internal openness\n  // state (`toggle`) and `style` parameter that should be added to the root div.\n  const Node = ({data: {isLeaf, name, nestingLevel}, isOpen, style, toggle}) => {\n\n    const toogleAndUpdate = () => {\n      toggle()\n      setTimeout(updateHeight, 100)\n    }\n\n    return <div\n      style={{\n        ...style,\n        alignItems: 'center',\n        display: 'flex',\n        marginLeft: nestingLevel * 30 + (isLeaf ? 48 : 0),\n      }}\n    >\n      {!isLeaf && (\n        <div>\n          <button\n            type=\"button\"\n            onClick={toogleAndUpdate}\n            style={defaultButtonStyle}\n          >\n            {isOpen ? '-' : '+'}\n          </button>\n        </div>\n      )}\n      <div>{name}</div>\n    </div>\n  }\n*/\n","import { useState, useCallback, useRef, useEffect } from 'react'\nimport classes from './SidebarContent.module.css'\n\nimport {\n  MenuList,\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  Divider,\n} from '@mui/material'\n\nimport {\n  MenuOpen as MenuOpenIcon,\n  Add as AddIcon,\n\n  Email as ContactIcon,\n  GitHub as SourceCodeIcon,\n  Login as LoginIcon,\n  Logout as LogoutIcon,\n\n  Help as HelpIcon,\n} from '@mui/icons-material'\n\nimport useSaveBlock from '../hooks/useSaveBlock.js'\n\nimport { useNavigate, useMatch } from 'react-router-dom'\n\nimport { Localized } from '../fluent/Localized.js'\nimport useUser from '../hooks/useUser.js'\nimport { useSidebarContext } from './Sidebar.js'\nimport AddMenu from './edit/AddMenu.js'\nimport BlockTree from './BlockTree.js'\n\nfunction debounce(func, wait, immediate) {\n  // Source: underscore.js\n\tvar timeout\n\treturn function() {\n\t\tvar context = this, args = arguments\n\t\tvar later = function() {\n\t\t\ttimeout = null\n\t\t\tif (!immediate) func.apply(context, args)\n\t\t}\n\t\tvar callNow = immediate && !timeout\n\t\tclearTimeout(timeout)\n\t\ttimeout = setTimeout(later, wait)\n\t\tif (callNow) func.apply(context, args)\n\t}\n}\n\nexport default function SidebarContent() {\n  const mounted = useRef(false)\n  useEffect(() => {\n    mounted.current = true\n    return () => {\n      mounted.current = false\n    }\n  }, [])\n\n  const [showBlockTree, setShowBlockTree] = useState(false)\n  var efficientSetShowBlockTree = useCallback(()=>{\n    if (mounted.current) {\n      debounce(() => {\n        if (mounted.current) {\n\t        setShowBlockTree(true)\n        }\n      }, 10)()\n    }\n  }, [ setShowBlockTree, mounted ])\n  useEffect(() => {\n    efficientSetShowBlockTree()\n  }, [ efficientSetShowBlockTree ])\n  \n  const { loggedIn } = useUser()\n  const { toggleSidebar } = useSidebarContext()\n\n  const matchesStartpage = useMatch('/')\n\n  const saveBlock = useSaveBlock()\n  const navigate = useNavigate()\n\n  const createBlock = useCallback(newBlock => {\n    saveBlock(newBlock)\n      .then(gottenBlock => {\n        navigate(`/${gottenBlock._id}/edit`)\n      })\n      .catch(error => {\n        console.error(error)\n      })\n  }, [ saveBlock, navigate ])\n\n  const scrollContainerRef = useRef(null)\n\n  return <div ref={scrollContainerRef} className={classes.scrollContainer}>\n    <div className={classes.content}>\n    <header className={classes.header}>\n      <div className={classes.headerBar}>\n        {\n          matchesStartpage\n          ? <h1>VoltLink</h1>\n          : <button onClick={toggleSidebar} className=\"text hasIcon\" style={{ margin: '0' }}>\n              <MenuOpenIcon className=\"icon\" />\n            </button>\n        }\n\n        <AddMenu\n          trigger={triggerProps => (\n            <button className=\"default hasIcon\" {...triggerProps}>\n              <AddIcon className=\"icon\" />\n              {/* <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}>Add</span> */}\n            </button>\n          )}\n          createBlock={createBlock}\n        />\n      </div>\n    </header>\n\n      <MenuList style={{ maxWidth: '100%' }}>\n\n        {\n          loggedIn\n            ? <a href={`${window.domains.frontend}help`}>\n                <MenuItem className=\"roundMenuItem\">\n                  <ListItemIcon>\n                    <HelpIcon />\n                  </ListItemIcon>\n                  <ListItemText primary={<Localized id=\"help_page\" />} />\n                </MenuItem>\n              </a>\n            : null\n        }\n\n        {\n          loggedIn\n            ? <a href={`${window.domains.backend}logout?redirect_to=${encodeURIComponent(window.location.toString())}`}>\n                <MenuItem className=\"roundMenuItem\">\n                  <ListItemIcon>\n                    <LogoutIcon />\n                  </ListItemIcon>\n                  <ListItemText primary={<Localized id=\"logout\" />} />\n                </MenuItem>\n              </a>\n            : <a href={`${window.domains.backend}login?redirect_to=${encodeURIComponent(window.location.toString())}`}>\n                <MenuItem className=\"roundMenuItem\">\n                  <ListItemIcon>\n                    <LoginIcon />\n                  </ListItemIcon>\n                  <ListItemText primary={<Localized id=\"login\" />} />\n                </MenuItem>\n              </a>\n        }\n\n        <a href=\"mailto:thomas.rosen@volteuropa.org\">\n          <MenuItem className=\"roundMenuItem\">\n            <ListItemIcon>\n              <ContactIcon />\n            </ListItemIcon>\n            <ListItemText primary={<Localized id=\"contact\" />} />\n          </MenuItem>\n        </a>\n\n        <a href=\"https://github.com/voltbonn/edit.volt.link\" target=\"_blank\" rel=\"noopener noreferrer\">\n          <MenuItem className=\"roundMenuItem\">\n            <ListItemIcon>\n              <SourceCodeIcon />\n            </ListItemIcon>\n            <ListItemText primary={<Localized id=\"source_code\" />} />\n          </MenuItem>\n        </a>\n\n      </MenuList>\n\n      <br/>\n      <Divider style={{ opacity: 0.2 }} />\n      <br/>\n\n      {\n        showBlockTree\n        ? <BlockTree\n            createBlock={createBlock}\n            showBlockMenu={true}\n            scrollContainer={scrollContainerRef}\n          />\n        : null\n      }\n    </div>\n  </div>\n}\n","import React, {\n  useState,\n  useCallback,\n  createContext,\n  useContext,\n} from 'react'\n\nimport {\n  SwipeableDrawer,\n} from '@mui/material'\n\nimport { useMatch } from 'react-router-dom'\n\nimport useMediaQuery from '../hooks/useMediaQuery.js'\nimport SidebarContent from './SidebarContent.js'\n\nimport classes from './Sidebar.module.css'\n\nconst SidebarContext = createContext({})\n\nfunction useSidebarContext() {\n  return useContext(SidebarContext)\n}\n\nfunction SidebarProvider({ children }) {\n  const [open, setOpen] = useState(false)\n\n  const matchesStartpage = useMatch('/')\n  const realOpen = matchesStartpage ? false : open\n\n  const toggleSidebar = useCallback(() => {\n    setOpen(oldOpen => !oldOpen)\n  }, [ setOpen ])\n\n  return (\n    <SidebarContext.Provider value={{\n      open: realOpen,\n      setOpen,\n      toggleSidebar,\n    }}>\n      {children}\n    </SidebarContext.Provider>\n  )\n}\n\nconst sidebarWidth = 320\n\nfunction Sidebar() {\n  const { open, toggleSidebar } = useSidebarContext()\n\n  const iOS = (typeof navigator !== 'undefined' && /iPad|iPhone|iPod/.test(navigator.userAgent))\n  const isDesktop = useMediaQuery('(min-width: 960px)')\n\n  if (open) {\n    return <SwipeableDrawer\n      variant={isDesktop ? 'permanent' : 'temporary'}\n      anchor=\"left\"\n      open={open}\n      onOpen={toggleSidebar}\n      onClose={toggleSidebar}\n      disableBackdropTransition={!iOS}\n      disableDiscovery={iOS}\n      sx={{\n        width: sidebarWidth,\n        flexShrink: 0,\n        [`& .MuiDrawer-paper`]: {\n          width: sidebarWidth,\n          boxSizing: 'border-box',\n          backgroundColor: 'var(--background-contrast)',\n          color: 'var(--on-background)',\n          border: 'none',\n        },\n      }}\n      PaperProps={{\n        sx: {\n          background: 'var(--background-contrast)',\n          color: 'var(--on-background)',\n        }\n      }}\n    >\n      <SidebarContent />\n    </SwipeableDrawer>\n  }\n\n  return null\n}\nfunction Main({ children }) {\n  const { open } = useSidebarContext()\n\n  return <main\n    className={`${classes.main} ${open ? classes.open : ''}`}\n    style={{\n      '--sidebarWidth': sidebarWidth+'px',\n    }}\n  >\n    {children}\n  </main>\n}\n\nexport {\n  SidebarContext,\n  useSidebarContext,\n  SidebarProvider,\n  SidebarContent,\n  Sidebar,\n  Main,\n}\n\n/*\n      <Drawer\n        variant={isDesktop ? 'permanent' : ''}\n        anchor=\"left\"\n        open={open}\n        sx={{\n          width: drawerWidth,\n          flexShrink: 0,\n          [`& .MuiDrawer-paper`]: {\n            width: drawerWidth,\n            boxSizing: 'border-box',\n            backgroundColor: 'var(--background)',\n            color: 'var(--on-background)',\n          },\n        }}\n        PaperProps={{\n          sx: {\n            background: 'var(--background-contrast)',\n            color: 'var(--on-background)',\n          }\n        }}\n      >\n        <Sidebar />\n      </Drawer>\n      */\n","import { useCallback } from 'react'\n\nimport { useLocalization } from '../fluent/Localized.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlock_Query } from '../graphql/queries'\n\nimport { useSnackbar } from 'notistack'\n\nfunction useLoadBlock() {\n  const { getString } = useLocalization()\n\n  const apollo_client = useApolloClient()\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\n\n  const handleLoadBlock = useCallback(_id => {\n    return new Promise(final_resolve => {\n    let snackbarKey = null\n\n    if (!_id || _id === '') {\n      final_resolve({\n        type: 'text',\n      })\n    } else {\n      const loadingDataPromise = new Promise(resolve => {\n        apollo_client.query({\n          query: getBlock_Query,\n          variables: {\n            _id,\n          },\n        })\n          .then(async ({ data }) => {\n            resolve('got-data')\n\n            if (snackbarKey !== null) {\n              closeSnackbar(snackbarKey)\n            }\n\n            if (typeof data.error === 'string' || !data.block) {\n              if (data.error === 'no_edit_permission') {\n                enqueueSnackbar(getString('path_editor_edit_permission_error'), {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 5000,\n                })\n              } else {\n                enqueueSnackbar('' + data.error, {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 5000,\n                })\n              }\n            }else{\n              const loadedBlock = data.block\n              final_resolve(loadedBlock)\n            }\n          })\n          .catch(async error => {\n            console.error('error', error)\n            resolve('got-error')\n\n            if (snackbarKey !== null) {\n              closeSnackbar(snackbarKey)\n            }\n\n            enqueueSnackbar('[could not load data] '+error.message, {\n              variant: 'error',\n              preventDuplicate: true,\n              autoHideDuration: 2000,\n            })\n          })\n      })\n\n      // Show a loading-info-snackbar if loading the data takes too long.\n      Promise.race([\n        new Promise(resolve => {\n          setTimeout(() => {\n            resolve('show-loading')\n          }, 300)\n        }),\n        loadingDataPromise,\n      ])\n        .then(response => {\n          if (response === 'show-loading') {\n            snackbarKey = enqueueSnackbar(getString('path_editor_status_started_loading'), {\n              persist: true,\n              preventDuplicate: true,\n            })\n          }\n        })\n        .catch(error => console.error)\n    }\n    })\n  }, [\n    enqueueSnackbar,\n    closeSnackbar,\n    apollo_client,\n    getString,\n  ])\n\n  return handleLoadBlock\n}\n\nexport default useLoadBlock\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { blockMatchesRoles_Query } from '../graphql/queries'\n\nexport default function useBlockMatchesRoles() {\n  const apollo_client = useApolloClient()\n\n  const handleLoadRoles = useCallback((_id, roles = []) => {\n    return new Promise(resolve => {\n      if (!_id || _id === '') {\n        resolve(false)\n      } else {\n        apollo_client.query({\n          query: blockMatchesRoles_Query,\n          variables: {\n            _id,\n            roles,\n          },\n        })\n          .then(async ({ data }) => {\n            if (data.hasOwnProperty('blockMatchesRoles')) {\n              resolve(data.blockMatchesRoles)\n            }else{\n              resolve(false)\n            }\n          })\n          .catch(async error => {\n            console.error('error', error)\n            resolve(false)\n          })\n      }\n    })\n  }, [ apollo_client ])\n\n  return handleLoadRoles\n}\n","import { useState, useCallback, useEffect } from 'react'\n\nimport classes from './Header.module.css'\n\nimport {\n  Menu as MenuIcon,\n  MoreHoriz as MoreHorizIcon,\n  Home as HomeIcon,\n} from '@mui/icons-material'\n\nimport { Link } from 'react-router-dom'\n\nimport { useSidebarContext } from './Sidebar.js'\nimport ViewerAuto from './view/ViewerAuto.js'\nimport PopoverMenu from './PopoverMenu.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlocks_Query, getParentBlocks_Query } from '../graphql/queries'\n\nexport default function Header({ title, block = {}, rightActions, notificationBanner }) {\n  const { open, toggleSidebar } = useSidebarContext()\n  const apollo_client = useApolloClient()\n\n  const blockId = block ? block._id : null\n  const parentId = block ? block.parent : null\n\n  const [parentBlocks, setParentBlocks] = useState([])\n  const [siblingBlocks, setSiblingBlocks] = useState([])\n\n  const loadParentBlocks = useCallback(blockId => {\n    apollo_client.query({\n      query: getParentBlocks_Query,\n      variables: {\n        _id: blockId,\n      },\n    })\n      .then(async ({ data }) => {\n        if (typeof data.error === 'string' || !data.blocks) {\n          console.error(data.error)\n          setParentBlocks([])\n        }else{\n          setParentBlocks(data.blocks || [])\n        }\n      })\n      .catch(async error => {\n        console.error('error', error)\n        setParentBlocks([])\n      })\n  }, [apollo_client, setParentBlocks])\n\n  const loadSiblingBlocks = useCallback((parentId, blockId) => {\n    apollo_client.query({\n      query: getBlocks_Query,\n      variables: {\n        roots: [parentId || blockId],\n        types: ['page', 'person', 'redirect'],\n        archived: false,\n      },\n    })\n      .then(async ({ data }) => {\n        if (typeof data.error === 'string' || !data.blocks) {\n          console.error(data.error)\n          setSiblingBlocks([])\n        }else{\n          setSiblingBlocks(\n            (data.blocks || [])\n              .filter(block => block._id !== blockId)\n          )\n        }\n      })\n      .catch(async error => {\n        console.error('error', error)\n        setSiblingBlocks([])\n      })\n  }, [apollo_client, setSiblingBlocks])\n\n  useEffect(() => {\n    if (blockId) {\n      loadParentBlocks(blockId)\n      loadSiblingBlocks(parentId, blockId)\n    }\n  }, [blockId, parentId, loadParentBlocks, loadSiblingBlocks])\n\n  const leftActions = <>\n    {\n      !open\n      ? <button onClick={toggleSidebar} className=\"text hasIcon\" style={{ margin: '0' }}>\n          <MenuIcon className=\"icon\" />\n        </button>\n      : null\n    }\n\n    <div style={{ flexGrow: '1' }}>\n      <Link to=\"/\">\n        <button className=\"text\" style={{ margin: 'calc(-2 * var(--basis))' }}>\n          <HomeIcon style={{ verticalAlign: 'middle' }} />\n        </button>\n      </Link>\n      <span style={{ margin: 'var(--basis_x2)', opacity: 'var(--alpha)' }}>/</span>\n\n    {\n      blockId\n      && parentBlocks.length > 0\n        ? <>\n          <PopoverMenu\n            trigger={triggerProps => (\n              <button {...triggerProps} className=\"text\" style={{ margin: 'calc(-2 * var(--basis))' }}>\n                <MoreHorizIcon style={{ verticalAlign: 'middle' }} />\n              </button>\n            )}\n          >\n            <div style={{\n              padding: 'var(--basis_x2)',\n            }}>\n              {\n                parentBlocks\n                .map((block) => {\n                  return <ViewerAuto\n                    key={block._id}\n                    block={block}\n                    size=\"line\"\n                  />\n                })\n              }\n            </div>\n          </PopoverMenu>\n          <span style={{ margin: 'var(--basis_x2)', opacity: 'var(--alpha)' }}>/</span>\n        </>\n        : null\n    }\n\n    {\n      siblingBlocks.length > 0\n        ? <PopoverMenu\n            trigger={triggerProps => (\n              <button {...triggerProps} className=\"text\" style={{ margin: 'calc(-2 * var(--basis))' }}>\n                <span style={{ fontWeight: 'bold' }}>\n                  {title}\n                </span>\n              </button>\n            )}\n          >\n            <div style={{\n              padding: 'var(--basis_x2)',\n            }}>\n              {\n                siblingBlocks\n                .map((block) => {\n                  return <ViewerAuto\n                    key={block._id}\n                    block={block}\n                    size=\"line\"\n                  />\n                })\n              }\n            </div>\n          </PopoverMenu>\n        : <span style={{ fontWeight: 'bold' }}>\n            {title}\n          </span>\n    }\n    </div>\n  </>\n\n  return <header className={classes.header}>\n    <div className={classes.headerBar}>\n      {leftActions}\n      {rightActions}\n    </div>\n    {\n      !!notificationBanner\n        ? <div className={classes.notificationBanner}>{notificationBanner}</div>\n        : null\n    }\n  </header>\n}\n","\nimport {\n  Login as LoginIcon,\n} from '@mui/icons-material'\n\nimport Localized from '../fluent/Localized.js'\n\nexport default function LoginScreen () {\n  return <>\n    <h1>Login to view content</h1>\n    <a href={`${window.domains.backend}login?redirect_to=${encodeURIComponent(window.location.toString())}`}>\n      <button className=\"text hasIcon\" style={{ margin: 'var(--basis_x4) 0 0 0' }}>\n        <LoginIcon className=\"icon\" />\n        <span>\n          <Localized id=\"login\" />\n        </span>\n      </button>\n    </a>\n  </>\n}\n\nexport function ErrorPage ({ errorName }) {\n  let title = 'Unknown Error'\n  let description = ''\n  let buttons = ''\n\n  if (errorName === 'no_access') {\n    title = `You don't have access to this page!`\n    \n    description = <>\n      <h2>If you are not logged in:</h2>\n      You propably need to login with a Volt Europa account to view this page. Contact your local community lead if you are unsure about your Volt Europa account.<br/>\n\n      <h2>If you are logged in:</h2>\n        You propably don't have access to this page.\n    </>\n\n    buttons = <a href={`${window.domains.backend}login?redirect_to=${encodeURIComponent(window.location.toString())}`}>\n      <button className=\"text hasIcon\" style={{ margin: 'var(--basis_x4) 0 0 0' }}>\n        <LoginIcon className=\"icon\" />\n        <span>\n          <Localized id=\"login\" />\n        </span>\n      </button>\n    </a>\n  } else if (errorName === 'not_found') {\n    title = 'We could not find the requested URL…'\n    description = \"The URL you requested does currently not exist. Did you type the URL correctly?\"\n\n    buttons = <a href={`${window.domains.backend}login?redirect_to=${encodeURIComponent(window.location.toString())}`}>\n      <button className=\"text hasIcon\" style={{ margin: 'var(--basis_x4) 0 0 0' }}>\n        <LoginIcon className=\"icon\" />\n        <span>\n          <Localized id=\"login\" />\n        </span>\n      </button>\n    </a>\n  }\n\n  \n  return <>\n    <h1>{title}</h1>\n    <p>{description}</p>\n    {buttons}\n\n    <br/> {/* Spacing */}\n    <br/>\n    <br/>\n    <br/>\n\n    <p>\n      Please contact <a href=\"mailto:thomas.rosen@volteuropa.org\">thomas.rosen@volteuropa.org</a> if you think this is a bug.<br/>\n      Go to <a href=\"https://volteuropa.org\">volteuropa.org</a> for information about the Pan-European Political Movement.\n    </p>\n  </>\n\n  // <hr/>\n  // <p>\n  //   <a href=\"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes#4xx_client_errors\">HTTP Error Code</a>: {errorCode}\n  // </p>\n}\n","import React, { useCallback, useRef, useState, useEffect } from 'react'\n\n// import hljs from 'highlight.js/lib/core'\n// import javascript from 'highlight.js/lib/languages/javascript'\n// // import 'highlight.js/styles/github.css'\n// import '../../highlightjs-volt-theme.css'\n\nimport {\n  offset as getCaretOffset,\n  getOffset,\n} from 'caret-pos'\n\nimport classes from './HtmlInput.module.css'\n\n// hljs.registerLanguage('javascript', javascript)\n\nfunction stripHtml(html){\n  // source: https://ourcodeworld.com/articles/read/376/how-to-strip-html-from-a-string-extract-only-text-content-in-javascript\n  // Create a new div element\n  var temporalDivElement = document.createElement(\"div\");\n  // Set the HTML content with the providen\n  temporalDivElement.innerHTML = html;\n  // Retrieve the text property of the element (cross-browser support)\n  return temporalDivElement.textContent || temporalDivElement.innerText || \"\";\n}\n\nfunction getRangeLengthWithLinebreaks(element){\n  element.normalize()\n\n  if (!window.getSelection) {\n    return 0;\n  }\n\n  const selection = window.getSelection()\n  const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n\n  if (!range) {\n    return 0;\n  }\n\n  const clonedRange = range.cloneRange()\n  clonedRange.selectNodeContents(element)\n  clonedRange.setEnd(range.endContainer, range.endOffset)\n  const content = clonedRange.cloneContents()\n\n  let rangeLength = 0\n  for (const node of content.childNodes) {\n    if (node.nodeType === 3) { // node type = 3 is a text node\n      rangeLength += node.textContent.length\n    } else if (node.nodeType === 1 && node.nodeName === 'BR') { // node type = 1 is an element node\n      rangeLength += 1\n    }\n  }\n\n  clonedRange.detach()\n\n  return rangeLength\n}\n\nfunction getInLineRangeLength(element, whichLine){\n  element.normalize()\n\n  if (!window.getSelection) {\n    return 0;\n  }\n\n  const selection = window.getSelection()\n  const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n\n  if (!range) {\n    return 0;\n  }\n\n  const clonedRange = range.cloneRange()\n  clonedRange.selectNodeContents(element)\n  clonedRange.setEnd(range.endContainer, range.endOffset)\n  const content = clonedRange.cloneContents()\n\n  let rangeLength = 0\n  if (content.childNodes.length > 0) {\n    if (whichLine === 'first') {\n      if (content.childNodes[0].nodeType === 3) {\n        rangeLength = content.childNodes[0].length\n      } else {\n        rangeLength = 0\n      }\n    } else if (whichLine === 'last') {\n      if (content.childNodes[content.childNodes.length-1].nodeType === 3) {\n        rangeLength = content.childNodes[content.childNodes.length-1].length\n      } else {\n        if (content.childNodes.length > 1) {\n          if (content.childNodes[content.childNodes.length-2].nodeType === 3) {\n            rangeLength = content.childNodes[content.childNodes.length-2].length\n          } else {\n            rangeLength = 0\n          }\n        } else {\n          rangeLength = 0\n        }\n      }\n    }\n  }\n\n  clonedRange.detach()\n\n  return rangeLength\n}\n\nfunction getCaretPosition(element){\n  // get element height without padding and border\n  const cs = getComputedStyle(element)\n  const paddingY = parseFloat(cs.paddingTop) + parseFloat(cs.paddingBottom)\n  const borderY = parseFloat(cs.borderTopWidth) + parseFloat(cs.borderBottomWidth)\n  const elementHeight = element.offsetHeight - paddingY - borderY\n\n  // get caret position\n  const offset = getOffset(element)\n  const caretOffset = getCaretOffset(element)\n  caretOffset.top = caretOffset.top - offset.top\n  caretOffset.left = caretOffset.left - offset.left\n\n  // check if caret is in the first line\n  let inFirstLine = caretOffset.top < caretOffset.height\n\n  // check if caret is in the last line\n  let inLastLine = elementHeight - caretOffset.top < caretOffset.height\n\n  // define caret position from start of text\n  const caretPositionFromStart = getRangeLengthWithLinebreaks(element)\n\n  // calc caret position from end of text\n  let textLength = element.innerText.length || 0\n  if (textLength < 0) {\n    textLength = 0\n  }\n  const caretPositionFromEnd = textLength - caretPositionFromStart\n\n  return {\n    inFirstLine,\n    inLastLine,\n    left: caretOffset.left,\n    top: caretOffset.top,\n    height: caretOffset.height,\n    positionFromLineStart: getInLineRangeLength(element, (inFirstLine ? 'first' : 'last')),\n    positionFromStart: caretPositionFromStart,\n    positionFromEnd: caretPositionFromEnd,\n  }\n}\n\nfunction HtmlInput({\n  type = 'text',\n  defaultValue = '',\n  children,\n  className,\n  onChange,\n  onBlur,\n  onError,\n  linebreaks,\n  style,\n  placeholder = '',\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n\n  ...props\n}) {\n  const inputRef = useRef(null)\n\n  const textRef = useRef('')\n  const textRefValue = textRef.current\n  \n  const [fakeDefaultValue, setFakeDefaultValue] = useState({ __html: '' })\n\n  const updateText = useCallback(defaultValue => {\n\n    let newHtmlValue = stripHtml(defaultValue)\n\n    // if (type === 'code') {\n    //   // const html = hljs.highlightAuto(newHtmlValue, { ignoreIllegals: false })\n    //   const html = hljs.highlight(newHtmlValue, { language: 'javascript', ignoreIllegals: false })\n    //   newHtmlValue = html.value\n    // // } else {\n    // //   newHtmlValue = newHtmlValue\n    // //     // .replace(/\\t/g, '&emsp;')\n    // //     .replace(/</g, '&lt;')\n    // //     .replace(/>/g, '&gt;')\n    // //     // .replace(/\\n/g, '<br />')\n    // }\n\n    textRef.current = defaultValue\n\n    if (fakeDefaultValue.__html !== newHtmlValue) {\n      return setFakeDefaultValue({__html: newHtmlValue})\n    }\n  }, [\n    // type,\n    fakeDefaultValue,\n    setFakeDefaultValue,\n  ])\n\n  useEffect(() => {\n    if (textRefValue !== defaultValue) {\n      updateText(defaultValue)\n    }\n  }, [\n    textRefValue,\n    defaultValue,\n    updateText,\n  ])\n\n  const handleTextChange = useCallback((event) => {\n    let value = event.target.innerHTML || ''\n    // .replace(/&emsp;/g, '\\t')\n    // .replace(/&lt;/g, '<')\n    // .replace(/&gt;/g, '>')\n\n    if (linebreaks === false) {\n      value = value.replace(/<\\/? ?br ?\\/?>/g, ' ')\n    } else {\n      value = value.replace(/<\\/? ?br ?\\/?>/g, '\\n')\n    }\n\n    value = value.trim()\n    textRef.current = value\n\n    if (onChange) {\n      onChange(value)\n    }\n  }, [onChange, linebreaks])\n\n  const handleTextBlur = useCallback(() => {\n    if (onBlur) {\n      onBlur(textRefValue)\n    }\n  }, [onBlur, textRefValue])\n\n  const keyDownHandler = useCallback(event => {\n    if (event.key === 'Enter' && event.shiftKey === true) {\n      // source: StackOverflow (https://stackoverflow.com/a/61237402)\n      if (linebreaks !== false) {\n        document.execCommand('insertLineBreak')\n      }\n      event.preventDefault()\n    } else if (event.key === 'Tab') {\n      document.execCommand('insertText', false, '\\t')\n      event.preventDefault()\n    } else if (event.key === 'ArrowUp') {\n      if (onGoToPrevInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.inFirstLine) {\n          onGoToPrevInput({ caret })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'ArrowLeft') {\n      if (onGoToPrevInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.inFirstLine && caret.positionFromStart <= 0) {\n          caret.positionFromLineStart = -1\n          onGoToPrevInput({ caret })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'ArrowDown') {\n      if (onGoToNextInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.inLastLine) {\n          onGoToNextInput({ caret })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'ArrowRight') {\n      if (onGoToNextInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.inLastLine && caret.positionFromEnd <= 1) {\n          caret.positionFromLineStart = 0\n          onGoToNextInput({ caret })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'Enter') {\n      if (type === 'code') {\n        if (linebreaks !== false) {\n          document.execCommand('insertLineBreak')\n        }\n        event.preventDefault()\n      } else {\n        if (onSplitText) {\n          const caret = getCaretPosition(inputRef.current)\n\n          const innerText = inputRef.current.innerText\n          const start = innerText.slice(0, caret.positionFromStart)\n          const end = innerText.slice(caret.positionFromStart)\n\n          onSplitText({\n            texts: [start, end],\n          })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'Backspace') {\n      if (onMergeToPrevInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.positionFromStart === 0 && caret.inFirstLine) {\n          onMergeToPrevInput({\n            caret,\n            text: inputRef.current.innerText,\n          })\n          event.preventDefault()\n        }\n      }\n    } else if (event.key === 'Delete') {\n      if (onMergeFromNextInput) {\n        const caret = getCaretPosition(inputRef.current)\n        if (caret.positionFromEnd === 0 && caret.inLastLine) {\n          onMergeFromNextInput({\n            caret,\n            text: inputRef.current.innerText,\n          })\n          event.preventDefault()\n        }\n      }\n    }\n  }, [\n    inputRef,\n    linebreaks,\n    onGoToPrevInput,\n    onGoToNextInput,\n    onSplitText,\n    onMergeToPrevInput,\n    onMergeFromNextInput,\n    type,\n  ])\n\n  useEffect(() => {\n    if (onInputRef) {\n      onInputRef(inputRef)\n    }\n  }, [onInputRef, inputRef])\n\n  const handlePaste = useCallback(event => {\n    // only accept plain text\n\n    // cancel paste\n    event.preventDefault()\n\n    // get text representation of clipboard\n    let text = (event.originalEvent || event).clipboardData.getData('text/plain')\n\n    if (linebreaks === false) {\n      text = text.replace(/\\n/g, ' ')\n    }\n\n    // insert text manually\n    document.execCommand('insertText', false, text)\n  }, [linebreaks])\n\n  // const highlighted = hljs.highlightAuto(text, { ignoreIllegals: true })\n  // language\n  //   ? hljs.highlight(language, content)\n  //   : hljs.highlightAuto(content)\n\n  return <>\n  <div\n    ref={inputRef}\n    onKeyDown={keyDownHandler}\n    onInput={handleTextChange}\n    onBlur={handleTextBlur}\n    onPaste={handlePaste}\n    className={`${classes.rebuild_textarea} ${textRefValue.length === 0 ? classes.show_placeholder : ''} ${className}`}\n    contentEditable={true}\n    dangerouslySetInnerHTML={fakeDefaultValue}\n    style={style}\n    placeholder={placeholder}\n  />\n    {/* <pre className=\"hljs\">\n      <code dangerouslySetInnerHTML={{ __html: highlighted.value }} />\n    </pre> */}\n  </>\n}\n\nexport default HtmlInput\n","import React, { useEffect, useState, useCallback } from 'react'\n\nimport {\n  Modal,\n} from '@mui/material'\nimport {\n  QrCodeSharp as QrCodeIcon,\n  AssessmentSharp as AssessmentIcon,\n  ContentCopySharp as CopyIcon,\n} from '@mui/icons-material'\n\nimport { Localized } from '../../fluent/Localized.js' // useLocalization\n\nimport classes from './SharingEditor.module.css'\n\nimport HtmlInput from './HtmlInput.js'\n\nfunction fallbackCopyTextToClipboard(text) {\n  // Source: https://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript\n  var textArea = document.createElement(\"textarea\");\n  textArea.value = text;\n\n  // Avoid scrolling to bottom\n  textArea.style.top = \"0\";\n  textArea.style.left = \"0\";\n  textArea.style.position = \"fixed\";\n\n  document.body.appendChild(textArea);\n  textArea.focus();\n  textArea.select();\n\n  try {\n    var successful = document.execCommand('copy');\n    var msg = successful ? 'successful' : 'unsuccessful';\n    console.info('Fallback: Copying text command was ' + msg);\n  } catch (err) {\n    console.error('Fallback: Oops, unable to copy', err);\n  }\n\n  document.body.removeChild(textArea);\n}\n\nfunction copyTextToClipboard(text) {\n  // Source: https://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript\n  if (!navigator.clipboard) {\n    fallbackCopyTextToClipboard(text);\n    return;\n  }\n  navigator.clipboard.writeText(text).then(function() {\n    console.info('Async: Copying to clipboard was successful!');\n  }, function(err) {\n    console.error('Async: Could not copy text: ', err);\n  });\n}\n\nfunction SharingEditor({\n  defaultBlock = {},\n  open = false,\n  onChange,\n  onClose,\n}) {\n  const [ path, setPath ] = useState('')\n\n  useEffect(() => {\n    const properties = defaultBlock.properties || {}\n    const initialPath = (properties.trigger || {}).path || ''\n\n    setPath(initialPath)\n  }, [ defaultBlock, setPath ])\n\n  const savePath = useCallback(newPath => {\n    const newProperties = {...(defaultBlock.properties || {})}\n\n    if (newPath === '') {\n      if (newProperties.hasOwnProperty('trigger')) {\n        delete newProperties.trigger\n      }\n      if (newProperties.hasOwnProperty('action')) {\n        delete newProperties.action\n      }\n    } else {\n      newProperties.trigger = {\n\t\t  \ttype: 'path',\n\t\t  \tpath: newPath,\n\t\t  }\n\t\t  newProperties.action = {\n\t\t  \ttype: 'render_block',\n\t\t  }\n    }\n\n    setPath(newPath)\n    onChange(newProperties)\n  }, [\n    defaultBlock,\n    onChange,\n    setPath,\n  ])\n\n  const viewStatistics = () => {\n    const a = document.createElement('a')\n    a.href = `https://umami.qiekub.org/share/s0ZHBZbb/volt.link?url=%2F${path}`\n    a.target = '_blank'\n    a.rel = 'noreferrer'\n    a.click()\n  }\n\n  const gotoQrcodePage = () => {\n    const a = document.createElement('a')\n    a.href = `https://qrcode.volt.link/?c=volt.link/${path}`\n    a.target = '_blank'\n    a.rel = 'noreferrer'\n    a.click()\n  }\n\n  const copyUrl = () => {\n    copyTextToClipboard(`https://volt.link/${path}`)\n  }\n\n  if (!open) {\n    return null\n  }\n\n  return (\n    <Modal\n      open={open}\n      onClose={onClose}\n      hideBackdrop={true}\n    >\n      <>\n        <div className={classes.backdrop} onClick={onClose}></div>\n\n        <div className={classes.dialog}>\n\n            <h1 style={{ margin: '0 0 var(--basis_x4) 0' }}>Share the link</h1>\n            {/* <p>Enter @volteuropa.org addresses to give editing rights.<br/>Groups addresses are not supported.</p> */}\n\n            {/* <hr style={{ opacity: 0.2 }} /> */}\n\n            <div className={classes.inputWrapper}>\n             <span style={{ paddingRight: 'var(--basis)' }}>volt.link/</span>\n             <HtmlInput\n                defaultValue={path}\n                onBlur={savePath}\n                linebreak={false}\n                className={classes.input}\n                style={{ margin: '0' }}\n              />\n            </div>\n\n            <hr style={{ opacity: 0.2 }} />\n\n            <div className={classes.actions}>\n              {\n                path !== ''\n                ? <div>\n                    <button className=\"text hasIcon\" onClick={gotoQrcodePage} style={{ marginInlineStart: '0' }}>\n                      <QrCodeIcon className=\"icon\" />\n                      <span className=\"hideOnSmallScreen\"><Localized id=\"sharing_qrcode\" /></span>\n                    </button>\n                    <button className=\"text hasIcon\" onClick={viewStatistics}>\n                      <AssessmentIcon className=\"icon\" />\n                      <span className=\"hideOnSmallScreen\"><Localized id=\"sharing_statistics\" /></span>\n                    </button>\n                    <button className=\"text hasIcon\" onClick={copyUrl}>\n                      <CopyIcon className=\"icon\" />\n                      <span className=\"hideOnSmallScreen\"><Localized id=\"sharing_copy_url\" /></span>\n                    </button>\n                  </div>\n                : <div></div>\n              }\n\n              <button onClick={onClose} className=\"green\" style={{ marginInlineEnd: '0' }}>\n                <Localized id=\"dialog_done\" />\n              </button>\n            </div>\n        </div>\n      </>\n    </Modal>\n  )\n}\n\nexport default SharingEditor\n","import { useState, useCallback } from 'react'\n\nimport {\n  MenuItem,\n} from '@mui/material'\n\nimport PopoverMenu from '../PopoverMenu.js'\n\nimport MdiIcon from '@mdi/react'\nimport {\n  mdiTranslate,\n} from '@mdi/js'\n\nconst locales = {\n  _: '??',\n  en: 'English',\n  de: 'Deutsch',\n  es: 'Español',\n  pt: 'Português',\n  fr: 'Français',\n  it: 'Italiano',\n  nl: 'Nederlands', // Dutch\n  da: 'Dansk', // Danish\n  sv: 'Svenska', // Swedish\n  nb: 'Norsk bokmål', // Norwegian\n  fi: 'Suomi', // Finish\n  mt: 'Malti', // Maltese\n  pl: 'Język polski', // Polish\n  ru: 'русский язык', // Russian\n  bg: 'български език', // Bulgarian\n  tr: 'Türkçe',\n  ar: 'اَلْعَرَبِيَّة', // Arabic\n  el: 'ελληνικά', // Greek\n  ro: 'limba română', // Romanian\n  sl: 'slovenščina', // Slovenian\n  // uk: 'украї́нська мо́ва', // Ukrainian\n  // cy: 'Cymraeg', // Welsh\n}\n\nconst localesArray = Object.entries(locales)\n.map(([code, nativeName]) => ({code, nativeName}))\n\nconst defaultOptions = Object.keys(locales)\n\nfunction LocaleSelect({\n  defaultValue,\n  onChange,\n  options = defaultOptions,\n}) {\n  if (\n    defaultValue === null\n    || defaultValue === undefined\n    || defaultValue === ''\n    || locales.hasOwnProperty(defaultValue) === false\n  ) {\n    defaultValue = '_'\n  }\n\n  const [changedLocale, setChangedLocale] = useState(defaultValue)\n\n  const handleLocaleChange = useCallback(newLocale => {\n    setChangedLocale(newLocale)\n    \n    if (newLocale === '_') {\n      newLocale = null\n    }\n\n    if (onChange) {\n      onChange(newLocale)\n    }\n  }, [ setChangedLocale, onChange ])\n  \n  return (\n    <PopoverMenu\n      trigger={(triggerProps, { isOpen }) => (\n        <button\n          {...triggerProps}\n          className=\"default hasIcon\"\n          style={{\n            margin: '0',\n          }}\n        >\n          <span style={{ width: '100%', textAlign: 'start' }}>\n          {\n            changedLocale === '_'\n            ? <MdiIcon\n              path={mdiTranslate}\n              className=\"icon\"\n            />\n            : changedLocale.toUpperCase()\n          }\n          </span>\n          <span style={{\n            marginLeft: 'var(--basis)',\n            lineHeight: '1',\n            verticalAlign: 'text-top',\n          }}>\n            { isOpen ? '▴' : '▾' }\n          </span>\n        </button>\n      )}\n      paperProps={{\n        sx: {\n          maxHeight: '300px',\n        }\n      }}\n    >\n      {({ close }) => (\n        <div style={{\n          padding: 'var(--basis_x2) 0',\n        }}>\n          {\n            localesArray\n            .filter(({ code }) => options.includes(code))\n            .map(({ code, nativeName }) => (\n              <MenuItem\n                key={code}\n                onClick={() => {\n                  handleLocaleChange(code)\n                  close()\n                }}\n                className=\"roundMenuItem\"\n                selected={code === changedLocale}\n              >\n                {code === '_' ? nativeName : `${code.toUpperCase()} — ${nativeName}`}\n              </MenuItem>\n            ))\n          }\n        </div>\n      )}\n    </PopoverMenu>    \n  )\n}\n\nexport default LocaleSelect\n","import { useState, useCallback } from 'react'\n\nimport classes from './InputWithLocal.module.css'\nimport LocaleSelect from './LocaleSelect.js'\n\nfunction InputWithLocal({ reorderHandle, actionButton, locale, defaultValue, children, style, onChange, onBlur, className, dataset = {}, ...props }) {\n  const [changedLocale, setChangedLocale] = useState(locale)\n  const [changedValue, setChangedValue] = useState(defaultValue)\n\n  const handleBlur = useCallback(() => {\n    if (onBlur) {\n      onBlur({\n        value: {\n          locale: changedLocale,\n          value: changedValue,\n        },\n        dataset,\n      })\n    }\n  }, [ onBlur, changedLocale, changedValue, dataset ])\n\n  const handleLocaleChange = useCallback(newLocale => {\n    setChangedLocale(newLocale)\n\n    const changes = {\n      value: {\n        locale: newLocale,\n        value: changedValue,\n      },\n      dataset,\n    }\n\n    if (onChange) {\n      onChange(changes)\n    }\n    if (onBlur) {\n      onBlur(changes)\n    }\n  }, [setChangedLocale, onChange, changedValue, dataset, onBlur])\n\n  const handleTextChange = useCallback((event_or_value) => {\n    let value = event_or_value\n    if (\n      !!event_or_value\n      && !!event_or_value.target\n      && !!event_or_value.target.value\n    ) {\n      value = event_or_value.target.value\n    }\n\n    setChangedValue(value)\n    if (onChange) {\n      onChange({\n        value: {\n          locale: changedLocale,\n          value,\n        },\n        dataset,\n      })\n    }\n  }, [setChangedValue, onChange, changedLocale, dataset])\n\n  return <div\n    className={classes.input_with_local+' '+className}\n    style={style}\n  >\n    <LocaleSelect\n      onChange={handleLocaleChange}\n      defaultValue={locale}\n    />\n    {\n      !!children\n        ? children({\n          onChange: handleTextChange,\n          onBlur: handleBlur,\n          defaultValue: defaultValue,\n          style: {\n            flexGrow: '1',\n          }\n        })\n        : null\n    }\n  </div>\n}\n\nexport default InputWithLocal\n","import { useState, useCallback, useEffect } from 'react'\n\nimport { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd'\n\nimport { v4 as uuidv4 } from 'uuid'\n\nimport classes from './Repeater.module.css'\n\nimport DragIndicatorIcon from '@mui/icons-material/DragIndicator'\n\nfunction reorder(list, startIndex, endIndex) {\n  const result = Array.from(list)\n  const [removed] = result.splice(startIndex, 1)\n  result.splice(endIndex, 0, removed)\n\n  return result\n}\n\nfunction Row({\n  subDefaultValue,\n  index,\n  render,\n  handleRowChange,\n  isReorderable,\n  handleAddRow,\n  handleRemoveRow,\n  showReorderControls,\n  reorderLabel,\n  showActionButton,\n  hasOnlyOneRow,\n  addRowByIndex,\n}) {\n  return <Draggable\n      key={subDefaultValue.tmp_id}\n      draggableId={subDefaultValue.tmp_id}\n      index={index}\n      isDragDisabled={isReorderable === true ? false : true}\n      disableInteractiveElementBlocking={true}\n      shouldRespectForcePress={true}\n    >\n      {provided => (\n        <div\n          ref={provided.innerRef}\n          {...provided.draggableProps}\n\n          key={subDefaultValue.tmp_id}\n          className={classes.row}\n        >\n          {/*\n            index !== 0\n            ? <div className={classes.middleActions}>\n              <div className={classes.trigger}></div>\n              <div className={classes.content}>\n                <button className={`green ${classes.inlineRowButton}`} data-index={index} onClick={handleAddRow}>+</button>\n              </div>\n            </div>\n            : null\n          */}\n\n        <div className={classes.form}>\n          {\n            isReorderable === true && showReorderControls === true\n              ? <button\n                  aria-label={reorderLabel}\n                  className={`text ${classes.inlineRowButton} ${classes.dragHandleButton}`}\n                  {...provided.dragHandleProps}\n                >\n                  <DragIndicatorIcon />\n                </button>\n              : null\n          }\n          {\n            render({\n              key: subDefaultValue.tmp_id,\n              defaultValue: subDefaultValue,\n              className: classes.item,\n              dataset: {\n                'data-index': index,\n                'data-id': subDefaultValue.tmp_id,\n              },\n              onChange: handleRowChange,\n              onRemoveRow: () => handleRemoveRow(index),\n              addRowBefore: (newValue) => addRowByIndex(index, 0, newValue),\n              addRowAfter: (newValue) => addRowByIndex(index, 1, newValue),\n              reorderHandle: <button\n                  aria-label={reorderLabel}\n                  className={`text ${classes.inlineRowButton} ${classes.dragHandleButton}`}\n                  {...provided.dragHandleProps}\n                >\n                  <DragIndicatorIcon />\n                </button>,\n              actionButton: (\n                hasOnlyOneRow\n                  ? <button className={`green ${classes.inlineRowButton}`} onClick={handleAddRow}>+</button>\n                  : <button className={`red ${classes.inlineRowButton}`} data-index={index} onClick={handleRemoveRow}>–</button>\n              ),\n            })\n          }\n          {\n            showActionButton === true\n            ? (\n            hasOnlyOneRow\n              ? <button className={`green ${classes.inlineRowButton}`} onClick={handleAddRow}>+</button>\n              : <button className={`red ${classes.inlineRowButton}`} data-index={index} onClick={handleRemoveRow}>–</button>\n            )\n            : null\n          }\n        </div>\n      </div>\n    )}\n  </Draggable>\n}\n\nfunction getIndex(eventOrIndex) {\n  let index = eventOrIndex // for if it is a number/index\n\n  if (typeof eventOrIndex === 'object') {\n    if (!!eventOrIndex.target) { // is event\n      eventOrIndex = eventOrIndex.target\n    }\n    if (!!eventOrIndex.dataset) { // is only the dataset\n      if (!!eventOrIndex.dataset.index) {\n        index = parseInt(eventOrIndex.dataset.index)\n        if (isNaN(index)) {\n          index = null\n        }\n      }\n    }\n  }\n\n  return index\n}\n\nfunction Repeater({\n  defaultValue,\n  addDefaultValue,\n  addButtonText,\n  hideAddButton = false,\n  reorderLabel = 'Reorder',\n  render,\n  style,\n  onChange,\n  prependNewItems,\n  showReorderControls = false,\n  showActionButton = true,\n  isReorderable = false\n}) {\n  if (!(!!addButtonText)) {\n    addButtonText = 'Add Row'\n  }\n\n  const [rows, setRows] = useState([])\n\n  const internalAddDefaultValue = useCallback(() => {\n    let tmp_defaultValue = {}\n    if (typeof addDefaultValue === 'function') {\n      const defaultValue = addDefaultValue()\n      if (typeof defaultValue === 'object' && defaultValue !== null) {\n        tmp_defaultValue = defaultValue\n        if (\n          typeof tmp_defaultValue.tmp_id !== 'string'\n          || tmp_defaultValue.tmp_id === ''\n        ) {\n          tmp_defaultValue.tmp_id = uuidv4()\n        }\n      }\n    }\n    return tmp_defaultValue\n  }, [addDefaultValue])\n\n  useEffect(() => {\n    let tmp_defaultValue = defaultValue\n    if (!Array.isArray(defaultValue) || defaultValue.length === 0) {\n      tmp_defaultValue = [internalAddDefaultValue()]\n    }\n    tmp_defaultValue = tmp_defaultValue.map(item => {\n      if (!item.tmp_id) {\n        return { ...item, tmp_id: uuidv4() }\n      }\n      return item\n    })\n    setRows(tmp_defaultValue)\n  }, [defaultValue, internalAddDefaultValue, setRows])\n\n  const handleRemoveRow = useCallback(eventOrIndex => {\n    const index = getIndex(eventOrIndex)\n\n    let new_rows = [...rows]\n    new_rows.splice(index, 1)\n    const rows_from_onChange = onChange(new_rows)\n    if (Array.isArray(rows_from_onChange)) {\n      new_rows = rows_from_onChange\n    }\n    setRows(new_rows)\n  }, [rows, setRows, onChange])\n\n  const handleRowChange = useCallback(event => {\n    const index = event.dataset.index || event.dataset['data-index']\n    const tmp_id = event.dataset.id || event.dataset['data-id']\n    const newValue = event.value\n\n    const new_rows = [...rows]\n    if (typeof newValue !== 'object' || newValue === null || Array.isArray(newValue)) {\n      new_rows[index] = {\n        tmp_id,\n        value: newValue\n      }\n    } else if (typeof newValue === 'object') {\n      new_rows[index] = {\n        tmp_id,\n        ...newValue\n      }\n    }\n    setRows(new_rows)\n    onChange(new_rows)\n  }, [rows, setRows, onChange])\n\n  const addRowByIndex = useCallback((index, offset = 0, newValue) => {\n    if (typeof newValue === 'object') {\n      newValue = {\n        ...(internalAddDefaultValue()),\n        ...newValue,\n      }\n    } else {\n      newValue = newValue || internalAddDefaultValue()\n    }\n\n    let new_rows = null\n    if (index !== null && index >= 0) {\n      new_rows = [...rows]\n      new_rows.splice(index + offset, 0, newValue)\n    }\n\n    setRows(new_rows)\n    onChange(new_rows)\n  }, [rows, internalAddDefaultValue, setRows, onChange])\n\n  const handleAddRow = useCallback(eventOrIndex => {\n    const newValue = internalAddDefaultValue()\n\n    const index = getIndex(eventOrIndex)\n\n    let new_rows = null\n    if (index !== null && index >= 0) {\n      new_rows = [...rows]\n      new_rows.splice(index, 0, newValue)\n    } else {\n      if (prependNewItems === true) {\n        new_rows = [newValue, ...rows]\n      } else {\n        new_rows = [...rows, newValue]\n      }\n    }\n\n    setRows(new_rows)\n    onChange(new_rows)\n  }, [rows, internalAddDefaultValue, setRows, onChange, prependNewItems])\n\n  function onDragEnd(result) {\n    if (!result.destination) {\n      return\n    }\n\n    if (result.destination.index === result.source.index) {\n      return\n    }\n\n    const new_rows = reorder(\n      rows,\n      result.source.index,\n      result.destination.index\n    )\n    setRows(new_rows)\n    onChange(new_rows)\n  }\n\n  const hasOnlyOneRow = rows.length === 1\n\n  const addButton = <div style={{ textAlign: 'right' }}>\n    <button className={`green ${classes.addRowButton}`} onClick={handleAddRow}>{addButtonText}</button>\n  </div>\n\n  return <div style={style}>\n    {hideAddButton === false && (!hasOnlyOneRow && prependNewItems) ? <div style={{ marginBottom: 'var(--basis)' }}>{addButton}</div> : null}\n\n    <DragDropContext onDragEnd={onDragEnd}>\n      <Droppable\n        droppableId=\"list\"\n        isDropDisabled={isReorderable === true ? false : true}\n      >\n        {provided => (\n          <div ref={provided.innerRef} {...provided.droppableProps}>\n            {\n              rows\n              .filter(subDefaultValue => subDefaultValue.tmp_id)\n              .map(\n                (subDefaultValue, index) => <Row\n                  key={subDefaultValue.tmp_id}\n                  {...{\n                    subDefaultValue,\n                    index,\n                    render,\n                    handleRowChange,\n                    isReorderable,\n                    handleAddRow,\n                    handleRemoveRow,\n                    showReorderControls,\n                    reorderLabel,\n                    showActionButton,\n                    hasOnlyOneRow,\n                    addRowByIndex,\n                  }}\n                />\n              )\n            }\n            {provided.placeholder}\n          </div>\n        )}\n      </Droppable>\n    </DragDropContext>\n\n    {hideAddButton === false && (!hasOnlyOneRow && !prependNewItems) ? addButton : null}\n  </div>\n}\n\nexport default Repeater\n","import React, { useEffect, useState, useCallback } from 'react'\n\nimport {\n  Modal,\n} from '@mui/material'\n\nimport { Localized } from '../../fluent/Localized.js' // useLocalization\n\nimport classes from './TranslationEditor.module.css'\n\nimport HtmlInput from './HtmlInput.js'\nimport InputWithLocal from './InputWithLocal.js'\nimport ViewerAuto from '../view/ViewerAuto.js'\nimport LocaleSelect from './LocaleSelect.js'\nimport Repeater from '../Repeater.js'\n\nimport useSaveBlock from '../../hooks/useSaveBlock.js'\nimport useLoadBlocks from '../../hooks/useLoadBlocks.js'\n\nfunction SimpleTranslationRepeater({ onSaveProperty, block, isFirst }) {\n\n  const addDefaultValue = () => ({\n    locale: null,\n    value: '',\n  })\n\n  let translations = block.properties.translations || []\n  if (translations.length === 0) {\n    translations = [addDefaultValue]\n  }\n\n  const onRepeaterChange = useCallback(newTranslations => {\n    newTranslations = newTranslations\n      .map(translation => ({\n        ...translation,\n        text: translation.value || '',\n      }))\n\n    onSaveProperty('translations', newTranslations)\n  }, [ onSaveProperty ])\n\n  const onBlockLocaleChange = useCallback(newLocale => {\n    onSaveProperty('locale', newLocale)\n  }, [ onSaveProperty ])\n\n  const block2display = { ...block }\n  if (isFirst === true && block2display.type === 'page') {\n    block2display.type = 'text'\n    block2display.properties.text_style = 'h1'\n  }\n\n  return <div style={{\n    width: '100%',\n  }}>\n\n    <div style={{\n      display: 'flex',\n      alignItems: 'flex-end',\n      marginBottom: 'var(--basis)',\n      gap: 'var(--basis)',\n    }}>\n      <LocaleSelect\n        onChange={onBlockLocaleChange}\n        defaultValue={block.properties.locale || null}\n      />\n\n      <ViewerAuto\n        block={block2display}\n        style={{\n          margin: '0',\n          minHeight: '30px',\n        }}\n        actions={{\n          click: false,\n        }}\n      />\n    </div>\n\n    <Repeater\n      onChange={onRepeaterChange}\n      defaultValue={translations}\n      addDefaultValue={addDefaultValue}\n      addButtonText=\"+\"\n      render={\n        ({ defaultValue, ...repeater_props }) => {\n          const {\n            onChange,\n            ...other_repeater_props\n          } = repeater_props\n\n          const locale = defaultValue.locale\n          const value = defaultValue.text\n          return <InputWithLocal\n            onBlur={onChange}\n            locale={locale}\n            defaultValue={value}\n            style={{\n              marginBottom: 'var(--basis)',\n            }}\n            {...other_repeater_props}\n          >\n            {InputWithLocal_props => <HtmlInput\n              {...InputWithLocal_props}\n              style={{\n                ...InputWithLocal_props.style,\n                margin: '0',\n              }}\n            />}\n          </InputWithLocal>\n        }\n      }\n    />\n  </div>\n}\n\nfunction TranslationEditor({\n  defaultBlock = {},\n  open = false,\n  onSaveProperty, // to not overwrite the translatins by the PageEditor\n  onClose,\n}) {\n\n  const [blocks, setBlocks] = useState([])\n\n  const loadBlocks = useLoadBlocks()\n  useEffect(() => {\n    async function loadContentBlocks () {\n      const ids2load = [\n        ...defaultBlock.content\n          .filter(contentConfig =>\n            contentConfig.hasOwnProperty('blockId')\n            && contentConfig.hasOwnProperty('block')\n          )\n          .map(contentConfig => contentConfig.blockId || contentConfig.block._id),\n      ]\n\n      let loadedBlocks = []\n      if (ids2load.length > 0) {\n        loadedBlocks = await loadBlocks({ ids: ids2load })\n      }\n\n      let contentBlocks = ids2load.map(id => { // map to the ids to keep the order\n        const block = loadedBlocks.find(block => block._id === id)\n        if (\n          block\n          && block.type !== 'divider'\n          && !!block.properties.text\n        ) {\n          return block\n        } else {\n          return null\n        }\n      })\n      .filter(Boolean) // remove null values\n\n      return contentBlocks\n    }\n\n    if (blocks.length === 0) {\n      loadContentBlocks()\n        .then(contentBlocks => {\n          const newBlocks = [\n            defaultBlock,\n            ...contentBlocks,\n          ]\n\n          setBlocks(newBlocks)\n        })\n    } else if (JSON.stringify(defaultBlock) !== JSON.stringify(blocks[0])) {\n      // replace the first block of blocks with defaultBlock\n      setBlocks([\n        defaultBlock,\n        ...blocks.slice(1),\n      ])\n    }\n  }, [ defaultBlock, loadBlocks, setBlocks, blocks ])\n\n  const saveBlock = useSaveBlock()\n  const onSaveChildProperty = useCallback((block, key, value) => {\n    const newBlock = {\n      ...block,\n      properties: {\n        ...block.properties,\n        [key]: value,\n      },\n    }\n\n    saveBlock(newBlock)\n      .then(gottenBlock => { // only the id changed in gottenBlock      \n        const blockId = newBlock._id\n\n        // find the block in the blocks array by _id\n        const blockIndex = blocks.findIndex(block => block._id === blockId)\n        \n        // replace the block at blockIndex in the blocks array by newBlock\n        const newBlocks = [\n          ...blocks.slice(0, blockIndex),\n          newBlock,\n          ...blocks.slice(blockIndex + 1),\n        ]\n\n        setBlocks(newBlocks)\n      })\n  }, [ saveBlock, blocks, setBlocks ])\n\n  if (!open) {\n    return null\n  }\n\n  return (\n    <Modal\n      open={open}\n      onClose={onClose}\n      hideBackdrop={true}\n      style={{\n        zIndex: '1000',\n      }}\n    >\n      <>\n        <div className={classes.backdrop} onClick={onClose}></div>\n\n        <div className={classes.dialog}>\n\n          \n          <div className={classes.actions}>\n            <h1 style={{ margin: '0 0 var(--basis_x4) 0' }}>\n              <Localized id=\"translate_dialog_title\" />\n            </h1>\n            <button onClick={onClose} className=\"green\" style={{ marginInlineEnd: '0' }}>\n              <Localized id=\"dialog_done\" />\n            </button>\n          </div>\n          <p>\n            <Localized id=\"translate_dialog_description\" />\n          </p>\n\n          <hr style={{ opacity: 0.2 }} />\n\n          {\n            blocks\n            .flatMap((block, index) => ([\n              <hr key={'hr-'+index} style={{ opacity: 0 }} />,\n              <div key={'div-'+index} style={{ margin: 'var(--basis_x4) 0' }}>\n                <SimpleTranslationRepeater\n                  onSaveProperty={\n                    block._id === defaultBlock._id\n                    ? onSaveProperty\n                    : (...attr) => onSaveChildProperty(block, ...attr)\n                  }\n                  block={block}\n                  isFirst={index === 0}\n                />\n              </div>\n            ]))\n          }\n\n          <hr style={{ opacity: 0.2 }} />\n\n          <div className={classes.actions}>\n            <div></div>\n            <button onClick={onClose} className=\"green\" style={{ marginInlineEnd: '0' }}>\n              <Localized id=\"dialog_done\" />\n            </button>\n          </div>\n        </div>\n      </>\n    </Modal>\n  )\n}\n\nexport default TranslationEditor\n","import { useState } from 'react'\n\nimport classes from './FancyInput.module.css'\n\nfunction FancyInput({ children, className, style, ...props }) {\n  const [error, setError] = useState('')\n\n  return <div\n    className={className}\n    style={style}\n  >\n    {children({ setError })}\n    {\n      error\n      ? <div className={classes.error}>\n          {error.split('\\n').map(error => <p key={error}>{error}</p>)}\n        </div>\n      : null\n    }\n  </div>\n}\n\nexport default FancyInput\n","import { useCallback } from 'react'\n\nconst email_regex = /^(?:(?:[^<>()[\\]\\\\.,;:\\s@\"]+(?:\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(?:\".+\"))@(?:(?:\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})|(?:(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,})\\.?)$/gui // is surrounded by start and end tags\nconst emails_regex = /((?:(?:[^<>()[\\]\\\\.,;:\\s@\"]+(?:\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(?:\".+\"))@(?:(?:\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})|(?:(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,})\\.?))/gui // is surrounded by a group\n\nfunction EmailInput({ multiple = false, onChange, onError, ...props }) {\n  const handleTextChange = useCallback((event) => {\n    if (onChange || onError) {\n      let value = event.target.value || ''\n      let isSubmittable = false\n      let error = ''\n\n      if (value !== '') {\n        if (multiple === true) {\n          const emails = value.match(emails_regex)\n          if (emails) {\n            value = emails\n            isSubmittable = true\n          } else {\n            error = 'Invalid email(s) format'\n          }\n        } else {\n          if (value.match(email_regex)) {\n            isSubmittable = true\n          } else {\n            error = 'invalid_email'\n          }\n        }\n      }\n\n      if (onChange) {\n        if (isSubmittable) {\n          onChange(value)\n        } else {\n          if (multiple === true) {\n            onChange([])\n          } else {\n            onChange('')\n          }\n        }\n      }\n\n      if (onError) {\n        onError(error)\n      }\n    }\n  }, [multiple, onChange, onError])\n\n  return <input\n    type=\"email\"\n    onChange={handleTextChange}\n    {...props}\n  />\n}\n\nexport default EmailInput\n","import React, { useState, useCallback, useEffect } from 'react'\n\nimport {\n  Modal,\n  Menu,\n  MenuItem,\n  Divider,\n  ListItemIcon,\n  ListItemText,\n} from '@mui/material'\nimport {\n  KeyboardArrowDown as KeyboardArrowDownIcon,\n  Delete as DeleteIcon,\n  Close as CloseIcon,\n  Visibility as ViewerIcon,\n  Edit as EditorIcon,\n} from '@mui/icons-material'\nimport { v4 as uuidv4 } from 'uuid'\n\nimport { Localized, useLocalization } from '../../fluent/Localized.js'\n\nimport useUser from '../../hooks/useUser.js'\n\nimport FancyInput from './FancyInput.js'\nimport EmailInput from './EmailInput.js'\n\nimport classes from './PermissionsEditor.module.css'\n\nfunction addTmpIds(array) {\n  return [...array].map(obj => {\n    const obj_new = { ...obj }\n    obj_new.tmp_id = uuidv4()\n    return obj_new\n  })\n}\n\nfunction LocalizedRole({ role }) {\n  return <Localized id={'role_'+role} />\n}\n\nfunction RolesMenu({\n  role,\n  trigger,\n  changeRole,\n  removePermission,\n}){\n  const [anchorEl, setAnchorEl] = React.useState(null)\n  const open = Boolean(anchorEl)\n  const handleOpen = event => {\n    setAnchorEl(event.currentTarget)\n  }\n  const handleClose = () => {\n    setAnchorEl(null)\n  }\n\n  return <>\n    {trigger({\n      onClick: handleOpen,\n    })}\n\n    <Menu\n      anchorEl={anchorEl}\n      open={open}\n      onClose={handleClose}\n      MenuListProps={{\n        style: {\n          maxWidth: '100%',\n        },\n      }}\n    >\n        {\n          role === 'editor'\n          ? <MenuItem onClick={() => changeRole('viewer')}>\n              <ListItemIcon>\n                <ViewerIcon />\n              </ListItemIcon>\n              <ListItemText>\n                <LocalizedRole role=\"viewer\" />\n              </ListItemText>\n            </MenuItem>\n          : <MenuItem onClick={() => changeRole('editor')}>\n              <ListItemIcon>\n                <EditorIcon />\n              </ListItemIcon>\n              <ListItemText>\n                <LocalizedRole role=\"editor\" />\n              </ListItemText>\n            </MenuItem>\n        }\n\n        {\n          typeof removePermission === 'function'\n          ? <MenuItem onClick={removePermission}>\n              <ListItemIcon>\n                <DeleteIcon />\n              </ListItemIcon>\n              <ListItemText>\n                Remove\n              </ListItemText>\n            </MenuItem>\n          : null\n        }\n\n        <Divider style={{opacity: 0.2}} />\n\n        <MenuItem onClick={handleClose}>\n          <ListItemIcon>\n            <CloseIcon />\n          </ListItemIcon>\n          <ListItemText>\n            Close\n          </ListItemText>\n        </MenuItem>\n    </Menu>\n  </>\n}\n\nfunction sortPermissions(permissions) {\n  const owner = permissions\n    .filter(p => p.role === 'owner')\n    .sort((a, b) => a.email.localeCompare(b.email))\n\n  const special = permissions\n    .filter(p => p.email === '@volteuropa.org' || p.email === '@public')\n    .sort((a, b) => a.email.localeCompare(b.email))\n\n  const other = permissions\n    .filter(p => p.role !== 'owner' && p.email !== '@volteuropa.org' && p.email !== '@public')\n    .sort((a, b) => a.email.localeCompare(b.email))\n\n  return [\n    ...owner,\n    ...special,\n    ...other,\n  ]\n}\n\nfunction PermissionsEditor({\n  defaultPermissions,\n  open = false,\n  onChange,\n  onClose,\n}) {\n  const { getString } = useLocalization()\n\n  const user_data = useUser()\n  let user_email = ''\n  if (!!user_data) {\n    if (!!user_data.user) {\n      if (!!user_data.user.email) {\n        user_email = user_data.user.email\n      }\n    }\n  }\n\n  const [inputRepaintKey, setInputRepaintKey] = useState(0)\n  const [permissions, setPermissions] = useState([])\n  const [newEmails, setNewEmails] = useState([])\n  const [newRole, setNewRole] = useState('editor')\n\n  const setNewPermission = useCallback(newPermissions => {\n    newPermissions = addTmpIds(newPermissions || [])\n\n    if (user_email !== '') {\n      const doesNotHaveOwner = newPermissions.filter(permission => permission.role === 'owner').length === 0\n      if (doesNotHaveOwner) {\n        newPermissions.unshift({ tmp_id: uuidv4(), email: user_email, role: 'owner' })\n      }\n    }\n    \n    setPermissions(newPermissions)\n  }, [ user_email, setPermissions ])\n\n  useEffect(() => {\n    const blockPermissions = defaultPermissions['/']\n    if (Array.isArray(blockPermissions)) {\n      setNewPermission(blockPermissions)\n    } else {\n      setNewPermission([])\n    }\n  }, [ setNewPermission, defaultPermissions ])\n\n  const removePermission = useCallback(email => {\n    let newPermissions = permissions.filter(p => p.email !== email)\n    if (email === '@volteuropa.org') {\n      newPermissions = newPermissions.filter(p => p.email !== '@public')\n    }\n\n    const doesNotHaveOwner = newPermissions.filter(p => p.role === 'owner').length === 0\n    if (doesNotHaveOwner) {\n      newPermissions = newPermissions.filter(p => p.email !== user_email)\n      newPermissions.unshift({ tmp_id: uuidv4(), email: user_email, role: 'owner' })\n    }\n\n    setPermissions(newPermissions)\n    onChange({ '/': newPermissions })\n  }, [permissions, user_email, setPermissions, onChange])\n\n  const changeRole = useCallback((email, newRole) => {\n    const newPermissions = permissions.map(permission => {\n      if (permission.email === email) {\n        return {\n          ...permission,\n          role: newRole,\n        }\n      }\n      return permission\n    })\n\n    setPermissions(newPermissions)\n    onChange({ '/': newPermissions })\n  }, [permissions, setPermissions, onChange])\n\n  const addPermissions = useCallback((newEmails, newRole) => {\n    if (newEmails.includes('@public')) {\n      newEmails.push('@volteuropa.org')\n    }\n    let newPermissions = permissions.filter(permission => !newEmails.includes(permission.email))\n    for (const newEmail of newEmails) {\n      newPermissions.unshift({ tmp_id: uuidv4(), email: newEmail, role: newRole })\n    }\n\n    const doesNotHaveOwner = newPermissions.filter(p => p.role === 'owner').length === 0\n    if (doesNotHaveOwner) {\n      newPermissions = newPermissions.filter(p => p.email !== user_email)\n      newPermissions.unshift({ tmp_id: uuidv4(), email: user_email, role: 'owner' })\n    }\n\n    setPermissions(newPermissions)\n    onChange({ '/': newPermissions })\n  }, [permissions, user_email, setPermissions, onChange])\n\n  const addNewPermissionFromInput = useCallback(() => {\n    addPermissions(newEmails, newRole)\n    setNewEmails([]) // reset the email-input | don't reset the role-input so it can be reused when entering multiple emails after each other // setNewRole('editor')\n    setInputRepaintKey(oldInputRepaintKey => oldInputRepaintKey + 1) // redraw the email-input\n  }, [ newEmails, newRole, addPermissions ])\n\n  if (!open) {\n    return null\n  }\n\n  const doesNotHaveVoltEuropa = permissions.filter(permission => permission.email === '@volteuropa.org').length === 0\n  const doesNotHavePublic = permissions.filter(permission => permission.email === '@public').length === 0\n\n  return (\n    <Modal\n      open={open}\n      onClose={onClose}\n      hideBackdrop={true}\n    >\n      <>\n        <div className={classes.backdrop} onClick={onClose}></div>\n\n        <div className={classes.dialog}>\n          <h1 style={{ margin: '0 0 var(--basis_x4) 0' }}>Give viewing and editing rights</h1>\n          <p>Enter @volteuropa.org addresses to give editing rights.<br/>Groups addresses are not supported.</p>\n          <div className={classes.inputWrapper} key={inputRepaintKey}>\n            <FancyInput className={classes.input}>\n              {({ setError }) => (\n                <EmailInput\n                  multiple={true}\n                  onError={setError}\n                  defaultValue=\"\"\n                  onChange={setNewEmails}\n                  aria-label={getString('path_editor_permissions_edit_label')}\n                  placeholder={getString('path_editor_permissions_edit_placeholder')}\n                  style={{\n                    flexGrow: '1',\n                    // margin: '0',\n                    margin: 'var(--basis) 0',\n                    width: 'calc(100% - var(--basis_x2))',\n                  }}\n                />\n              )}\n            </FancyInput>\n            <RolesMenu\n              role={newRole}\n              changeRole={setNewRole}\n              trigger={triggerProps => <button className={classes.menuButton} {...triggerProps}><LocalizedRole role={newRole} /> <KeyboardArrowDownIcon/></button>}\n            />\n          </div>\n\n          {\n            newEmails.length > 0 && newEmails[0].length > 0\n            ? <>\n                <hr />\n\n                <div className={classes.actions}>\n                  <div></div>\n                  <button onClick={addNewPermissionFromInput} className=\"green\" style={{margin: '0'}}>\n                    {\n                      newEmails.length > 1\n                      ? \"Add People\"\n                      : \"Add Person\"\n                    }\n                  </button>\n                </div>\n              </>\n            : <>\n                {\n                  doesNotHaveVoltEuropa || doesNotHavePublic\n                  ? <div style={{ marginTop: 'var(--basis_x2)' }}>\n                    Make visible for…\n                    {\n                      doesNotHaveVoltEuropa\n                      ? <button onClick={() => addPermissions(['@volteuropa.org'], 'viewer')}>Volt Europa</button>\n                      : null\n                    }\n                    {\n                      doesNotHavePublic\n                      ? <button onClick={() => addPermissions(['@public'], 'viewer')}>Public</button>\n                      : null\n                    }\n                  </div>\n                  : null\n                }\n\n                {\n                  permissions.length === 0\n                   ? null\n                   : <hr style={{ opacity: 0.2 }} />\n                }\n\n                {\n                  sortPermissions(permissions)\n                  .map(p => <div key={p.tmp_id} className={classes.permissionRow}>\n                    {\n                      p.email === '@public'\n                        ? <strong>Public</strong>\n                        : (\n                          p.email === '@volteuropa.org'\n                            ? <strong>Volt Europa</strong>\n                            : <span>{p.email}</span>\n                        )\n                    }\n\n                    {\n                      p.role === 'owner'\n                      ? <strong className={`type_button ${classes.ownerInfo}`}><LocalizedRole role={p.role} /></strong>\n                      : <RolesMenu\n                          role={p.role}\n                          removePermission={() => removePermission(p.email)}\n                          changeRole={(newRole) => changeRole(p.email, newRole)}\n                          trigger={triggerProps => <button className={classes.menuButton} {...triggerProps}><LocalizedRole role={p.role} /> <KeyboardArrowDownIcon/></button>}\n                        />\n                    }\n                  </div>)\n                }\n\n                <hr style={{ opacity: 0.2 }} />\n\n                <div className={classes.actions}>\n                  <div></div>\n                  <button onClick={onClose} className=\"green\" style={{margin: '0'}}>\n                    <Localized id=\"dialog_done\" />\n                  </button>\n                </div>\n              </>\n          }\n        </div>\n      </>\n    </Modal>\n  )\n}\n\nexport default PermissionsEditor\n","import { useCallback, useState } from 'react'\n\nimport {\n  CheckBox as CheckBoxIcon,\n  CheckBoxOutlineBlank as CheckBoxOutlineBlankIcon,\n} from '@mui/icons-material'\n\nfunction CheckboxInput({\n  defaultValue = '',\n  onChange,\n  onBlur,\n  style,\n  className,\n  disabled = false,\n}) {\n  // TODO: make ARIA compatible\n\n  const [ checked, setChecked ] = useState(Boolean(defaultValue))\n\n  const publishChanges = useCallback(() => {\n    if (onChange) {\n      onChange(checked)\n    }\n    if (onBlur) {\n      onBlur(checked)\n    }\n  }, [ onChange, onBlur, checked ])\n\n  const checkBlock = useCallback(() => {\n    if (disabled === true) {\n      return\n    }\n    publishChanges()\n    setChecked(true)\n  }, [ disabled, publishChanges, setChecked ])\n\n  const uncheckBlock = useCallback(() => {\n    if (disabled === true) {\n      return\n    }\n    publishChanges()\n    setChecked(false)\n  }, [ disabled, publishChanges, setChecked ])\n\n  return <div\n    style={{\n      display: 'inline-block',\n      padding: 'var(--basis)',\n      cursor: disabled === true ? 'default' : 'pointer',\n      verticalAlign: 'middle',\n      ...style,\n    }}\n    className={className}\n  >\n    {\n      checked\n      ? <CheckBoxIcon onClick={uncheckBlock} />\n      : <CheckBoxOutlineBlankIcon onClick={checkBlock} />\n    }\n  </div>\n}\n\nexport default CheckboxInput\n","import { useState, useCallback, useEffect } from 'react'\n\nfunction MultiButton({ ariaLabel, items, defaultValue, onChange, style, className }) {\n  const [choosen, setChoosen] = useState()\n\n  useEffect(() => setChoosen(defaultValue), [defaultValue, setChoosen])\n\n  const handleClick = useCallback(event => {\n    const newValue = event.target.dataset.value\n    setChoosen(newValue)\n    if (onChange) {\n      onChange(newValue)\n    }\n  }, [setChoosen, onChange])\n\n  return <div\n    aria-label={ariaLabel}\n    className={'buttonRow ' + (className || '')}\n    style={{\n      display: 'inline-block',\n      ...style\n    }}\n  >\n    {\n      items.map(item => {\n        const value = item.value\n        const title = item.title\n        const icon = item.icon || null\n        return <button\n          key={value+'_'+title}\n          className={`default ${choosen === value ? 'choosen' : ''} ${!!icon ? 'hasIcon' : ''}`}\n          onClick={handleClick}\n          data-value={value}\n        >\n          <span style={{pointerEvents: 'none'}}>\n            {!!icon ? icon : null}\n            {!!title ? <span style={{verticalAlign: 'middle'}}>{title}</span> : null}\n          </span>\n        </button>\n      })\n    }\n  </div>\n}\n\nexport default MultiButton\n","import { useCallback, useState } from 'react'\n\nconst url_regex = /^([A-Z0-9+-.]+:(?:\\/\\/)?)[\\w\\u00C0-\\u00FF_.-]+(?:\\.[\\w\\u00C0-\\u00FF_.-]+)+[\\w\\u00C0-\\u00FF_~:/?#[\\]!%$&'()@*+,;=.-]+$/gui\nconst email_regex = /^(?:(?:[^<>()[\\]\\\\.,;:\\s@\"]+(?:\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(?:\".+\"))@(?:(?:\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})|(?:(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,})\\.?)$/gui\nconst is_email_not_url_regex = /^[^:/]+@.+$/gui\n\nfunction UrlInput({\n  defaultValue = '',\n  onChange,\n  onBlur,\n  onError,\n  placeholder = 'https://',\n  style,\n  className\n}) {\n  const [text, setText] = useState(defaultValue)\n\n  const handleTextChange = useCallback((event) => {\n    const value = event.target.value || ''\n    // let isSubmittable = false\n    let error = ''\n\n    if (value !== '') {\n      const schema_parts = value.split(':')\n      const schema = schema_parts.shift()\n      const after_schema = schema_parts.join(':')\n\n      if (schema === 'tel') {\n        // isSubmittable = true\n      } else if (schema === 'mailto' || value.match(is_email_not_url_regex)) {\n        if (after_schema.match(email_regex)) {\n          // isSubmittable = true\n        } else {\n          error = 'invalid_mailto_url'\n        }\n      } else {\n        if (value.match(url_regex)) {\n          // isSubmittable = true\n        } else {\n          error = 'invalid_url'\n        }\n      }\n    }\n\n    if (onChange) {\n      onChange(value)\n    }\n\n    if (onError) {\n      onError(error)\n    }\n\n    setText(value)\n  }, [onChange, onError])\n\n  const handleBlur = useCallback(() => {\n    if (onBlur) {\n      onBlur(text)\n    }\n  }, [onBlur, text])\n\n  return <input\n    type=\"url\"\n    onChange={handleTextChange}\n    onBlur={handleBlur}\n    defaultValue={defaultValue}\n    placeholder={placeholder}\n    style={style}\n    className={className}\n  />\n}\n\nexport default UrlInput\n","export default __webpack_public_path__ + \"static/media/20200912_Plakatschlange_Koeln_Matteo Sant_Unione_011.3f9289d0.png\";","export default __webpack_public_path__ + \"static/media/Aktion.89c1bcdf.png\";","export default __webpack_public_path__ + \"static/media/tYADz4UyUAAcV5WlmWLlkXD9LG8W02U9LbQd8rxzQ2bt99lxwK.6824f6ef.png\";","export default __webpack_public_path__ + \"static/media/Welcome-to-Volt.39e04eca.png\";","export default __webpack_public_path__ + \"static/media/portugal.682fc2e3.jpg\";","\nimport classes from './CoverphotoPicker.module.css'\n\n// import { getImageUrl } from '../../functions.js'\n\nimport Popover from '../Popover.js'\n\nimport { Paper } from '@mui/material'\nimport {\n  RectangleSharp as CoverphotoIcon,\n} from '@mui/icons-material'\n\nimport { Localized, withLocalization } from '../../fluent/Localized.js'\n\nimport MultiButton from '../MultiButton.js'\nimport FancyInput from './FancyInput.js'\nimport UrlInput from './UrlInput.js'\n\nimport plakatschlange_thumb from '../../images/coverphotos/thumbs/20200912_Plakatschlange_Koeln_Matteo Sant_Unione_011.png'\nimport aktion_thumb from '../../images/coverphotos/thumbs/Aktion.png'\nimport volt_bonn_thumb from '../../images/coverphotos/thumbs/tYADz4UyUAAcV5WlmWLlkXD9LG8W02U9LbQd8rxzQ2bt99lxwK.png'\nimport welcome_to_volt_thumb from '../../images/coverphotos/thumbs/Welcome-to-Volt.png'\nimport portugal_thumb from '../../images/coverphotos/thumbs/portugal.jpg'\n\n\nfunction CoverphotoPicker({ getString, coverphotoValue, iconValue, onChange, className = '', style = {} }) {\n  \n  const onUrlChange = newUrl => {\n    onChange({\n      type: 'url',\n      url: newUrl,\n    })\n  }\n\n  const isAbsoluteUrlRegexp = new RegExp('^(?:[a-z]+:)?//', 'i')\n\n  // if (\n  //   typeof coverphotoValue === 'object'\n  //   && coverphotoValue !== null\n  //   && !Array.isArray(coverphotoValue)\n  // ) {\n  //   if (coverphotoValue.type === 'url') {\n  //     return coverphotoValue.url || ''\n  //   }\n  // }\n\n  let coverphotoValueUrl = ''\n  let coverphotoIsSet = false\n  let iconIsSet = false\n\n  if (\n    typeof coverphotoValue === 'object'\n    && coverphotoValue !== null\n    && !Array.isArray(coverphotoValue)\n  ) {\n    if (\n      coverphotoValue.type === 'url'\n      && typeof coverphotoValue.url === 'string'\n      && isAbsoluteUrlRegexp.test(coverphotoValue.url)\n    ) {\n      coverphotoIsSet = true\n      coverphotoValueUrl = coverphotoValue.url || ''\n    }\n  }\n\n  if (\n    typeof iconValue === 'object'\n    && iconValue !== null\n    && !Array.isArray(iconValue)\n  ) {\n    if (\n      iconValue.type === 'url'\n      && typeof iconValue.url === 'string'\n      && isAbsoluteUrlRegexp.test(iconValue.url)\n    ) {\n      iconIsSet = true\n    }\n  }\n\n  return <div\n    className={`\n      ${classes.root}\n      ${coverphotoIsSet ? classes.coverphotoIsSet : classes.coverphotoIsNotSet}\n      ${iconIsSet ? classes.iconIsSet : classes.iconIsNotSet}\n      ${className}\n    `}\n    style={style}\n  >\n    <Popover\n      trigger={(triggerProps) => (\n        <div\n          className={classes.coverphoto}\n          style={{\n            backgroundImage: coverphotoIsSet ? `url(${window.domains.backend}download_url?f=jpg&w=1400&h=400&url=${encodeURIComponent(coverphotoValue.url)})` : '',\n          }}\n        >\n          <div className={classes.button_wrapper}>\n            <button {...triggerProps} className={`text hasIcon ${classes.changeCoverphotoButton}`}>\n              <CoverphotoIcon className=\"icon\" />\n              <span style={{ marginInlineStart: 'var(--basis_x2)', verticalAlign: 'middle'}}>Set Coverphoto</span>\n            </button>\n          </div>\n        </div>\n      )}\n    >\n      {({closePopover, ...popoverProps}) => (\n        <Paper\n          {...popoverProps}\n          sx={{\n            maxWidth: 'calc(calc(100vw - 32px) - var(--basis_x8))',\n            maxHeight: 'calc(calc(100vh - 32px) - var(--basis_x8))',\n            overflow: 'auto',\n            padding: 'var(--basis_x4)',\n            background: 'var(--background-contrast)',\n            color: 'var(--on-background)',\n          }}\n          elevation={8}\n        >\n          <h3 style={{ marginTop: '0' }}><Localized id=\"path_editor_coverphoto_label\" /></h3>\n\n          <em className=\"body2\" style={{ display: 'block', marginBottom: 'var(--basis)' }}>\n            <Localized id=\"path_editor_coverphoto_info\" />\n          </em>\n\n          <FancyInput>\n            {({ setError }) => (\n              <UrlInput\n                onError={setError}\n                onChange={onUrlChange}\n                defaultValue={coverphotoValueUrl}\n                style={{\n                  marginRight: '0',\n                  marginLeft: '0',\n                  width: '100%'\n                }}\n              />\n            )}\n          </FancyInput>\n\n          <MultiButton\n            onChange={onUrlChange}\n            ariaLabel={getString('path_editor_coverphoto_label')}\n            defaultValue={coverphotoValueUrl}\n            items={[\n              {\n                value: '',\n                title: getString('path_editor_no_coverphoto'),\n              },\n              ...[\n                {\n                  value: 'https://assets.volteuropa.org/styles/scale_2880x/public/inline-images/tYADz4UyUAAcV5WlmWLlkXD9LG8W02U9LbQd8rxzQ2bt99lxwK.jpg',\n                  icon: volt_bonn_thumb,\n                },\n                {\n                  value: 'https://assets.volteuropa.org/styles/scale_1920x/public/2020-11/Welcome-to-Volt.jpg',\n                  icon: welcome_to_volt_thumb,\n                },\n                {\n                  value: 'https://assets.volteuropa.org/styles/scale_1920x/public/2021-07/20200912_Plakatschlange_Ko%CC%88ln_Matteo%20Sant_Unione_011.jpeg',\n                  icon: plakatschlange_thumb,\n                },\n                {\n                  value: 'https://assets.volteuropa.org/2021-11/portugal.jpg',\n                  icon: portugal_thumb,\n                },\n                {\n                  value: 'https://assets.volteuropa.org/styles/scale_1920x/public/2021-05/Aktion.jpeg',\n                  icon: aktion_thumb,\n                },\n                // 'https://www.volteuropa.org/stripes/hero-desktop-green.jpg',\n                // 'https://www.volteuropa.org/stripes/hero-desktop-red.jpg',\n                // 'https://www.volteuropa.org/stripes/hero-desktop-blue.jpg',\n                // 'https://www.volteuropa.org/stripes/hero-desktop-yellow.jpg',\n                // 'https://assets.volteuropa.org/styles/scale_1920x/public/2021-05/Colours-Background-Big.jpeg',\n                // 'https://www.volteuropa.org/stripes/intermediate-green.jpg',\n                // 'https://www.volteuropa.org/stripes/intermediate-red.jpg',\n                // 'https://www.volteuropa.org/stripes/intermediate-blue.jpg',\n                // 'https://www.volteuropa.org/stripes/intermediate-yellow.jpg',\n                // 'https://www.volteuropa.org/og-default.png',\n                // 'https://www.volteuropa.org/hero-default.jpg',\n              ]\n              .map(({value = '', icon = ''}) => ({\n                value,\n                icon: <img alt=\"\" src={icon} className=\"icon image\" />\n              }))\n            ]}\n          />\n\n          <hr />\n\n          <button className=\"text\" onClick={closePopover} style={{ margin: 0 }}>\n            Close\n          </button>\n        </Paper>\n      )}\n    </Popover>\n  </div>\n}\n\nexport default withLocalization(CoverphotoPicker)\n","\nimport classes from './IconPicker.module.css'\n\nimport Popover from '../Popover.js'\n\nimport { Paper } from '@mui/material'\nimport {\n  CircleSharp as IconIcon,\n} from '@mui/icons-material'\n\nimport { Localized, withLocalization } from '../../fluent/Localized.js'\n\nimport FancyInput from './FancyInput.js'\nimport UrlInput from './UrlInput.js'\n\nfunction IconPicker({ coverphotoValue, iconValue, onChange, className, style }) {\n\n  const onUrlChange = newUrl => {\n    onChange({\n      type: 'url',\n      url: newUrl,\n    })\n  }\n\n  const isAbsoluteUrlRegexp = new RegExp('^(?:[a-z]+:)?//', 'i')\n\n  let iconValueUrl = ''\n  let coverphotoIsSet = false\n  let iconIsSet = false\n\n  if (\n    typeof coverphotoValue === 'object'\n    && coverphotoValue !== null\n    && !Array.isArray(coverphotoValue)\n  ) {\n    if (\n      coverphotoValue.type === 'url'\n      && typeof coverphotoValue.url === 'string'\n      && isAbsoluteUrlRegexp.test(coverphotoValue.url)\n    ) {\n      coverphotoIsSet = true\n    }\n  }\n\n  if (\n    typeof iconValue === 'object'\n    && iconValue !== null\n    && !Array.isArray(iconValue)\n  ) {\n    if (\n      iconValue.type === 'url'\n      && typeof iconValue.url === 'string'\n      && isAbsoluteUrlRegexp.test(iconValue.url)\n    ) {\n      iconIsSet = true\n      iconValueUrl = iconValue.url || ''\n    }\n  }\n\n  return <div\n    className={`\n      ${classes.root}\n      ${iconIsSet ? classes.iconIsSet : classes.iconIsNotSet}\n      ${coverphotoIsSet ? classes.coverphotoIsSet : classes.coverphotoIsNotSet}\n      ${className}\n    `}\n    style={style}\n  >\n    <Popover\n      trigger={(triggerProps) => (<div className={classes.iconWrapper}>\n        <div\n          className={`${classes.icon} ${!iconIsSet ? classes.no_image : ''}`}\n          style={{\n            backgroundImage: iconIsSet ? `url(${window.domains.backend}download_url?f=png&w=400&h=400&url=${encodeURIComponent(iconValueUrl)})` : '',\n          }}\n        ></div>\n        <button {...triggerProps} className={`text hasIcon ${classes.changeIconButton}`}>\n          <IconIcon className=\"icon\" />\n          <span style={{ marginInlineStart: 'var(--basis_x2)', verticalAlign: 'middle'}}>Set Icon</span>\n        </button>\n      </div>)}\n    >\n      {({closePopover, ...popoverProps}) => (\n        <Paper\n          {...popoverProps}\n          sx={{\n            maxWidth: 'calc(calc(100vw - 32px) - var(--basis_x8))',\n            maxHeight: 'calc(calc(100vh - 32px) - var(--basis_x8))',\n            overflow: 'auto',\n            padding: 'var(--basis_x4)',\n            background: 'var(--background-contrast)',\n            color: 'var(--on-background)',\n          }}\n          elevation={8}\n        >\n          <h3 style={{ marginTop: '0' }}><Localized id=\"path_editor_icon_label\" /></h3>\n\n          <em className=\"body2\" style={{ display: 'block', marginBottom: 'var(--basis)' }}>\n            <Localized id=\"path_editor_icon_info\" />\n          </em>\n\n          <FancyInput>\n            {({ setError }) => (\n              <UrlInput\n                onError={setError}\n                onBlur={onUrlChange}\n                defaultValue={iconValueUrl}\n                style={{\n                  marginRight: '0',\n                  marginLeft: '0',\n                  width: '100%'\n                }}\n              />\n            )}\n          </FancyInput>\n\n          <hr />\n\n          <button className=\"text\" onClick={closePopover} style={{ margin: 0 }}>\n            Close\n          </button>\n        </Paper>\n      )}\n    </Popover>\n  </div>\n}\n\nexport default withLocalization(IconPicker)\n","import { useRef, useCallback, useState, useEffect } from 'react'\n\nimport HtmlInput from './HtmlInput.js'\nimport useCheckPath from '../../hooks/useCheckPath.js'\n\nfunction PathInput({\n  defaultValue = '',\n  onChange,\n  onBlur,\n  onSubmit,\n  onError,\n  allowExisting = false,\n  placeholder = 'de-bonn',\n  ...props\n}) {\n  const mountedRef = useRef(false)\n  useEffect(() => {\n    mountedRef.current = true\n    return () => {\n      mountedRef.current = false\n    }\n  }, [])\n\n  const checkPath = useCheckPath()\n\n  const [text, setText] = useState(defaultValue)\n\n  const handleTextChange = useCallback(async newText => {\n    newText = newText.toLowerCase()\n    setText(newText)\n\n    let isSubmittable = true\n    let error = ''\n    if (newText !== '') {\n      const {\n        isOkay,\n        errors\n      } = (await checkPath(newText)) || {}\n      \n      isSubmittable = isOkay\n      error = errors.join('\\n')\n    }\n\n    if (isSubmittable && onChange) {\n      onChange(newText)\n    }\n\n    if (onError) {\n      onError(error)\n    }\n  }, [\n    setText,\n    checkPath,\n    onChange,\n    onError,\n  ])\n\n  const handleBlur = useCallback(() => {\n    if (onBlur) {\n      onBlur(text)\n    }\n  }, [onBlur, text])\n\n  return <HtmlInput\n    onChange={handleTextChange}\n    onBlur={handleBlur}\n    defaultValue={defaultValue}\n    placeholder={placeholder}\n    linebreaks={false}\n    {...props}\n  />\n}\n\nexport default PathInput\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { checkPath_Query } from '../graphql/queries'\n\nexport default function useCheckPath() {\n  const apollo_client = useApolloClient()\n\n  const handleCheckPath = useCallback((path = '') => {\n    return new Promise(resolve => {\n      apollo_client.query({\n        query: checkPath_Query,\n        variables: {\n          path,\n        },\n      })\n        .then(async ({ data }) => {\n          if (data.hasOwnProperty('checkPath')) {\n            resolve(data.checkPath)\n          } else {\n            resolve(null)\n          }\n        })\n        .catch(async error => {\n          console.error('error', error)\n          resolve(null)\n        })\n    })\n  }, [apollo_client])\n\n  return handleCheckPath\n}\n","import { useState, useCallback, useEffect } from 'react'\n\nimport FancyInput from './FancyInput.js'\nimport PathInput from './PathInput.js'\n// import HtmlInput from './HtmlInput.js'\n\nimport { useLocalization } from '../../fluent/Localized.js'\n\nfunction TriggerInput({\n  defaultValue,\n  className,\n  style,\n  onChange,\n}) {\n  const { getString } = useLocalization()\n\n  const [properties, setProperties] = useState({})\n\n  useEffect(() => {\n    defaultValue.type = 'path'\n    setProperties(defaultValue)\n  }, [\n    defaultValue,\n    setProperties,\n  ])\n\n  const updateProperty = useCallback((propertyKey, newPropertyValue) => {\n    const propertyTypes = {\n      type: 'string',\n      path: 'string',\n      url: 'string',\n      cron: 'string',\n      blockId: 'string',\n    }\n\n    const newProperties = { ...properties }\n\n    if (propertyTypes.hasOwnProperty(propertyKey)) {\n      switch (propertyTypes[propertyKey]) {\n        case 'array':\n          if (newPropertyValue.length > 0) {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        case 'string':\n          if (newPropertyValue !== '') {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        case 'boolean':\n          if (newPropertyValue === true) {\n            newProperties[propertyKey] = true\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        case 'object':\n          if (\n            typeof newPropertyValue === 'object'\n            && newPropertyValue !== null\n            && Object.keys(newPropertyValue).length > 0\n          ) {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        default:\n          newProperties[propertyKey] = newPropertyValue\n      }\n\n      if (JSON.stringify(newProperties) !== JSON.stringify(properties)) {\n        setProperties(newProperties)\n        if (onChange) {\n          onChange(newProperties)\n        }\n      }\n    }\n  }, [\n    properties,\n    setProperties,\n    onChange,\n  ])\n\n  const type = properties.type || ''\n\n  let morePropsInput = null\n  if (type === 'click') {\n    morePropsInput = null\n  } else if (type === 'path') {\n    morePropsInput = <>\n      <FancyInput\n        style={{\n          flexGrow: '1',\n        }}\n      >\n        {({ setError }) => (\n          <PathInput\n            onError={setError}\n            placeholder={getString('trigger_input_path_placeholder')}\n            defaultValue={properties.path}\n            onBlur={newValue => updateProperty('path', newValue)}\n            style={{\n              flexGrow: '1',\n              margin: '0',\n              minWidth: '300px',\n            }}\n            // className=\"show_border_on_active\"\n          />\n        )}\n      </FancyInput>\n    </>\n  // } else if (type === 'cron') {\n  //   morePropsInput = <>cron: String</>\n  // } else if (type === 'block_change') {\n  //   morePropsInput = <>blockId: ID</>\n  }\n\n  return <div\n    className={className}\n    style={{\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'flex-start',\n      maxWidth: '100%',\n      flexWrap: 'wrap',\n      gap: 'var(--basis)',\n      ...style\n    }}\n  >\n    {/*\n    <select\n      key={properties.type}\n      onChange={event => updateProperty('type', event.target.value)}\n      defaultValue={properties.type || ''}\n      style={{\n        margin: '0',\n      }}\n    >\n      <option value=\"\">No Trigger</option>\n      <option value=\"path\">Path</option>\n      <option value=\"click\">Click</option>\n      <option value=\"cron\">Cron</option>\n      <option value=\"block_change\">Block Change</option>\n    </select>\n    */}\n\n    {morePropsInput}\n  </div>\n}\n\nexport default TriggerInput\n","import { useState, useCallback, useEffect } from 'react'\n\nimport FancyInput from './FancyInput.js'\nimport UrlInput from './UrlInput.js'\nimport HtmlInput from './HtmlInput.js'\n\nimport { useLocalization } from '../../fluent/Localized.js'\n\nfunction ActionInput({\n  defaultValue,\n  className,\n  style,\n  onChange,\n}) {\n  const { getString } = useLocalization()\n\n  const [properties, setProperties] = useState({})\n\n  useEffect(() => {\n    defaultValue.type = 'open_url'\n    setProperties(defaultValue)\n  }, [\n    defaultValue,\n    setProperties,\n  ])\n\n  const updateProperty = useCallback((propertyKey, newPropertyValue) => {\n    const propertyTypes = {\n      type: 'string',\n      path: 'string',\n      url: 'string',\n      cron: 'string',\n      blockId: 'string',\n    }\n\n    const newProperties = { ...properties }\n\n    if (propertyTypes.hasOwnProperty(propertyKey)) {\n      switch (propertyTypes[propertyKey]) {\n        case 'array':\n          if (newPropertyValue.length > 0) {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        case 'string':\n          if (newPropertyValue !== '') {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        case 'boolean':\n          if (newPropertyValue === true) {\n            newProperties[propertyKey] = true\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        case 'object':\n          if (\n            typeof newPropertyValue === 'object'\n            && newPropertyValue !== null\n            && Object.keys(newPropertyValue).length > 0\n          ) {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        default:\n          newProperties[propertyKey] = newPropertyValue\n      }\n\n      if (JSON.stringify(newProperties) !== JSON.stringify(properties)) {\n        setProperties(newProperties)\n        if (onChange) {\n          onChange(newProperties)\n        }\n      }\n    }\n  }, [\n    properties,\n    setProperties,\n    onChange,\n  ])\n\n  const type = properties.type || ''\n\n  let morePropsInput = null\n  if (\n    type === 'open_url'\n    || type === 'send_payload'\n  ) {\n    morePropsInput = <>\n      <FancyInput\n        style={{\n          flexGrow: '1',\n          margin: '0',\n          minWidth: '300px',\n        }}\n      >\n        {({ setError }) => (\n          <UrlInput\n            onError={setError}\n            onBlur={newValue => updateProperty('url', newValue)}\n            defaultValue={properties.url}\n            placeholder={getString('action_input_url_placeholder')}\n            type=\"text\"\n            style={{\n              flexGrow: 1,\n              margin: '0',\n              width: '100%'\n            }}\n            // className=\"show_border_on_active\"\n          />\n        )}\n      </FancyInput>\n    </>\n  } else if (\n    type === 'render_block'\n    || type === 'run_block'\n  ) {\n    morePropsInput = <HtmlInput\n        placeholder=\"blockId\"\n        defaultValue={properties.blockId}\n        onBlur={newValue => updateProperty('blockId', newValue)}\n        linebreak={false}\n        style={{\n          flexGrow: '1',\n          margin: '0',\n          minWidth: '300px',\n        }}\n        // className=\"show_border_on_active\"\n      />\n  }\n\n  return <div\n    className={className}\n    style={{\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'flex-start',\n      maxWidth: '100%',\n      flexWrap: 'wrap',\n      gap: 'var(--basis)',\n      ...style\n    }}\n  >\n    {/*\n    <select\n      key={properties.type}\n      onChange={event => updateProperty('type', event.target.value)}\n      defaultValue={properties.type || ''}\n      style={{\n        margin: '0',\n      }}\n    >\n      <option value=\"\">No Action</option>\n      <option value=\"open_url\">Open URL</option>\n      <option value=\"render_block\">Render Block</option>\n      <option value=\"run_block\">Run Block</option>\n      <option value=\"send_payload\">Send Payload</option>\n    </select>\n    */}\n\n    {morePropsInput}\n  </div>\n}\n\nexport default ActionInput\n\n\n/*\n\n  let morePropsInput = null\n  if (\n    type === 'open_url'\n    || type === 'send_payload'\n  ) {\n    morePropsInput = <>\n      <UrlInput />\n    </>\n  } else if (\n    type === 'render_block'\n    || type === 'run_block'\n  ) {\n    morePropsInput = <>blockId: ID</>\n  }\n\n\n      <option key=\"editor\" value=\"\">…</option>\n      <option key=\"editor\" value=\"open_url\">Open URL</option>\n      <option key=\"viewer\" value=\"render_block\">Render Block</option>\n      <option key=\"viewer\" value=\"run_block\">Run Block</option>\n      <option key=\"viewer\" value=\"send_payload\">Send Payload</option>\n      */\n","import { useState, useCallback, useEffect } from 'react'\n\n// import { v4 as uuidv4 } from 'uuid'\n\nimport classes from './PropertiesEditor.module.css'\n\nimport { Localized, withLocalization } from '../../fluent/Localized.js'\n// import UrlInput from './UrlInput.js'\nimport CheckboxInput from './CheckboxInput.js'\nimport HtmlInput from './HtmlInput.js'\n// import FancyInput from './FancyInput.js'\nimport CoverphotoPicker from './CoverphotoPicker.js'\nimport IconPicker from './IconPicker.js'\nimport TriggerInput from './TriggerInput.js'\nimport ActionInput from './ActionInput.js'\n\n// function stripTmpIds(array){\n//   return [...array].map(obj => {\n//     const obj_new = { ...obj }\n//     delete obj_new._id\n//     return obj_new\n//   })\n// }\n\n// function addTmpIds(array) {\n//   return [...(array || [])].map(obj => {\n//     if (!obj.tmp_id) {\n//       const obj_new = { ...obj }\n//       obj_new.tmp_id = uuidv4()\n//       return obj_new\n//     }\n//\n//     return obj\n//   })\n// }\n\nfunction PropertiesEditor({ getString, type, defaultProperties = {}, onChange }) {\n  const [properties, setProperties] = useState({})\n\n  // const [coverphoto, setCoverphoto] = useState('')\n  // const [imprint, setImprint] = useState('')\n  // const [privacy_policy, setPrivacyPolicy] = useState('')\n  // const [link, setLink] = useState('')\n\n  // let [voltTeams, setVoltTeams] = useState([])\n  // voltTeams = voltTeams.map(({ id, name }) => ({ value: id, label: name }))\n\n  // const [voltTeamInfos, setVoltTeamInfos] = useState({\n  //   id: null,\n  //   name: ''\n  // })\n  // const setVoltTeamInfosFromSelect = useCallback((data) => {\n  //   setVoltTeamInfos({\n  //     id: data.value,\n  //     name: data.label,\n  //   })\n  // }, [setVoltTeamInfos])\n\n  const updateProperty = useCallback((propertyKey, newPropertyValue, silent = false) => {\n    const propertyTypes = {\n      text: 'string',\n      coverphoto: 'string',\n      icon: 'string',\n      imprint: 'string',\n      privacy_policy: 'string',\n      tags: 'string',\n      checked: 'boolean',\n      trigger: 'object',\n      action: 'object',\n      pronouns: 'string',\n    }\n\n    const newProperties = { ...properties }\n\n    if (propertyTypes.hasOwnProperty(propertyKey)) {\n      switch (propertyTypes[propertyKey]) {\n        case 'array':\n          if (newPropertyValue.length > 0) {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        case 'string':\n          if (newPropertyValue !== '') {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        case 'boolean':\n          if (newPropertyValue === true) {\n            newProperties[propertyKey] = true\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        case 'object':\n          if (\n            typeof newPropertyValue === 'object'\n            && newPropertyValue !== null\n            && Object.keys(newPropertyValue).length > 0\n          ) {\n            newProperties[propertyKey] = newPropertyValue\n          } else if (newProperties.hasOwnProperty(propertyKey)) {\n            delete newProperties[propertyKey]\n          }\n        break\n        default:\n          newProperties[propertyKey] = newPropertyValue\n      }\n    }\n\n    if (JSON.stringify(newProperties) !== JSON.stringify(properties)) {\n      setProperties(newProperties)\n      if (silent === false && onChange) {\n        onChange(newProperties)\n      }\n    }\n  }, [\n    properties,\n    setProperties,\n    onChange,\n  ])\n\n  const publishProperties = useCallback(() => {\n    if (onChange) {\n      onChange(properties)\n    }\n  }, [properties, onChange])\n\n  useEffect(() => {\n    setProperties({\n      ...defaultProperties,\n      text: defaultProperties.text || '',\n    })\n  }, [\n    defaultProperties,\n    setProperties,\n  ])\n\n\n  // useEffect(() => {\n  //   fetch(`${window.domains.backend}teams_simple.json`, {\n  //     mode: 'cors',\n  //     credentials: 'include',\n  //   })\n  //     .then(response => response.json())\n  //     .then(data => {\n  //       if (typeof data.error === 'string') {\n  //         setVoltTeams([])\n  //       } else {\n  //         setVoltTeams(data)\n  //       }\n  //     })\n  //     .catch(error => {\n  //       console.error(error)\n  //       setVoltTeams([])\n  //     })\n  // }, [ setVoltTeams ])\n\n  let propertiesFrameContent = null\n  // if (type === 'page') {\n  //   propertiesFrameContent = <>\n  //     <div className={classes.properties_row}>\n  //     <h3><Localized id=\"properties_editor_imprint_label\" /></h3>\n  //     <div>\n  //     <FancyInput>\n  //       {({ setError }) => (\n  //         <UrlInput\n  //           onError={setError}\n  //           onBlur={newValue => updateProperty('imprint', newValue)}\n  //           defaultValue={properties.imprint}\n  //           type=\"text\"\n  //           style={{\n  //             margin: '0',\n  //             width: '100%'\n  //           }}\n  //           // className=\"show_border_on_active\"\n  //         />\n  //       )}\n  //     </FancyInput>\n  //     </div>\n  //     </div>\n  //\n  //     <div className={classes.properties_row}>\n  //     <h3><Localized id=\"properties_editor_privacy_policy_label\" /></h3>\n  //     <div>\n  //     <FancyInput>\n  //       {({ setError }) => (\n  //         <UrlInput\n  //           onError={setError}\n  //           onBlur={newValue => updateProperty('privacy_policy', newValue)}\n  //           defaultValue={properties.privacy_policy}\n  //           type=\"text\"\n  //           style={{\n  //             margin: '0',\n  //             width: '100%'\n  //           }}\n  //           // className=\"show_border_on_active\"\n  //         />\n  //       )}\n  //     </FancyInput>\n  //     </div>\n  //     </div>\n  //   </>\n  // // } else if (type === 'redirect') {\n  // //   propertiesFrameContent = <>\n  // //     <div className={classes.properties_row}>\n  // //     <h3><Localized id=\"path_editor_redirect_label\" /></h3>\n  // //     <FancyInput>\n  // //       {({ setError }) => (\n  // //         <UrlInput\n  // //           onError={setError}\n  // //           onBlur={newValue => updateProperty('link', newValue)}\n  // //           type=\"text\"\n  // //           placeholder={getString('path_editor_redirect_placeholder')}\n  // //           aria-label={getString('path_editor_redirect_label')}\n  // //           defaultValue={properties.link}\n  // //           style={{\n  // //             marginRight: '0',\n  // //             marginLeft: '0',\n  // //             width: '100%'\n  // //           }}\n  // //           className=\"show_border_on_active\"\n  // //         />\n  // //       )}\n  // //     </FancyInput>\n  // //     </div>\n  // //   </>\n  // } else if (type === 'person') {\n  //   propertiesFrameContent = <>\n  //     <div className={classes.properties_row}>\n  //       <h3><Localized id=\"properties_editor_pronouns_label\" /></h3>\n  //       <HtmlInput\n  //         defaultValue={properties.pronouns}\n  //         onChange={newValue => updateProperty('pronouns', newValue, true)}\n  //         onBlur={publishProperties}\n  //         placeholder={'…'}\n  //         style={{\n  //           margin: '0',\n  //           width: '100%',\n  //         }}\n  //         linebreaks={false}\n  //         className={`type_text`}\n  //       />\n  //     </div>\n  //   </>\n  // } else\n  if (type === 'checkbox') {\n    propertiesFrameContent = <>\n      <div className={classes.properties_row}>\n        <h3><Localized id=\"properties_editor_checked_label\" /></h3>\n        <CheckboxInput\n          onChange={newValue => updateProperty('checked', newValue)}\n          defaultValue={Boolean(properties.checked)}\n          style={{\n            marginRight: '0',\n            marginLeft: '0',\n            width: '100%'\n          }}\n        />\n      </div>\n    </>\n  } else if (type === 'button') {\n    propertiesFrameContent = <>\n      <div className={classes.properties_row}>\n        <h3><Localized id=\"properties_editor_action_label\" /></h3>\n        <ActionInput\n          onChange={newValue => updateProperty('action', newValue)}\n          defaultValue={properties.action || {}}\n          style={{\n            marginRight: '0',\n            marginLeft: '0',\n            width: '100%'\n          }}\n        />\n      </div>\n    </>\n  } else if (type === 'page' || type === 'person') {\n    propertiesFrameContent = <>\n      <div className={classes.properties_row}>\n        <h3><Localized id=\"properties_editor_trigger_path_label\" /></h3>\n        <TriggerInput\n          onChange={newValue => updateProperty('trigger', newValue)}\n          defaultValue={properties.trigger || {}}\n          style={{\n            marginRight: '0',\n            marginLeft: '0',\n            width: '100%'\n          }}\n        />\n      </div>\n    </>\n  } else if (type === 'redirect') {\n    propertiesFrameContent = <>\n      <div className={classes.properties_row}>\n        <h3><Localized id=\"properties_editor_trigger_path_label\" /></h3>\n        <TriggerInput\n          onChange={newValue => updateProperty('trigger', newValue)}\n          defaultValue={properties.trigger || {}}\n          style={{\n            marginRight: '0',\n            marginLeft: '0',\n            width: '100%'\n          }}\n        />\n      </div>\n      <div className={classes.properties_row}>\n        <h3><Localized id=\"properties_editor_action_url_label\" /></h3>\n        <ActionInput\n          onChange={newValue => updateProperty('action', newValue)}\n          defaultValue={properties.action || {}}\n          style={{\n            marginRight: '0',\n            marginLeft: '0',\n            width: '100%'\n          }}\n        />\n      </div>\n    </>\n  }\n  // else if (type === 'automation') {\n  //   propertiesFrameContent = <>\n  //     <div className={classes.properties_row}>\n  //       <h3><Localized id=\"properties_editor_trigger_label\" /></h3>\n  //       <TriggerInput\n  //         onChange={newValue => updateProperty('trigger', newValue)}\n  //         defaultValue={properties.trigger || {}}\n  //         style={{\n  //           marginRight: '0',\n  //           marginLeft: '0',\n  //           width: '100%'\n  //         }}\n  //       />\n  //     </div>\n  //     <div className={classes.properties_row}>\n  //       <h3><Localized id=\"properties_editor_action_label\" /></h3>\n  //       <ActionInput\n  //         onChange={newValue => updateProperty('action', newValue)}\n  //         defaultValue={properties.action || {}}\n  //         style={{\n  //           marginRight: '0',\n  //           marginLeft: '0',\n  //           width: '100%'\n  //         }}\n  //       />\n  //     </div>\n  //   </>\n  // }\n\n  return <>\n    {\n      type === 'page'\n      || type === 'person'\n      || type === 'redirect'\n      ? <>\n          <CoverphotoPicker\n            coverphotoValue={properties.coverphoto}\n            iconValue={properties.icon}\n            onChange={newValue => updateProperty('coverphoto', newValue)}\n          />\n          <IconPicker\n            iconValue={properties.icon}\n            coverphotoValue={properties.coverphoto}\n            onChange={newValue => updateProperty('icon', newValue)}\n          />\n        </>\n      : null\n    }\n\n    <div className={classes.main_headline} style={{\n      paddingLeft: 'calc(8 * var(--basis))',\n    }}>\n      <HtmlInput\n        defaultValue={properties.text}\n        onChange={newValue => updateProperty('text', newValue, true)}\n        onBlur={publishProperties}\n\n        placeholder={getString('placeholder_main_headline')}\n        style={{\n          padding: 'var(--basis) var(--basis_x2)',\n        }}\n        linebreaks={true}\n        className={`type_h1`}\n      />\n    </div>\n\n    <div className={classes.propertiesFrame} style={\n      propertiesFrameContent === null\n        ? { display: 'none' }\n        : null\n    }>\n      {propertiesFrameContent}\n\n      {/* <div className={classes.properties_row}>\n        <h3><Localized id=\"path_editor_tags_label\" /></h3>\n        <HtmlInput\n          onBlur={newValue => updateProperty('tags', newValue)}\n          type=\"text\"\n          placeholder={getString('path_editor_tags_placeholder')}\n          aria-label={getString('path_editor_tags_label')}\n          defaultValue={properties.tags}\n          style={{\n            marginRight: '0',\n            marginLeft: '0',\n            width: 'calc(100% - var(--basis_x2))'\n          }}\n        />\n      </div> */}\n\n      {/*\n        voltTeams && voltTeams.length > 0\n        ? <>\n          <h3><Localized id=\"path_editor_belongs_to_team_label\" /></h3>\n          <em className=\"body2\" style={{ display: 'block', marginBottom: 'var(--basis)' }}><Localized id=\"path_editor_belongs_to_team_info\" /></em>\n          <Select\n            defaultValue={{\n              value: voltTeamInfos !== null ? voltTeamInfos.id || null : null,\n              label: voltTeamInfos !== null ? voltTeamInfos.name || '' : '',\n            }}\n            defaultInputValue={voltTeamInfos !== null ? voltTeamInfos.name || '' : ''}\n            onChange={setVoltTeamInfosFromSelect}\n            ariaLabel={getString('path_editor_belongs_to_team_search_placeholder')}\n            label={getString('path_editor_belongs_to_team_search_placeholder')}\n            placeholder={getString('path_editor_belongs_to_team_search_placeholder')}\n            options={voltTeams}\n            styles={custom_react_select_styles}\n            theme={custom_react_select_theme}\n          />\n        </>\n        : null\n      */}\n    </div>\n  </>\n}\n\nexport default withLocalization(PropertiesEditor)\n","import React, { useState, useEffect, useCallback } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport HtmlInput from './HtmlInput.js'\n\nfunction InlineEditorBlockTextRaw({\n  getString,\n  block = {},\n  onChange,\n  onSaveBlock,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n\n  onAddRowAfter,\n}) {\n  const properties = block.properties || {}\n  const [text, setText] = useState('')\n\n  useEffect(() => {\n    setText(properties.text || '')\n  }, [properties.text, setText])\n\n  const publishTextChange = useCallback(() => {\n    if (onChange) {\n      onChange({\n        ...block,\n        properties: {\n          ...block.properties,\n          text,\n        },\n      })\n    }\n  }, [onChange, block, text])\n\n  let text_style_class = 'type_text'\n  if (properties.hasOwnProperty('text_style')) {\n    text_style_class = 'type_'+properties.text_style\n  }\n\n  const {\n    color,\n  } = getBlockColor(block)\n\n  const colorStyles = {}\n  if (color) {\n    colorStyles.color = color\n  }\n\n  return <HtmlInput\n    defaultValue={text}\n    onChange={setText}\n    onBlur={publishTextChange}\n\n    placeholder={getString('placeholder_text')}\n    style={{\n      margin: '0',\n      backgroundColor: 'transparent',\n      ...colorStyles,\n    }}\n    linebreaks={true}\n    className={`hide_border ${text_style_class}`}\n\n    onInputRef={onInputRef}\n    onGoToPrevInput={onGoToPrevInput}\n    onGoToNextInput={onGoToNextInput}\n    onMergeToPrevInput={() => onMergeToPrevInput(block)}\n    onMergeFromNextInput={() => onMergeFromNextInput(block)}\n    onSplitText={onSplitText}\n  />\n}\n\nconst InlineEditorBlockText = withLocalization(InlineEditorBlockTextRaw)\n\nexport default InlineEditorBlockText\n","import React, { useState, useCallback } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport FancyInput from './FancyInput.js'\nimport HtmlInput from './HtmlInput.js'\nimport UrlInput from './UrlInput.js'\n\nfunction InlineEditorBlockButtonRaw({\n  getString,\n  block = {},\n  onChange,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n}) {\n  const properties = block.properties || {}\n  const [text, setText] = useState(properties.text || '')\n  const {\n    action = {}\n  } = properties\n  const [link, setLink] = useState(action.url || '')\n\n  const publishChanges = useCallback(() => {\n    if (onChange) {\n      const newBlock = {\n        ...block,\n        properties: {\n          ...block.properties,\n          text,\n        },\n      }\n\n      if (link === '') {\n        if (newBlock.properties.hasOwnProperty('trigger')) {\n          delete newBlock.properties.trigger\n        }\n        if(newBlock.properties.hasOwnProperty('action')) {\n          delete newBlock.properties.action\n        }\n      } else {\n        newBlock.properties.trigger = {\n          type: 'click'\n        }\n        newBlock.properties.action = {\n\t\t\t\t  type: 'open_url',\n\t\t\t\t  url: link,\n\t\t\t  }\n      }\n\n      onChange(newBlock)\n    }\n  }, [onChange, block, text, link])\n  \n  const {\n    color,\n    colorRGB,\n    contrastingColor,\n  } = getBlockColor(block)\n\n  const colorStyles = {}\n  if (color) {\n    colorStyles['--on-background-rgb'] = colorRGB\n    colorStyles['--button-background'] = color\n    colorStyles['--button-color'] = contrastingColor\n  }\n\n  return <div style={{\n    margin: '0 0 var(--basis) 0',\n    cursor: 'auto',\n    ...colorStyles,\n  }}\n  className=\"clickable_card active\"\n  >\n    <HtmlInput\n      defaultValue={text}\n      onChange={setText}\n      onBlur={publishChanges}\n\n      placeholder={getString('placeholder_button')}\n      style={{\n        margin: '0',\n        ...colorStyles,\n      }}\n      linebreaks={true}\n      className=\"hide_border type_button default\"\n\n      onInputRef={onInputRef}\n      onGoToPrevInput={onGoToPrevInput}\n      onGoToNextInput={onGoToNextInput}\n      onMergeToPrevInput={() => onMergeToPrevInput(block)}\n      onMergeFromNextInput={() => onMergeFromNextInput(block)}\n      onSplitText={onSplitText}\n    />\n\n    <FancyInput>\n      {({ setError }) => (\n        <UrlInput\n          onError={setError}\n          onChange={setLink}\n          onBlur={publishChanges}\n          type=\"text\"\n          defaultValue={link}\n          placeholder={getString('action_input_url_placeholder')}\n          style={{\n            margin: 'var(--basis) 0 0 0',\n            width: '100%',\n          }}\n        />\n      )}\n    </FancyInput>\n  </div>\n}\n\nconst InlineEditorBlockButton = withLocalization(InlineEditorBlockButtonRaw)\n\nexport default InlineEditorBlockButton\n","import React, { useRef, useCallback } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport {\n  // AutoAwesomeSharp as ActionIcon,\n  LinkSharp as RedirectIcon,\n  ArrowForward as ToIcon,\n} from '@mui/icons-material'\n\nimport FancyInput from './FancyInput.js'\nimport HtmlInput from './HtmlInput.js'\nimport UrlInput from './UrlInput.js'\nimport PathInput from './PathInput.js'\n\n\nfunction InlineEditorBlockRedirectRaw({\n  getString,\n  block = {},\n  onChange,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n\n  style = {},\n}) {\n  const properties = block.properties || {}\n  const {\n    trigger = {},\n    action = {}\n  } = properties\n\n  const textRef = useRef(properties.text || '')\n  const text = textRef.current\n  const setText = newValue => textRef.current = newValue\n\n  const triggerPathRef = useRef(trigger.path || '')\n  const triggerPath = triggerPathRef.current\n  const setTriggerPath = newValue => triggerPathRef.current = newValue\n\n  const linkRef = useRef(action.url || '')\n  const link = linkRef.current\n  const setLink = newValue => linkRef.current = newValue\n\n  const publishChanges = useCallback(() => {\n    if (onChange) {\n      const text = textRef.current\n      const triggerPath = triggerPathRef.current\n      const link = linkRef.current\n\n      const newBlock = {\n        ...block,\n        properties: {\n          ...block.properties,\n          text,\n        },\n      }\n\n      if (triggerPath === '') {\n        if (newBlock.properties.hasOwnProperty('trigger')) {\n          delete newBlock.properties.trigger\n        }\n      } else {\n        newBlock.properties.trigger = {\n          type: 'path',\n          path: triggerPath,\n        }\n      }\n\n      if (link === '') {\n        if(newBlock.properties.hasOwnProperty('action')) {\n          delete newBlock.properties.action\n        }\n      } else {\n        newBlock.properties.action = {\n\t\t\t\t  type: 'open_url',\n\t\t\t\t  url: link,\n\t\t\t  }\n      }\n\n      onChange(newBlock)\n    }\n  }, [ onChange, block ])\n  \n  const {\n    color = 'inherit',\n    colorRGB = '--on-background-rgb',\n  } = getBlockColor(block)\n\n  return <div style={{\n    ...style,\n    margin: '0 0 var(--basis) 0',\n    cursor: 'auto',\n    '--on-background-rgb': colorRGB,\n  }}\n  className=\"clickable_card active\"\n  >\n    <div style={{ width: '100%', display: 'flex', alignItems: 'center', color }}>\n      <RedirectIcon\n        style={{\n          margin: 'var(--basis)',\n        }}\n      />\n\n      <HtmlInput\n        defaultValue={text}\n        onChange={setText}\n        onBlur={publishChanges}\n\n        placeholder={getString('placeholder_headline_main')}\n        style={{\n          flexGrow: '1',\n          width: '100%',\n          margin: '0',\n          fontWeight: 'bold',\n          backgroundColor: 'transparent',\n          color,\n        }}\n        linebreaks={true}\n        className=\"hide_border type_text\"\n\n        onInputRef={onInputRef}\n        onGoToPrevInput={onGoToPrevInput}\n        onGoToNextInput={onGoToNextInput}\n        onMergeToPrevInput={() => onMergeToPrevInput(block)}\n        onMergeFromNextInput={() => onMergeFromNextInput(block)}\n        onSplitText={onSplitText}\n      />\n    </div>\n\n    <div style={{ paddingInlineStart: 'var(--basis_x8)', width: '100%', display: 'flex', alignItems: 'center', }}>\n      volt.link/\n      <FancyInput style={{ width: '100%', marginInlineStart: 'var(--basis)' }}>\n        {({ setError }) => (\n          <PathInput\n            onError={setError}\n            onChange={setTriggerPath}\n            onBlur={publishChanges}\n            defaultValue={triggerPath}\n            placeholder={getString('trigger_input_path_placeholder')}\n            style={{\n              margin: 'var(--basis) 0',\n              width: '100%',\n            }}\n          />\n        )}\n      </FancyInput>\n    </div>\n\n    <div style={{ paddingInlineStart: 'var(--basis_x8)', width: '100%', display: 'flex', alignItems: 'center', }}>\n      <ToIcon\n        style={{\n          flexShrink: 0,\n          margin: '0 var(--basis) 0 0',\n        }}\n      />\n\n      <FancyInput style={{ width: '100%' }}>\n        {({ setError }) => (\n          <UrlInput\n            onError={setError}\n            onChange={setLink}\n            onBlur={publishChanges}\n            type=\"text\"\n            defaultValue={link}\n            placeholder={getString('path_editor_item_link_label')}\n            style={{\n              margin: 'var(--basis) 0',\n              width: '100%',\n            }}\n          />\n        )}\n      </FancyInput>\n    </div>\n  </div>\n}\n\nconst InlineEditorBlockRedirect = withLocalization(InlineEditorBlockRedirectRaw)\n\nexport default InlineEditorBlockRedirect\n","import { getBlockColor } from '../../functions.js'\n\nexport default function InlineEditorBlockDivider({ block }) {\n  const {\n    color,\n  } = getBlockColor(block)\n\n  const styles = {}\n  if (color) {\n    styles['--on-background'] = color\n  }\n\n  return <hr style={styles} />\n}\n","import React, { useState, useCallback, useRef } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\n\nimport HtmlInput from './HtmlInput.js'\nimport CheckboxInput from './CheckboxInput.js'\n\nfunction InlineEditorBlockCheckboxRaw({\n  getString,\n  block = {},\n  onChange,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n}) {\n  const properties = block.properties || {}\n  const [text, setText] = useState(properties.text || '')\n  const checked = useRef(Boolean(properties.checked))\n\n  const publishChanges = useCallback(() => {\n    if (onChange) {\n      onChange({\n        ...block,\n        properties: {\n          ...block.properties,\n          text,\n          checked: checked.current,\n        },\n      })\n    }\n  }, [onChange, block, text])\n\n  const saveChecked = useCallback(newValue => {\n    checked.current = newValue\n    publishChanges()\n  }, [ publishChanges ])\n\n  return <div style={{ display: 'flex' }}>\n    <CheckboxInput\n      checked={checked.current}\n      onChange={saveChecked}\n    />\n\n    <HtmlInput\n      defaultValue={text}\n      onChange={setText}\n      onBlur={publishChanges}\n\n      placeholder={getString('placeholder_text')}\n      style={{\n        flexGrow: '1',\n        width: '100%',\n        margin: '0',\n        backgroundColor: 'transparent',\n      }}\n      linebreaks={true}\n      className=\"hide_border type_text\"\n\n      onInputRef={onInputRef}\n      onGoToPrevInput={onGoToPrevInput}\n      onGoToNextInput={onGoToNextInput}\n      onMergeToPrevInput={() => onMergeToPrevInput(block)}\n      onMergeFromNextInput={() => onMergeFromNextInput(block)}\n      onSplitText={onSplitText}\n    />\n  </div>\n}\n\nconst InlineEditorBlockCheckbox = withLocalization(InlineEditorBlockCheckboxRaw)\n\nexport default InlineEditorBlockCheckbox\n","import React, { useState, useCallback } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\n\nimport {\n  Face as PersonPlaceholderIcon,\n} from '@mui/icons-material'\n\nimport HtmlInput from './HtmlInput.js'\n\nfunction InlineEditorBlockPersonRaw({\n  getString,\n  block = {},\n  onChange,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n}) {\n  const properties = block.properties || {}\n  const [text, setText] = useState(properties.text || '')\n\n  const publishChanges = useCallback(() => {\n    if (onChange) {\n      onChange({\n        ...block,\n        properties: {\n          ...block.properties,\n          text,\n        },\n      })\n    }\n  }, [onChange, block, text])\n  \n  const {\n    color = 'inherit',\n    colorRGB = '--on-background-rgb',\n  } = getBlockColor(block)\n\n  return <div\n    style={{\n      display: 'flex',\n      margin: '0 0 var(--basis) 0',\n      cursor: 'auto',\n      '--on-background-rgb': colorRGB,\n      color: color,\n    }}\n    className=\"clickable_card active\"\n  >\n    <PersonPlaceholderIcon\n      style={{\n        margin: 'var(--basis)',\n      }}\n    />\n\n    <HtmlInput\n      defaultValue={text}\n      onChange={setText}\n      onBlur={publishChanges}\n\n      placeholder={getString('placeholder_text')}\n      style={{\n        flexGrow: '1',\n        width: '100%',\n        margin: '0',\n        fontWeight: 'bold',\n        backgroundColor: 'transparent',\n        color,\n      }}\n      linebreaks={true}\n      className=\"hide_border type_text\"\n\n      onInputRef={onInputRef}\n      onGoToPrevInput={onGoToPrevInput}\n      onGoToNextInput={onGoToNextInput}\n      onMergeToPrevInput={() => onMergeToPrevInput(block)}\n      onMergeFromNextInput={() => onMergeFromNextInput(block)}\n      onSplitText={onSplitText}\n    />\n  </div>\n}\n\nconst InlineEditorBlockPerson = withLocalization(InlineEditorBlockPersonRaw)\n\nexport default InlineEditorBlockPerson\n","import React, { useState, useCallback } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport {\n  InsertDriveFile as PagePlaceholderIcon,\n} from '@mui/icons-material'\n\nimport HtmlInput from './HtmlInput.js'\n\nfunction InlineEditorBlockPageRaw({\n  getString,\n  block = {},\n  onChange,\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n}) {\n  const properties = block.properties || {}\n  const [text, setText] = useState(properties.text || '')\n\n  const publishChanges = useCallback(() => {\n    if (onChange) {\n      onChange({\n        ...block,\n        properties: {\n          ...block.properties,\n          text,\n        },\n      })\n    }\n  }, [onChange, block, text])\n  \n  const {\n    color = 'inherit',\n    colorRGB = '--on-background-rgb',\n  } = getBlockColor(block)\n\n  return <div\n    style={{\n      display: 'flex',\n      margin: '0 0 var(--basis) 0',\n      cursor: 'auto',\n      '--on-background-rgb': colorRGB,\n      color: color,\n    }}\n    className=\"clickable_card active\"\n  >\n    <PagePlaceholderIcon\n      style={{\n        margin: 'var(--basis)',\n      }}\n    />\n\n    <HtmlInput\n      defaultValue={text}\n      onChange={setText}\n      onBlur={publishChanges}\n\n      placeholder={getString('placeholder_headline_main')}\n      style={{\n        flexGrow: '1',\n        width: '100%',\n        margin: '0',\n        fontWeight: 'bold',\n        backgroundColor: 'transparent',\n        color,\n      }}\n      linebreaks={true}\n      className=\"hide_border type_text\"\n\n      onInputRef={onInputRef}\n      onGoToPrevInput={onGoToPrevInput}\n      onGoToNextInput={onGoToNextInput}\n      onMergeToPrevInput={() => onMergeToPrevInput(block)}\n      onMergeFromNextInput={() => onMergeFromNextInput(block)}\n      onSplitText={onSplitText}\n    />\n  </div>\n}\n\nconst InlineEditorBlockPage = withLocalization(InlineEditorBlockPageRaw)\n\nexport default InlineEditorBlockPage\n","import React, { useState, useCallback, useEffect } from 'react'\n\nimport { withLocalization } from '../../fluent/Localized.js'\n\nimport BlockMenu from './BlockMenu.js'\nimport useSaveBlock from '../../hooks/useSaveBlock.js'\n\nimport InlineEditorBlockText from './InlineEditorBlockText.js'\nimport InlineEditorBlockButton from './InlineEditorBlockButton.js'\nimport InlineEditorBlockRedirect from './InlineEditorBlockRedirect.js'\nimport InlineEditorBlockDivider from './InlineEditorBlockDivider.js'\nimport InlineEditorBlockCheckbox from './InlineEditorBlockCheckbox.js'\nimport InlineEditorBlockPerson from './InlineEditorBlockPerson.js'\nimport InlineEditorBlockPage from './InlineEditorBlockPage.js'\n// import InlineEditorBlockCode from './InlineEditorBlockCode.js'\n\nimport classes from './InlineEditorBlock.module.css'\n\n// function addIds(array){\n//   if (Array.isArray(array)) {\n//     return array.map(item => {\n//       let new_item = { ...item }\n//       if (!new_item.hasOwnProperty('_id')) {\n//         new_item._id = uuidv4()\n//       }\n//       return new_item\n//     })\n//   }\n//   return array\n// }\n\n// function stripIDs(array){\n//   return [...array].map(obj => {\n//     const obj_new = { ...obj }\n//     delete obj_new._id\n//     return obj_new\n//   })\n// }\n\nfunction InlineEditorBlockInbetweenComponent({ type = 'text', ...props }){\n  let component = null\n\n  switch (type) {\n    case 'button':\n      component = <InlineEditorBlockButton {...props} />\n    break;\n    case 'redirect':\n      component = <InlineEditorBlockRedirect {...props} />\n    break;\n    case 'divider':\n      component = <InlineEditorBlockDivider {...props} />\n    break;\n    case 'checkbox':\n      component = <InlineEditorBlockCheckbox {...props} />\n    break;\n    case 'person':\n      component = <InlineEditorBlockPerson {...props} />\n    break;\n    case 'page':\n      component = <InlineEditorBlockPage {...props} />\n    break;\n    // case 'code':\n    //   component = <InlineEditorBlockCode {...props} />\n    // break;\n    default:\n      component = <InlineEditorBlockText {...props} />\n  }\n\n  return component\n}\n\nfunction InlineEditorBlockRaw({\n  fluentByObject,\n  getString,\n  contentConfig = {},\n  className,\n  onChange,\n  reorderHandle,\n  onRemoveRow,\n  actionButton,\n  dataset = {},\n  addRowBefore,\n  addRowAfter,\n  permissions = [],\n\n  onInputRef,\n  onGoToPrevInput,\n  onGoToNextInput,\n  onSplitText,\n  onMergeToPrevInput,\n  onMergeFromNextInput,\n  onRemoveSelf,\n}) {\n  const saveBlock = useSaveBlock()\n\n  // const defaultLocale = getString('default_locale')\n\n  const [block, setBlock] = useState({\n    ...(contentConfig.block || { type: 'text' }),\n    _id: contentConfig.blockId || null,\n  })\n  const properties = block.properties || {}\n  const active = typeof properties.active === 'boolean' ? properties.active : true\n\n  useEffect(() => {\n    if (contentConfig.block) {\n      setBlock(contentConfig.block)\n    }\n  }, [contentConfig.block])\n\n  const saveBlockCallback = useCallback(newBlock => {\n    saveBlock(newBlock)\n      .then(gottenBlock => {\n        setBlock(gottenBlock)\n        if (!block._id || block._id !== gottenBlock._id) {\n          onChange({\n            blockId: gottenBlock._id,\n            block: gottenBlock,\n          })\n        }\n      })\n  }, [block, onChange, saveBlock])\n\n  const changeType = useCallback(newValue => {\n    const newBlock = {\n      ...block,\n      type: newValue,\n    }\n\n    saveBlockCallback(newBlock)\n  }, [ block, saveBlockCallback])\n\n  const saveProperty = useCallback((propertyName, newValue) => {\n    if (typeof propertyName === 'string') {\n      const newProperties = { ...block.properties }\n      if (newValue === null) {\n        delete newProperties[propertyName]\n      } else {\n        newProperties[propertyName] = newValue\n      }\n\n      if (newProperties !== block.properties) {\n        const newBlock = {\n          ...block,\n          properties: newProperties,\n        }\n\n        saveBlockCallback(newBlock)\n      }\n    }\n  }, [ block, saveBlockCallback ])\n\n  // const handleChange = useCallback(newBlock => {\n  //   setBlock(newBlock)\n\n  //   if (onChange) {\n  //     const target = wrapperDiv.current\n  //     target.value = newBlock\n  //     onChange({ target })\n  //   }\n  // }, [setBlock, onChange])\n\n  const handleBlockChange = useCallback(newBlock => {\n    if (JSON.stringify(newBlock) !== JSON.stringify(block)) {\n      saveBlock(newBlock)\n        .then((newBlock) => {\n          setBlock(newBlock)\n          if (!block._id || block._id !== newBlock._id) {\n            onChange({\n              blockId: newBlock._id,\n              block: newBlock,\n            })\n          }\n        })\n    }\n  }, [saveBlock, block, onChange])\n\n  const handleSaveBlock = useCallback((newBlock, callback) => {\n    saveBlock(newBlock)\n      .then(newBlock => {\n        if (callback) {\n          callback(newBlock)\n        }\n      })\n      .catch(console.error)\n  }, [ saveBlock ])\n\n  const onArchiveToggle = useCallback(newArchivedValue => {\n    if (typeof onRemoveSelf === 'function') {\n      onRemoveSelf()\n    }\n  }, [onRemoveSelf])\n\n  return <div\n    className={`${classes.block} ${className}`}\n    {...dataset}\n  >\n\n    <BlockMenu\n      {...{\n        block,\n        setType: changeType,\n        setProperty: saveProperty,\n        onRemoveRow,\n        addRowBefore,\n        addRowAfter,\n      }}\n\n      onArchivedToggle={onArchiveToggle}\n\n      trigger={props => (\n        <div\n          {...props}\n          className={classes.reorderHandle}\n        >\n          {reorderHandle}\n        </div>\n      )}\n    />\n\n    <div className={`${classes.block_input} ${(active ? classes.form_active : classes.form_deactivated)}`}>\n      <InlineEditorBlockInbetweenComponent\n        type={block.type}\n        block={block}\n        onChange={handleBlockChange}\n        onSaveBlock={handleSaveBlock}\n\n        onInputRef={onInputRef}\n        onGoToPrevInput={onGoToPrevInput}\n        onGoToNextInput={onGoToNextInput}\n        onSplitText={onSplitText}\n        onMergeToPrevInput={onMergeToPrevInput}\n        onMergeFromNextInput={onMergeFromNextInput}\n\n        onAddRowAfter={addRowAfter}\n      />\n    </div>\n\n  </div>\n}\n\nconst InlineEditorBlock = withLocalization(InlineEditorBlockRaw)\n\nexport default InlineEditorBlock\n","import { useState, useRef, useEffect, useCallback } from 'react'\n\nimport { v4 as uuidv4 } from 'uuid'\n\nimport {\n  Add as AddIcon,\n} from '@mui/icons-material'\nimport {\n  Tooltip,\n} from '@mui/material'\n\nimport { Localized } from '../../fluent/Localized.js'\nimport InlineEditorBlock from './InlineEditorBlock.js'\nimport useLoadBlocks from '../../hooks/useLoadBlocks.js'\nimport useSaveBlock from '../../hooks/useSaveBlock.js'\nimport useArchiveBlock from '../../hooks/useArchiveBlock.js'\n// import { useTranslatedInputContext } from './TranslatedInput.js'\n\nimport AddMenu from './AddMenu.js'\n\nimport { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd'\nimport DragIndicatorIcon from '@mui/icons-material/DragIndicator'\n\nimport classes from './ContentEditor.module.css'\n\n// function stripTmpIds(array){\n//   return [...array].map(obj => {\n//     const obj_new = { ...obj }\n//     delete obj_new._id\n//     return obj_new\n//   })\n// }\n\nfunction addTmpIds(array) {\n  return [...array].map(obj => {\n    const obj_new = { ...obj }\n    obj_new.tmp_id = uuidv4()\n    return obj_new\n  })\n}\n\nfunction getFirstLineStartNode(element){\n  element.normalize()\n\n  const childNodes = element.childNodes\n  if (childNodes.length > 0) {\n    return childNodes[0]\n  }\n\n  return element\n}\n\nfunction getLastLineStartNode(element) {\n  element.normalize()\n\n  const childNodes = [...element.childNodes].reverse()\n  if (childNodes.length > 0) {\n    let lastLineNode = element\n    if (childNodes[0].nodeType === 3) {\n      for (const childNode of childNodes) {\n        if (childNode.nodeType === 3) {\n          lastLineNode = childNode\n        } else if (childNode.nodeType === 1) {\n          break\n        }\n      }\n    } else {\n      if (childNodes.length > 1) {\n        if (childNodes[1].nodeType === 3) {\n          const thisChildNodes = childNodes.slice(1)\n          for (const childNode of thisChildNodes) {\n            if (childNode.nodeType === 3) {\n              lastLineNode = childNode\n            } else if (childNode.nodeType === 1) {\n              break\n            }\n          }\n        }\n      }\n    }\n\n    return lastLineNode\n  }\n\n  return element\n}\n\nfunction moveCursorToOffsetInLine(contentEditableElement, lastLineStartNode, offset = 0) {\n  contentEditableElement.focus()\n\n  // If this function exists... (IE 9+)\n  if (window.getSelection) {\n    const lastLineStartNodeLength = (\n      lastLineStartNode.nodeType === 3\n        ? lastLineStartNode.length\n        : lastLineStartNode.innerText.length\n    )\n\n    if (offset === -1 || offset > lastLineStartNodeLength) {\n      offset = lastLineStartNodeLength\n    }\n\n    const range = document.createRange()\n    range.setStart(lastLineStartNode, 0)\n    range.setEnd(lastLineStartNode, offset)\n    range.collapse(false) // false = collapse to end\n    const sel = window.getSelection()\n    sel.removeAllRanges()\n    sel.addRange(range)\n  }\n}\n\nfunction reorder(list, startIndex, endIndex) {\n  const result = Array.from(list)\n  const [removed] = result.splice(startIndex, 1)\n  result.splice(endIndex, 0, removed)\n\n  return result\n}\n\nfunction ContentEditor({ defaultValue = [], onChange }) {\n  // const [contentConfigs, setContentConfigs] = useState([])\n  const contentConfigs_Ref = useRef([])\n  const contentConfigs = contentConfigs_Ref.current\n\n  // const [inputRefs, setInputRefs] = useState({})\n  const inputRefs_Ref = useRef({})\n  const inputRefs = inputRefs_Ref.current\n\n  const [updateCounter, setUpdateCounter] = useState(0)\n\n  const loadBlocks = useLoadBlocks()\n  const saveBlock = useSaveBlock()\n  const archiveBlock = useArchiveBlock()\n\n  const [autoFocus, setAutoFocus] = useState(null)\n  useEffect(()=>{\n    if (typeof autoFocus === 'object' && autoFocus !== null) {\n      if (\n        inputRefs.hasOwnProperty(autoFocus.tmp_id)\n      ) {\n        const inputRef = inputRefs[autoFocus.tmp_id]\n        if (\n          typeof inputRef === 'object'\n          && inputRef !== null\n        ) {\n          if (autoFocus.inFirstLine === true) {\n            const firstLineStartNode = getFirstLineStartNode(inputRef.current)\n            moveCursorToOffsetInLine(inputRef.current, firstLineStartNode, autoFocus.positionFromLineStart)\n          } else if (autoFocus.inLastLine === true) {\n            const lastLineStartNode = getLastLineStartNode(inputRef.current)\n            moveCursorToOffsetInLine(inputRef.current, lastLineStartNode, autoFocus.positionFromLineStart)\n          }\n          setAutoFocus(null)\n        }\n      }\n    }\n  }, [\n    autoFocus,\n    setAutoFocus,\n    inputRefs,\n  ])\n\n  useEffect(()=>{\n    async function loadMissingBlocks () {\n      let newContentConfigs = [...addTmpIds(defaultValue)]\n\n      const ids2load = newContentConfigs\n        .filter(contentConfig => !contentConfig.hasOwnProperty('block'))\n        .map(contentConfig => contentConfig.blockId)\n\n      let loadedBlocks = []\n      if (ids2load.length > 0) {\n        loadedBlocks = await loadBlocks({ ids: ids2load })\n      }\n      \n      newContentConfigs = newContentConfigs\n        .map(contentConfig => {\n          if (!contentConfig.hasOwnProperty('block')) {\n            contentConfig.block = loadedBlocks.find(block => block._id === contentConfig.blockId)\n          }\n          return contentConfig\n        })\n\n      contentConfigs_Ref.current = newContentConfigs\n      setUpdateCounter(old => old + 1)\n    }\n\n    if (contentConfigs.length === 0) {\n      if (defaultValue.length > 0) {\n        loadMissingBlocks()\n      }\n    }\n  }, [contentConfigs, defaultValue, loadBlocks, contentConfigs_Ref, setUpdateCounter])\n\n  const saveInputRef = useCallback((keys, inputRef) => {\n    const newInputRefs = {...inputRefs_Ref.current}\n\n    if (\n      !newInputRefs.hasOwnProperty(keys.tmp_id)\n      || newInputRefs[keys.tmp_id] !== inputRef\n    ) {\n      newInputRefs[keys.tmp_id] = inputRef\n      inputRefs_Ref.current = newInputRefs\n    }\n  }, [ inputRefs_Ref ])\n\n  const goToPrevInput = useCallback((keys, { caret }) => {\n    const index = keys.index\n\n    let prevInputRef = null\n    for (let thisIndex = contentConfigs.length-1; thisIndex >= 0; thisIndex--) {\n      const tmp_id = contentConfigs[thisIndex].tmp_id\n      if (thisIndex < index && inputRefs[tmp_id] && inputRefs[tmp_id].current) {\n        prevInputRef = inputRefs[tmp_id]\n        break\n      }\n    }\n\n    if (prevInputRef) {\n      const lastLineStartNode = getLastLineStartNode(prevInputRef.current)\n      moveCursorToOffsetInLine(prevInputRef.current, lastLineStartNode, caret.positionFromLineStart)\n    }\n  }, [ contentConfigs, inputRefs ])\n\n  const goToNextInput = useCallback((keys, { caret }) => {\n    const index = keys.index\n\n    let nextInputRef = null\n    for (let thisIndex = 0; thisIndex < contentConfigs.length; thisIndex++) {\n      const tmp_id = contentConfigs[thisIndex].tmp_id\n      if (thisIndex > index && inputRefs[tmp_id] && inputRefs[tmp_id].current) {\n        nextInputRef = inputRefs[tmp_id]\n        break\n      }\n    }\n\n    if (nextInputRef) {\n      const firstLineStartNode = getFirstLineStartNode(nextInputRef.current)\n      moveCursorToOffsetInLine(nextInputRef.current, firstLineStartNode, caret.positionFromLineStart)\n    }\n  }, [ contentConfigs, inputRefs ])\n\n  const focusLastLine = useCallback(() => {\n    let lastInputRef = null\n    for (let thisIndex = contentConfigs.length-1; thisIndex >= 0; thisIndex--) {\n      const tmp_id = contentConfigs[thisIndex].tmp_id\n      if (inputRefs[tmp_id] && inputRefs[tmp_id].current) {\n        lastInputRef = inputRefs[tmp_id]\n        break\n      }\n    }\n\n    if (lastInputRef) {\n      const lastLineStartNode = getLastLineStartNode(lastInputRef.current)\n      moveCursorToOffsetInLine(lastInputRef.current, lastLineStartNode, -1)\n    }\n  }, [ contentConfigs, inputRefs ])\n\n  const handleRowChange = useCallback((keys, newContentConfig) => {\n    const newContentConfigs = [...contentConfigs]\n    for (const index in newContentConfigs) {\n      const oldContentConfig = newContentConfigs[index]\n      if (oldContentConfig.tmp_id === keys.tmp_id) {\n        newContentConfigs[index] = {\n          ...oldContentConfig,\n          ...newContentConfig,\n        }\n        break\n      }\n    }\n\n    contentConfigs_Ref.current = newContentConfigs\n    onChange(newContentConfigs)\n\n    return new Promise(resolve => {\n      resolve(newContentConfigs)\n    })\n  }, [contentConfigs, contentConfigs_Ref, onChange])\n\n  const addRowByIndex = useCallback((index, offset = 0, newContentConfig) => {\n    if (typeof newContentConfig === 'object') {\n      newContentConfig = {\n        tmp_id: uuidv4(),\n        ...newContentConfig,\n      }\n    } else {\n      newContentConfig = newContentConfig || { tmp_id: uuidv4() }\n    }\n\n    const newBlock = newContentConfig.block || null\n\n    if (\n      newBlock !== null\n      && typeof index === 'number'\n      && !isNaN(index)\n    ) {\n      saveBlock(newBlock)\n        .then(newBlock => {\n          newContentConfig.block = newBlock\n          newContentConfig.blockId = newBlock._id\n\n          let new_rows = [...contentConfigs]\n          new_rows.splice(index + offset, 0, newContentConfig)\n          contentConfigs_Ref.current = new_rows\n          onChange(new_rows)\n        })\n        .catch(console.error)\n    }\n  }, [contentConfigs, contentConfigs_Ref, saveBlock, onChange])\n\n  const onMergeToPrevInput = useCallback(keys => {\n    const {\n      index,\n    } = keys\n\n    const clonedContentConfigs = [...contentConfigs]\n    if (index > 0) {\n      const prev_index = index - 1\n      const prev_contentConfig = clonedContentConfigs[prev_index]\n      const prev_tmp_id = prev_contentConfig.tmp_id\n\n      const this_block = clonedContentConfigs[index].block\n      const prev_block = clonedContentConfigs[prev_index].block\n\n      const new_prev_block = {\n        ...prev_block,\n        properties: {\n          ...prev_block.properties,\n          text: prev_block.properties.text + this_block.properties.text,\n        },\n      }\n\n      const thisRef = inputRefs_Ref.current[prev_tmp_id]\n      const textLength = thisRef.current.textContent.length\n\n      saveBlock(new_prev_block)\n        .then(savedPrevBlock => {\n          const new_tmp_id = uuidv4()\n          handleRowChange({\n            index: prev_index,\n            tmp_id: prev_tmp_id,\n          }, {\n            ...prev_contentConfig,\n            tmp_id: new_tmp_id,\n            blockId: savedPrevBlock._id,\n            block: savedPrevBlock,\n          })\n            .then(newContentConfigs => {\n              const this_block = newContentConfigs[index].block\n              newContentConfigs.splice(index, 1) // delete the block\n\n              archiveBlock({ _id: this_block._id, archive: true })\n                .then(() => {\n                  contentConfigs_Ref.current = newContentConfigs\n                  setAutoFocus({\n                    tmp_id: new_tmp_id,\n                    positionFromLineStart: textLength,\n                    inFirstLine: false,\n                    inLastLine: true,\n                  })\n                  onChange(newContentConfigs)\n                })\n            })\n        })\n        .catch(console.error)\n    } else {\n      // This is the first row. Nothing to merge into.\n    }\n  }, [ contentConfigs, inputRefs_Ref, saveBlock, handleRowChange, archiveBlock, contentConfigs_Ref, setAutoFocus, onChange ])\n\n  const onMergeFromNextInput = useCallback(keys => {\n    const {\n      index,\n      tmp_id,\n    } = keys\n\n    const clonedContentConfigs = [...contentConfigs]\n    if (index < clonedContentConfigs.length - 1) {\n\n      const next_index = index + 1\n\n      const this_old_contentConfig = clonedContentConfigs[index]\n      const this_block = clonedContentConfigs[index].block\n      const next_block = clonedContentConfigs[next_index].block\n\n      const new_block = {\n        ...this_block,\n        properties: {\n          ...this_block.properties,\n          text: this_block.properties.text + next_block.properties.text,\n        },\n      }\n\n      const thisRef = inputRefs_Ref.current[tmp_id]\n      const textLength = thisRef.current.textContent.length\n\n      saveBlock(new_block)\n        .then(savedBlock => {\n          const new_tmp_id = uuidv4()\n          handleRowChange(keys, {\n            ...this_old_contentConfig,\n            tmp_id: new_tmp_id,\n            blockId: savedBlock._id,\n            block: savedBlock,\n          })\n            .then(newContentConfigs => {\n              const next_block = newContentConfigs[next_index].block\n              newContentConfigs.splice(next_index, 1) // delete the block\n\n              archiveBlock({ _id: next_block._id, archive: true })\n                .then(() => {\n                  contentConfigs_Ref.current = newContentConfigs\n                  setAutoFocus({\n                    tmp_id: new_tmp_id,\n                    positionFromLineStart: textLength,\n                    inFirstLine: false,\n                    inLastLine: true,\n                  })\n                  onChange(newContentConfigs)\n                })\n            })\n        })\n        .catch(console.error)\n\n\n\n\n      // // const firstBlock = rows[index]\n      // // const secondBlock = rows[index + 1]\n\n      // // get current text length (we know the caret is at the end of the text)\n      // const thisRef = inputRefs[tmp_id]\n      // const textLength = thisRef.current.textContent.length\n\n      // // refocus the input at the last caret position\n      // const lastLineStartNode = getLastLineStartNode(thisRef.current)\n      // moveCursorToOffsetInLine(thisRef.current, lastLineStartNode, textLength) // we can't use a text length of -1, as the text length will be changed after the merge\n    } else {\n      // This is the last row. Nothing to merge into.\n    }\n  }, [ contentConfigs, inputRefs_Ref, saveBlock, handleRowChange, archiveBlock, contentConfigs_Ref, setAutoFocus, onChange ])\n\n  const splitText = useCallback((keys, { texts }) => {\n    const {\n      index,\n      tmp_id,\n    } = keys\n\n    const newContentConfigs = [...contentConfigs]\n\n    const block = (newContentConfigs.find(block => block.tmp_id === tmp_id)).block || {}\n\n    const firstBlock = {\n      ...block,\n      properties: {\n        ...block.properties,\n        text: texts[0],\n      },\n    }\n\n    const secondBlock = {\n      type: block.type,\n      properties: {\n        text: texts[1],\n      },\n    }\n\n    saveBlock(firstBlock)\n      .then(savedFirstBlock => {\n        saveBlock(secondBlock)\n          .then(savedSecondBlock => {\n            newContentConfigs[index] = {\n              ...newContentConfigs[index],\n              tmp_id: uuidv4(),\n              blockId: savedFirstBlock._id,\n              block: savedFirstBlock,\n            }\n\n            const nextContentConfig = {\n              tmp_id: uuidv4(),\n              blockId: savedSecondBlock._id,\n              block: savedSecondBlock,\n            }\n            newContentConfigs.splice(index + 1, 0, nextContentConfig)\n\n            contentConfigs_Ref.current = newContentConfigs\n            onChange(newContentConfigs)\n            setAutoFocus({\n              tmp_id: nextContentConfig.tmp_id,\n              positionFromLineStart: 0,\n              inFirstLine: true,\n              inLastLine: false,\n            })\n          })\n          .catch(console.error)\n        })\n      .catch(console.error)\n  }, [\n    contentConfigs,\n    saveBlock,\n    contentConfigs_Ref,\n    onChange,\n    setAutoFocus,\n  ])\n\n  const handleRemoveSelf = useCallback(keys => {\n    const {\n      index,\n    } = keys\n\n    const newContentConfigs = [...contentConfigs]\n    newContentConfigs.splice(index, 1) // delete the block\n\n    contentConfigs_Ref.current = newContentConfigs\n\n    onChange(newContentConfigs)\n  }, [ contentConfigs, onChange ])\n\n  function onDragEnd(result) {\n    if (!result.destination) {\n      return\n    }\n\n    if (result.destination.index === result.source.index) {\n      return\n    }\n\n    const newContentConfigs = reorder(\n      contentConfigs,\n      result.source.index,\n      result.destination.index\n    )\n\n    contentConfigs_Ref.current = newContentConfigs\n    onChange(newContentConfigs)\n  }\n\n  const filteredContentConfigs = contentConfigs\n    .filter(Boolean)\n    .filter(contentConfig => contentConfig.tmp_id)\n\n  return <>\n  <div\n    key={updateCounter}\n    style={{\n      position: 'relative',\n      width: '1000px',\n      maxWidth: '100%',\n      margin: 'var(--basis_x8) auto 0 auto',\n    }}\n  >\n    <div>\n      <AddMenu\n        types={[\n          'button',\n          'text',\n          // 'checkbox',\n          // 'code',\n          'divider',\n          'page',\n          'redirect',\n        ]}\n        createBlock={({ type }) => addRowByIndex(0, 0, { block: { type: type } })}\n        trigger={triggerProps => \n          <button\n            {...triggerProps}\n            className=\"text hasIcon\"\n            style={{\n              margin: '0 0 var(--basis_x2) 0',\n            }}\n          >\n            <span style={{pointerEvents: 'none'}}>\n              <AddIcon className=\"icon\" />\n              <span style={{marginInlineStart: 'var(--basis_x2)', verticalAlign: 'middle'}}>\n                <Localized id=\"add_content_before\" />\n              </span>\n            </span>\n          </button>\n        }\n      />\n    </div>\n\n    <DragDropContext onDragEnd={onDragEnd}>\n      <Droppable\n        droppableId=\"list\"\n        isDropDisabled={false}\n      >\n        {provided => (\n          <div\n            ref={provided.innerRef}\n            {...provided.droppableProps}\n            className=\"inputBorder\"\n            style={{\n              '--input-box-shadow': 'inset var(--basis_x8) 0 0 0 var(--background), inset var(--basis_x8) 0 0 var(--basis_x0_2) var(--on-background-contrast), inset 0 0 0 var(--basis_x0_2) var(--on-background-contrast)',\n              boxShadow: 'var(--input-box-shadow)',\n              paddingTop: filteredContentConfigs.length > 0 ? 'var(--basis)' : '',\n              paddingRight: 'var(--basis)',\n            }}\n          >\n            {\n              filteredContentConfigs\n              .map(\n                (contentConfig, index) => {\n                  const tmp_id = contentConfig.tmp_id\n                  const keys = {\n                    index,\n                    tmp_id,\n                  }\n\n                  return <Draggable\n                    key={tmp_id}\n                    draggableId={tmp_id}\n                    index={index}\n                    isDragDisabled={false}\n                    disableInteractiveElementBlocking={true}\n                    shouldRespectForcePress={true}\n                  >\n                    {provided => (\n                      <div\n                        ref={provided.innerRef}\n                        {...provided.draggableProps}\n\n                        key={tmp_id}\n                        className={classes.row}\n                      >\n                      <div className={classes.form}>\n                        <InlineEditorBlock\n                          key={tmp_id}\n                          className={classes.item}\n                          dataset={{\n                            'data-index': index,\n                            'data-id': tmp_id,\n                          }}\n                          contentConfig={contentConfig}\n\n                          reorderHandle={\n                            <Tooltip title={<div style={{ textAlign: 'center' }}>\n                              <strong>Drag</strong> to move.<br />\n                              <strong>Click</strong> to open menu.\n                            </div>}>\n                              <button\n                                className={`text ${classes.inlineRowButton} ${classes.dragHandleButton}`}\n                                {...provided.dragHandleProps}\n                              >\n                                <DragIndicatorIcon />\n                              </button>\n                            </Tooltip>\n                          }\n\n                          onRemoveSelf={ () => handleRemoveSelf(keys) }\n                          addRowBefore={ (newValue) => addRowByIndex(index, 0, newValue) }\n                          addRowAfter={ (newValue) => addRowByIndex(index, 1, newValue) }\n\n                          onInputRef={(inputRef) => saveInputRef(keys, inputRef)}\n                          onGoToPrevInput={(attr) => goToPrevInput(keys, attr)}\n                          onGoToNextInput={(attr) => goToNextInput(keys, attr)}\n                          onSplitText={(attr) => splitText(keys, attr)}\n                          onChange={(attr) => handleRowChange(keys, attr)}\n                          onMergeToPrevInput={(attr) => onMergeToPrevInput(keys, attr)}\n                          onMergeFromNextInput={(attr) => onMergeFromNextInput(keys, attr)}\n                          // {...repeater_props}\n                        />\n                      </div>\n                    </div>\n                    )}\n                  </Draggable>\n                }\n              )\n            }\n            {provided.placeholder}\n          </div>\n        )}\n      </Droppable>\n    </DragDropContext>\n  </div>\n\n  <div\n    style={{\n      position: 'relative',\n      height: '50vh',\n      cursor: (filteredContentConfigs.length === 0 ? 'default' : 'text'),\n    }}\n    onClick={filteredContentConfigs.length === 0 ? null : focusLastLine}\n  ></div>\n  </>\n}\n\nexport default ContentEditor\n","import { useState, useCallback } from 'react'\n\nimport useSaveBlock from '../../hooks/useSaveBlock.js'\n\nimport { Helmet } from 'react-helmet'\n\n// import Select from 'react-select'\n\nimport {\n  // TranslateSharp as TranslateIcon,\n  IosShareSharp as ShareIcon,\n  LockSharp as PermissionsIcon,\n  SaveSharp as SaveIcon,\n  MoreHorizSharp as BlockMenuIcon,\n} from '@mui/icons-material'\n\nimport MdiIcon from '@mdi/react'\nimport {\n  mdiTranslate,\n} from '@mdi/js'\n\nimport classes from './PageEditor.module.css'\n\nimport { Localized, useLocalization } from '../../fluent/Localized.js'\n// import { useTranslatedInputContext, LocalesMenu } from '../edit/TranslatedInput.js'\n\nimport Header from '../Header.js'\nimport BlockMenu from '../edit/BlockMenu.js'\nimport SharingEditor from '../edit/SharingEditor.js'\nimport TranslationEditor from '../edit/TranslationEditor.js'\nimport PermissionsEditor from '../edit/PermissionsEditor.js'\nimport PropertiesEditor from '../edit/PropertiesEditor.js'\nimport ContentEditor from '../edit/ContentEditor.js'\n\n// const custom_react_select_styles = {\n//   menu: (provided, state) => ({\n//     ...provided,\n//     background: 'var(--purple)',\n//   }),\n// }\n// const custom_react_select_theme = theme => ({\n//   ...theme,\n//   borderRadius: 0,\n//   colors: {\n//     ...theme.colors,\n//     primary: 'var(--green)',\n//     primary25: 'var(--purple-dark)',\n//   },\n// })\n\nfunction PageEditor({\n  block,\n  onSaveBlock,\n}) {\n  const { getString } = useLocalization()\n\n  const saveBlock = useSaveBlock()\n\n  // const { currentLocale, setLocales } = useTranslatedInputContext()\n\n  const [ isSharingEditorOpen, setIsSharingEditorOpen ] = useState(false)\n  const openSharingEditor = useCallback(() => setIsSharingEditorOpen(true), [ setIsSharingEditorOpen ])\n  const closeSharingEditor = useCallback(() => setIsSharingEditorOpen(false), [ setIsSharingEditorOpen ])\n\n  const [ isTranslationEditorOpen, setIsTranslationEditorOpen ] = useState(false)\n  const openTranslationEditor = useCallback(() => setIsTranslationEditorOpen(true), [ setIsTranslationEditorOpen ])\n  const closeTranslationEditor = useCallback(() => setIsTranslationEditorOpen(false), [ setIsTranslationEditorOpen ])\n\n  const [ isPermissionsEditorOpen, setIsPermissionsEditorOpen ] = useState(false)\n  const openPermissionsEditor = useCallback(() => setIsPermissionsEditorOpen(true), [ setIsPermissionsEditorOpen ])\n  const closePermissionsEditor = useCallback(() => setIsPermissionsEditorOpen(false), [ setIsPermissionsEditorOpen ])\n\n  // const [block, setBlock] = useState({\n  //   type: defaultType || 'page',\n  //   properties: defaultProperties || {},\n  //   content: defaultContent || [],\n  //   ...defaultBlockRest,\n  // })\n  const type = block.type\n  const properties = block.properties\n  const content = block.content\n  const permissions = block.permissions\n\n  const saveType = useCallback(newType => {\n    if (newType !== block.type) {\n      const newBlock = {\n        ...block,\n        type: newType,\n      }\n\n      saveBlock(newBlock)\n        .then(gottenBlock => {\n          onSaveBlock(gottenBlock)\n        })\n    }\n  }, [block, saveBlock, onSaveBlock])\n\n  const saveProperties = useCallback(newProperties => {\n    if (newProperties !== block.properties) {\n      const newBlock = {\n        ...block,\n        properties: newProperties,\n      }\n\n      saveBlock(newBlock)\n        .then(gottenBlock => {\n          onSaveBlock(gottenBlock)\n        })\n    }\n  }, [block, saveBlock, onSaveBlock])\n\n  const saveProperty = useCallback((propertyName, newValue) => {\n    if (\n      typeof propertyName === 'string'\n    ) {\n      const newProperties = { ...properties }\n      if (newValue === null) {\n        delete newProperties[propertyName]\n      } else {\n        newProperties[propertyName] = newValue\n      }\n      \n      saveProperties(newProperties)\n    }\n  }, [properties, saveProperties])\n\n  const saveContent = useCallback(newContent => {\n    if (newContent !== block.content) {\n      const newBlock = {\n        ...block,\n        content: newContent,\n      }\n\n      saveBlock(newBlock)\n        .then(gottenBlock => {\n          onSaveBlock(gottenBlock)\n        })\n    }\n  }, [block, saveBlock, onSaveBlock])\n\n  const savePermissions = useCallback(newPermissions => {\n    if (newPermissions !== block.permissions) {\n      const newBlock = {\n        ...block,\n        permissions: newPermissions,\n      }\n\n      saveBlock(newBlock)\n        .then(gottenBlock => {\n          onSaveBlock(gottenBlock)\n        })\n    }\n  }, [block, saveBlock, onSaveBlock])\n\n  const manuallySaveEverything = useCallback(() => {\n    saveBlock(block)\n      .then(gottenBlock => {\n        if (gottenBlock._id !== block._id) {\n          onSaveBlock(gottenBlock)\n        }\n      })\n  }, [saveBlock, block, onSaveBlock])\n\n  // const isFirstRun = useRef(true)\n  // useEffect(() => {\n  //   if (isFirstRun.current) {\n  //     isFirstRun.current = false\n  //     return;\n  //   }\n  //\n  //   if (\n  //     Object.keys(block).length > 0\n  //     && JSON.stringify(initialBlock) !== JSON.stringify(block)\n  //   ) {\n  //   }\n  // }, [isFirstRun, initialBlock, block])\n\n  const rightHeaderActions = <div className=\"buttonRow\" style={{ whiteSpace: 'nowrap' }}>\n    {/* <button className=\"text\"><Localized id=\"path_editor_share\"/></button> */}\n\n\n    {/*\n    <LocalesMenu\n      trigger={triggerProps => (\n        <button {...triggerProps} className=\"text hasIcon\">\n          <TranslateIcon className=\"icon\" />\n          <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}>\n            <Localized id=\"path_editor_translate\" />\n            {getString('locale_'+currentLocale)}\n          </span>\n        </button>\n      )}\n    />\n    */}\n\n    {\n      isSharingEditorOpen\n      ? <SharingEditor\n          defaultBlock={block}\n          open={isSharingEditorOpen}\n          onClose={closeSharingEditor}\n          onChange={saveProperties}\n        />\n      : null\n    }\n    <button className=\"text hasIcon\" onClick={openSharingEditor}>\n      <ShareIcon className=\"icon\" />\n      <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"path_editor_share\" /></span>\n    </button>\n\n    {\n      type !== 'divider'\n      ? <>\n        {\n          isTranslationEditorOpen\n          ? <TranslationEditor\n              defaultBlock={block}\n              open={isTranslationEditorOpen}\n              onClose={closeTranslationEditor}\n              onSaveProperty={saveProperty}\n            />\n          : null\n        }\n        <button className=\"text hasIcon\" onClick={openTranslationEditor}>\n          <MdiIcon\n            path={mdiTranslate}\n            className=\"icon\"\n          />\n          <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"path_editor_translate\" /></span>\n        </button>\n      </>\n      : null\n    }\n\n    {\n      isPermissionsEditorOpen\n      ? <PermissionsEditor\n          defaultPermissions={permissions}\n          open={isPermissionsEditorOpen}\n          onClose={closePermissionsEditor}\n          onChange={savePermissions}\n        />\n      : null\n    }\n    <button className=\"text hasIcon\" onClick={openPermissionsEditor}>\n      <PermissionsIcon className=\"icon\" />\n      <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"path_editor_permissions\" /></span>\n    </button>\n\n    <button className=\"text hasIcon\" onClick={manuallySaveEverything}>\n      <SaveIcon className=\"icon\" />\n      <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"path_editor_publish\" /></span>\n    </button>\n\n    <BlockMenu\n      {...{\n        block,\n        setType: saveType,\n        setProperty: saveProperty,\n      }}\n\n      typeOptions={[\n        'page',\n        'redirect',\n      ]}\n\n      trigger={props => (\n        <button\n          {...props}\n          className=\"default hasIcon\"\n        >\n          <BlockMenuIcon className=\"icon\" />\n        </button>\n      )}\n    />\n  </div>\n\n  const title = block.properties.text || getString('placeholder_main_headline')\n\n  return <div key={block._id} className={`hasHeader ${classes.editor} ${typeof type === 'string' && type !== '' ? classes['type_'+type] : ''}`}>\n    <Helmet>\n      <title>✍️ {title}</title>\n    </Helmet>\n    \n    <Header\n      block={block}\n      // title={<a href={`https://volt.link/${slug}`} target=\"_blank\" rel=\"noopener noreferrer\"><span className=\"hideOnSmallScreen\">volt.link</span>/{slug}</a>}\n      title={title}\n      rightActions={rightHeaderActions}\n    />\n\n    <PropertiesEditor\n      type={type}\n      defaultProperties={properties}\n      onChange={saveProperties}\n    />\n\n    <ContentEditor\n      onChange={saveContent}\n      defaultValue={content}\n    />\n  </div>\n}\n\nexport default PageEditor\n","import { useRef, useState, useEffect, useCallback } from 'react'\n\nimport {\n  useParams,\n} from 'react-router-dom'\n\nimport classes from './Editor.module.css'\n\nimport useLoadBlock from '../hooks/useLoadBlock.js'\nimport useBlockMatchesRoles from '../hooks/useBlockMatchesRoles.js'\n\nimport Header from '../components/Header.js'\nimport { ErrorPage } from '../components/ErrorPages.js'\n\nimport PageEditor from '../components/apps/PageEditor.js'\n\nfunction Editor() {\n  const loadBlock = useLoadBlock()\n\n  const loadedTheBlock = useRef(false)\n  let { id = '' } = useParams()\n\n  const [block, setBlockInternal] = useState({\n    type: 'page',\n    properties: {},\n    content: [],\n  })\n\n  const setBlock = useCallback(newBlock => {\n    setBlockInternal(newBlock)\n  }, [ setBlockInternal ])\n\n  const [ canEdit, setCanEdit ] = useState(null)\n  const blockMatchesRoles = useBlockMatchesRoles()\n  useEffect(() => {\n    blockMatchesRoles(id, ['editor', 'owner'])\n      .then(matchesRoles => {\n        setCanEdit(matchesRoles)\n      })\n      .catch(error => {\n        console.error(error)\n        setCanEdit(false)\n      })\n  }, [ id, blockMatchesRoles, setCanEdit ])\n\n  useEffect(() => {\n    if (\n      canEdit\n      && typeof id === 'string'\n      && id !== ''\n      && (\n        !loadedTheBlock.current\n        || id !== block._id\n      )\n    ) {\n      loadBlock(id)\n        .then(loadedBlock => {\n          loadedTheBlock.current = true\n\n          setBlock(loadedBlock)\n        })\n    }\n  }, [\n    canEdit,\n    id,\n    block,\n    loadBlock,\n    setBlock,\n    // setLocales,\n  ])\n\n  // const isFirstRun = useRef(true)\n  // useEffect(() => {\n  //   if (isFirstRun.current) {\n  //     isFirstRun.current = false\n  //     return;\n  //   }\n  //\n  //   if (\n  //     Object.keys(block).length > 0\n  //     && JSON.stringify(initialBlock) !== JSON.stringify(block)\n  //   ) {\n  //   }\n  // }, [isFirstRun, initialBlock, block])\n\n  if (canEdit === false) {\n    return <div className={classes.editor}>\n      <Header\n        block={null}\n        title=\"Error\"\n        rightActions={null}\n      />\n      <div className={`basis_x1 ${classes.app} ${classes.spine_aligned}`} dir=\"auto\">\n        <main className={`${classes.contentWrapper}`}>\n          <ErrorPage errorName=\"no_access\" />\n        </main>\n      </div>\n    </div>\n  } else if (canEdit === true) {\n    return <PageEditor\n      block={block}\n      onSaveBlock={setBlock}\n    />\n  } else {\n    return null\n  }\n}\n\nexport default Editor\n","import React, { useRef, useState, useEffect, useCallback } from 'react'\n\nimport {\n  useParams,\n  Link,\n} from 'react-router-dom'\n\nimport { Helmet } from 'react-helmet'\n\nimport { getImageUrl } from '../functions.js'\n\nimport { Localized, useLocalization } from '../fluent/Localized.js'\nimport useLoadBlock from '../hooks/useLoadBlock.js'\nimport useLoadBlocks from '../hooks/useLoadBlocks.js'\nimport useUser from '../hooks/useUser.js'\nimport useBlockMatchesRoles from '../hooks/useBlockMatchesRoles.js'\n\nimport { ErrorPage } from '../components/ErrorPages.js'\nimport Header from '../components/Header.js'\nimport ViewerAuto from '../components/view/ViewerAuto.js'\n\nimport LocaleSelect from '../components/edit/LocaleSelect.js'\n\nimport classes from './Viewer.module.css'\n\nimport {\n  EditSharp as EditIcon,\n} from '@mui/icons-material'\n\nimport { renderInlineMarkdown } from '../markdown.js'\n\nfunction Viewer () {\n  const loadingTheBlock = useRef(false)\n  const { getString, translateBlock, userLocales } = useLocalization()\n\n  const { loggedIn } = useUser()\n\n  const loadBlock = useLoadBlock()\n  const loadBlocks = useLoadBlocks()\n\n  let { id = '' } = useParams()\n\n  const [block, setBlock] = useState({\n    type: 'page',\n    properties: {},\n    content: [],\n  })\n  const [contentBlocks, setContentBlocks] = useState([])\n\n  const [possibleLocales, setPossibleLocales] = useState([])\n  const [locales, setLocales] = useState(block.properties.locale || userLocales || ['en'])\n  const handleLocaleChange = useCallback((newLocale) => {\n    setLocales([newLocale])\n  }, [ setLocales ])\n\n  const [canView, setCanView] = useState(null)\n  const blockMatchesRoles = useBlockMatchesRoles()\n  useEffect(() => {\n    blockMatchesRoles(id, ['viewer', 'owner'])\n      .then(matchesRoles => {\n        setCanView(matchesRoles)\n      })\n      .catch(error => {\n        console.error(error)\n        setCanView(false)\n      })\n  }, [ id, blockMatchesRoles, setCanView ])\n\n  useEffect(() => {\n    if (\n      canView\n      && loadingTheBlock.current === false\n      && typeof id === 'string'\n      && id !== ''\n      && id !== block._id\n    ) {\n      loadingTheBlock.current = true\n      loadBlock(id)\n        .then(async loadedBlock => {\n\n          let newLoadedBlock = loadedBlock\n\n          if (\n            Array.isArray(loadedBlock.content)\n            && loadedBlock.content.length > 0\n          ) {\n            let newContentConfigs = [...loadedBlock.content]\n\n            const ids2load = loadedBlock.content\n              .filter(contentConfig => !contentConfig.hasOwnProperty('block'))\n              .map(contentConfig => contentConfig.blockId)\n\n            let loadedContentBlocks = []\n            if (ids2load.length > 0) {\n              loadedContentBlocks = await loadBlocks({ ids: ids2load })\n            }\n          \n            newContentConfigs = newContentConfigs\n              .map(contentConfig => {\n                if (!contentConfig.hasOwnProperty('block')) {\n                  contentConfig.block = loadedContentBlocks.find(block => block._id === contentConfig.blockId)\n                }\n                return contentConfig\n              })\n\n            newLoadedBlock = {\n              ...newLoadedBlock,\n              content: newContentConfigs,\n            }\n          }\n\n          const blocks = (newLoadedBlock.content || [])\n          .map(contentConfig => contentConfig.block)\n\n          const newPossibleLocales = [...new Set(\n            [\n              block,\n              ...blocks,\n            ]\n            .flatMap(thisBlock => [\n              thisBlock.properties.locale,\n              ...(thisBlock.properties.translations || [])\n                .filter(t => t.text && t.text.length > 0)\n                .map(t => t.locale),\n            ])\n            .filter(Boolean)\n          )]\n          setPossibleLocales(newPossibleLocales)\n\n          setBlock(newLoadedBlock)\n          setContentBlocks(blocks)\n          loadingTheBlock.current = false\n        })\n    }\n  }, [\n    canView,\n    id,\n    block,\n    block._id,\n    loadBlock,\n    setBlock,\n    loadBlocks,\n    setContentBlocks,\n    setPossibleLocales\n  ])\n\n  if (canView === false) {\n    return <div className={classes.viewer}>\n      <Header\n        block={null}\n        title=\"Error\"\n        rightActions={null}\n      />\n      <div className={`basis_x1 ${classes.app} ${classes.spine_aligned}`} dir=\"auto\">\n        <main className={`${classes.contentWrapper}`}>\n          <ErrorPage errorName=\"no_access\" />\n        </main>\n      </div>\n    </div>\n  } else {\n  const type = block.type || null\n\n  const title = translateBlock(block, locales, getString('placeholder_main_headline'))\n  const coverphoto_url = getImageUrl(block.properties.coverphoto)\n  const icon_url = getImageUrl(block.properties.icon)\n\n  // const pronouns = block.properties.pronouns || ''\n  \n  const rightHeaderActions = <>\n    <div className=\"buttonRow\" style={{ whiteSpace: 'nowrap' }}>\n      {\n        loggedIn\n        && <Link to={`/${block._id}/edit`} style={{ marginRight: 'var(--basis_x2)' }}>\n            <button className=\"text hasIcon\">\n              <EditIcon className=\"icon\" />\n              <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"edit_block\" /></span>\n            </button>\n          </Link>\n      }\n\n      {\n        possibleLocales.length > 1\n        && <LocaleSelect\n          onChange={handleLocaleChange}\n          defaultValue={locales[0] || userLocales[0] || 'en'}\n          options={possibleLocales}\n        />\n      }\n    </div>\n  </>\n\n  const titleWithRenderedMarkdown = {\n    __html: renderInlineMarkdown(title)\n  }\n\n  return <div className={classes.viewer}>\n    <Helmet>\n      <title>{title}</title>\n    </Helmet>\n\n    <Header\n      block={block}\n      title={\n        <span\n          dir=\"auto\"\n          dangerouslySetInnerHTML={titleWithRenderedMarkdown}\n        />\n      }\n      rightActions={rightHeaderActions}\n    />\n\n    <div className={`basis_x1 ${classes.app} ${classes.spine_aligned}`} dir=\"auto\">\n      {\n      (type === 'page' || type === 'person' || type === 'redirect')\n      && coverphoto_url !== ''\n          ? <div style={{ backgroundImage: `url(${window.domains.backend}download_url?f=jpg&w=1400&h=400&url=${encodeURIComponent(coverphoto_url)})` }} className={classes.coverphoto}></div>\n          : null\n      }\n      <main className={`${classes.contentWrapper}`}>\n        {\n          (type === 'page' || type === 'person' || type === 'redirect')\n          && icon_url !== ''\n            ? <div\n                style={{\n                  backgroundImage: `url(${window.domains.backend}download_url?f=png&w=400&h=400&url=${encodeURIComponent(icon_url)})`\n                }}\n                className={`${classes.icon} ${coverphoto_url === '' ? classes.coverphotoIsNotSet : classes.coverphotoIsSet}`}\n              ></div>\n            : null\n        }\n        {\n          title !== ''\n          ? <h1\n              dir=\"auto\"\n              dangerouslySetInnerHTML={titleWithRenderedMarkdown}\n              style={{\n                whiteSpace: 'pre-wrap',\n              }}\n            />\n          : null\n        }\n        { /* type === 'person' && pronouns !== '' ? <p dir=\"auto\"><strong style={{\n          padding: 'var(--basis)',\n          margin: 'var(--basis_x0_5) calc(-1 * var(--basis))',\n          display: 'inline-block',\n          backgroundColor: 'rgba(var(--on-background-rgb), var(--alpha-less))',\n        }}>{pronouns}</strong></p> : null */ }\n        <div className={classes.items}>\n          {\n            contentBlocks\n            .filter(block => !!block)\n            .filter(block => block.properties.active !== false)\n            .map(contentBlock => <ViewerAuto key={contentBlock._id} block={contentBlock} locales={locales} />)\n          }\n        </div>\n      </main>\n    </div>\n  </div>\n  }\n}\n\nexport default Viewer\n","import React, { useState, useEffect } from 'react'\n\nimport classes from './App.module.css'\n\nimport {\n  Routes,\n  Route,\n  useLocation,\n  useMatch,\n  // useNavigate,\n} from 'react-router-dom'\n\nimport { SidebarProvider, Sidebar, SidebarContent, Main } from '../components/Sidebar.js'\n// import Shortcode from './Shortcode.js'\nimport Editor from './Editor.js'\nimport Viewer from './Viewer.js'\n\n// function useScrollMemory() {\n//   // const navigate = useNavigate()\n//   const location = useLocation()\n//\n//   const pathRef = useRef(null)\n//\n//   useEffect(() => {\n//     console.log('location', location)\n//     pathRef.current = location.pathname\n//   }, [location])\n//\n//   useEffect(() => {\n//     // Listen for location changes and set the scroll position accordingly.\n//     const setFromHistoryState = state => {\n//       console.log('popstate-state', state)\n//       let scrollY = 0\n//       if (state && state.scrollY) {\n//         scrollY = state.scrollY\n//       }\n//       console.log('A-popstate-scrollY', scrollY)\n//       if (scrollY < 100) {\n//         scrollY = 0\n//       }\n//\n//       console.log('B-popstate-scrollY', scrollY)\n//       window.scrollTo(0, scrollY)\n//       setTimeout(()=>{\n//         window.scrollTo(0, scrollY)\n//       }, 500)\n//     }\n//\n//     setFromHistoryState(window.history.state)\n//     const popstateListener = event => {\n//       if (event.type === 'popstate') {\n//         setFromHistoryState(event.state)\n//       }\n//     }\n//     window.addEventListener('popstate', popstateListener)\n//\n//     const scrollListener = () => {\n//       const newScrollY = window.scrollY\n//       console.log(' ')\n//       console.log('scrollListener-window.history.state', window.history.state)\n//       console.log('scrollListener-newScrollY', newScrollY)\n//       console.log('pathRef.current', pathRef.current)\n//\n//       if (typeof pathRef.current === 'string') {\n//         window.history.replaceState(\n//           {\n//             ...(window.history.state || {}),\n//             scrollY: newScrollY,\n//           },\n//           '',\n//           pathRef.current\n//         )\n//         console.log('window.history.state', window.history.state)\n//\n//         // navigate(pathRef.current, {\n//         //   replace: true,\n//         //   state: {\n//         //     // ...(window.history.state || {}),\n//         //     scrollY: newScrollY,\n//         //   },\n//         // })\n//       }\n//     }\n//     window.addEventListener('scroll', scrollListener)\n//\n//     // Unregister listener when component unmounts.\n//     return () => {\n//       console.log('Unregister')\n//       window.removeEventListener('popstate', popstateListener)\n//       window.removeEventListener('scroll', scrollListener)\n//     }\n//   }, [])\n// }\n\nfunction App() {\n  // useScrollMemory()\n\n  const matchesStartpage = useMatch('/')\n  const location = useLocation()\n\n  const [customLocation, setCustomLocation] = useState({})\n\n  useEffect(() => {\n    //    /slug=id/suffix\n    //    /slugOrId/suffix\n\n    const slugAndIdRegex = /^\\/([^=/]*)(?:=?)([^=/]*)(.*)/\n\n    const slugAndIdMatch = location.pathname.match(slugAndIdRegex)\n    const slugOrId = slugAndIdMatch[1]\n    let id = slugAndIdMatch[2]\n    let suffix = slugAndIdMatch[3]\n\n    if (!id && slugOrId) {\n      id = slugOrId\n    }\n\n    if (\n      id !== ''\n      && suffix !== '/edit'\n      && suffix !== '/view'\n    ) {\n      suffix = '/view'\n    }\n\n    const newPathname = `/${id}${suffix}`\n    if (customLocation.pathname !== newPathname) {\n      // TODO: save scroll position\n      \n\n\n      setCustomLocation({\n        pathname: newPathname,\n      })\n    }\n  }, [ location, customLocation, setCustomLocation ])\n\n  return (<>\n    <div className={`${classes.app} ${matchesStartpage ? classes.isStartpage : ''}`}>\n      <SidebarProvider>\n        {\n          matchesStartpage\n          ? null\n          : <Sidebar />\n        }\n        <Main>\n          <Routes location={customLocation}>\n            <Route path=\"/:id/view\" element={<Viewer />} />\n            <Route path=\"/:id/edit\" element={<Editor />} />\n            {/* <Route path=\"/shortcode\" element={<Shortcode />} /> */}\n            <Route path=\"/\" element={<SidebarContent />} />\n          </Routes>\n        </Main>\n      </SidebarProvider>\n    </div>\n  </>)\n}\n\nexport default App\n","import React, { useEffect, useState } from 'react'\n\n// https://projectfluent.org/play/\n\n// import { LocalizationProvider, Localized } from '@fluent/react' // '@fluent/react/compat'\nimport { ReactLocalization, LocalizationProvider } from '@fluent/react'\nimport { FluentBundle, FluentResource } from '@fluent/bundle'\nimport { negotiateLanguages } from '@fluent/langneg'\n\n\nexport const locales = {\n  de: 'Deutsch',\n  en: 'English',\n  // es: 'Español',\n  // pt: 'Português',\n  fr: 'Français',\n  // it: 'Italiano',\n  // nl: 'Dutch',\n  // pl: 'Polska',\n  // ru: 'Pусский',\n}\n\nconst _supportedLocales_ = Object.keys(locales)\nconst _defaultLocale_ = 'en'\n\n\nasync function fetchMessages(locale) {\n  const path = await import('../locales/' + locale + '.ftl')\n\n  const response = await fetch(path.default)\n  const messages = await response.text()\n\n  return { [locale]: new FluentResource(messages) }\n}\n\nfunction getDefaultBundles() {\n  const bundle = new FluentBundle('')\n  bundle.addResource(new FluentResource(''))\n  return new ReactLocalization([bundle])\n}\n\nasync function createMessagesGenerator(currentLocales) {\n  const fetched = await Promise.all(\n    currentLocales.map(fetchMessages)\n  )\n  const messages = fetched.reduce(\n    (obj, cur) => Object.assign(obj, cur)\n  )\n\n  return function* generateBundles() {\n    for (const locale of currentLocales) {\n      const bundle = new FluentBundle(locale)\n      bundle.addResource(messages[locale])\n      yield bundle\n    }\n  }\n}\n\nexport function AppLocalizationProvider({ userLocales, children, onLocaleChange }) {\n  const [bundles, setBundles] = useState(getDefaultBundles())\n\n  useEffect(() => {\n    async function loadBundles() {\n      const currentLocales = negotiateLanguages(\n        userLocales,\n        _supportedLocales_,\n        { defaultLocale: _defaultLocale_ }\n      )\n\n      if (!!onLocaleChange) {\n        onLocaleChange(currentLocales)\n      }\n\n      const generateBundles = await createMessagesGenerator(currentLocales)\n\n      const new_bundles = new ReactLocalization(generateBundles())\n      new_bundles.userLocales = userLocales\n      new_bundles.defaultLocale = _defaultLocale_\n      new_bundles.supportedLocales = _supportedLocales_\n      setBundles(new_bundles)\n    }\n    loadBundles()\n  }, [userLocales, onLocaleChange])\n\n  if (!bundles) {\n    // Show a loader.\n    return <div>Loading texts…</div>\n  }\n\n  return <LocalizationProvider l10n={bundles}>\n    {children}\n  </LocalizationProvider>\n}\n\n","import React, { useState, useEffect, useCallback } from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\n\nimport snackbarClasses from './Snackbar.module.css'\n\nimport App from './pages/App.js'\n// import reportWebVitals from './reportWebVitals'\nimport { BrowserRouter as Router } from 'react-router-dom'\n\nimport 'intl-pluralrules'\nimport { AppLocalizationProvider, locales } from './fluent/l10n.js'\n// import { TranslatedInputProvider } from './components/edit/TranslatedInput.js'\n\nimport useMediaQuery from '@mui/material/useMediaQuery'\nimport { createTheme, ThemeProvider } from '@mui/material/styles'\n\nimport { SnackbarProvider } from 'notistack'\n\nimport {\n  ApolloClient,\n  InMemoryCache,\n  ApolloProvider,\n} from '@apollo/client'\n\nwindow.process = {} // BUGFIX for CRA4 error-page after hot-reloading.\n\nwindow.env = 'prod' // dev / prod\nwindow.domains = {\n  frontend: 'https://beta.volt.link/',\n  backend: 'https://api.volt.link/',\n  // frontend: 'http://localhost:4003/',\n  // backend: 'http://localhost:4004/',\n}\n\nconst client = new ApolloClient({\n  uri: window.domains.backend+'graphql/v1/',\n  cache: new InMemoryCache(),\n  credentials: 'include',\n  defaultOptions: {\n    watchQuery: {\n      // fetchPolicy: 'cache-and-network',\n      fetchPolicy: 'no-cache',\n      errorPolicy: 'ignore',\n    },\n    query: {\n      fetchPolicy: 'no-cache',\n      errorPolicy: 'all',\n    },\n  },\n})\n\n// client\n//   .query({\n//     query: gql`\n//       query GetRates {\n//         rates(currency: \"USD\") {\n//           currency\n//         }\n//       }\n//     `\n//   })\n//   .then(result => console.info(result));\n\nfunction Start() {\n  // const [userLocales, setUserLocales] = useState(['de'])\n  const [userLocales, setUserLocales] = useState(navigator.languages)\n  const [currentLocale, setCurrentLocale] = useState(null)\n\n  useEffect(() => {\n    if (!!window.umami) {\n      let systemLocales = navigator.languages\n      if (!!systemLocales || Array.isArray(systemLocales)) {\n        for (let locale of systemLocales) {\n          locale = locale.toLowerCase() // Not really correct but the system locales sadly don't conform to the standard.\n\n          const language = locale.split('-')[0]\n          if (language !== locale) {\n            window.umami.trackEvent('L: ' + language) // Log just the language.\n          }\n          window.umami.trackEvent('L: ' + locale) // Log the full locale.\n        }\n      }\n    }\n  }, [])\n\n  const handleLanguageChange = useCallback(event => {\n    setUserLocales([event.target.dataset.locale])\n  }, [setUserLocales])\n\n  const handleCurrentLocalesChange = useCallback(currentLocales => {\n    setCurrentLocale(currentLocales.length > 0 ? currentLocales[0] : '')\n  }, [setCurrentLocale])\n\n\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)')\n\n  const theme = React.useMemo(\n    () =>\n      createTheme({\n        palette: {\n          mode: prefersDarkMode ? 'dark' : 'light',\n        },\n      }),\n    [prefersDarkMode],\n  )\n\n  return <>\n  <div\n    id=\"react-notification\"\n    key=\"react-notification\"\n    style={{zIndex: '10000'}}\n  ></div>\n\n  <AppLocalizationProvider\n    key=\"AppLocalizationProvider\"\n    userLocales={userLocales}\n    onLocaleChange={handleCurrentLocalesChange}\n  >\n    <ApolloProvider client={client}>\n      <ThemeProvider theme={theme}>\n        <SnackbarProvider\n          anchorOrigin={{\n            vertical: 'bottom',\n            horizontal: 'right',\n          }}\n          style={{ minWidth: 'unset' }}\n          classes={{\n            variantSuccess: `${snackbarClasses.snackbar} ${snackbarClasses.success}`,\n            variantError: `${snackbarClasses.snackbar} ${snackbarClasses.error}`,\n            variantWarning: `${snackbarClasses.snackbar} ${snackbarClasses.warning}`,\n            variantInfo: `${snackbarClasses.snackbar} ${snackbarClasses.info}`,\n          }}\n          domRoot={document.getElementById('react-notification')}\n        >\n          {/* <TranslatedInputProvider> */}\n            <Router>\n              <App locales={locales} currentLocale={currentLocale} onLanguageChange={handleLanguageChange} />\n            </Router>\n          {/* </TranslatedInputProvider> */}\n        </SnackbarProvider>\n      </ThemeProvider>\n    </ApolloProvider>\n  </AppLocalizationProvider>\n  </>\n}\n\nReactDOM.render(<Start />, document.getElementById('root'))\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.info))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals()\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"Viewer_app__1_jMF\",\"spine_aligned\":\"Viewer_spine_aligned__2mJuq\",\"items\":\"Viewer_items__2FgjF\",\"coverphoto\":\"Viewer_coverphoto__16R-U\",\"icon\":\"Viewer_icon__219E5\",\"coverphotoIsSet\":\"Viewer_coverphotoIsSet__26PSP\",\"contentWrapper\":\"Viewer_contentWrapper__1HLN8\",\"type_p\":\"Viewer_type_p__O5DZS\",\"viewer\":\"Viewer_viewer__JHrvB\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"row\":\"Repeater_row__1ODoF\",\"middleActions\":\"Repeater_middleActions__3nRoT\",\"trigger\":\"Repeater_trigger__1VtG5\",\"content\":\"Repeater_content__110R9\",\"form\":\"Repeater_form__2N6kw\",\"item\":\"Repeater_item__2OI78\",\"inlineRowButton\":\"Repeater_inlineRowButton__uqk8Y\",\"dragHandleButton\":\"Repeater_dragHandleButton__2eLww\",\"addRowButton\":\"Repeater_addRowButton__3huSP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"icon\":\"ViewerLine_icon__DvsyX\",\"square\":\"ViewerLine_square__3knjg\",\"round\":\"ViewerLine_round__1pnCx\",\"title\":\"ViewerLine_title__35XNW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"PermissionsEditor_dialog__2rpyk\",\"backdrop\":\"PermissionsEditor_backdrop__1dRPN\",\"inputWrapper\":\"PermissionsEditor_inputWrapper__4DGsr\",\"input\":\"PermissionsEditor_input__1HyOC\",\"actions\":\"PermissionsEditor_actions__k4oBn\",\"permissionRow\":\"PermissionsEditor_permissionRow__2HaWO\",\"menuButton\":\"PermissionsEditor_menuButton__2jIMI\",\"ownerInfo\":\"PermissionsEditor_ownerInfo__EEKXP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"IconPicker_root__2okyv\",\"iconIsSet\":\"IconPicker_iconIsSet__SnQwA\",\"coverphotoIsSet\":\"IconPicker_coverphotoIsSet__3m9Dw\",\"icon\":\"IconPicker_icon__JWgfX\",\"iconWrapper\":\"IconPicker_iconWrapper__1zo6g\",\"sizing_pixel\":\"IconPicker_sizing_pixel__3TeE0\",\"iconIsNotSet\":\"IconPicker_iconIsNotSet__1T0Zd\",\"changeIconButton\":\"IconPicker_changeIconButton__TxsdG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"snackbar\":\"Snackbar_snackbar__119_w\",\"default\":\"Snackbar_default__31-eU\",\"success\":\"Snackbar_success__zvTW8\",\"error\":\"Snackbar_error__3XeD6\",\"warning\":\"Snackbar_warning__2CBXt\",\"info\":\"Snackbar_info__EuVSN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"coverphoto\":\"CoverphotoPicker_coverphoto__1mWB4\",\"root\":\"CoverphotoPicker_root__3T8t9\",\"coverphotoIsNotSet\":\"CoverphotoPicker_coverphotoIsNotSet__1O3-S\",\"button_wrapper\":\"CoverphotoPicker_button_wrapper__2oEjh\",\"coverphotoIsSet\":\"CoverphotoPicker_coverphotoIsSet__2o24A\",\"iconIsSet\":\"CoverphotoPicker_iconIsSet__D_4uA\",\"changeCoverphotoButton\":\"CoverphotoPicker_changeCoverphotoButton__2GnZD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main_headline\":\"PropertiesEditor_main_headline__3wy7R\",\"propertiesFrame\":\"PropertiesEditor_propertiesFrame__1uBEz\",\"properties_row\":\"PropertiesEditor_properties_row__2tX7M\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"SharingEditor_dialog__22jfY\",\"backdrop\":\"SharingEditor_backdrop__1Gra9\",\"inputWrapper\":\"SharingEditor_inputWrapper__1UyBD\",\"input\":\"SharingEditor_input__brkXK\",\"actions\":\"SharingEditor_actions__2zz6x\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"InlineEditorBlock_block__14-zd\",\"block_input\":\"InlineEditorBlock_block_input__2I1iu\",\"form_deactivated\":\"InlineEditorBlock_form_deactivated__2oktp\",\"form_active\":\"InlineEditorBlock_form_active__hi5HC\",\"reorderHandle\":\"InlineEditorBlock_reorderHandle__2_s23\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"row\":\"ContentEditor_row__JonRI\",\"form\":\"ContentEditor_form__wtoB9\",\"item\":\"ContentEditor_item__3U0XE\",\"inlineRowButton\":\"ContentEditor_inlineRowButton__2pw6r\",\"dragHandleButton\":\"ContentEditor_dragHandleButton__1Y_RP\"};"],"sourceRoot":""}