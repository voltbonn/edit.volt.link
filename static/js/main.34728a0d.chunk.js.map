{"version":3,"sources":["components/DataTransmat.module.css","components/Twemoji.js","hooks/useMutation.js","components/Header.module.css","components/Header.js","fluent/l10n.js","pages/App.module.css","components/Sidebar.module.css","fluent/Localized.js","fluent/fluentBy.js","hooks/useLoadBlocks.js","components/SubMenu.js","components/edit/BlockMenu.js","components/Popover.js","components/MultiButton.js","hooks/useArchiveBlock.js","components/view/BlockIcon.js","hooks/useLoadPage.js","components/view/ViewerAuto.module.css","components/edit/AddMenu.js","locales lazy /^/.//.*/.ftl$/ groupOptions: {} namespace object","components/SearchBox.js","pages/Viewer.js","pages/App.js","index.js","functions.js","pages/Viewer.module.css","graphql/queries.js","graphql/mutations.js","Snackbar.module.css","components/SearchBox.module.css","components/view/BlockIcon.module.css","components/DataTransmat.js","components/view/ViewerTextCard.js","components/view/ViewerButtonCard.js","components/view/ViewerDividerLine.js","components/view/ViewerLineAndCard.js","hooks/useBlockTrigger.js","components/view/ViewerImageCard.js","hooks/useLoadBlock.js","components/view/ViewerAuto.js","hooks/useUser.js","markdown.js","components/PopoverMenu.js","hooks/useMediaQuery.js","components/Sidebar.js","components/view/ViewerLine.module.css"],"names":["module","exports","Twemoji","className","style","emoji","useState","__html","html","setHtml","useEffect","length","textWithHtml","twemoji","parse","folder","ext","base","fontSize","dangerouslySetInnerHTML","memo","useMutation","apollo_client","useApolloClient","useCallback","option","Promise","resolve","reject","mutate","then","data","error","catch","Header","title","block","rightActions","notificationBanner","useSidebarContext","open","toggleSidebar","blockId","_id","parentId","parent","parentBlocks","setParentBlocks","siblingBlocks","setSiblingBlocks","loadParentBlocks","query","getParentBlocks_Query","variables","a","blocks","parentBlocksSorted","sort","b","computed","console","loadSiblingBlocks","getBlocks_Query","roots","types","archived","filter","leftActions","onClick","margin","flexGrow","to","verticalAlign","opacity","trigger","triggerProps","padding","map","size","fontWeight","classes","header","headerBar","locales","de","en","it","se","fr","es","nl","_supportedLocales_","Object","keys","_defaultLocale_","fetchMessages","locale","path","fetch","default","response","text","messages","FluentResource","createMessagesGenerator","currentLocales","all","fetched","reduce","obj","cur","assign","generateBundles","bundle","FluentBundle","addResource","f","AppLocalizationProvider","userLocales","children","onLocaleChange","ReactLocalization","getDefaultBundles","bundles","setBundles","negotiateLanguages","defaultLocale","new_bundles","supportedLocales","loadBundles","l10n","Localized","props","elems","br","Fragment","id","withLocalization","Inner","React","useContext","FluentContext","createElement","fluentByObject","object","fallback","globalSupportedLocales","thisSupportedLocales","includes","getString","args","translateBlock","properties","Array","isArray","translations","correct_translations","fluentBy","fluentByArray","useLocalization","fluentByAny","any","require","lookupedLocale","strategy","array","key","item","Boolean","result","value","useLoadBlocks","handleLoadBlocks","errors","Error","SubMenu","disabled","parentMenuIsOpen","label","MenuListProps","position","onOpen","triggerRef","useRef","isSubMenuOpen","setIsSubMenuOpen","toggleSubmenu","newOpen","closeSubmenu","MenuItem","ref","display","justifyContent","ArrowRight","marginRight","Menu","pointerEvents","anchorEl","current","anchorOrigin","vertical","horizontal","transformOrigin","autoFocus","disableAutoFocus","disableEnforceFocus","onClose","sx","marginTop","maxWidth","maxHeight","overflow","background","color","ListSubheader","whiteSpace","lineHeight","backgroundColor","Divider","ListItemIcon","Close","typeIcons","button","image","divider","page","redirect","defaultTypeOptions","colorOptions","yellow","green","red","blue","colorOptionsKeys","getColor","hasOwnProperty","renderedColor","getBlockColor","onToogle","saveType","saveProperty","typeOptions","onRemoveRow","addRowBefore","onArchivedToggle","onReloadContext","useUser","loggedIn","userroles","type","active","text_style","text_decorations","roles","canEdit","setArchived","archiveBlock","useArchiveBlock","mutationFunction","navigate","useNavigate","toggleArchiveBlock","mutation","saveBlock_Mutation","newChildBlockId","saveBlock","moveBlock_Mutation","movingBlockId","newParentId","newIndex","newArchived","archive","toggleActive","metadata","toggleTextDecoration","thisDecoration","newTextDecorations","Set","decoration","push","PopoverMenu","height","typeName","selected","marginBottom","thisColor","placeholder","defaultValue","onBlur","e","target","width","thisStyle","VisibilityOff","Visibility","ListItemText","primary","secondary","Unarchive","Archive","component","Link","ListItem","paddingTop","paddingBottom","modified","replace","Popover","setOpenBlockMenuRef","anchorRef","setOpen","setOpenExternal","closePopover","Math","random","toString","substring","undefined","prevOpen","isOpen","top","right","bottom","left","zIndex","cursor","transition","placement","disablePortal","modifiers","name","enabled","options","altBoundary","rootBoundary","TransitionProps","MultiButton","ariaLabel","items","onChange","buttonProps","choosen","setChoosen","handleClick","event","newValue","dataset","icon","archiveBlock_Mutation","unarchiveBlock_Mutation","BlockIcon","iconComponent","isSquareIcon","icon_url","getImageUrl","coverphoto","square","round","backgroundImage","window","domains","backend","imageFormat","encodeURIComponent","alt","useLoadPage","useSnackbar","enqueueSnackbar","closeSnackbar","loadBlocks","slugOrId","final_resolve","preloaded_blocks","SERVER_DATA","slug","getBlocksWithContent_Query","slugs","ids","loadedBlocks","loadSlugInfos","checkSlug_Query","handleLoadPage","final_reject","snackbarKey","loadingDataPromise","done","code","variant","preventDuplicate","autoHideDuration","existsAsSlug","existsAsId","race","setTimeout","persist","blockTypeIcons","checkbox","person","default_types","AddMenuContent","createBlock","close","AddMenu","webpackAsyncContext","req","__webpack_require__","o","website","possibleTypes","SearchBox","results","setResults","setErrors","queryTextRef","setType","showArchived","setShowArchived","useHotkeys","preventDefault","enableOnTags","enableOnContentEditable","open_search","close_search","addEventListener","removeEventListener","perform_search","query_text","t","search_Query","search","handleClose","handleResultClick","index","newBlock","chosenResult","Modal","hideBackdrop","BackdropProps","theme","drawer","backdrop","dialog","alignItems","onFocus","currentTarget","select","searchInput","thisType","filters","gap","searchResults","searchErrors","blockRow","flexDirection","ViewerAuto","blockRowActions","BlockMenu","flexShrink","ErrorPage","lazy","LocaleSelect","Viewer","loadingTheBlock","loadPage","useParams","slugOrId_to_use","split","content","setBlock","contentBlocks","setContentBlocks","possibleLocales","setPossibleLocales","setLocales","handleLocaleChange","newLocale","setError","setAndTrackError","umami","trackEvent","for_slugOrId","loadedBlock","newLoadedBlock","newContentConfigs","ids2load","contentConfig","loadedContentBlocks","find","newPossibleLocales","flatMap","thisBlock","viewer","app","spine_aligned","dir","contentWrapper","forceId","pathSuffix","errorName","coverphoto_url","rightHeaderActions","titleWithRenderedMarkdown","renderInlineMarkdown","metadata_image_url","coverphotoIsSet","Helmet","property","contentBlock","Editor","App","matchesStartpage","useMatch","location","useLocation","customLocation","setCustomLocation","newPathname","parts","pathname","part","last","pop","idOrSlug","suffix","dispatchEvent","CustomEvent","fallback_title","fallback_description","isStartpage","Sidebar","element","process","env","frontend","client","ApolloClient","uri","cache","InMemoryCache","credentials","defaultOptions","watchQuery","fetchPolicy","errorPolicy","Start","navigator","languages","setUserLocales","currentLocale","setCurrentLocale","savedLocale","localStorage","getItem","systemLocales","language","toLowerCase","handleLanguageChange","handleCurrentLocalesChange","change_locale","detail","removeItem","setItem","prefersDarkMode","useMediaQuery","useMemo","createTheme","palette","mode","ApolloProvider","ThemeProvider","minWidth","variantSuccess","snackbarClasses","snackbar","success","variantError","variantWarning","warning","variantInfo","info","domRoot","document","getElementById","onLanguageChange","container","createRoot","render","hexToRGBArray","startsWith","charAt","rgb","i","parseInt","substr","getContrastingColor","luma","colorToHex","rgba","cvs","ctx","getContext","fillStyle","fillRect","getImageData","colorToRGBA","idx","slice","join","imageObj","url","colors","colorRGB","contrastingColor","contrastingColorRGB","defaultColors","newColor","parsedColor","getBlock_Query","gql","getSelf_Query","getTransmatOptions","transmat","mimetypes","mimetype","hasType","JSON","getData","DataBothWays","onTransmit","onReceive","checkEntry","draggable","bothwayRef","unlistenTransmit","addListeners","Transmat","setData","unlistenReceive","isOkay","accept","obs","TransmatObserver","entries","entry","classList","toggle","drag_over","isTarget","drag_active","isActive","observe","disconnect","tabIndex","ViewerTextCard","defaultProps","checked","prefixs","iconProps","CheckBox","CheckBoxOutlineBlank","text_content","ViewerButtonCard","clickable","linkify","colorStyles","href","rel","ViewerDividerLine","styles","toSimpleIsoString","date","toISOString","ViewerLineAndCard","link","setLink","setPath","newLink","newPath","changedPathSuffix","trim","pathSuffixFull","useBlockTrigger","additionalInfos","description","nbf","Date","exp","from","cardLink","onClickProps","root","ViewerImageCard","og_image_url","image_url","src","boxShadow","textAlign","useLoadBlock","handleLoadBlock","preloaded_block","message","removeProperty","prop","stringify","dragable","parentProps","setLoadedBlock","loadingBlockRef","getPressedKeys","pressedKeysRef","onKeyDown","add","onKeyUp","delete","usePressedKeys","loadBlock","json","movingBlock","block_roles","movingBlock_roles","pressedKeys","everything_updated","has","log","handleCheckEntry","this_roles","defaultUser","forceRefetch","mountedRef","user","setUser","setLoggedIn","logged_in","self","getMD","md","mdit","xhtmlOut","typographer","breaks","use","kbd","renderInline","paperProps","popoverProps","paperPropsRest","elevation","matches","setMatches","media","matchMedia","listener","LazySidebarContent","SidebarContext","createContext","SidebarProvider","realOpen","oldOpen","Provider","iOS","test","userAgent","isDesktop","SwipeableDrawer","anchor","disableBackdropTransition","disableDiscovery","boxSizing","border","PaperProps","SidebarContent","Main","main","sidebarWidth"],"mappings":"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","file":"static/js/main.34728a0d.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"drag_over\":\"DataTransmat_drag_over__3XVzh\",\"drag_active\":\"DataTransmat_drag_active__2nwCM\"};","import React, { memo, useState, useEffect } from 'react'\nimport twemoji from 'twemoji'\n\nconst Twemoji = ({ className, style, emoji = '' }) => {\n  const [html, setHtml] = useState({ __html: '' })\n\n  useEffect(() => {\n    if (typeof emoji === 'string' && emoji.length > 0) {\n      const textWithHtml = twemoji.parse(emoji, {\n        folder: 'svg',\n        ext: '.svg',\n        base: '/public/twemoji/assets/',\n      })\n\n      setHtml({ __html: textWithHtml })\n    } else {\n      setHtml({ __html: '' })\n    }\n  }, [emoji, setHtml])\n\n  return <span\n    className={className}\n    style={{\n      fontSize: 0,\n      ...style,\n    }}\n    dangerouslySetInnerHTML={html}\n  />\n}\n\nexport default memo(Twemoji)\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\n\nfunction useMutation() {\n  const apollo_client = useApolloClient()\n\n  const handleMutation = useCallback(option => {\n    return new Promise((resolve,reject) => {\n      apollo_client.mutate(option)\n        .then(({ data }) => {\n          if (typeof data.error === 'string') {\n            reject(data.error)\n          } else {\n            resolve(data)\n          }\n        })\n        .catch(reject)\n    })\n  }, [ apollo_client ])\n\n  return handleMutation\n}\n\nexport default useMutation\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__3mObx\",\"headerBar\":\"Header_headerBar__2YU41\",\"notificationBanner\":\"Header_notificationBanner__104SP\"};","import { useState, useCallback, useEffect } from 'react'\n\nimport classes from './Header.module.css'\n\nimport {\n  Menu as MenuIcon,\n  MoreHoriz as MoreHorizIcon,\n  Home as HomeIcon,\n} from '@mui/icons-material'\n\nimport { Link } from 'react-router-dom'\n\nimport { useSidebarContext } from './Sidebar.js'\nimport ViewerAuto from './view/ViewerAuto.js'\nimport PopoverMenu from './PopoverMenu.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlocks_Query, getParentBlocks_Query } from '../graphql/queries'\n\nexport default function Header({ title, block = {}, rightActions, notificationBanner }) {\n  const { open, toggleSidebar } = useSidebarContext()\n  const apollo_client = useApolloClient()\n\n  const blockId = block ? block._id : null\n  const parentId = block ? block.parent : null\n\n  const [parentBlocks, setParentBlocks] = useState([])\n  const [siblingBlocks, setSiblingBlocks] = useState([])\n\n  const loadParentBlocks = useCallback(blockId => {\n    apollo_client.query({\n      query: getParentBlocks_Query,\n      variables: {\n        _id: blockId,\n      },\n    })\n      .then(async ({ data }) => {\n        if (typeof data.error === 'string' || !data.blocks) {\n          console.error(data.error)\n          setParentBlocks([])\n        }else{\n          const parentBlocksSorted = (data.blocks || [])\n            .sort((a, b) => b.computed.sort - a.computed.sort)\n\n          setParentBlocks(parentBlocksSorted)\n        }\n      })\n      .catch(async error => {\n        console.error('error', error)\n        setParentBlocks([])\n      })\n  }, [apollo_client, setParentBlocks])\n\n  const loadSiblingBlocks = useCallback((parentId, blockId) => {\n    apollo_client.query({\n      query: getBlocks_Query,\n      variables: {\n        roots: [blockId],\n        types: ['page', 'person', 'redirect'],\n        archived: false,\n      },\n    })\n      .then(async ({ data }) => {\n        if (typeof data.error === 'string' || !data.blocks) {\n          console.error(data.error)\n          setSiblingBlocks([])\n        }else{\n          setSiblingBlocks(\n            (data.blocks || [])\n              .filter(block => block._id !== blockId)\n          )\n        }\n      })\n      .catch(async error => {\n        console.error('error', error)\n        setSiblingBlocks([])\n      })\n  }, [apollo_client, setSiblingBlocks])\n\n  useEffect(() => {\n    if (blockId) {\n      loadParentBlocks(blockId)\n      loadSiblingBlocks(parentId, blockId)\n    }\n  }, [blockId, parentId, loadParentBlocks, loadSiblingBlocks])\n\n  const leftActions = <>\n    {\n      !open\n      ? <button onClick={toggleSidebar} className=\"text hasIcon\" style={{ margin: '0' }}>\n          <MenuIcon className=\"icon\" />\n        </button>\n      : null\n    }\n\n    <div style={{ flexGrow: '1' }}>\n      <Link to=\"/\">\n        <button className=\"text\" style={{ margin: 'calc(-2 * var(--basis))' }}>\n          <HomeIcon style={{ verticalAlign: 'middle' }} />\n        </button>\n      </Link>\n      <span style={{ margin: 'var(--basis_x2)', opacity: 'var(--alpha)' }}>/</span>\n\n    {\n      blockId\n      && parentBlocks.length > 0\n        ? <>\n          <PopoverMenu\n            trigger={triggerProps => (\n              <button {...triggerProps} className=\"text\" style={{ margin: 'calc(-2 * var(--basis))' }}>\n                <MoreHorizIcon style={{ verticalAlign: 'middle' }} />\n              </button>\n            )}\n          >\n            <div style={{\n              padding: 'var(--basis_x2)',\n            }}>\n              {\n                parentBlocks\n                .map((block) => {\n                  return <ViewerAuto\n                    key={block._id}\n                    block={block}\n                    size=\"line\"\n                  />\n                })\n              }\n            </div>\n          </PopoverMenu>\n          <span style={{ margin: 'var(--basis_x2)', opacity: 'var(--alpha)' }}>/</span>\n        </>\n        : null\n    }\n\n    {\n      siblingBlocks.length > 0\n        ? <PopoverMenu\n            trigger={triggerProps => (\n              <button {...triggerProps} className=\"text\" style={{ margin: 'calc(-2 * var(--basis))' }}>\n                <span style={{ fontWeight: 'bold' }}>\n                  {title}\n                </span>\n              </button>\n            )}\n          >\n            <div style={{\n              padding: 'var(--basis_x2)',\n            }}>\n              {\n                siblingBlocks\n                .map((block) => {\n                  return <ViewerAuto\n                    key={block._id}\n                    block={block}\n                    size=\"line\"\n                  />\n                })\n              }\n            </div>\n          </PopoverMenu>\n        : <span style={{ fontWeight: 'bold' }}>\n            {title}\n          </span>\n    }\n    </div>\n  </>\n\n  return <header className={classes.header}>\n    <div className={classes.headerBar}>\n      {leftActions}\n      {rightActions}\n    </div>\n    {\n      !!notificationBanner\n        ? <div className={classes.notificationBanner}>{notificationBanner}</div>\n        : null\n    }\n  </header>\n}\n","import React, { useEffect, useState } from 'react'\n\n// https://projectfluent.org/play/\n\n// import { LocalizationProvider, Localized } from '@fluent/react' // '@fluent/react/compat'\nimport { ReactLocalization, LocalizationProvider } from '@fluent/react'\nimport { FluentBundle, FluentResource } from '@fluent/bundle'\nimport { negotiateLanguages } from '@fluent/langneg'\n\n\nexport const locales = {\n  de: 'Deutsch (German)',\n  en: 'English',\n  it: 'Italiano (Italian)',\n  se: 'Davvisámegiella (Northern Sami)',\n\n  fr: 'Français (French)',\n  es: 'Español (Spanish)',\n  nl: 'Dutch (Nederlands)',\n  // pt: 'Português (Portuguese)',\n\n  // pl: 'Polska (Polish)',\n  // ru: 'Pусский (Russian)',\n}\n\nconst _supportedLocales_ = Object.keys(locales)\nconst _defaultLocale_ = 'en'\n\n\nasync function fetchMessages(locale) {\n  const path = await import('../locales/' + locale + '.ftl')\n\n  const response = await fetch(path.default)\n  const messages = await response.text()\n\n  return { [locale]: new FluentResource(messages) }\n}\n\nfunction getDefaultBundles() {\n  const bundle = new FluentBundle('')\n  bundle.addResource(new FluentResource(''))\n  return new ReactLocalization([bundle])\n}\n\nasync function createMessagesGenerator(currentLocales) {\n  const fetched = await Promise.all(\n    currentLocales.map(fetchMessages)\n  )\n  const messages = fetched.reduce(\n    (obj, cur) => Object.assign(obj, cur)\n  )\n\n  return function* generateBundles() {\n    for (const locale of currentLocales) {\n      const bundle = new FluentBundle(locale)\n      bundle.addResource(messages[locale])\n      yield bundle\n    }\n  }\n}\n\nexport function AppLocalizationProvider({ userLocales, children, onLocaleChange }) {\n  const [bundles, setBundles] = useState(getDefaultBundles())\n\n  useEffect(() => {\n    async function loadBundles() {\n      const currentLocales = negotiateLanguages(\n        userLocales,\n        _supportedLocales_,\n        { defaultLocale: _defaultLocale_ }\n      )\n\n      if (!!onLocaleChange) {\n        onLocaleChange(currentLocales)\n      }\n\n      const generateBundles = await createMessagesGenerator(currentLocales)\n\n      const new_bundles = new ReactLocalization(generateBundles())\n      new_bundles.userLocales = userLocales\n      new_bundles.defaultLocale = _defaultLocale_\n      new_bundles.supportedLocales = _supportedLocales_\n      setBundles(new_bundles)\n    }\n    loadBundles()\n  }, [userLocales, onLocaleChange])\n\n  if (!bundles) {\n    // Show a loader.\n    return <div>Loading texts…</div>\n  }\n\n  return <LocalizationProvider l10n={bundles}>\n    {children}\n  </LocalizationProvider>\n}\n\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"App_app__3hbGO\",\"isStartpage\":\"App_isStartpage__1Q6rs\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"Sidebar_main__1MCX5\",\"open\":\"Sidebar_open__gnBQb\"};","import React from 'react'\nimport {\n  Localized as LocalizedOriginal,\n  // withLocalization,\n} from '@fluent/react'\nimport { negotiateLanguages } from '@fluent/langneg'\n\nimport { FluentContext } from '../../node_modules/@fluent/react/esm/context.js'\nimport fluentBy from './fluentBy.js'\n\nconst Localized = props => (\n  <LocalizedOriginal\n    key={props.id}\n    {...props}\n    elems={{\n      br: <br />,\n      ...props.elems,\n    }}\n  >\n    <React.Fragment>{props.children}</React.Fragment>\n  </LocalizedOriginal>\n)\n\n// A custom withLocalization to have an empty fallback.\n// It is nearly identical to the original.\nfunction withLocalization(Inner) {\n  function WithLocalization(props) {\n    const l10n = React.useContext(FluentContext)\n\n    const getString = (id, args, fallback) => l10n.getString(id, args, fallback || '')\n\n    const fluentByObject = (object, fallback) => {\n      if (!(!!fallback)) {\n        fallback = null\n      }\n\n      if (!!object) {\n        const globalSupportedLocales = l10n.supportedLocales || []\n        const thisSupportedLocales = Object.keys(object).filter(locale => globalSupportedLocales.includes(locale))\n\n        const currentLocales = negotiateLanguages(\n          l10n.userLocales,\n          thisSupportedLocales,\n          { defaultLocale: l10n.defaultLocale }\n        )\n\n        for (const locale of currentLocales) {\n          if (!!object[locale]) {\n            return object[locale]\n          }\n        }\n\n        return fallback\n      }\n\n      return fallback\n    }\n\n    return React.createElement(Inner, { fluentByObject, getString, ...props })\n  }\n  return WithLocalization\n}\n\n\nfunction translateBlock (block, userLocales, fallback) {\n\n  const properties = block.properties || {}\n  \n  let locale = properties.locale || 'en'\n  let text = properties.text || fallback || ''\n\n  if (!userLocales || !Array.isArray(userLocales)) {\n    userLocales = [locale]\n  }\n    \n  let translations = properties.translations || []\n  if (Array.isArray(translations)) {\n    translations = [\n      {\n        locale,\n        text,\n      },\n      ...translations,\n    ]\n\n    const correct_translations = fluentBy.fluentByArray(translations, userLocales, 'locale')\n    if (correct_translations.length > 0) {\n      text = correct_translations[0].text\n    }\n  }\n\n  return text\n}\n\nfunction useLocalization() {\n  const l10n = React.useContext(FluentContext)\n\n  const getString = (id, args, fallback) => l10n.getString(id, args, fallback || ' ')\n  const fluentByAny = (any = [], fallback = '') => fluentBy.fluentByAny(any, l10n.userLocales, fallback)\n\n  return {\n    ...l10n,\n    userLocales: l10n.userLocales || [],\n    getString,\n    fluentByAny,\n    translateBlock,\n  }\n}\n\nexport {\n  negotiateLanguages,\n  withLocalization,\n  Localized,\n  Localized as default,\n  useLocalization,\n}\n\n/*\n\nimport { Localized, withLocalization } from '../Localized/'\n\n<Localized id=\"translation_id\" />\nexport default withLocalization(componentName)\n\n\nimport Localized from '../Localized/'\n<Localized id=\"translation_id\" />\n\nimport { withLocalization } from '@fluent/react'\nexport default withLocalization(componentName)\n\n*/\n","const { negotiateLanguages } = require('@fluent/langneg')\n\nfunction fluentByObject(object = {}, userLocales = ['en']){\n  const supportedLocales = Object.keys(object)\n\n  if (supportedLocales.length === 0) {\n    return null\n  }\n\n  const lookupedLocale = negotiateLanguages(\n    userLocales,\n    supportedLocales,\n    {\n      defaultLocale: supportedLocales[0],\n      strategy: 'lookup',\n    }\n  )\n\n  if (lookupedLocale.length === 0) {\n    return null\n  }\n\n  return object[lookupedLocale[0]]\n}\n\nfunction fluentByArray(array = [], userLocales = ['en'], key = 'locale') {\n  const supportedLocales = array.map(item => item[key]).filter(Boolean)\n\n  if (supportedLocales.length === 0) {\n    return null\n  }\n\n  const lookupedLocale = negotiateLanguages(\n    userLocales,\n    supportedLocales,\n    {\n      defaultLocale: supportedLocales[0],\n      strategy: 'lookup',\n    }\n  )\n\n  if (lookupedLocale.length === 0) {\n    return null\n  }\n\n  return array.filter(item => item[key] === lookupedLocale[0])\n}\n\nfunction fluentByAny(any = '', userLocales = ['en'], fallback = '') {\n  if (Array.isArray(any)) {\n    const result = fluentByArray(any, userLocales)\n    if (Array.isArray(result) && result.length > 0) {\n      any = result[0].value\n    }\n  } else if (typeof any === 'object') {\n    any = fluentByObject(any, userLocales)\n  }\n  if (typeof any !== 'string') {\n    any = fallback\n  }\n  return any\n}\n\nmodule.exports = {\n  fluentByObject,\n  fluentByArray,\n  fluentByAny,\n}\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlocks_Query } from '../graphql/queries'\n\nfunction useLoadBlocks() {\n  const apollo_client = useApolloClient()\n\n  const handleLoadBlocks = useCallback(variables => {\n    return new Promise(resolve => {\n      apollo_client.query({\n        query: getBlocks_Query,\n        variables,\n      })\n        .then(async ({ errors, data }) => {\n          if (Array.isArray(errors) && errors.length > 0) {\n            throw errors\n          } else if (Array.isArray(data.blocks)) {\n            resolve(data.blocks)\n          }else{\n            throw new Error('Unknown error while loading blocks.')\n          }\n        })\n        .catch(async error => {\n          console.error('error', error)\n          resolve([])\n        })\n    })\n  }, [apollo_client])\n\n  return handleLoadBlocks\n}\n\nexport default useLoadBlocks\n","import { useRef, useState, useCallback } from 'react'\n\nimport {\n  Divider,\n  Menu,\n  MenuItem,\n  ListItemIcon,\n  ListSubheader,\n} from '@mui/material'\n\nimport {\n  Close as CloseIcon,\n  ArrowRight as ArrowRightIcon,\n} from '@mui/icons-material'\n\nimport { Localized } from '../fluent/Localized.js'\n\n// INFO: Some code is copied from: https://github.com/azmenak/material-ui-nested-menu-item/blob/master/src/index.tsx\n\nexport default function SubMenu ({\n  disabled = false,\n  parentMenuIsOpen = true,\n  label = '',\n  triggerProps = {},\n  header = null,\n  MenuListProps = {},\n  position = 'right',\n  onOpen = () => {},\n  children,\n}) {\n  const triggerRef = useRef(null)\n  const [isSubMenuOpen, setIsSubMenuOpen] = useState(false)\n  const open = isSubMenuOpen && parentMenuIsOpen\n\n  const toggleSubmenu = useCallback(() => {\n    if (disabled !== true) {\n      const newOpen = !open\n      setIsSubMenuOpen(newOpen)\n      if (newOpen === true) {\n        onOpen()\n      }\n    }\n  }, [ setIsSubMenuOpen, open, onOpen, disabled ])\n\n  const closeSubmenu = useCallback(() => {\n    setIsSubMenuOpen(false)\n  }, [ setIsSubMenuOpen ])\n\n  return <>\n    <MenuItem\n      {...triggerProps}\n\n      disabled={disabled}\n\n      ref={triggerRef}\n      onClick={toggleSubmenu}\n      className=\"roundMenuItem\"\n      style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        ...triggerProps.style,\n      }}\n    >\n      <div style={{ display: 'flex' }}>\n        {label}\n      </div>\n      <ArrowRightIcon style={{ marginRight: '-10px' }} />\n    </MenuItem>\n    <Menu\n      // Set pointer events to 'none' to prevent the invisible Popover div from capturing events for clicks and hovers\n      style={{ pointerEvents: 'none' }}\n      anchorEl={triggerRef.current}\n      anchorOrigin={{\n        vertical: 'top',\n        horizontal: (position === 'right' ? 'right' : 'left'),\n      }}\n      transformOrigin={{\n        vertical: 'top',\n        horizontal: (position === 'right' ? 'left' : 'right'),\n      }}\n      open={open}\n      autoFocus={false}\n      disableAutoFocus\n      disableEnforceFocus\n      onClose={closeSubmenu}\n      sx={{\n        marginTop: '-8px', // align with parent menu\n      }}\n      MenuListProps={{\n        ...MenuListProps,\n        sx: {\n          maxWidth: 380,\n          maxHeight: 'calc(100vh - 32px)',\n          overflow: 'auto',\n          background: 'var(--background-contrast)',\n          color: 'var(--on-background)',\n          ...MenuListProps.sx,\n        },\n      }}\n    >\n      <div style={{pointerEvents: 'auto'}}>\n        {\n          header !== null\n            ? <ListSubheader\n                style={{\n                  whiteSpace: 'nowrap',\n                  lineHeight: '1',\n                  margin: '0',\n                  padding: '4px 16px 12px',\n                  backgroundColor: 'var(--background-contrast)',\n                  color: 'var(--on-background)',\n                }}\n              >\n                {header}\n              </ListSubheader>\n            : null\n        }\n\n        {children}\n\n        <Divider style={{opacity: 0.2}} />\n\n        <MenuItem className=\"roundMenuItem\" style={{marginTop:'8px'}} onClick={closeSubmenu}>\n          <ListItemIcon>\n            <CloseIcon />\n          </ListItemIcon>\n          <Localized id=\"block_menu_close_menu\" />\n        </MenuItem>\n      </div>\n    </Menu>\n  </>\n}\n","import { useCallback, useState } from 'react'\n\nimport {\n  Link,\n  useNavigate,\n} from 'react-router-dom'\n\nimport {\n  MenuItem,\n  Divider,\n  ListItemIcon,\n  ListItemText,\n  ListItem,\n} from '@mui/material'\n\nimport {\n  Archive as ArchiveIcon,\n  Unarchive as UnarchiveIcon,\n\n  Visibility as VisibilityIcon,\n  VisibilityOff as VisibilityOffIcon,\n  // Delete as DeleteIcon,\n  // VerticalAlignTop as VerticalAlignTopIcon,\n  // VerticalAlignBottom as VerticalAlignBottomIcon,\n  Add as AddIcon,\n  RepeatSharp as RepeatIcon,\n  // RemoveCircleSharp as RemoveCircleIcon,\n\n  InsertDriveFileSharp as PageIcon,\n  LinkSharp as RedirectIcon,\n  // PersonSharp as PersonIcon,\n  Crop75Sharp as ButtonIcon,\n  NotesSharp as TextIcon,\n  ImageSharp as ImageIcon,\n  // CodeSharp as CodeIcon,\n  Remove as DividerIcon,\n  // CheckBox as CheckboxIcon,\n\n  PreviewSharp as ViewIcon,\n  EditSharp as EditIcon,\n\n  FormatSizeSharp as TextStyleIcon,\n  TextFormatSharp as TextDecorationsIcon,\n  PaletteSharp as ColorIcon,\n  CircleSharp as ColorSwatchIcon,\n\n  CheckSharp as SelectedIcon,\n} from '@mui/icons-material'\n\nimport { Localized, withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport useArchiveBlock from '../../hooks/useArchiveBlock.js'\nimport useUser from '../../hooks/useUser.js'\n\nimport PopoverMenu from '../PopoverMenu.js'\nimport SubMenu from '../SubMenu.js'\nimport { AddMenuContent } from './AddMenu.js'\n\nimport { saveBlock_Mutation, moveBlock_Mutation } from '../../graphql/mutations.js'\nimport useMutation from '../../hooks/useMutation.js'\n\nconst typeIcons = {\n  button: <ButtonIcon />,\n  text: <TextIcon />,\n  image: <ImageIcon />,\n  // checkbox: <CheckboxIcon />,\n  // code: <CodeIcon />,\n  divider: <DividerIcon />,\n  page: <PageIcon />,\n  redirect: <RedirectIcon />,\n}\n\nconst defaultTypeOptions = [\n  'button',\n  'text',\n  'image',\n  // 'checkbox',\n  // 'code',\n  'divider',\n  'page',\n  'redirect',\n]\n\nconst colorOptions = {\n  default: 'var(--on-background)',\n  yellow: 'var(--yellow)',\n  green: 'var(--green)',\n  red: 'var(--red)',\n  blue: 'var(--blue)',\n}\nconst colorOptionsKeys = Object.keys(colorOptions)\nfunction getColor (color) {\n  if (colorOptions.hasOwnProperty(color)) {\n    return colorOptions[color]\n  } else {\n    const {\n      color: renderedColor\n    } = getBlockColor({\n      properties: {\n        color,\n      },\n    })\n\n    if (renderedColor) {\n      return renderedColor\n    }\n  }\n  \n  return color\n}\n\nfunction BlockMenu ({\n  block = {},\n  getString,\n\n  trigger,\n  onToogle,\n\n  saveType,\n  saveProperty,\n  typeOptions = defaultTypeOptions,\n\n  onRemoveRow = null,\n  addRowBefore = null,\n  // addRowAfter = null,\n  onArchivedToggle = null,\n  onReloadContext = null,\n}) {\n  const { loggedIn, userroles } = useUser()\n\n  if (\n    !(\n      block.hasOwnProperty('properties')\n      && typeof block.properties === 'object'\n      && block.properties !== null\n      && !Array.isArray(block.properties)\n    )\n  ) {\n    block.properties = {}\n  }\n\n  const { _id = '', type = '', properties = {}, computed = {} } = block\n  let {\n    active = true,\n    text_style = null,\n    text_decorations = [],\n    color = null,\n  } = properties\n\n  if (!Array.isArray(text_decorations)) {\n    text_decorations = []\n  }\n\n  const {\n    roles = [],\n  } = (computed === null ? {} : computed)\n  const canEdit = loggedIn && (userroles.includes('admin') || roles.includes('owner') || roles.includes('editor'))\n\n  const [archived, setArchived] = useState(properties.archived === true)\n  const archiveBlock = useArchiveBlock()\n\n  // const handleAddRowBefore = useCallback(() => {\n  //\n  //   // const newBlock = {\n  //   //   type,\n  //   // }\n  //\n  //   const newBlockId = ''\n  //\n  //   addRowBefore({\n  //     blockId: newBlockId,\n  //   })\n  // }, [ addRowBefore ])\n\n\n  const mutationFunction = useMutation()\n  const navigate = useNavigate()\n  const createChildBlock = useCallback(async ({ type }) => {\n    try {\n      if (typeof type === 'string' && type.length > 0) {\n        const { saveBlock: newChildBlockId } = await mutationFunction({\n          mutation: saveBlock_Mutation,\n          variables: {\n            block: { type },\n          },\n        })\n\n        if (newChildBlockId !== null) {\n          await mutationFunction({\n            mutation: moveBlock_Mutation,\n            variables: {\n              movingBlockId: newChildBlockId,\n              newParentId: _id,\n              newIndex: 0,\n            },\n          })\n          if (typeof onReloadContext === 'function') {\n            onReloadContext()\n          }\n          navigate(`/${newChildBlockId}/edit`)\n        }\n      }\n    } catch (error) {\n      console.error(error)\n    }\n  }, [mutationFunction, _id, onReloadContext, navigate])\n\n  const toggleArchiveBlock = useCallback(() => {\n    const newArchived = !archived\n    archiveBlock({ _id: block._id, archive: newArchived })\n      .then(() => {\n        setArchived(newArchived)\n        if (typeof onArchivedToggle === 'function') {\n          onArchivedToggle(newArchived)\n        }\n        if (typeof onReloadContext === 'function') {\n          onReloadContext()\n        }\n      })\n      .catch(console.error)\n  }, [archiveBlock, setArchived, archived, block, onArchivedToggle, onReloadContext])\n\n  const toggleActive = useCallback(() => {\n    if (typeof saveProperty === 'function') {\n      saveProperty('active', !active)\n    }\n  }, [active, saveProperty])\n\n  const metadata = block.metadata || {}\n\n  let {\n    color: renderedColor\n  } = getBlockColor(block)\n\n  if (!renderedColor) {\n    renderedColor = 'transparent'\n  }\n\n  const toggleTextDecoration = useCallback(thisDecoration => {\n    let newTextDecorations = [...new Set(text_decorations)]\n\n    if (text_decorations.includes(thisDecoration)) {\n      newTextDecorations = newTextDecorations.filter(decoration => decoration !== thisDecoration)\n    } else {\n      newTextDecorations.push(thisDecoration)\n    }\n\n    saveProperty('text_decorations', newTextDecorations)\n  }, [text_decorations, saveProperty])\n\n  return <PopoverMenu\n    trigger={trigger}\n    onToogle={onToogle}\n  >\n    {({ open }) => (<div>\n\n      <div style={{ height: '8px' }}></div>\n\n      {\n        (\n          canEdit\n          && typeof saveType === 'function'\n          && Array.isArray(typeOptions)\n          && typeOptions.length > 0\n        )\n        && <>\n          <SubMenu\n            disabled={type === 'person'}\n            parentMenuIsOpen={open}\n            label={<>\n              <ListItemIcon>\n                <RepeatIcon />\n              </ListItemIcon>\n              <Localized id=\"block_menu_choose_type_label\" />\n            </>}\n            header={<Localized id=\"block_menu_choose_type_label\" />}\n          >\n            {\n              typeOptions\n              .map(typeName => (\n                <MenuItem\n                  key={typeName}\n                  selected={typeName === type}\n                  onClick={() => saveType(typeName)}\n                  className=\"roundMenuItem\"\n                >\n                  <ListItemIcon>\n                    {typeIcons[typeName]}\n                  </ListItemIcon>\n                  {getString(`block_menu_type_label_${typeName}`, typeName)}\n                </MenuItem>\n              ))\n            }\n          </SubMenu>\n          <Divider style={{ opacity: 0.2, marginTop: '8px', marginBottom: '8px' }} />\n        </>\n      }\n\n      {\n        (\n          canEdit\n          && typeof saveProperty === 'function'\n        )\n        && <SubMenu\n          parentMenuIsOpen={open}\n          label={<>\n            <ListItemIcon>\n              <ColorIcon\n                style={{\n                  color: getColor(color),\n                }}\n              />\n            </ListItemIcon>\n            <Localized id=\"block_menu_choose_color_label\" />\n          </>}\n          header={<Localized id=\"block_menu_choose_color_label\" />}\n        >\n          {\n            colorOptionsKeys\n            .map(thisColor => (\n              <MenuItem\n                key={thisColor}\n                selected={thisColor === 'default' ? color === null : color === thisColor}\n                onClick={() => saveProperty('color', thisColor === 'default' ? null : thisColor)}\n                className=\"roundMenuItem\"\n              >\n                <ListItemIcon>\n                  <ColorSwatchIcon\n                    style={{\n                      color: getColor(thisColor),\n                    }}\n                  />\n                </ListItemIcon>\n                {thisColor}\n              </MenuItem>\n            ))\n          }\n\n          <MenuItem\n            className=\"roundMenuItem\"\n            selected={color !== null && !colorOptionsKeys.includes(color)}\n          >\n            <ListItemIcon>\n              <ColorSwatchIcon\n                style={{\n                  color: renderedColor,\n                }}\n              />\n            </ListItemIcon>\n            <input\n              key={colorOptionsKeys.includes(color) ? color : 'custom'}\n              type=\"text\"\n              placeholder=\"#FFFFFF\"\n              defaultValue={color}\n              onBlur={e => saveProperty('color', e.target.value)}\n              style={{\n                width: '160px',\n                margin: '0 calc(-1 * var(--basis)) 0 0',\n              }}\n            />\n          </MenuItem>\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof saveProperty === 'function'\n          && type === 'text'\n        )\n        && <SubMenu\n          parentMenuIsOpen={open}\n          label={<>\n            <ListItemIcon>\n              <TextStyleIcon />\n            </ListItemIcon>\n            <Localized id=\"block_menu_choose_text_style_label\" />\n          </>}\n          header={<Localized id=\"block_menu_choose_text_style_label\" />}\n        >\n          {\n            [\n              // 'h1', // title\n              'h2', // heading\n              'h3', // subheading\n              'body', // body text. This is saved as null.\n              // 'caption',\n            ]\n            .map(thisStyle => (\n              <MenuItem\n                key={thisStyle}\n                selected={thisStyle === 'body' ? text_style === null : text_style === thisStyle}\n                onClick={() => saveProperty('text_style', thisStyle === 'body' ? null : thisStyle)}\n                className=\"roundMenuItem\"\n              >\n                {getString(`block_menu_text_style_label_${thisStyle}`, thisStyle)}\n              </MenuItem>\n            ))\n          }\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof saveProperty === 'function'\n          && type === 'text'\n        )\n        && <SubMenu\n          parentMenuIsOpen={open}\n          label={<>\n            <ListItemIcon>\n              <TextDecorationsIcon />\n            </ListItemIcon>\n            <Localized id=\"block_menu_choose_text_decorations_label\" />\n          </>}\n          header={<Localized id=\"block_menu_choose_text_decorations_label\" />}\n        >\n          {\n            [\n              'checkbox',\n            ]\n              .map(thisDecoration => {\n                const selected = text_decorations.includes(thisDecoration)\n                return <MenuItem\n                  key={thisDecoration}\n                  selected={selected}\n                  onClick={() => toggleTextDecoration(thisDecoration)}\n                  className=\"roundMenuItem\"\n                >\n                  <ListItemIcon>\n                    {\n                      selected\n                        ? <SelectedIcon />\n                        : <SelectedIcon style={{ opacity: 0 }} />\n                    }\n                  </ListItemIcon>\n                  {getString(`block_menu_text_decoration_label_${thisDecoration}`, thisDecoration)}\n                </MenuItem>\n              })\n          }\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof saveProperty === 'function'\n        )\n        && <Divider style={{opacity: 0.2, marginTop:'8px', marginBottom:'8px'}} />\n      }\n\n      {/*\n        addRowBefore\n        && <MenuItem onClick={handleAddRowBefore}>\n          <ListItemIcon>\n            <VerticalAlignTopIcon />\n          </ListItemIcon>\n          <Localized id=\"block_menu_add_before\" />\n        </MenuItem>\n      */}\n\n      {/*\n        addRowAfter\n        && <MenuItem onClick={addRowAfter}>\n          <ListItemIcon>\n            <VerticalAlignBottomIcon />\n          </ListItemIcon>\n          <Localized id=\"block_menu_add_after\" />\n        </MenuItem>\n      */}\n\n      {\n        false\n        && canEdit\n        && <SubMenu\n          parentMenuIsOpen={open}\n          label={<>\n            <ListItemIcon>\n              <AddIcon />\n            </ListItemIcon>\n            <Localized id=\"block_menu_create_child_block\" />\n          </>}\n        >\n          <AddMenuContent createBlock={createChildBlock} />\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof saveProperty === 'function'\n        )\n        && <MenuItem className=\"roundMenuItem\" onClick={toggleActive}>\n          <ListItemIcon>\n            {\n              active\n              ? <VisibilityOffIcon />\n              : <VisibilityIcon />\n            }\n          </ListItemIcon>\n\n          <ListItemText\n            primary={<span>{\n              active\n              ? <Localized id=\"block_menu_hide\" />\n              : <Localized id=\"block_menu_show\" />\n            }</span>}\n            secondary={<span style={{ whiteSpace: 'normal' }}><Localized id=\"block_menu_hide_show_description\" /></span>}\n          />\n          \n        </MenuItem>\n      }\n\n      {\n        (\n          canEdit\n          && typeof onArchivedToggle === 'function'\n        )\n        && <MenuItem className=\"roundMenuItem\" onClick={toggleArchiveBlock}>\n          <ListItemIcon>\n            {\n              archived === true\n              ? <UnarchiveIcon />\n              : <ArchiveIcon />\n            }\n          </ListItemIcon>\n          {\n            archived === true\n            ? <Localized id=\"block_menu_unarchive\" />\n            : <Localized id=\"block_menu_archive\" />\n          }\n        </MenuItem>\n      }\n            \n      {\n        (typeof saveProperty === 'function' || typeof onArchivedToggle === 'function')\n        && <Divider style={{ opacity: 0.2, marginTop: '8px', marginBottom: '8px' }} />\n      }\n\n      {\n        (typeof _id === 'string' && _id !== '')\n        && <>\n          <MenuItem component={Link} to={`/${_id}/view`} className=\"roundMenuItem\" style={{ marginTop: '8px' }}>\n            <ListItemIcon>\n              <EditIcon />\n            </ListItemIcon>\n            <Localized id=\"view_block\" />\n          </MenuItem>\n\n          {\n            canEdit\n            && <MenuItem component={Link} to={`/${_id}/edit`} className=\"roundMenuItem\">\n              <ListItemIcon>\n                <ViewIcon />\n              </ListItemIcon>\n              <Localized id=\"edit_block\" />\n            </MenuItem>\n          }\n\n          <Divider style={{opacity: 0.2, marginTop:'8px', marginBottom:'8px' }} />\n        </>\n      }\n\n      {/*\n      <ListItem sx={{ paddingTop: '0', paddingBottom: '0' }}>\n        <ListItemText\n          primary={<Localized id=\"block_menu_info_created\" />}\n          secondary={(metadata.created || '').replace(/[TZ]/g, ' ')}\n        />\n      </ListItem>\n      */}\n      <ListItem sx={{ paddingTop: '0', paddingBottom: '0' }}>\n        <ListItemText\n          primary={<span><Localized id=\"block_menu_info_modified\" /></span>}\n          secondary={<span>{(metadata.modified || '').replace(/[TZ]/g, ' ')}</span>}\n        />\n      </ListItem>\n      <ListItem sx={{ paddingTop: '0', paddingBottom: '0' }}>\n        <ListItemText\n          primary={<span><Localized id=\"block_menu_info_id\" /></span>}\n          secondary={<span>{_id}</span>}\n        />\n      </ListItem>\n\n    </div>)}\n  </PopoverMenu>\n}\n\nexport default withLocalization(BlockMenu)\n","import { useState, useRef, useEffect, useCallback } from 'react'\n\nimport {\n  Fade,\n  Popper,\n} from '@mui/material'\n\nconst randomString = () => (Math.random() + 1).toString(36).substring(7)\n\nfunction Popover ({\n  trigger,\n  children = () => {},\n  onToogle = () => {},\n  setOpenBlockMenuRef,\n}) {\n  const anchorRef = useRef(null)\n  const [open, setOpen] = useState(false)\n\n  const setOpenExternal = useCallback((newOpen) => {\n    setOpen(newOpen)\n  }, [ setOpen ])\n\n  useEffect(() => {\n    if (!!setOpenBlockMenuRef) {\n      setOpenBlockMenuRef.current = setOpenExternal\n    }\n  }, [ setOpenExternal, setOpenBlockMenuRef ])\n\n  const handlePopoverToggleClick = () => {\n    setOpen((prevOpen) => {\n      onToogle(!prevOpen)\n      return !prevOpen\n    })\n  }\n\n  const closePopover = () => {\n    onToogle(false)\n    setOpen(false)\n  }\n\n  const id = open ? 'popover-'+randomString() : undefined\n\n  return <>\n\n    {trigger(\n      {\n        ref: anchorRef,\n        'aria-describedby': id,\n        onClick: handlePopoverToggleClick,\n        style: {\n          pointerEvents: open ? 'none' : 'all',\n        },\n      }, {\n        isOpen: open,\n      }\n    )}\n\n    <div\n      onClick={closePopover}\n      style={{\n        display: (open ? 'block' : 'none'),\n        position: 'fixed',\n        top: 0,\n        right: 0,\n        bottom: 0,\n        left: 0,\n        zIndex: 1299,\n        cursor: 'pointer',\n      }}\n    />\n\n    <Popper\n      id={id}\n      open={open}\n      anchorEl={anchorRef.current}\n      transition\n      placement=\"bottom-start\"\n      disablePortal={false}\n      modifiers={[\n        {\n          name: 'flip',\n          enabled: true,\n          options: {\n            altBoundary: true,\n            rootBoundary: 'viewport',\n            padding: 8,\n          },\n        },\n      ]}\n      style={{\n        zIndex: 1300,\n      }}\n    >\n      {({ TransitionProps }) => (\n        <Fade {...TransitionProps}>\n          <div>\n          {\n            !!children && typeof children === 'function'\n            ? children({\n              open,\n              style: {\n                transformOrigin: 'top left',\n              },\n              closePopover,\n            })\n            : null\n          }\n          </div>\n        </Fade>\n      )}\n    </Popper>\n\n  </>\n}\n\nexport default Popover\n","import { useState, useCallback, useEffect } from 'react'\n\nfunction MultiButton({ ariaLabel, items, defaultValue, onChange, style = {}, buttonProps = {}, className = '' }) {\n  const [choosen, setChoosen] = useState()\n\n  useEffect(() => setChoosen(defaultValue), [defaultValue, setChoosen])\n\n  const handleClick = useCallback(event => {\n    const newValue = event.target.dataset.value\n    setChoosen(newValue)\n    if (onChange) {\n      onChange(newValue)\n    }\n  }, [setChoosen, onChange])\n\n  return <div\n    aria-label={ariaLabel}\n    className={'buttonRow ' + (className || '')}\n    style={style}\n  >\n    {\n      items.map(item => {\n        const value = item.value\n        const title = item.title\n        const icon = item.icon || null\n        return <button\n          {...buttonProps}\n          key={value}\n          className={`default ${choosen === value ? 'choosen' : ''} ${!!icon ? 'hasIcon' : ''} ${buttonProps?.className || ''}`}\n          onClick={handleClick}\n          data-value={value}\n        >\n          <span style={{pointerEvents: 'none'}}>\n            {!!icon ? icon : null}\n            {\n              !!title\n                ? (\n                  typeof title === 'object' // check if it's a component\n                    ? title\n                    : <span style={{verticalAlign: 'middle'}}>{title}</span>\n                )\n                : null\n            }\n          </span>\n        </button>\n      })\n    }\n  </div>\n}\n\nexport default MultiButton\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { archiveBlock_Mutation, unarchiveBlock_Mutation } from '../graphql/mutations.js'\n\nfunction useArchiveBlock() {\n  const apollo_client = useApolloClient()\n\n  const handleArchiveBlock = useCallback(({ _id, archive }) => {\n    return apollo_client.mutate({\n      mutation: archive ? archiveBlock_Mutation : unarchiveBlock_Mutation,\n      variables: { _id }\n    })\n  }, [ apollo_client ])\n\n  return handleArchiveBlock\n}\n\nexport default useArchiveBlock\n","\nimport {\n  InsertDriveFile as PageIcon,\n  Face as PersonIcon,\n  LinkSharp as RedirectIcon,\n  PublicSharp as WebsiteIcon,\n} from '@mui/icons-material'\n\nimport Twemoji from '../Twemoji.js'\n\nimport { getImageUrl } from '../../functions.js'\n\nimport classes from './BlockIcon.module.css'\n\nexport default function BlockIcon({ block, style = {}, className = '', ...props }) {\n  const properties = block.properties || {}\n\n  let iconComponent = null\n\n  if (\n    // TODO: is the check overkill ? 😅\n    properties.hasOwnProperty('icon')\n    && typeof properties.icon === 'object'\n    && properties.icon !== null\n    && !Array.isArray(properties.icon)\n    && properties.icon.hasOwnProperty('type')\n    && typeof properties.icon.type === 'string'\n    && properties.icon.type === 'emoji'\n    && properties.icon.hasOwnProperty('emoji')\n    && typeof properties.icon.emoji === 'string'\n    && properties.icon.emoji.length !== 0\n  ) {\n    iconComponent = <Twemoji\n      {...props}\n      style={style}\n      key={properties.icon.emoji}\n      className={`${classes.icon} ${className}`}\n      emoji={properties.icon.emoji}\n    />\n  }\n\n  if (iconComponent === null) {\n    let isSquareIcon = false\n    let icon_url = getImageUrl(properties.icon)\n\n    if (!icon_url) {\n      // coverphoto fallback\n      isSquareIcon = true\n      icon_url = getImageUrl(properties.coverphoto)\n    }\n\n    if (typeof icon_url === 'string' && icon_url.length !== 0) {\n      iconComponent = <div\n        {...props}\n        className={`${classes.icon} ${isSquareIcon ? classes.square : classes.round} ${className}`}\n        style={{ ...style, backgroundImage: `url(${window.domains.backend}download_url?f=${window.imageFormat || 'jpg'}&w=40&h=40&url=${encodeURIComponent(icon_url)})` }}\n        alt=\"\"\n      />\n    }\n  }\n\n  if (iconComponent === null) {\n    switch (block.type) {\n      case 'person':\n        iconComponent = <PersonIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'redirect':\n        iconComponent = <RedirectIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'website':\n        iconComponent = <WebsiteIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      default:\n        iconComponent = <PageIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n    }\n  }\n\n  return iconComponent\n}\n","import { useCallback } from 'react'\n\nimport { useLocalization } from '../fluent/Localized.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlocksWithContent_Query, checkSlug_Query } from '../graphql/queries'\n\nimport { useSnackbar } from 'notistack'\n\nfunction useLoadPage() {\n  const { getString } = useLocalization()\n\n  const apollo_client = useApolloClient()\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\n\n  const loadBlocks = useCallback(slugOrId => {\n    return new Promise(final_resolve => {\n      if (!slugOrId || slugOrId === '') {\n        final_resolve(null)\n      } else {\n        let preloaded_blocks = []\n        if (\n          typeof window.SERVER_DATA === 'object'\n          && window.SERVER_DATA !== null\n          && !Array.isArray(window.SERVER_DATA)\n        ) {\n          preloaded_blocks = window.SERVER_DATA.preloaded_blocks || []\n        }\n\n        if (!Array.isArray(preloaded_blocks)) {\n          preloaded_blocks = []\n        }\n\n        preloaded_blocks = preloaded_blocks\n          .filter(block => block?._id !== null && (block?._id === slugOrId || block?.properties?.slug === slugOrId))\n\n        if (preloaded_blocks.length > 0) {\n          window.SERVER_DATA = { preloaded_blocks: null }\n          final_resolve(preloaded_blocks)\n        } else {\n          apollo_client.query({\n            query: getBlocksWithContent_Query,\n            variables: {\n              slugs: [slugOrId],\n              ids: [slugOrId].filter(id => id.length === 24), // A very basic check. A mongoid is 24 chars long).But it can still\n            },\n          })\n            .then(({ errors, data }) => {\n              if (Array.isArray(errors)) {\n                final_resolve(null)\n              } else if (Array.isArray(data.blocks) && data.blocks.length > 0) {\n                const loadedBlocks = data.blocks\n                  .filter(block => block?._id !== null)\n\n                  if (loadedBlocks.length > 0) {\n                    final_resolve(loadedBlocks)\n                  } else {\n                    final_resolve(null)\n                  }\n              } else {\n                final_resolve(null)\n              }\n            })\n            .catch(error => {\n              console.error('error', error)\n              final_resolve(null)\n            })\n        }\n      }\n    })\n  }, [apollo_client])\n\n  const loadSlugInfos = useCallback(slug => {\n    return new Promise(final_resolve => {\n      if (!slug || slug === '') {\n        final_resolve(null)\n      } else {\n        apollo_client.query({\n          query: checkSlug_Query,\n          variables: {\n            slug,\n          },\n        })\n          .then(({ errors, data }) => {\n            if (Array.isArray(errors)) {\n              final_resolve(null)\n            } else if (data.block !== null) {\n              final_resolve(data.block)\n            } else {\n              final_resolve(null)\n            }\n          })\n          .catch(error => {\n            console.error('error', error)\n            final_resolve(null)\n          })\n      }\n    })\n  }, [apollo_client])\n\n  const handleLoadPage = useCallback(slugOrId => {\n    return new Promise((final_resolve, final_reject) => {\n      let snackbarKey = null\n\n      if (!slugOrId || slugOrId === '') {\n        final_reject({ code: '404' })\n      } else {\n        const loadingDataPromise = new Promise(async resolve => {\n          let done = false\n\n          if (done === false && typeof slugOrId === 'string' && slugOrId !== '') {\n            const blocks = await loadBlocks(slugOrId)\n            if (Array.isArray(blocks)) {\n              if (blocks.length === 1) {\n                // This gets called for \"/:slug\"\n                // slugOrId is a slug\n                // redirect it accoringly\n                done = true\n                resolve('got-data')\n\n                if (snackbarKey !== null) {\n                  closeSnackbar(snackbarKey)\n                }\n\n                final_resolve(blocks[0])\n              } else if (blocks.length > 1) {\n                done = true\n                resolve('got-error')\n\n                if (snackbarKey !== null) {\n                  closeSnackbar(snackbarKey)\n                }\n\n                final_reject({\n                  code: '300',\n                  blocks,\n                })\n\n                enqueueSnackbar('Error 300: Multiple blocks found..', { // todo: remove me\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 2000,\n                })\n              }\n            }\n          }\n\n          if (\n            done === false\n            && typeof slugOrId === 'string' && slugOrId !== ''\n          ) {\n            const {\n              existsAsSlug = false,\n              existsAsId = false,\n            } = await loadSlugInfos(slugOrId) || {}\n\n            done = true\n            resolve('got-error')\n\n            if (snackbarKey !== null) {\n              closeSnackbar(snackbarKey)\n            }\n\n            if (existsAsId === true || existsAsSlug === true) {\n              // show error page: now permission to view this block\n              final_reject({ code: '403' })\n\n              enqueueSnackbar('Error 403: You are not allowed to view this page.', { // todo: remove me\n                variant: 'error',\n                preventDuplicate: true,\n                autoHideDuration: 2000,\n              })\n            } else {\n              // show error page: the block does not exist\n              final_reject({ code: '404' })\n\n              enqueueSnackbar('Error 404: The page does not exist.', { // todo: remove me\n                variant: 'error',\n                preventDuplicate: true,\n                autoHideDuration: 2000,\n              })\n            }\n          }\n        })\n\n        // Show a loading-info-snackbar if loading the data takes too long.\n        Promise.race([\n          new Promise(resolve => {\n            setTimeout(() => {\n              resolve('show-loading')\n            }, 300)\n          }),\n          loadingDataPromise,\n        ])\n          .then(response => {\n            if (response === 'show-loading') {\n              snackbarKey = enqueueSnackbar(getString('path_editor_status_started_loading'), {\n                persist: true,\n                preventDuplicate: true,\n              })\n            }\n          })\n          .catch(error => console.error)\n      }\n    })\n  }, [\n    loadBlocks,\n    loadSlugInfos,\n    enqueueSnackbar,\n    closeSnackbar,\n    getString,\n  ])\n\n  return handleLoadPage\n}\n\nexport default useLoadPage\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ViewerAuto_root__1p6KG\"};","\nimport {\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n} from '@mui/material'\n\nimport {\n  InsertDriveFileSharp as PageIcon,\n  LinkSharp as RedirectIcon,\n  PersonSharp as PersonIcon,\n  Crop75Sharp as ButtonIcon,\n  NotesSharp as TextIcon,\n  Remove as DividerIcon,\n  CodeSharp as CodeIcon,\n  CheckBoxSharp as CheckboxIcon,\n  // EditSharp as EditIcon,\n  ImageSharp as ImageIcon,\n} from '@mui/icons-material'\n\nimport useUser from '../../hooks/useUser.js'\nimport PopoverMenu from '../PopoverMenu.js'\nimport { Localized } from '../../fluent/Localized.js'\n\nconst blockTypeIcons = {\n  button: <ButtonIcon />,\n  text: <TextIcon />,\n  code: <CodeIcon />,\n  divider: <DividerIcon />,\n  checkbox: <CheckboxIcon />,\n  page: <PageIcon />,\n  person: <PersonIcon />,\n  redirect: <RedirectIcon />,\n  image: <ImageIcon />,\n}\n\nconst default_types = [\n  'page',\n  'redirect',\n]\n\nfunction AddMenuContent({ createBlock, types, close = null }) {\n  if (!types || !Array.isArray(types)) {\n    types = default_types\n  }\n\n  return <>\n    {\n      types\n        .map(type => (\n          <MenuItem className=\"roundMenuItem\" key={type} onClick={() => createBlock({ type, close })}>\n            <ListItemIcon>\n              {blockTypeIcons[type]}\n            </ListItemIcon>\n            <ListItemText>\n              <Localized id={'block_menu_type_label_'+type} />\n            </ListItemText>\n          </MenuItem>\n        ))\n    }\n  </>\n}\n\nfunction AddMenu ({ trigger, createBlock, types }) {\n  const { loggedIn } = useUser()\n\n  if (loggedIn) {\n    return <PopoverMenu trigger={trigger}>\n      {\n        ({ close }) => <>\n          <div style={{ marginTop: '8px' }}></div>\n          <AddMenuContent createBlock={createBlock} types={types} close={close} />\n        </>\n      }\n    </PopoverMenu>\n  }\n\n  return null\n}\n\nexport {\n  AddMenuContent,\n  AddMenu as default,\n}\n","var map = {\n\t\"./de.ftl\": [\n\t\t352,\n\t\t9\n\t],\n\t\"./en.ftl\": [\n\t\t353,\n\t\t10\n\t],\n\t\"./es.ftl\": [\n\t\t354,\n\t\t11\n\t],\n\t\"./fr.ftl\": [\n\t\t355,\n\t\t12\n\t],\n\t\"./it.ftl\": [\n\t\t356,\n\t\t13\n\t],\n\t\"./nl.ftl\": [\n\t\t357,\n\t\t14\n\t],\n\t\"./se.ftl\": [\n\t\t358,\n\t\t15\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 319;\nmodule.exports = webpackAsyncContext;","import { useState, useCallback, useEffect, useRef } from 'react'\n\nimport { useHotkeys } from 'react-hotkeys-hook'\n\nimport {\n  Modal\n} from '@material-ui/core'\n\nimport {\n  // Search as SearchIcon,\n\n  InsertDriveFileSharp as PageIcon,\n  // AutoAwesomeSharp as ActionIcon,\n  LinkSharp as RedirectIcon,\n  PersonSharp as PersonIcon,\n  // Crop75Sharp as ButtonIcon,\n  // TitleSharp as HeadlineIcon,\n  // NotesSharp as TextIcon,\n  // Remove as DividerIcon,\n\n  PublicSharp as WebsiteIcon,\n\n  CloseSharp as CloseIcon,\n\n  MoreHorizSharp as BlockMenuIcon,\n\n  ArchiveSharp as ArchiveIcon,\n} from '@mui/icons-material'\n\nimport classes from './SearchBox.module.css'\nimport BlockMenu from './edit/BlockMenu.js'\nimport ViewerAuto from './view/ViewerAuto.js'\nimport MultiButton from './MultiButton.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { search_Query } from '../graphql/queries.js'\nimport { saveBlock_Mutation } from '../graphql/mutations.js'\n\nimport { Localized } from '../fluent/Localized.js'\n\nconst blockTypeIcons = {\n  page: <PageIcon />,\n  person: <PersonIcon />,\n  redirect: <RedirectIcon />,\n  website: <WebsiteIcon />,\n}\n\nconst possibleTypes = [\n  'everything',\n  'page',\n  'redirect',\n  'person',\n  'website',\n]\n\nfunction SearchBox() {\n  const apollo_client = useApolloClient()\n\n  const [open, setOpen] = useState(false)\n  const [results, setResults] = useState([])\n  const [errors, setErrors] = useState([])\n\n  const queryTextRef = useRef('')\n  const [type, setType] = useState(possibleTypes[0])\n  const [showArchived, setShowArchived] = useState(false)\n\n  useHotkeys('cmd+k, ctrl+k', event => {\n    event.preventDefault()\n    setOpen(true)\n  }, {\n    // enableOnTags: ['INPUT', 'SELECT', 'TEXTAREA'],\n    // enableOnContentEditable: true,\n  })\n\n  useHotkeys('esc', event => {\n    event.preventDefault()\n    setOpen(false)\n  }, {\n    enableOnTags: ['INPUT', 'SELECT', 'TEXTAREA'],\n    enableOnContentEditable: true,\n  })\n\n  useEffect(() => {\n\n    // TODO: load last searchs from cache / or load them from server\n\n    // only save a search when clicked on the item (needs function/hook to the click event)\n  }, [])\n\n  useEffect(() => {\n    const open_search = () => setOpen(true)\n    const close_search = () => setOpen(false)\n\n    window.addEventListener('open_search', open_search)\n    window.addEventListener('close_search', close_search)\n    return () => {\n      window.removeEventListener('open_search', open_search)\n      window.removeEventListener('close_search', close_search)\n    }\n  }, [setOpen])\n\n  const perform_search = useCallback(async (query_text, type, showArchived) => {\n    if (query_text.length === 0) {\n      setResults([])\n      setErrors([])\n    } else if (query_text.length < 2) {\n      setResults([])\n      setErrors(['Type more than one characters.'])\n    } else {\n      const variables = {\n        query: query_text,\n        archived: showArchived,\n      }\n      if (\n        typeof type === 'string'\n        && type.length > 0\n        && possibleTypes.includes(type)\n        && type !== 'everything'\n      ) {\n        variables.types = [type]\n      } else {\n        variables.types = possibleTypes.filter(t => t !== 'everything')\n      }\n\n      try {\n        const { errors, data } = await apollo_client.query({\n          query: search_Query,\n          variables,\n        })\n\n        if (Array.isArray(errors) && errors.length > 0) {\n          throw errors\n        } else if (Array.isArray(data.blocks)) {\n          const blocks = data.blocks\n            .filter(block => typeof block === 'object' && block !== null && !Array.isArray(block))\n\n          setResults(blocks)\n          if (blocks.length === 0) {\n            setErrors(['No results found.'])\n          } else {\n            setErrors([])\n          }\n        } else {\n          setErrors(['Unknown error while loading blocks.'])\n        }\n      } catch (error) {\n        console.error('error', error)\n        setResults([])\n      }\n    }\n  }, [apollo_client, setResults, setErrors])\n\n  const search = useCallback(async event => {\n    let query_text = event.target.value || ''\n    if (typeof query_text !== 'string') {\n      query_text = ''\n    }\n    queryTextRef.current = query_text\n\n    perform_search(query_text, type, showArchived)\n  }, [perform_search, type, showArchived])\n\n  useEffect(() => {\n    perform_search(queryTextRef.current, type, showArchived)\n  }, [perform_search, type, showArchived])\n\n  const handleClose = useCallback(() => {\n    setOpen(false)\n  }, [setOpen])\n\n  const handleResultClick = useCallback(async (block, index) => {\n    setOpen(false)\n\n    const newBlock = {\n      type: 'search',\n      properties: {\n        text: queryTextRef.current,\n        // filter: {\n        //   type,\n        //   showArchived,\n        // },\n        chosenResult: {\n          index,\n          blockId: block._id,\n        }\n      }\n    }\n\n    try {\n      await apollo_client.mutate({\n        mutation: saveBlock_Mutation,\n        variables: {\n          block: newBlock,\n        },\n      })\n    } catch (error) {\n      console.error('error', error)\n    }\n  }, [setOpen, apollo_client]) // showArchived, type\n\n  return <Modal\n    open={open}\n    onClose={handleClose}\n    hideBackdrop={true}\n    BackdropProps={{\n      sx: {\n        color: '#fff',\n        zIndex: (theme) => theme.zIndex.drawer + 1,\n      }\n    }}\n  >\n    <>\n      <div className={classes.backdrop} onClick={handleClose}></div>\n\n      <div className={classes.dialog}>\n        <div\n          style={{\n            position: 'sticky',\n            top: 0,\n            zIndex: 2,\n            background: 'var(--background)',\n          }}\n        >\n          <div style={{\n            display: 'flex',\n            alignItems: 'center'\n          }}>\n            <input\n              autoFocus\n              onFocus={e => e.currentTarget.select()} // select the text\n\n              type=\"search\"\n              placeholder=\"Search…\"\n              className={classes.searchInput}\n              defaultValue={queryTextRef.current}\n              onChange={search}\n              style={{\n                // borderBottom: (results.length > 0 || errors.length > 0)\n                //   ? 'var(--basis) solid rgba(var(--on-background-rgb), var(--alpha))'\n                //   : '',\n                // boxShadow: (results.length > 0 || errors.length > 0)\n                //   ? '0 var(--basis) rgba(var(--on-background-rgb), var(--alpha))'\n                //   : '',\n              }}\n            />\n            <button\n              className=\"hasIcon\"\n              onClick={handleClose}\n              style={{\n                margin: '0 var(--basis_x2) 0 calc(-4 * var(--basis))'\n              }}\n            >\n              <CloseIcon className=\"icon\" />\n            </button>\n          </div>\n\n          <MultiButton\n            defaultValue={type}\n            items={\n              possibleTypes.map(thisType => ({\n                value: thisType,\n                // title: thisType,\n                title: <Localized id={'block_menu_type_label_plural_' + thisType} />,\n                icon: <span className=\"icon\">\n                  {blockTypeIcons[thisType]}\n                </span>\n              }))\n            }\n            onChange={setType}\n            className={classes.filters}\n            style={{\n              display: 'flex',\n              gap: 'var(--basis_x2)',\n            }}\n            // buttonStyle={{\n            //   flexGrow: 1,\n            //   justifyContent: 'center',\n            // }}\n          />\n\n          {/* <div className={classes.filters}>\n            {possibleTypes.map(thisType =>\n              <button\n                key={thisType}\n                onClick={() => setType(thisType)}\n                className={type === thisType ? 'default hasIcon' : ' hasIcon'}\n              >\n                <span className=\"icon\">\n                  {blockTypeIcons[thisType]}\n                </span>\n                <Localized id={'block_menu_type_label_plural_' + thisType} />\n              </button>\n            )}\n          </div> */}\n        </div>\n\n        <div\n          className={classes.searchResults}\n          style={{\n            display: (\n              (typeof queryTextRef.current === 'string' && queryTextRef.current.length > 1)\n              || (Array.isArray(errors) && errors.length > 0)\n              || (Array.isArray(results) && results.length > 0)\n              ? 'block'\n              : 'none'\n            )\n          }}\n        >\n\n          {\n            typeof queryTextRef.current === 'string' && queryTextRef.current.length > 1\n              ? <button\n                onClick={() => setShowArchived(!showArchived)}\n                className={showArchived === true ? 'default hasIcon' : ' hasIcon'}\n                style={{ margin: '0' }}\n              >\n                <span className=\"icon\">\n                  <ArchiveIcon />\n                </span>\n                {\n                  showArchived === true\n                    ? <Localized id=\"filter_menu_showing_archiv\" />\n                    : <Localized id=\"filter_menu_show_archiv\" />\n                }\n              </button>\n            : null\n          }\n\n          {\n            (typeof queryTextRef.current === 'string' && queryTextRef.current.length > 1)\n            && (\n              (Array.isArray(errors) && errors.length > 0)\n              || (Array.isArray(results) && results.length > 0)\n            )\n              ? <hr />\n              : null\n          }\n\n          {\n            Array.isArray(errors) && errors.length > 0\n              ? <div className={classes.searchErrors}>\n                {errors.map(error => <p key={error}>{error}</p>)}\n              </div>\n              : null\n          }\n\n          {\n            Array.isArray(results) && results.length > 0\n              ? <div>\n                {\n                  results\n                    .map((block, index) => <div\n                      key={block._id}\n                      className={classes.blockRow}\n                      style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        flexDirection: 'row',\n                      }}\n                    >\n                      <ViewerAuto\n                        size=\"card\"\n                        block={block}\n                        onClick={() => handleResultClick(block, index)}\n                      />\n\n                      <div className={classes.blockRowActions}>\n                        <BlockMenu\n                          block={block}\n                          trigger={props => (\n                            <button\n                              {...props}\n                              className=\"text hasIcon\"\n                              style={{\n                                margin: '0',\n                                padding: 'var(--basis) 0',\n                                flexShrink: '0',\n                              }}\n                            >\n                              <BlockMenuIcon className=\"icon\" />\n                            </button>\n                          )}\n                        />\n                      </div>\n                    </div>)\n                }\n              </div>\n              : null\n          }\n        </div>\n      </div>\n    </>\n  </Modal>\n}\n\nexport default SearchBox\n","import React, { lazy, Suspense, useRef, useState, useEffect, useCallback } from 'react'\n\nimport {\n  useParams,\n  Link,\n} from 'react-router-dom'\n\nimport { Helmet } from 'react-helmet'\nimport Twemoji from '../components/Twemoji.js'\n\nimport { getImageUrl } from '../functions.js'\n\nimport { Localized, useLocalization } from '../fluent/Localized.js'\nimport useLoadPage from '../hooks/useLoadPage.js'\nimport useLoadBlocks from '../hooks/useLoadBlocks.js'\nimport useUser from '../hooks/useUser.js'\n\nimport Header from '../components/Header.js'\nimport ViewerAuto from '../components/view/ViewerAuto.js'\n\nimport classes from './Viewer.module.css'\n\nimport {\n  EditSharp as EditIcon,\n} from '@mui/icons-material'\n\nimport { renderInlineMarkdown } from '../markdown.js'\n\nconst ErrorPage = lazy(() => import('../components/ErrorPage.js'))\nconst LocaleSelect = lazy(() => import('../components/edit/LocaleSelect.js'))\n\nfunction Viewer () {\n  const loadingTheBlock = useRef(false)\n  const { getString, translateBlock, userLocales } = useLocalization()\n\n  const { loggedIn } = useUser()\n\n  const loadPage = useLoadPage()\n  const loadBlocks = useLoadBlocks()\n\n  let { id: slugOrId = '' } = useParams()\n\n  let slugOrId_to_use = slugOrId\n\n  if (slugOrId.includes('=')) {\n    const [, id] = slugOrId.split('=')\n    slugOrId_to_use = id\n  }\n\n  const [block, setBlock] = useState({\n    type: 'page',\n    properties: {},\n    content: [],\n  })\n  const properties = block.properties || {}\n  const [contentBlocks, setContentBlocks] = useState([])\n\n  const [possibleLocales, setPossibleLocales] = useState([])\n  const [locales, setLocales] = useState(properties.locale || userLocales || ['en'])\n  const handleLocaleChange = useCallback((newLocale) => {\n    setLocales([newLocale])\n  }, [ setLocales ])\n\n  const [error, setError] = useState(null)\n\n  const setAndTrackError = useCallback(error => {\n    setError(error)\n\n    if (\n      !!window.umami\n      && typeof error === 'object'\n      && error !== null\n      && error.hasOwnProperty('code')\n      && typeof error.code === 'string'\n    ) {\n      window.umami.trackEvent('E: ' + error.code)\n    }\n  }, [setError])\n\n  useEffect(() => {\n    const properties = block.properties || {}\n\n    if (\n      loadingTheBlock.current === false\n      && typeof slugOrId_to_use === 'string'\n      && slugOrId_to_use !== ''\n      && slugOrId_to_use !== block._id\n      && slugOrId_to_use !== properties.slug\n      && (\n        error === null\n        || error.for_slugOrId !== slugOrId_to_use\n      )\n    ) {\n      loadingTheBlock.current = true\n      loadPage(slugOrId_to_use)\n        .then(async loadedBlock => { \n          if (typeof loadedBlock !== 'object' || loadedBlock === null) {\n            setAndTrackError({\n              code: '404',\n              for_slugOrId: slugOrId_to_use,\n            })\n            loadingTheBlock.current = false\n          } else {\n            let newLoadedBlock = loadedBlock\n\n            if (\n              Array.isArray(loadedBlock.content)\n              && loadedBlock.content.length > 0\n            ) {\n              let newContentConfigs = [...loadedBlock.content]\n\n              const ids2load = loadedBlock.content\n                .filter(contentConfig => !contentConfig.hasOwnProperty('block'))\n                .map(contentConfig => contentConfig.blockId)\n\n              let loadedContentBlocks = []\n              if (ids2load.length > 0) {\n                loadedContentBlocks = await loadBlocks({ ids: ids2load })\n              }\n\n              newContentConfigs = newContentConfigs\n                .map(contentConfig => {\n                  if (!contentConfig.hasOwnProperty('block')) {\n                    contentConfig.block = loadedContentBlocks.find(block => block._id === contentConfig.blockId)\n                  }\n                  return contentConfig\n                })\n\n              newLoadedBlock = {\n                ...newLoadedBlock,\n                content: newContentConfigs,\n              }\n            }\n\n            const blocks = (newLoadedBlock.content || [])\n              .map(contentConfig => contentConfig.block)\n\n            const newPossibleLocales = [...new Set(\n              [\n                loadedBlock,\n                ...blocks,\n              ]\n                .filter(Boolean)\n                .flatMap(thisBlock => {\n                  const properties = thisBlock?.properties || {}\n\n                  return [\n                    properties.locale || null,\n                    ...(properties.translations || [])\n                      .filter(t => t.text && t.text.length > 0)\n                      .map(t => t.locale),\n                  ]\n                })\n                .filter(Boolean)\n            )]\n            setPossibleLocales(newPossibleLocales)\n\n            setAndTrackError(null)\n            setBlock(newLoadedBlock)\n            setContentBlocks(blocks)\n            loadingTheBlock.current = false\n          }\n        })\n        .catch(error => {\n          console.error(error)\n          setAndTrackError({\n            ...error,\n            for_slugOrId: slugOrId_to_use,\n          })\n          loadingTheBlock.current = false\n        })\n    }\n  }, [\n    error,\n    slugOrId_to_use,\n    block,\n    block._id,\n    loadPage,\n    setBlock,\n    loadBlocks,\n    setContentBlocks,\n    setPossibleLocales,\n    setAndTrackError,\n  ])\n\n  if (error !== null && error.for_slugOrId === slugOrId_to_use) {\n    return <div className={classes.viewer}>\n      <Header\n        block={null}\n        title=\"Error\"\n        rightActions={null}\n      />\n      <div className={`basis_x1 ${classes.app} ${classes.spine_aligned}`} dir=\"auto\">\n        <main className={`${classes.contentWrapper}`}>\n          {\n            error.code === '300'\n              ? <>\n                <h1>\n                  <Localized id=\"error_300_title\" />\n                </h1>\n                <br />\n                <p>\n                  <Localized id=\"error_300_description\" />\n                </p>\n                <br />\n                {\n                  error.blocks.map(block => <ViewerAuto\n                    key={block._id}\n                    block={block}\n                    forceId={true}\n                    pathSuffix=\"view\"\n                  />)\n                }\n              </>\n              : null\n          }\n          {\n            error.code === '403'\n              ? <Suspense>\n                  <ErrorPage errorName=\"no_access\" />\n              </Suspense>\n              : null\n          }\n          {\n            error.code === '404'\n              ? <Suspense>\n                <ErrorPage errorName=\"not_found\" />\n              </Suspense>\n              : null\n          }\n        </main>\n      </div>\n    </div>\n  } else {\n  const type = block.type || null\n\n  const title = translateBlock(block, locales, getString('placeholder_headline_empty'))\n  const coverphoto_url = getImageUrl(properties.coverphoto)\n\n  // const pronouns = properties.pronouns || ''\n  \n  const rightHeaderActions = <>\n    <div className=\"buttonRow\" style={{ whiteSpace: 'nowrap' }}>\n      {\n        (loggedIn && !!block._id)\n        && <Link to={`/${block._id}/edit`} style={{ marginRight: 'var(--basis_x2)' }}>\n            <button className=\"text hasIcon\">\n              <EditIcon className=\"icon\" />\n              <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"edit_block\" /></span>\n            </button>\n          </Link>\n      }\n\n      {\n        possibleLocales.length > 1\n          ? <Suspense>\n              <LocaleSelect\n                onChange={handleLocaleChange}\n                defaultValue={locales[0] || userLocales[0] || 'en'}\n                options={possibleLocales}\n              />\n            </Suspense>\n          : null\n      }\n    </div>\n  </>\n\n  const titleWithRenderedMarkdown = {\n    __html: renderInlineMarkdown(title)\n  }\n\n  let metadata_image_url = ''\n  if (typeof coverphoto_url === 'string' && coverphoto_url.length > 0) {\n    metadata_image_url = `${window.domains.backend}download_url?f=jpg&w=1000&h=1000&url=${encodeURIComponent(coverphoto_url)}`\n  }\n\n\n  let iconComponent = null\n\n  if (\n    // TODO: is the check overkill ? 😅\n    properties.hasOwnProperty('icon')\n    && typeof properties.icon === 'object'\n    && properties.icon !== null\n    && !Array.isArray(properties.icon)\n    && properties.icon.hasOwnProperty('type')\n    && typeof properties.icon.type === 'string'\n    && properties.icon.type === 'emoji'\n    && properties.icon.hasOwnProperty('emoji')\n    && typeof properties.icon.emoji === 'string'\n    && properties.icon.emoji.length !== 0\n  ) {\n    iconComponent = <Twemoji className={`${classes.icon} ${coverphoto_url === '' ? '' : classes.coverphotoIsSet}`} emoji={properties.icon.emoji} />\n  }\n\n  if (iconComponent === null) {\n    let icon_url = getImageUrl(properties.icon)\n    if (typeof icon_url === 'string' && icon_url.length !== 0) {\n      iconComponent = <div\n        style={{\n          backgroundImage: `url(${window.domains.backend}download_url?f=${window.imageFormat || 'jpg'}&w=400&h=400&url=${encodeURIComponent(icon_url)})`\n        }}\n        className={`${classes.icon} ${coverphoto_url === '' ? '' : classes.coverphotoIsSet}`}\n      ></div>\n    }\n  }\n\n  return <div className={classes.viewer}>\n    <Helmet>\n      <title>{title}</title>\n      <meta name=\"title\" content={title} />\n      <meta name=\"og:title\" content={title} />\n      <meta name=\"twitter:title\" content={title} />\n\n      <meta name=\"description\" content=\"\" />\n      <meta property=\"og:description\" content=\"\" />\n      <meta name=\"twitter:description\" content=\"\" />\n\n      <meta property=\"og:image\" content={metadata_image_url} />\n      <meta name=\"twitter:image\" content={metadata_image_url} />\n\n      <meta property=\"twitter:card\" content=\"summary\" />\n    </Helmet>\n\n    <Header\n      block={block}\n      title={\n        <span\n          dir=\"auto\"\n          dangerouslySetInnerHTML={titleWithRenderedMarkdown}\n        />\n      }\n      rightActions={rightHeaderActions}\n    />\n\n    <div className={`basis_0_8 ${classes.app} ${classes.spine_aligned}`} dir=\"auto\">\n      {\n      (type === 'page' || type === 'person' || type === 'redirect')\n      && coverphoto_url !== ''\n          ? <div style={{ backgroundImage: `url(${window.domains.backend}download_url?f=${window.imageFormat || 'jpg'}&w=1400&h=400&url=${encodeURIComponent(coverphoto_url)})` }} className={classes.coverphoto}></div>\n          : null\n      }\n      <main className={`${classes.contentWrapper}`}>\n        {\n          (type === 'page' || type === 'person' || type === 'redirect')\n            ? iconComponent\n            : null\n        }\n        {\n          title !== ''\n          ? <h1\n              dir=\"auto\"\n              dangerouslySetInnerHTML={titleWithRenderedMarkdown}\n              style={{\n                whiteSpace: 'pre-wrap',\n              }}\n            />\n          : null\n        }\n        { /* type === 'person' && pronouns !== '' ? <p dir=\"auto\"><strong style={{\n          padding: 'var(--basis)',\n          margin: 'var(--basis_x0_5) calc(-1 * var(--basis))',\n          display: 'inline-block',\n          backgroundColor: 'rgba(var(--on-background-rgb), var(--alpha-less))',\n        }}>{pronouns}</strong></p> : null */ }\n        <div className={classes.items}>\n          {\n            contentBlocks\n            .filter(block => !!block)\n            .filter(block => block.properties.active !== false)\n            .map(contentBlock => <ViewerAuto key={contentBlock._id} block={contentBlock} locales={locales} />)\n          }\n        </div>\n      </main>\n    </div>\n  </div>\n  }\n}\n\nexport default Viewer\n","import React, { Suspense, lazy, useState, useEffect } from 'react'\n\nimport classes from './App.module.css'\n\nimport {\n  Routes,\n  Route,\n  useLocation,\n  useMatch,\n  // useNavigate,\n} from 'react-router-dom'\n\nimport { SidebarProvider, Sidebar, SidebarContent, Main } from '../components/Sidebar.js'\nimport { Helmet } from 'react-helmet'\n\nimport SearchBox from '../components/SearchBox.js'\n\nimport Viewer from './Viewer.js'\nconst Editor = lazy(() => import('./Editor.js'))\n\n// function useScrollMemory() {\n//   // const navigate = useNavigate()\n//   const location = useLocation()\n//\n//   const pathRef = useRef(null)\n//\n//   useEffect(() => {\n//     console.log('location', location)\n//     pathRef.current = location.pathname\n//   }, [location])\n//\n//   useEffect(() => {\n//     // Listen for location changes and set the scroll position accordingly.\n//     const setFromHistoryState = state => {\n//       console.log('popstate-state', state)\n//       let scrollY = 0\n//       if (state && state.scrollY) {\n//         scrollY = state.scrollY\n//       }\n//       console.log('A-popstate-scrollY', scrollY)\n//       if (scrollY < 100) {\n//         scrollY = 0\n//       }\n//\n//       console.log('B-popstate-scrollY', scrollY)\n//       window.scrollTo(0, scrollY)\n//       setTimeout(()=>{\n//         window.scrollTo(0, scrollY)\n//       }, 500)\n//     }\n//\n//     setFromHistoryState(window.history.state)\n//     const popstateListener = event => {\n//       if (event.type === 'popstate') {\n//         setFromHistoryState(event.state)\n//       }\n//     }\n//     window.addEventListener('popstate', popstateListener)\n//\n//     const scrollListener = () => {\n//       const newScrollY = window.scrollY\n//       console.log(' ')\n//       console.log('scrollListener-window.history.state', window.history.state)\n//       console.log('scrollListener-newScrollY', newScrollY)\n//       console.log('pathRef.current', pathRef.current)\n//\n//       if (typeof pathRef.current === 'string') {\n//         window.history.replaceState(\n//           {\n//             ...(window.history.state || {}),\n//             scrollY: newScrollY,\n//           },\n//           '',\n//           pathRef.current\n//         )\n//         console.log('window.history.state', window.history.state)\n//\n//         // navigate(pathRef.current, {\n//         //   replace: true,\n//         //   state: {\n//         //     // ...(window.history.state || {}),\n//         //     scrollY: newScrollY,\n//         //   },\n//         // })\n//       }\n//     }\n//     window.addEventListener('scroll', scrollListener)\n//\n//     // Unregister listener when component unmounts.\n//     return () => {\n//       console.log('Unregister')\n//       window.removeEventListener('popstate', popstateListener)\n//       window.removeEventListener('scroll', scrollListener)\n//     }\n//   }, [])\n// }\n\nfunction App() {\n  // useScrollMemory()\n\n  const matchesStartpage = useMatch('/')\n  const location = useLocation()\n\n  const [customLocation, setCustomLocation] = useState({})\n\n  useEffect(() => {\n    //    /slug=id/suffix\n    //    /slugOrId/suffix\n\n    let newPathname = ''\n\n    const parts = location.pathname.split('/')\n      .filter(part => part.length > 0)\n\n    if (parts.length > 0) {\n      const last = parts.pop()\n\n      let idOrSlug = last\n      let suffix = 'view'\n\n      if ((last === 'edit' || last === 'view') && parts.length > 0) {\n        suffix = last\n        idOrSlug = parts.pop()      \n      }\n\n      newPathname = `/${idOrSlug}/${suffix}`\n\n      if (idOrSlug === 'search') {\n        window.dispatchEvent(new CustomEvent('open_search'))\n      }\n    }\n\n    if (customLocation.pathname !== newPathname) {\n      // TODO: save scroll position\n\n      setCustomLocation({\n        pathname: newPathname,\n      })\n    }\n  }, [ location, customLocation, setCustomLocation ])\n\n  const fallback_title = 'VoltLink'\n  const fallback_description = 'VoltLink is an information-hub about Volt Europa.'\n\n  return (<>\n    <div className={`${classes.app} ${matchesStartpage ? classes.isStartpage : ''}`}>\n      <SidebarProvider>\n        {\n          matchesStartpage\n          ? null\n          : <Sidebar />\n        }\n        <Main>\n          <SearchBox />\n          \n          <Routes location={customLocation}>\n            <Route path=\"/:id/view\" element={<Viewer />} />\n            <Route path=\"/:id/edit\" element={\n              <Suspense>\n                <Editor />\n              </Suspense>\n            } />\n            <Route path=\"/\" element={<>\n              <Helmet>\n                <title>{fallback_title}</title>\n                <meta name=\"title\" content={fallback_title} />\n                <meta name=\"og:title\" content={fallback_title} />\n                <meta name=\"twitter:title\" content={fallback_title} />\n\n                <meta name=\"description\" content={fallback_description} />\n                <meta name=\"og:description\" content={fallback_description} />\n                <meta name=\"twitter:description\" content={fallback_description} />\n              </Helmet>\n\n              <SidebarContent />\n            </>} />\n          </Routes>\n        </Main>\n      </SidebarProvider>\n    </div>\n  </>)\n}\n\nexport default App\n","import React, { useState, useEffect, useCallback } from 'react'\nimport { createRoot } from 'react-dom/client'\n\nimport './index.css'\n\nimport snackbarClasses from './Snackbar.module.css'\n\nimport App from './pages/App.js'\n// import reportWebVitals from './reportWebVitals'\nimport { BrowserRouter as Router } from 'react-router-dom'\n\nimport 'intl-pluralrules'\nimport { AppLocalizationProvider, locales } from './fluent/l10n.js'\n// import { TranslatedInputProvider } from './components/edit/TranslatedInput.js'\n\nimport useMediaQuery from '@mui/material/useMediaQuery'\nimport { createTheme, ThemeProvider } from '@mui/material/styles'\n\nimport { SnackbarProvider } from 'notistack'\n\nimport {\n  ApolloClient,\n  InMemoryCache,\n  ApolloProvider,\n} from '@apollo/client'\n\nwindow.process = {} // BUGFIX for CRA4 error-page after hot-reloading.\n\nwindow.env = 'prod' // dev / prod\nwindow.domains = {\n  frontend: 'https://volt.link/',\n  backend: 'https://api.volt.link/',\n  // frontend: 'http://localhost:4003/',\n  // backend: 'http://localhost:4004/',\n}\n\nconst client = new ApolloClient({\n  uri: window.domains.backend+'graphql/v1/',\n  cache: new InMemoryCache(),\n  credentials: 'include',\n  defaultOptions: {\n    watchQuery: {\n      // fetchPolicy: 'cache-and-network',\n      fetchPolicy: 'no-cache',\n      errorPolicy: 'ignore',\n    },\n    query: {\n      fetchPolicy: 'no-cache',\n      errorPolicy: 'all',\n    },\n  },\n})\n\n// client\n//   .query({\n//     query: gql`\n//       query GetRates {\n//         rates(currency: \"USD\") {\n//           currency\n//         }\n//       }\n//     `\n//   })\n//   .then(result => console.info(result));\n\nfunction Start() {\n  const [userLocales, setUserLocales] = useState(navigator.languages)\n  const [currentLocale, setCurrentLocale] = useState(null)\n\n  useEffect(() => {\n    // get saved locale from localStorage\n    const savedLocale = window.localStorage.getItem('locale') || null\n    if (typeof savedLocale === 'string' && savedLocale !== '') {\n      setUserLocales([savedLocale])\n    } else {\n      setUserLocales(navigator.languages)\n    }\n  }, [setUserLocales])\n\n  useEffect(() => {\n    if (!!window.umami) {\n      let systemLocales = navigator.languages\n      if (!!systemLocales || Array.isArray(systemLocales)) {\n        for (let locale of systemLocales) {\n          locale = locale.toLowerCase() // Not really correct but the system locales sadly don't conform to the standard.\n\n          const language = locale.split('-')[0]\n          if (typeof language === 'string' && language !== '') {\n            window.umami.trackEvent('L: ' + language) // Log just the language.\n          }\n        }\n      }\n    }\n  }, [])\n\n  const handleLanguageChange = useCallback(event => {\n    setUserLocales([event.target.dataset.locale])\n  }, [setUserLocales])\n\n  const handleCurrentLocalesChange = useCallback(currentLocales => {\n    setCurrentLocale(currentLocales.length > 0 ? currentLocales[0] : '')\n  }, [setCurrentLocale])\n\n  useEffect(() => {\n    const change_locale = event => {\n      const detail = event.detail || {}\n      const newLocale = detail.locale || null\n\n      if (newLocale === null) {\n        if (!!userLocales && Array.isArray(userLocales) && userLocales.length > 0) { // check that userLocales is not an empty array\n          setUserLocales(navigator.languages)\n          window.localStorage.removeItem('locale')\n        }\n      } else {\n        setUserLocales([newLocale])\n        window.localStorage.setItem('locale', newLocale)\n      }\n    }\n\n    window.addEventListener('change_locale', change_locale)\n    return () => {\n      window.removeEventListener('change_locale', change_locale)\n    }\n  }, [userLocales, setUserLocales])\n\n\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)')\n\n  const theme = React.useMemo(\n    () =>\n      createTheme({\n        palette: {\n          mode: prefersDarkMode ? 'dark' : 'light',\n        },\n      }),\n    [prefersDarkMode],\n  )\n\n  return <>\n  <div\n    id=\"react-notification\"\n    key=\"react-notification\"\n    style={{zIndex: '10000'}}\n  ></div>\n\n  <AppLocalizationProvider\n    key=\"AppLocalizationProvider\"\n    userLocales={userLocales}\n    onLocaleChange={handleCurrentLocalesChange}\n  >\n    <ApolloProvider client={client}>\n      <ThemeProvider theme={theme}>\n        <SnackbarProvider\n          anchorOrigin={{\n            vertical: 'bottom',\n            horizontal: 'right',\n          }}\n          style={{ minWidth: 'unset' }}\n          classes={{\n            variantSuccess: `${snackbarClasses.snackbar} ${snackbarClasses.success}`,\n            variantError: `${snackbarClasses.snackbar} ${snackbarClasses.error}`,\n            variantWarning: `${snackbarClasses.snackbar} ${snackbarClasses.warning}`,\n            variantInfo: `${snackbarClasses.snackbar} ${snackbarClasses.info}`,\n          }}\n          domRoot={document.getElementById('react-notification')}\n        >\n          {/* <TranslatedInputProvider> */}\n            <Router>\n              <App locales={locales} currentLocale={currentLocale} onLanguageChange={handleLanguageChange} />\n            </Router>\n          {/* </TranslatedInputProvider> */}\n        </SnackbarProvider>\n      </ThemeProvider>\n    </ApolloProvider>\n  </AppLocalizationProvider>\n  </>\n}\n\nconst container = document.getElementById('root')\nconst root = createRoot(container)\nroot.render(<Start />)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.info))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals()\n","function getImageUrl(imageObj) {\n  if (\n    typeof imageObj === 'object'\n    && imageObj !== null\n    && !Array.isArray(imageObj)\n  ) {\n    if (imageObj.type === 'url') {\n      return imageObj.url || ''\n    }\n  }\n\n  return ''\n}\n\n\n\nfunction hexToRGBArray(color) {\n  if (color.startsWith('#')) {\n    color = color.substring(1)\n  }\n\n  if (color.length === 3) {\n    color = color.charAt(0) + color.charAt(0) + color.charAt(1) + color.charAt(1) + color.charAt(2) + color.charAt(2);\n  } else if (color.length !== 6) {\n    throw(new Error('Invalid hex color: ' + color));\n  }\n\n  let rgb = [];\n  for (var i = 0; i <= 2; i++) {\n    rgb[i] = parseInt(color.substr(i * 2, 2), 16);\n  }\n\n  return rgb;\n}\nfunction luma(color) { \n  // color can be a hex string or an array of RGB values 0-255\n  const rgb = (typeof color === 'string') ? hexToRGBArray(color) : color;\n  return (0.2126 * rgb[0]) + (0.7152 * rgb[1]) + (0.0722 * rgb[2]); // SMPTE C, Rec. 709 weightings\n}\nfunction getContrastingColor(color) {\n  // source: https://stackoverflow.com/questions/635022/calculating-contrasting-colours-in-javascript\n  // exact answer: https://stackoverflow.com/a/6511606/2387277\n  // example: https://jsfiddle.net/thomasrosen/9njo6t7s/20/\n  \n  return (luma(color) >= 165) ? '000' : 'fff';\n}\n\n\n\n// function randomHexColor () {\n//   let color = ''\n//   for (let i = 0; i < 6; i++){\n//     const random = Math.random()\n//     const bit = (random * 16) | 0\n//     color += (bit).toString(16)\n//   }\n//   return '#'+color\n// }\n\n\n\nfunction colorToRGBA(color) {\n  // source: https://stackoverflow.com/questions/1573053/javascript-function-to-convert-color-names-to-hex-codes\n  // source: https://stackoverflow.com/a/24390910/2387277\n\n  // Returns the color as an array of [r, g, b, a] -- all range from 0 - 255\n  // color must be a valid canvas fillStyle. This will cover most anything\n  // you'd want to use.\n  // Examples:\n  // colorToRGBA('red')  # [255, 0, 0, 255]\n  // colorToRGBA('#f00') # [255, 0, 0, 255]\n  var cvs, ctx;\n  cvs = document.createElement('canvas');\n  cvs.height = 1;\n  cvs.width = 1;\n  ctx = cvs.getContext('2d');\n  ctx.fillStyle = color;\n  ctx.fillRect(0, 0, 1, 1);\n  return ctx.getImageData(0, 0, 1, 1).data;\n}\nfunction byteToHex(num) {\n    // Turns a number (0-255) into a 2-character hex number (00-ff)\n    return ('0'+num.toString(16)).slice(-2);\n}\nfunction colorToHex(color) {\n    // Convert any CSS color to a hex representation\n    // Examples:\n    // colorToHex('red')            # '#ff0000'\n    // colorToHex('rgb(255, 0, 0)') # '#ff0000'\n    var rgba, hex;\n    rgba = colorToRGBA(color);\n    hex = [0,1,2].map(\n        function(idx) { return byteToHex(rgba[idx]); }\n        ).join('');\n    return \"#\"+hex;\n}\n\n\n\nfunction getBlockColor(block = {}) {\n  const colors = {\n    color: null,\n    colorRGB: null,\n    contrastingColor: null,\n    contrastingColorRGB: null,\n  }\n\n  block.properties = block.properties || {}\n\n  if (block.hasOwnProperty('properties') && block.properties.hasOwnProperty('color') && !!block.properties.color) {\n    const defaultColors = ['purple', 'red', 'green', 'blue', 'yellow']\n    let newColor = block.properties.color\n\n    if (defaultColors.includes(newColor)) {\n      colors.color = `var(--${newColor})`\n      colors.colorRGB = `var(--${newColor}-rgb)`\n      colors.contrastingColor = `var(--on-${newColor})`\n      colors.contrastingColorRGB = `var(--on-${newColor}-rgb)`\n    } else {\n      if (newColor.startsWith('#')) {\n        if (newColor.length !== 4 && newColor.length !== 7) {\n          newColor = null\n        }\n      } else {\n        const parsedColor = colorToHex(newColor)\n        if (parsedColor === '#000000' && newColor !== 'black') {\n          newColor = null\n        } else {\n          newColor = parsedColor\n        }\n      }\n\n      if (newColor) {\n        colors.color = newColor\n        const colorRGB = hexToRGBArray(newColor)\n        colors.colorRGB = colorRGB.join(', ')\n        colors.contrastingColor = '#'+getContrastingColor(newColor)\n        colors.contrastingColorRGB = hexToRGBArray(colors.contrastingColor)\n      }\n    }\n  }\n\n  return colors\n}\n\nmodule.exports = {\n  getImageUrl,\n  getBlockColor,\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"Viewer_app__1_jMF\",\"spine_aligned\":\"Viewer_spine_aligned__2mJuq\",\"items\":\"Viewer_items__2FgjF\",\"coverphoto\":\"Viewer_coverphoto__16R-U\",\"icon\":\"Viewer_icon__219E5\",\"coverphotoIsSet\":\"Viewer_coverphotoIsSet__26PSP\",\"contentWrapper\":\"Viewer_contentWrapper__1HLN8\",\"type_p\":\"Viewer_type_p__O5DZS\",\"viewer\":\"Viewer_viewer__JHrvB\"};","import { gql } from '@apollo/client'\n\nexport const getBlock_Query = gql`\n  query getBlock ($_id: ObjectID!) {\n    block (_id: $_id) {\n\t\t  _id\n\t\t  type\n\t\t  properties\n\t\t  content {\n        blockId\n        block {\n          _id\n          type\n          properties\n          content {\n            blockId\n          }\n          parent\n          metadata {\n            modified\n            modified_by\n          }\n          permissions\n          computed {\n            roles\n            inherited_block_permissions\n          }\n        }\n      }\n\t\t  parent\n\t\t  metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n      }\n    }\n  }\n`\n\nexport const getBlocks_Query = gql`\n  query getBlocks ($ids: [String], $slugs: [String], $types: [String], $archived: Boolean, $roots: [ObjectID], $roles: [String]) {\n    blocks (ids: $ids, slugs: $slugs, types: $types, archived: $archived, roots: $roots, roles: $roles) {\n      _id\n      type\n      properties\n      content {\n        blockId\n      }\n      parent\n      metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n      }\n    }\n  }\n`\n\nexport const getBlocksWithContent_Query = gql`\n  query getBlocks ($ids: [String], $slugs: [String], $types: [String], $archived: Boolean, $roots: [ObjectID] $roles: [String]) {\n    blocks (ids: $ids, slugs: $slugs, types: $types, archived: $archived, roots: $roots, roles: $roles) {\n\t\t  _id\n\t\t  type\n\t\t  properties\n\t\t  content {\n        blockId\n        block {\n          _id\n          type\n          properties\n          content {\n            blockId\n          }\n          parent\n          metadata {\n            modified\n            modified_by\n          }\n          permissions\n          computed {\n            roles\n            inherited_block_permissions\n          }\n        }\n      }\n\t\t  parent\n\t\t  metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n      }\n    }\n  }\n`\n\nexport const getBlockBySlug_Query = gql`\n  query getBlockBySlug ($slug: String!) {\n    block: blockBySlug (slug: $slug) {\n\t\t  _id\n\t\t  type\n\t\t  properties\n\t\t  content {\n        blockId\n        block {\n          _id\n          type\n          properties\n          content {\n            blockId\n          }\n          parent\n          metadata {\n            modified\n            modified_by\n          }\n          permissions\n          computed {\n            roles\n            inherited_block_permissions\n          }\n        }\n      }\n\t\t  parent\n\t\t  metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n      }\n    }\n  }\n`\n\nexport const getSelf_Query = gql`\n  query getSelf {\n    self {\n\t\t  logged_in\n\t\t  user\n\t\t  blockId\n      userroles\n    }\n  }\n`\n\nexport const getSiblingBlocks_Query = gql`\n  query getSiblingBlocks ($_id: ObjectID!, $types: [String]) {\n    blocks: siblingBlocks (_id: $_id, types: $types) {\n      _id\n      type\n      properties\n    }\n  }\n`\n\nexport const getParentBlocks_Query = gql`\n  query getParentBlocks ($_id: ObjectID!) {\n    blocks: parentBlocks (_id: $_id) {\n      _id\n      type\n      properties\n      computed {\n        sort\n      }\n    }\n  }\n`\n\nexport const blockMatchesRoles_Query = gql`\n  query blockMatchesRoles ($_id: ObjectID!, $roles: [String]) {\n    blockMatchesRoles (_id: $_id, roles: $roles)\n  }\n`\n\nexport const checkSlug_Query = gql`\n  query checkSlug ($slug: String!) {\n    checkSlug (slug: $slug) {\n      isOkay\n      errors\n      existsAsSlug\n      existsAsId\n    }\n  }\n`\n\nexport const search_Query = gql`\n  query search ($query: String!, $types: [String], $archived: Boolean) {\n    blocks: search (query: $query, types: $types, archived: $archived) {\n      _id\n      type\n      properties\n      content {\n        blockId\n      }\n      parent\n      metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n      }\n    }\n  }\n`\n","import { gql } from '@apollo/client'\n\nexport const saveBlock_Mutation = gql`\n  mutation saveBlock ($block: InputBlock!) {\n    saveBlock (block: $block) {\n\t\t  _id\n\t\t  type\n\t\t  properties\n\t\t  content {\n        blockId\n        block {\n          _id\n          type\n          properties\n          content {\n            blockId\n          }\n          parent\n          metadata {\n            modified\n            modified_by\n          }\n          permissions\n          computed {\n            roles\n            inherited_block_permissions\n          }\n        }\n      }\n\t\t  parent\n\t\t  metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n      }\n    }\n  }\n`\n\nexport const archiveBlock_Mutation = gql`\n  mutation archiveBlock ($_id: ObjectID!) {\n    archiveBlock (_id: $_id)\n  }\n`\n\nexport const unarchiveBlock_Mutation = gql`\n  mutation unarchiveBlock ($_id: ObjectID!) {\n    unarchiveBlock (_id: $_id)\n  }\n`\n\nexport const moveBlock_Mutation = gql`\n  mutation moveBlock ($movingBlockId: ObjectID!, $newParentId: ObjectID!, $newIndex: Int!) {\n    moveBlock(movingBlockId: $movingBlockId, newParentId: $newParentId, newIndex: $newIndex)\n  }\n`\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"snackbar\":\"Snackbar_snackbar__119_w\",\"default\":\"Snackbar_default__31-eU\",\"success\":\"Snackbar_success__zvTW8\",\"error\":\"Snackbar_error__3XeD6\",\"warning\":\"Snackbar_warning__2CBXt\",\"info\":\"Snackbar_info__EuVSN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"SearchBox_dialog__1znAI\",\"backdrop\":\"SearchBox_backdrop__2e5Wz\",\"inputWrapper\":\"SearchBox_inputWrapper__24CrI\",\"input\":\"SearchBox_input__1qb9w\",\"actions\":\"SearchBox_actions__4Zrwb\",\"searchInput\":\"SearchBox_searchInput__3M4FI\",\"filters\":\"SearchBox_filters__1axwa\",\"searchResults\":\"SearchBox_searchResults__3ySIT\",\"searchErrors\":\"SearchBox_searchErrors__1Q8W1\",\"blockRow\":\"SearchBox_blockRow__13jhD\",\"blockRowActions\":\"SearchBox_blockRowActions__1FRMH\",\"fakeHover\":\"SearchBox_fakeHover__30G2t\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"icon\":\"BlockIcon_icon__1wJFr\",\"square\":\"BlockIcon_square__11KYn\",\"round\":\"BlockIcon_round__1sKzE\"};","import { useRef, useEffect } from 'react'\n\nimport { Transmat, addListeners, TransmatObserver } from 'transmat'\n\nimport classes from './DataTransmat.module.css'\n\nfunction getTransmatOptions(transmat, mimetypes) {\n  let data = {}\n  for (const mimetype of mimetypes) {\n    if (transmat.hasType(mimetype)) {\n      if (mimetype === 'application/json') {\n        data[mimetype] = JSON.parse(transmat.getData(mimetype))\n      } else {\n        data[mimetype] = transmat.getData(mimetype)\n      }\n    }\n  }\n\n  const options = {\n    data,\n    transmat,\n  }\n\n  return options\n}\n\nexport function DataReceiver({ onReceive, style, className, children, checkEntry, mimetypes = ['application/json'] }){\n  const receiverRef = useRef(null)\n\n  useEffect(() => {\n    const unlisten = addListeners(receiverRef.current, 'receive', event => {\n      const transmat = new Transmat(event)\n      const options = getTransmatOptions(transmat, mimetypes)\n      \n      let isOkay = false\n      if (typeof checkEntry === 'function') {\n        isOkay = checkEntry(options)\n      }\n\n      if (isOkay && transmat.accept()) {\n        if (typeof onReceive === 'function') {\n          onReceive(options)\n        }\n        event.preventDefault()\n      }\n    })\n\n    const obs = new TransmatObserver(entries => {\n      for (const entry of entries) {\n        const transmat = new Transmat(entry.event)\n\n        const options = getTransmatOptions(transmat, mimetypes)\n      \n        let isOkay = false\n        if (typeof checkEntry === 'function') {\n          isOkay = checkEntry(options)\n        }\n\n        if (isOkay) {\n          entry.target.classList.toggle(classes.drag_over, entry.isTarget)\n          entry.target.classList.toggle(classes.drag_active, entry.isActive)\n        }\n      }\n    })\n    obs.observe(receiverRef.current)\n\n    return () => {\n      unlisten()\n      obs.disconnect()\n    }\n  }, [ onReceive, checkEntry, mimetypes ])\n\n  return <div ref={receiverRef} style={style} className={className}>\n    {children}\n  </div>\n}\n\nexport function DataTransmiter({ onTransmit, draggable, style, className, children }){\n  const transmiterRef = useRef(null)\n\n  useEffect(() => {\n    return addListeners(transmiterRef.current, 'transmit', async event => {\n      const transmat = new Transmat(event)\n      if (typeof onTransmit === 'function') {\n        const options = await onTransmit(transmat)\n        if (\n          typeof options === 'object'\n          && options !== null\n          && !Array.isArray(options.data)\n          && typeof options.data === 'object'\n          && options.data !== null\n        ) {\n          transmat.setData(options.data)\n          // transmat.setData({\n          //   'text/plain': 'Hello world!',\n          //   'text/html': '<h1>Hello world!</h1>',\n          //   'text/uri-list': 'http://example.com',\n          //   'application/json': {foo:'bar'},\n          // })\n        }\n      }\n    })\n  }, [ onTransmit ])\n\n  return <div ref={transmiterRef} style={style} className={className} draggable={draggable ? 'true' : 'false'} tabIndex=\"0\">\n    {children}\n  </div>\n}\n\nexport function DataBothWays({ onTransmit, onReceive, checkEntry, draggable, style, className, children, mimetypes = ['application/json'] }){\n  const bothwayRef = useRef(null)\n\n  useEffect(() => {\n    const unlistenTransmit = addListeners(bothwayRef.current, 'transmit', async event => {\n      const transmat = new Transmat(event)\n\n      if (typeof onTransmit === 'function') {\n        const options = await onTransmit(transmat)\n        if (\n          typeof options === 'object'\n          && options !== null\n          && !Array.isArray(options.data)\n          && typeof options.data === 'object'\n          && options.data !== null\n        ) {\n          transmat.setData(options.data)\n          // transmat.setData({\n          //   'text/plain': 'Hello world!',\n          //   'text/html': '<h1>Hello world!</h1>',\n          //   'text/uri-list': 'http://example.com',\n          //   'application/json': {foo:'bar'},\n          // })\n        }\n      }\n    })\n\n    const unlistenReceive = addListeners(bothwayRef.current, 'receive', event => {\n      const transmat = new Transmat(event)\n      const options = getTransmatOptions(transmat, mimetypes)\n      \n      let isOkay = false\n      if (typeof checkEntry === 'function') {\n        isOkay = checkEntry(options)\n      }\n\n      if (true && transmat.accept()) { // accept everything so wrong stuff like images does not get displayed in the browser\n        if (isOkay) {\n          if (typeof onReceive === 'function') {\n            onReceive(options)\n          }\n        }\n        event.preventDefault()\n      }\n    })\n\n    const obs = new TransmatObserver(entries => {\n      for (const entry of entries) {\n        const transmat = new Transmat(entry.event)\n        const options = getTransmatOptions(transmat, mimetypes)\n\n        let isOkay = false\n        if (typeof checkEntry === 'function') {\n          isOkay = checkEntry(options)\n        }\n\n        if (isOkay) {\n          entry.target.classList.toggle(classes.drag_over, entry.isTarget)\n          entry.target.classList.toggle(classes.drag_active, entry.isActive)\n        }\n      }\n    })\n    obs.observe(bothwayRef.current)\n\n    return () => {\n      unlistenTransmit()\n      unlistenReceive()\n      obs.disconnect()\n    }\n  }, [ onTransmit, onReceive, checkEntry, mimetypes ])\n\n  return <div\n    ref={bothwayRef}\n    style={style}\n    className={className}\n    draggable={draggable ? 'true' : 'false'}\n    tabIndex=\"0\"\n  >\n    {children}\n  </div>\n}\n\n// Examples:\n//\n// <DataTransmiter\n//   draggable={true}\n//   style={{\n//     width: '100%',\n//     height: '200px',\n//     backgroundColor: 'blue',\n//   }}\n//   onTransmit={() => ({\n//     'text/plain': 'Hello world!',\n//     'text/html': '<h1>Hello world!</h1>',\n//     'text/uri-list': 'http://example.com',\n//     'application/json': {foo:'bar'},\n//   })}\n// >\n//   DataTransmiter\n// </DataTransmiter>\n//\n// <DataReceiver\n//   style={{\n//     width: '100%',\n//     height: '200px',\n//     backgroundColor: 'red',\n//   }}\n//   onReceive={data => console.info('received', data)}\n// >\n//   DataReceiver\n// </DataReceiver>\n","import { useState, useEffect } from 'react'\n\nimport { renderInlineMarkdown } from '../../markdown.js'\nimport { useLocalization } from '../../fluent/Localized.js'\n\nimport { getBlockColor } from '../../functions.js'\n\nimport {\n  CheckBox as CheckBoxIcon,\n  CheckBoxOutlineBlank as CheckBoxOutlineBlankIcon,\n} from '@mui/icons-material'\n\nfunction ViewerTextCard ({ block, style, locales }) {\n  const [html, setHtml] = useState({ __html: '' })\n\n  const { translateBlock } = useLocalization()\n  const text = translateBlock(block, locales, '')\n\n  useEffect(() => {\n    const textWithHtml = renderInlineMarkdown(text)\n    setHtml({ __html: textWithHtml })\n  }, [text, setHtml])\n  \n  const defaultProps = {\n    dir: 'auto',\n    style: {\n      whiteSpace: 'pre-wrap',\n      display: 'flex',\n      ...style,\n    },\n  }\n\n  const {\n    color,\n  } = getBlockColor(block)\n  if (color) {\n    defaultProps.style.color = color\n  }\n\n  let text_style = 'body'\n  if (block.properties.hasOwnProperty('text_style')) {\n    text_style = block.properties.text_style\n  }\n\n\n  const {\n    text_decorations = [],\n    checked,\n  } = (block || {}).properties || {}\n\n  const prefixs = []\n  if (text_decorations.includes('checkbox')) {\n    const iconProps = {\n      key: 'checkbox',\n      style: {\n        margin: 'var(--basis_x0_2) var(--basis) 0 0',\n        height: 'var(--prefix-icon-size)',\n        width: 'var(--prefix-icon-size)',\n      }\n    }\n\n    if (checked) {\n      prefixs.push(<CheckBoxIcon {...iconProps} />)\n    } else {\n      prefixs.push(<CheckBoxOutlineBlankIcon {...iconProps} />)\n    }\n  }\n\n  const text_content = <span dangerouslySetInnerHTML={html}></span>\n\n\n\n  let component = null\n  switch (text_style) {\n    case 'h1':\n      component = <h1\n        {...defaultProps}\n      >\n        {prefixs}\n        {text_content}\n      </h1>\n      break\n    case 'h2':\n      component = <h2\n        {...defaultProps}\n      >\n        {prefixs}\n        {text_content}\n      </h2>\n      break\n    case 'h3':\n      component = <h3\n        {...defaultProps}\n      >\n        {prefixs}\n        {text_content}\n      </h3>\n      break\n    case 'caption':\n      component = <caption\n        {...defaultProps}\n      >\n        {prefixs}\n        {text_content}\n      </caption>\n      break\n    default: // body\n      component = <p\n        {...defaultProps}\n      >\n        {prefixs}\n        {text_content}\n      </p>\n  }\n\n  return <div style={{\n    display: 'flex',\n  }}>\n    {component}\n  </div>\n}\n\nexport default ViewerTextCard\n","import { useState, useEffect } from 'react'\n\nimport { renderInlineMarkdown } from '../../markdown.js'\nimport { useLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nfunction ViewerButtonCard({ block, clickable = true, locales }) {\n  const [html, setHtml] = useState({ __html: '' })\n\n  const { getString, translateBlock } = useLocalization()\n  const text = translateBlock(block, locales, getString('placeholder_headline_empty'))\n\n  useEffect(() => {\n    const textWithHtml = renderInlineMarkdown(text, { linkify: false })\n    setHtml({ __html: textWithHtml })\n  }, [text, setHtml])\n\n  let url = ''\n  if (\n    block\n    && block.properties\n    && block.properties.url\n  ) {\n    url = block.properties.url\n  }\n\n  const {\n    color,\n    contrastingColor,\n  } = getBlockColor(block)\n\n  const colorStyles = {}\n  if (color) {\n    colorStyles['--button-background'] = color\n    colorStyles['--button-color'] = contrastingColor\n  }\n\n  if (clickable === true && url !== '') {\n    return <a\n        href={url}\n        target=\"_blank\" rel=\"noreferrer\"\n      >\n      <button\n        dir=\"auto\"\n        dangerouslySetInnerHTML={html}\n        className=\"default square\"\n        style={{\n          margin: '0',\n          whiteSpace: 'pre-wrap',\n          ...colorStyles,\n        }}\n      ></button>\n    </a>\n  }\n\n  return <button\n    dir=\"auto\"\n    dangerouslySetInnerHTML={html}\n    disabled=\"disabled\"\n    className=\"default square\"\n    style={{\n      margin: '0',\n      whiteSpace: 'pre-wrap',\n      ...colorStyles,\n    }}\n  ></button>\n}\n\nexport default ViewerButtonCard\n","import { getBlockColor } from '../../functions.js'\n\nexport default function ViewerDividerLine ({ block }) {\n  const {\n    color,\n  } = getBlockColor(block)\n\n  const styles = {}\n  if (color) {\n    styles['--on-background'] = color\n  }\n\n  return <hr style={styles} />\n}\n","import { useLocalization } from '../../fluent/Localized.js'\n\nimport { getBlockColor } from '../../functions.js'\nimport useBlockTrigger from '../../hooks/useBlockTrigger.js'\n\nimport { Link } from 'react-router-dom'\n\nimport classes from './ViewerLine.module.css'\nimport BlockIcon from './BlockIcon.js'\n\nfunction toSimpleIsoString(date) {\n  let simpleIsoString = date.toISOString()\n    .replace('T', ' ')\n    .replace(/(:[^:]*?)$/, '')\n\n  return simpleIsoString\n}\n\nfunction ViewerLineAndCard({ block, clickable = true, onClick, locales, forceId, pathSuffix, size = 'line' }) {\n  const { getString, translateBlock, userLocales } = useLocalization()\n\n  const type = block?.type || 'unknown'\n  const properties = block.properties || {}\n  const slug = properties.slug || ''\n  \n  const { link, path } = useBlockTrigger({ block, forceId, pathSuffix })\n\n  let title = translateBlock(block, locales || userLocales, '')\n\n  let additionalInfos = []\n  if (type === 'page' || type === 'redirect' || type === 'person') {\n    if (title === '' && typeof slug === 'string' && slug !== '') {\n      additionalInfos.push(<div key=\"slug\">{'/' + slug}</div>)\n    }\n  } else if (type === 'website') {\n    if (properties.hasOwnProperty('description')) {\n      const description = properties.description\n      additionalInfos.push(<div key=\"description\">{description}</div>)\n    }\n  } else if (type === 'apikey') {\n    if (properties.hasOwnProperty('nbf') && properties.hasOwnProperty('exp')) {\n      // display date range of validity\n      const nbf = new Date(properties.nbf)\n      const exp = new Date(properties.exp)\n      additionalInfos.push(<div key=\"nbf_and_exp\">{getString('apikey_validity', { from: toSimpleIsoString(nbf), to: toSimpleIsoString(exp) })}</div>)\n    } else if (properties.hasOwnProperty('nbf')) {\n      // display start date of validity\n      const nbf = new Date(properties.nbf)\n      additionalInfos.push(<div key=\"nbf\">{getString('apikey_validity_from', { from: toSimpleIsoString(nbf) })}</div>)\n    } else if (properties.hasOwnProperty('exp')) {\n      // display end date of validity\n      const exp = new Date(properties.exp)\n      additionalInfos.push(<div key=\"exp\">{getString('apikey_validity_to', { to: toSimpleIsoString(exp) })}</div>)\n    }\n  }\n\n  if (title === '' && additionalInfos.length === 0) {\n    title = getString('placeholder_headline_empty')\n  }\n\n  if (size === 'line') {\n    if (title !== '') {\n      additionalInfos = []\n    } else if (additionalInfos.length === 0) {\n      additionalInfos = [additionalInfos[0]]\n    }\n  }\n\n  const content = <div style={{ display: 'flex', alignItems: 'flex-start' }}>\n    <BlockIcon block={block} />\n    <div className={classes.content}>\n      <div dir=\"auto\" className={classes.title}>\n        {title}\n      </div>\n      {\n        additionalInfos.length > 0\n          ? <div dir=\"auto\" className={classes.additionalInfos}>\n            {additionalInfos}\n          </div>\n          : null\n      }\n    </div>\n  </div>\n\n\n\n  let cardLink = path || link\n\n  const {\n    color = 'inherit',\n    colorRGB = '--on-background-rgb',\n  } = getBlockColor(block)\n\n  const onClickProps = {}\n  if (typeof onClick === 'function') {\n    onClickProps.onClick = onClick\n  }\n  \n  if (clickable === true && typeof cardLink === 'string' && cardLink.length > 0) {\n    if (cardLink.includes(':')) {\n      return <a\n        href={cardLink}\n        target=\"_blank\" rel=\"noreferrer\"\n        title={title}\n        className={`clickable_card ${classes.root}`}\n        style={{\n          display: 'block',\n          cursor: 'pointer',\n          color,\n          '--on-background-rgb': colorRGB,\n        }}\n        {...onClickProps}\n      >\n        {content}\n      </a>\n    } else {\n      return <Link\n        to={cardLink}\n        title={title}\n        className={`clickable_card ${classes.root}`}\n        style={{\n          display: 'block',\n          cursor: 'pointer',\n          color,\n          '--on-background-rgb': colorRGB,\n        }}\n        {...onClickProps}\n      >\n        {content}\n      </Link>\n    }\n  }\n\n  return <div\n    title={title}\n    className={`clickable_card ${classes.root}`}\n    style={{\n      cursor: 'auto',\n      color,\n      '--on-background-rgb': colorRGB,\n    }}\n    {...onClickProps}\n  >\n    {content}\n  </div>\n}\n\nexport default ViewerLineAndCard\n","import { useState, useEffect } from 'react' // useCallback\n// import { useNavigate } from 'react-router-dom'\n\nexport default function useBlockTrigger({ block = null, forceId = false, pathSuffix = '' }) {\n  const [link, setLink] = useState(null)\n  const [path, setPath] = useState(null)\n  // const [onClick, setOnClick] = useState(null)\n\n  // let navigate = useNavigate()\n\n  useEffect(() => {\n    let newLink = null\n    let newPath = null\n    // let newOnClick = null\n\n    let changedPathSuffix = pathSuffix.trim().toLowerCase()\n    if (changedPathSuffix === 'view') {\n      changedPathSuffix = ''\n    }\n\n    let pathSuffixFull = changedPathSuffix\n    if (pathSuffixFull.length > 0) {\n      pathSuffixFull = `/${pathSuffixFull}`\n    }\n\n\n    if (block !== null) {\n      const blockId = block._id\n      const type = block.type\n      const properties = block.properties || {}\n      const slug = properties.slug || ''\n      const url = properties.url || ''\n\n      if (\n        (type === 'redirect' || type === 'website')\n        && typeof url === 'string'\n        && url.length > 0\n        && changedPathSuffix === '' // empty path suffix means that we are in the view page\n      ) {\n        newLink = url\n        newPath = null // `/${properties.slug}`\n        // newOnClick = () => window.open(newLink, '_blank')\n      } else if (\n        typeof slug === 'string'\n        && slug.length > 0\n      ) {\n        if (forceId === true) {\n          newLink = `${window.domains.frontend}${slug}=${blockId}${pathSuffixFull}`\n          newPath = `/${slug}=${blockId}${pathSuffixFull}`\n        } else {\n          newLink = `${window.domains.frontend}${slug}${pathSuffixFull}`\n          newPath = `/${slug}${pathSuffixFull}`\n        }\n        // newOnClick = () => navigate(newPath)\n      } else {\n        newLink = `${window.domains.frontend}${blockId}${pathSuffixFull}`\n        newPath = `/${blockId}${pathSuffixFull}`\n        // newOnClick = () => navigate(newPath)\n      }\n    }\n\n    setLink(newLink)\n    setPath(newPath)\n    // setOnClick(newOnClick)\n  }, [block, forceId, pathSuffix, setLink, setPath]) // setOnClick, navigate\n\n  return { link, path } // onClick\n}\n","import { useState, useEffect } from 'react'\n\nimport { renderInlineMarkdown } from '../../markdown.js'\nimport { useLocalization } from '../../fluent/Localized.js'\n\nfunction ViewerImageCard({ block, locales }) {\n  const [html, setHtml] = useState({ __html: '' })\n\n  const { translateBlock } = useLocalization()\n  const text = translateBlock(block, locales, '')\n\n  useEffect(() => {\n    const textWithHtml = renderInlineMarkdown(text, { linkify: false })\n    setHtml({ __html: textWithHtml })\n  }, [text, setHtml])\n\n  let og_image_url = ''\n  if (\n    block\n    && block.properties\n    && block.properties.coverphoto\n    && block.properties.coverphoto.type\n  ) {\n    if (\n      block.properties.coverphoto.type === 'url'\n      && block.properties.coverphoto.url\n    ) {\n      og_image_url = block.properties.coverphoto.url\n    }\n  }\n\n  let image_url = ''\n  if (typeof og_image_url === 'string' && og_image_url.length > 0) {\n    image_url = `${window.domains.backend}download_url?f=${window.imageFormat || 'jpg'}&w=1000&h=1000&url=${encodeURIComponent(og_image_url)}`\n  }\n\n  if (image_url !== '') {\n    return <div>\n      <img\n        src={image_url}\n        alt={text}\n        title={text}\n        style={{\n          maxWidth: '100%',\n          margin: '0 auto',\n          display: 'block',\n          boxShadow: 'inset 0 0 0 1px rgba(var(--on-background-rgb), var(--alpha-less))',\n        }}\n      />\n      <div\n        dir=\"auto\"\n        dangerouslySetInnerHTML={html}\n        className=\"type_caption\"\n        style={{\n          textAlign: 'center',\n          marginTop: 'var(--basis_x0_5)',\n        }}\n      />\n    </div>\n  }\n\n  return null\n}\n\nexport default ViewerImageCard\n","import { useCallback } from 'react'\n\nimport { useLocalization } from '../fluent/Localized.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlock_Query } from '../graphql/queries'\n\nimport { useSnackbar } from 'notistack'\n\nfunction useLoadBlock() {\n  const { getString } = useLocalization()\n\n  const apollo_client = useApolloClient()\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\n\n  const handleLoadBlock = useCallback(_id => {\n    return new Promise(final_resolve => {\n    let snackbarKey = null\n\n    if (!_id || _id === '') {\n      final_resolve({\n        type: 'text',\n      })\n    } else {\n      const loadingDataPromise = new Promise(resolve => {\n        let preloaded_block = null\n        if (\n          typeof window.SERVER_DATA === 'object'\n          && window.SERVER_DATA !== null\n          && !Array.isArray(window.SERVER_DATA)\n        ) {\n          preloaded_block = window.SERVER_DATA.preloaded_block || null\n        }\n\n        if (\n          typeof preloaded_block === 'object'\n          && preloaded_block !== null\n          && preloaded_block.hasOwnProperty('_id')\n          && preloaded_block._id === _id\n        ) {\n          window.SERVER_DATA = { preloaded_block: null }\n          resolve('got-preloaded-data')\n          final_resolve(preloaded_block)\n        } else {\n          apollo_client.query({\n            query: getBlock_Query,\n            variables: {\n              _id,\n            },\n          })\n            .then(async ({ errors, data }) => {\n              resolve('got-data')\n\n              if (snackbarKey !== null) {\n                closeSnackbar(snackbarKey)\n              }\n\n              if (Array.isArray(errors)) {\n                enqueueSnackbar(errors.map(e => e.message).join('\\n'), {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 5000,\n                })\n                final_resolve(null)\n              } else if (data.block === null) {\n                enqueueSnackbar(`Could not load the content.`, {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 5000,\n                })\n                final_resolve(null)\n              } else {\n                const loadedBlock = data.block\n                final_resolve(loadedBlock)\n              }\n            })\n            .catch(async error => {\n              console.error('error', error)\n              resolve('got-error')\n\n              if (snackbarKey !== null) {\n                closeSnackbar(snackbarKey)\n              }\n\n              enqueueSnackbar('[could not load data] ' + error.message, {\n                variant: 'error',\n                preventDuplicate: true,\n                autoHideDuration: 2000,\n              })\n            })\n        }\n      })\n\n      // Show a loading-info-snackbar if loading the data takes too long.\n      Promise.race([\n        new Promise(resolve => {\n          setTimeout(() => {\n            resolve('show-loading')\n          }, 300)\n        }),\n        loadingDataPromise,\n      ])\n        .then(response => {\n          if (response === 'show-loading') {\n            snackbarKey = enqueueSnackbar(getString('path_editor_status_started_loading'), {\n              persist: true,\n              preventDuplicate: true,\n            })\n          }\n        })\n        .catch(error => console.error)\n    }\n    })\n  }, [\n    enqueueSnackbar,\n    closeSnackbar,\n    apollo_client,\n    getString,\n  ])\n\n  return handleLoadBlock\n}\n\nexport default useLoadBlock\n","import React, { useState, useEffect, useRef, useCallback } from 'react'\n\nimport { DataBothWays } from '../DataTransmat.js'\n\nimport ViewerTextCard from './ViewerTextCard.js'\nimport ViewerButtonCard from './ViewerButtonCard.js'\nimport ViewerDividerLine from './ViewerDividerLine.js'\nimport ViewerLineAndCard from './ViewerLineAndCard.js'\nimport ViewerImageCard from './ViewerImageCard.js'\n\nimport classes from './ViewerAuto.module.css'\n\nimport { moveBlock_Mutation, saveBlock_Mutation } from '../../graphql/mutations.js'\nimport useMutation from '../../hooks/useMutation.js'\nimport useLoadBlock from '../../hooks/useLoadBlock.js'\nimport useUser from '../../hooks/useUser.js'\n\nfunction usePressedKeys({ keys = [] }) { // keys needs to lowercase\n  const pressedKeysRef = useRef(new Set())\n\n  useEffect(() => {\n    function onKeyDown(event) {\n      const key = event.key.toLowerCase()\n      if (keys.includes(key)) {\n        pressedKeysRef.current.add(key)\n      }\n    }\n    function onKeyUp(event) {\n      const key = event.key.toLowerCase()\n      pressedKeysRef.current.delete(key)\n    }\n\n    window.addEventListener('keydown', onKeyDown)\n    window.addEventListener('keyup', onKeyUp)\n\n    return () => {\n      window.removeEventListener('keydown', onKeyDown)\n      window.removeEventListener('keyup', onKeyUp)\n    }\n  }, [keys])\n\n  const getPressedKeys = () => pressedKeysRef.current // returns a Set !!!\n\n  return { getPressedKeys }\n}\n\nfunction removeProperty(obj, prop) {\n  // remove property from objects, arrays and sub-objects\n\n  obj = JSON.parse(JSON.stringify(obj)) // clone object to make everything mutable\n\n  if (obj.hasOwnProperty(prop)) {\n    delete obj[prop]\n  }\n  for (const i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (typeof obj[i] == 'object' && obj[i] !== null) {\n        removeProperty(obj[i], prop)\n      }\n    }\n  }\n\n  return obj\n}\n\nfunction ViewerAuto ({\n  blockId = null,\n  block = {},\n  clickable = true,\n  size = 'line',\n  dragable = false,\n  parentProps = {},\n  ...props\n}) {\n  let component = null\n\n  const [loadedBlock, setLoadedBlock] = useState(block || {})\n  const loadingBlockRef = useRef(false)\n\n  const { userroles } = useUser()\n  const { getPressedKeys } = usePressedKeys({ keys: ['shift'] }) // returns a Set !!!\n\n  const loadBlock = useLoadBlock()\n\n  useEffect(() => {\n    if (JSON.stringify(block) !== JSON.stringify(loadedBlock)) {\n      if (!block) {\n        setLoadedBlock({})\n      } else {\n        setLoadedBlock(block)\n      }\n    }\n  }, [loadedBlock, block])\n\n  useEffect(() => {\n    if (\n      !!blockId\n      && (!loadedBlock.hasOwnProperty('_id') || blockId !== loadedBlock._id)\n      && loadingBlockRef.current === false\n    ) {\n      loadingBlockRef.current = true\n\n      loadBlock(blockId)\n        .then(async loadedBlock => {\n          if (typeof loadedBlock !== 'object' || loadedBlock === null) {\n            throw new Error('ViewerAuto: loadBlock returned no object')\n          } else {\n            if (loadedBlock.type !== null) {\n              setLoadedBlock(loadedBlock)\n            }\n          }\n          loadingBlockRef.current = false\n        })\n        .catch(error => {\n          console.error(error)\n          loadingBlockRef.current = false\n        })\n    }\n  }, [blockId, loadedBlock, loadBlock, setLoadedBlock])\n\n  const type = loadedBlock.type || null\n\n  switch (type) {\n    case 'text':\n      component = <ViewerTextCard key={loadedBlock._id} block={loadedBlock} {...props} />\n      break\n    case 'button':\n      component = <ViewerButtonCard key={loadedBlock._id} block={loadedBlock} {...props} />\n      break\n    case 'divider':\n      component = <ViewerDividerLine key={loadedBlock._id} block={loadedBlock} {...props} />\n      break\n    case 'page':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'person':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'redirect':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'website':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'apikey':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'image':\n      component = <ViewerImageCard key={loadedBlock._id} block={loadedBlock} {...props} />\n      break\n    default:\n      component = null // JSON.stringify(loadedBlock) // <ViewerTextCard key={loadedBlock._id} block={loadedBlock} {...props} />\n  }\n\n  const mutationFunction = useMutation()\n\n  const onReceive = useCallback(async ({ data = {} }) => {\n    const {\n      'application/json': json\n    } = data || {}\n\n    if (typeof json === 'object' && json !== null) {\n      let movingBlock = json\n\n      movingBlock = removeProperty(movingBlock, '__typename')\n\n      const block_roles = loadedBlock.computed.roles || []\n      const movingBlock_roles = movingBlock.computed.roles || []\n\n      if (\n        movingBlock._id !== loadedBlock._id\n        && (\n          userroles.includes('admin')\n          || (\n            ( block_roles.includes('editor') || block_roles.includes('owner') )\n            && ( movingBlock_roles.includes('editor') || movingBlock_roles.includes('owner') )\n          )\n        )\n      ) {\n        const pressedKeys = getPressedKeys()\n        // TODO: handle alt-key to duplicate block (child-blocks also need to be duplicated)\n        // if (pressedKeys.has('alt')) {\n        //   // duplicate block\n        //   delete movingBlock._id\n        //   const save_result = await mutationFunction({\n        //     mutation: saveBlock_Mutation,\n        //     variables: {\n        //       block: movingBlock,\n        //     },\n        //   })\n        //\n        //   movingBlock._id = save_result.saveBlock\n        // }\n\n        let everything_updated = false\n\n        try {\n          await mutationFunction({\n            mutation: moveBlock_Mutation,\n            variables: {\n              movingBlockId: movingBlock._id,\n              newParentId: loadedBlock._id,\n              newIndex: 0,\n            },\n          })\n        \n          if (pressedKeys.has('shift')) {\n            // auto hide the block        \n            await mutationFunction({\n              mutation: saveBlock_Mutation,\n              variables: {\n                block: {\n                  _id: movingBlock._id,\n                  properties: {\n                    'active': false,\n                  },\n                },\n              },\n            })\n          }\n        \n          everything_updated = true\n        } catch (error) {\n          console.error(error)\n        }\n      \n        if (everything_updated) {\n          console.log('TODO reload sidebar')\n          // TODO: reload sidebar\n        }\n      }\n    } \n  }, [mutationFunction, loadedBlock, getPressedKeys, userroles])\n\n  const handleCheckEntry = useCallback(({ data = {} }) => {\n    const {\n      'application/json': json\n    } = data || {}\n\n    let isOkay = false\n\n    if (\n      typeof json === 'object'\n      && json !== null\n      && json.hasOwnProperty('computed')\n      && json.computed.hasOwnProperty('roles')\n    ) {\n      const this_roles = json.computed.roles || []\n      if (userroles.includes('admin') || this_roles.includes('editor') || this_roles.includes('owner')) {\n        isOkay = true\n      }\n    }\n\n    return isOkay\n  }, [userroles])\n\n  return <DataBothWays\n    key={loadedBlock._id}\n    draggable={dragable}\n    className={classes.root}\n    onTransmit={() => ({\n      data: {\n        'text/plain': loadedBlock.properties.text || '',\n        // 'text/html': '<h1>Hello world!</h1>',\n        // 'text/uri-list': 'http://example.com',\n        'application/json': loadedBlock,\n      }\n    })}\n    onReceive={onReceive}\n    checkEntry={handleCheckEntry}\n    {...parentProps}\n  >\n    {component}\n  </DataBothWays>\n}\n\nexport default ViewerAuto\n","import { useState, useEffect, useRef } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getSelf_Query } from '../graphql/queries'\n\nconst defaultUser = {\n  userroles: [],\n}\n\nexport default function useUser(forceRefetch = false) {\n  const mountedRef = useRef(false)\n  useEffect(() => {\n    mountedRef.current = true\n    return () => {\n      mountedRef.current = false\n    }\n  }, [])\n\n  const [user, setUser] = useState(defaultUser)\n  const [loggedIn, setLoggedIn] = useState(false)\n\n  const apollo_client = useApolloClient()\n\n  useEffect(() => {\n    if (forceRefetch !== true && window.hasOwnProperty('user')) {\n      setUser({\n        ...window.user,\n        userroles: window.user.userroles || [],\n      })\n      setLoggedIn(window.user.logged_in)\n    } else {\n      apollo_client.query({\n        query: getSelf_Query,\n      })\n        .then(async ({ data }) => {\n          if (mountedRef.current === true) {\n            if (data.hasOwnProperty('self') && data.self !== null) {\n              window.user = data.self\n              setUser({\n                ...data.self,\n                userroles: data.self.userroles || [],\n              })\n              setLoggedIn(data.self.logged_in)\n            } else {\n              setUser(defaultUser)\n              setLoggedIn(false)\n            }\n          }\n        })\n        .catch(error => {\n          console.error(error)\n          if (mountedRef.current === true) {\n            setUser(defaultUser)\n            setLoggedIn(false)\n          }\n        })\n    }\n  }, [forceRefetch, setUser, setLoggedIn, apollo_client])\n\n  return {\n    ...user,\n    loggedIn,\n  }\n}\n","import mdit from 'markdown-it'\nimport kbd from 'markdown-it-kbd'\nimport emoji from 'markdown-it-emoji'\nimport twemoji from 'twemoji'\n\nfunction getMD(options){\n  // var hljs = require('highlight.js') // https://highlightjs.org/\n  const md = mdit({\n    html: false,\n    xhtmlOut: false,\n    linkify: true,\n    typographer: true,\n    breaks: false,\n    // highlight: function (str, lang) {\n    //   const language_obj = hljs.getLanguage(lang)\n    //   if (lang && language_obj) {\n    //     const language = language_obj.aliases[0]\n    //     return '<pre class=\"hljs language-'+language+'\"><code>' +\n    //       hljs.highlight(str, { language, ignoreIllegals: true }).value +\n    //     '</code></pre>';\n    //   } else {\n    //     const html = hljs.highlightAuto(str, { ignoreIllegals: true })\n    //     return '<pre class=\"hljs language-'+html.language+'\"><code>' +\n    //       html.value +\n    //     '</code></pre>';\n    //   }\n\n    //   return '<pre class=\"hljs\"><code>' + md.utils.escapeHtml(str) + '</code></pre>';\n    // }\n    ...options,\n  })\n\n  // md.disable([ 'heading', 'heading', 'lheading', 'paragraph', 'image' ])\n  md.use(kbd)\n  md.use(emoji)\n\n  return md\n}\n\nfunction renderInlineMarkdown(text, options = {}){\n  text = text || ''\n  // text = text.replace(/\\n/g, '<br>')\n  // text = text.replace(/\\t/g, '&emsp;')\n\n  text = text\n  .replace(/\\(TM\\)/gi, '™')\n  .replace(/\\(SM\\)/gi, '℠')\n  .replace(/\\(C\\)/gi, '©')\n  .replace(/\\(R\\)/gi, '®')\n\n  const md = getMD(options)\n  text = md.renderInline(text)\n\n  text = twemoji.parse(text, {\n    folder: 'svg',\n    ext: '.svg',\n    base: '/public/twemoji/assets/',\n    // callback: function(icon, options, variant) {\n    //   switch ( icon ) {\n    //     case 'a9':      // © copyright\n    //     case 'ae':      // ® registered trademark\n    //     case '2122':    // ™ trademark\n    //       return false\n    //     default:\n    //       return ''.concat(options.base, options.size, '/', icon, options.ext)\n    //   }\n    // }\n  })\n    \n  return text\n}\n\nexport {\n  renderInlineMarkdown,\n}\n","import {\n  Paper,\n  MenuList,\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  Divider,\n} from '@mui/material'\n\nimport {\n  Close as CloseIcon,\n} from '@mui/icons-material'\n\nimport { Localized } from '../fluent/Localized.js'\n\nimport Popover from './Popover.js'\n\nexport default function PopoverMenu ({\n  trigger,\n  children,\n  onToogle,\n  paperProps = {},\n}) {\n  return <Popover\n    trigger={trigger}\n    onToogle={onToogle}\n  >\n    {({closePopover, open, ...popoverProps}) => {\n      const {\n        sx = {},\n        ...paperPropsRest\n      } = paperProps || {}\n\n      return (\n        <Paper\n          {...popoverProps}\n          sx={{\n            maxWidth: 380,\n            // height: 325,\n            maxHeight: 'calc(100vh - 32px)',\n            overflow: 'auto',\n            background: 'var(--background-contrast)',\n            color: 'var(--on-background)',\n            ...sx,\n          }}\n          elevation={8}\n          {...paperPropsRest}\n        >\n          <MenuList\n            autoFocus={true}\n            style={{\n              width: '100%',\n              maxWidth: '100%',\n              marginTop: '-8px',\n            }}\n          >\n            <div>\n\n              {typeof children === 'function' ? children({ isOpen: open, close: closePopover }) : children}\n\n              <Divider style={{opacity: 0.2, marginBottom:'8px'}}  />\n\n              <MenuItem className=\"roundMenuItem\" onClick={closePopover}>\n                <ListItemIcon>\n                  <CloseIcon />\n                </ListItemIcon>\n                <ListItemText>\n                  <Localized id=\"block_menu_close_menu\" />\n                </ListItemText>\n              </MenuItem>\n\n            </div>\n          </MenuList>\n        </Paper>\n    )}}\n  </Popover>\n}\n","import { useState, useEffect } from \"react\";\n\nconst useMediaQuery = (query) => {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    if (media.matches !== matches) {\n      setMatches(media.matches);\n    }\n    const listener = () => setMatches(media.matches);\n    window.addEventListener(\"resize\", listener);\n    return () => window.removeEventListener(\"resize\", listener);\n  }, [matches, query]);\n\n  return matches;\n}\n\nexport default useMediaQuery;\n","import React, {\n  Suspense,\n  lazy,\n  useState,\n  useCallback,\n  createContext,\n  useContext,\n} from 'react'\n\nimport {\n  SwipeableDrawer,\n} from '@mui/material'\n\nimport { useMatch } from 'react-router-dom'\n\nimport useMediaQuery from '../hooks/useMediaQuery.js'\n\nimport classes from './Sidebar.module.css'\n\nconst LazySidebarContent = lazy(() => import('./SidebarContent.js'))\n\nconst SidebarContext = createContext({})\n\nfunction useSidebarContext() {\n  return useContext(SidebarContext)\n}\n\nfunction SidebarProvider({ children }) {\n  const [open, setOpen] = useState(false)\n\n  const matchesStartpage = useMatch('/')\n  const realOpen = matchesStartpage ? false : open\n\n  const toggleSidebar = useCallback(() => {\n    setOpen(oldOpen => !oldOpen)\n  }, [ setOpen ])\n\n  return (\n    <SidebarContext.Provider value={{\n      open: realOpen,\n      setOpen,\n      toggleSidebar,\n    }}>\n      {children}\n    </SidebarContext.Provider>\n  )\n}\n\nconst sidebarWidth = 320\n\nfunction Sidebar() {\n  const { open, toggleSidebar } = useSidebarContext()\n\n  const iOS = (typeof navigator !== 'undefined' && /iPad|iPhone|iPod/.test(navigator.userAgent))\n  const isDesktop = useMediaQuery('(min-width: 960px)')\n\n  if (open) {\n    return <SwipeableDrawer\n      variant={isDesktop ? 'permanent' : 'temporary'}\n      anchor=\"left\"\n      open={open}\n      onOpen={toggleSidebar}\n      onClose={toggleSidebar}\n      disableBackdropTransition={!iOS}\n      disableDiscovery={iOS}\n      sx={{\n        width: sidebarWidth,\n        flexShrink: 0,\n        [`& .MuiDrawer-paper`]: {\n          width: sidebarWidth,\n          boxSizing: 'border-box',\n          backgroundColor: 'var(--background-contrast)',\n          color: 'var(--on-background)',\n          border: 'none',\n        },\n      }}\n      PaperProps={{\n        sx: {\n          background: 'var(--background-contrast)',\n          color: 'var(--on-background)',\n        }\n      }}\n    >\n      <Suspense>\n        <SidebarContent />\n      </Suspense>\n    </SwipeableDrawer>\n  }\n\n  return null\n}\n\nfunction SidebarContent() {\n  return <Suspense>\n    <LazySidebarContent />\n  </Suspense>\n}\nfunction Main({ children }) {\n  const { open } = useSidebarContext()\n\n  return <main\n    className={`${classes.main} ${open ? classes.open : ''}`}\n    style={{\n      '--sidebarWidth': sidebarWidth+'px',\n    }}\n  >\n    {children}\n  </main>\n}\n\nexport {\n  SidebarContext,\n  useSidebarContext,\n  SidebarProvider,\n  SidebarContent,\n  Sidebar,\n  Main,\n}\n\n/*\n      <Drawer\n        variant={isDesktop ? 'permanent' : ''}\n        anchor=\"left\"\n        open={open}\n        sx={{\n          width: drawerWidth,\n          flexShrink: 0,\n          [`& .MuiDrawer-paper`]: {\n            width: drawerWidth,\n            boxSizing: 'border-box',\n            backgroundColor: 'var(--background)',\n            color: 'var(--on-background)',\n          },\n        }}\n        PaperProps={{\n          sx: {\n            background: 'var(--background-contrast)',\n            color: 'var(--on-background)',\n          }\n        }}\n      >\n        <Sidebar />\n      </Drawer>\n      */\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"ViewerLine_content__3FcZv\",\"title\":\"ViewerLine_title__35XNW\",\"additionalInfos\":\"ViewerLine_additionalInfos__32pXv\"};"],"sourceRoot":""}