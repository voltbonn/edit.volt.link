{"version":3,"sources":["hooks/useLoadBlocks.js","components/Twemoji.js","components/Header.js","components/DataTransmat.module.css","hooks/useSaveBlock.js","components/SubMenu.js","components/edit/BlockMenu.js","hooks/useArchiveBlock.js","hooks/useMutation.js","components/Header.module.css","components/ReactionButton.module.css","fluent/Localized.js","fluent/l10n.js","pages/App.module.css","components/Sidebar.module.css","fluent/fluentBy.js","components/Popover.js","components/view/BlockIcon.js","components/MultiButton.js","hooks/useLoadPage.js","components/view/ViewerAuto.module.css","components/edit/AddMenu.js","components/view/BlockIcon.module.css","locales lazy /^/.//.*/.ftl$/ groupOptions: {} namespace object","components/SearchBox.js","pages/List.js","components/ReactionButton.js","pages/Viewer.js","pages/App.js","index.js","functions.js","pages/Viewer.module.css","graphql/mutations.js","graphql/queries.js","pages/List.module.css","components/DataTransmat.js","components/view/ViewerTextCard.js","components/view/ViewerButtonCard.js","components/view/ViewerDividerLine.js","components/view/ViewerLineAndCard.js","hooks/useBlockTrigger.js","components/view/ViewerImageCard.js","components/view/ViewerCodeCard.js","hooks/useLoadBlock.js","components/view/ViewerAuto.js","hooks/useUser.js","components/PopoverMenu.js","markdown.js","components/SearchBox.module.css","Snackbar.module.css","components/view/ViewerLineAndCard.module.css","hooks/useMediaQuery.js","components/Sidebar.js"],"names":["useLoadBlocks","apollo_client","useApolloClient","handleLoadBlocks","useCallback","variables","Promise","resolve","query","getBlocks_Query","then","a","errors","data","Array","isArray","length","blocks","Error","catch","error","console","Twemoji","className","emojiClassName","style","emoji","useState","__html","html","setHtml","useEffect","textWithHtml","twemoji","parse","folder","ext","base","fontSize","dangerouslySetInnerHTML","memo","Header","title","block","rightActions","notificationBanner","useSidebarContext","open","toggleSidebar","blockId","_id","parentId","parent","parentBlocks","setParentBlocks","loadParentBlocks","getParentBlocks_Query","parentBlocksSorted","sort","b","computed","leftActions","flexGrow","display","alignItems","height","to","margin","onClick","opacity","trigger","triggerProps","verticalAlign","padding","map","size","parentProps","classes","header","headerBar","module","exports","removeProperty","obj","prop","i","JSON","stringify","hasOwnProperty","useSaveBlock","getString","useLocalization","useSnackbar","enqueueSnackbar","closeSnackbar","handleSaveBlock","initialBlock","final_resolve","snackbarKey","newBlock","content","contentConfig","loadingDataPromise","mutate","mutation","saveBlock_Mutation","variant","preventDuplicate","autoHideDuration","saveBlock","message","race","setTimeout","response","persist","SubMenu","name","disabled","label","onToggle","children","childrenRef","useRef","childrenSize","target","mountedRef","React","current","setSize","useLayoutEffect","getBoundingClientRect","useResizeObserver","entry","contentRect","useSize","toggleSubmenu","paperStyle","boxShadow","background","Paper","sx","color","overflow","transition","borderRadius","ListSubheader","whiteSpace","lineHeight","backgroundColor","MenuItem","justifyContent","ArrowRight","marginRight","transform","ref","typeIcons","button","text","image","code","divider","page","redirect","poster","definition","defaultTypeOptions","colorOptions","default","yellow","green","red","blue","colorOptionsKeys","Object","keys","getColor","renderedColor","getBlockColor","properties","withLocalization","onToogle","saveType","saveProperty","typeOptions","onRemoveRow","addRowBefore","onArchivedToggle","onReloadContext","useUser","loggedIn","userroles","type","active","text_style","text_decorations","roles","canEdit","includes","archived","setArchived","archiveBlock","useArchiveBlock","openSubmenu","setOpenSubmenu","newSubmenuName","oldSubmenuName","mutationFunction","useMutation","navigate","useNavigate","toggleArchiveBlock","newChildBlockId","moveBlock_Mutation","movingBlockId","newParentId","newIndex","newArchived","archive","toggleActive","metadata","toggleTextDecoration","thisDecoration","newTextDecorations","Set","filter","decoration","push","PopoverMenu","ListItemIcon","Localized","id","typeName","selected","Divider","marginTop","marginBottom","thisColor","placeholder","defaultValue","onBlur","e","value","width","thisStyle","VisibilityOff","Visibility","ListItemText","primary","secondary","Unarchive","Archive","component","Link","ListItem","paddingTop","paddingBottom","modified","replace","useArchiveBlocks","ids","archiveBlocks_Mutation","unarchiveBlocks_Mutation","option","reject","props","elems","br","Fragment","Inner","l10n","useContext","FluentContext","createElement","fluentByObject","object","fallback","globalSupportedLocales","supportedLocales","thisSupportedLocales","locale","currentLocales","negotiateLanguages","userLocales","defaultLocale","args","translateBlock","translations","correct_translations","fluentBy","fluentByArray","fluentByAny","any","locales","de","en","it","se","lt","fr","es","nl","_supportedLocales_","_defaultLocale_","fetchMessages","path","fetch","messages","FluentResource","createMessagesGenerator","all","fetched","reduce","cur","assign","generateBundles","bundle","FluentBundle","addResource","f","AppLocalizationProvider","onLocaleChange","ReactLocalization","getDefaultBundles","bundles","setBundles","new_bundles","loadBundles","require","lookupedLocale","strategy","array","key","item","Boolean","result","Popover","setOpenBlockMenuRef","anchorRef","setOpen","setOpenExternal","newOpen","closePopover","Math","random","toString","substring","undefined","prevOpen","pointerEvents","isOpen","position","top","right","bottom","left","zIndex","cursor","anchorEl","placement","disablePortal","modifiers","enabled","options","altBoundary","rootBoundary","TransitionProps","transformOrigin","BlockIcon","iconComponent","isSquareIcon","canBeIcon","split","contentAsPlaintext","hasContent","coverphotoPropertyValue","fileId","coverphoto","coverphotoUrl","getImageUrl","hasCoverphoto","icon","square","round","backgroundImage","window","domains","storage","imageFormat","encodeURIComponent","alt","icon_url","backgroundSize","hasText","contrastingColor","lines","slice","concat","line","text_document","MultiButton","ariaLabel","items","onChange","buttonProps","choosen","setChoosen","handleClick","event","newValue","dataset","gap","useLoadPage","loadBlocks","slugOrId","preloaded_blocks","SERVER_DATA","slug","getBlocksWithContent_Query","slugs","loadedBlocks","loadSlugInfos","checkSlug_Query","handleLoadPage","final_reject","done","existsAsSlug","existsAsId","blockTypeIcons","checkbox","person","default_types","AddMenuContent","createBlock","types","close","AddMenu","webpackAsyncContext","req","__webpack_require__","o","website","possibleTypes","SearchBox","results","setResults","setErrors","queryTextRef","setType","showArchived","setShowArchived","mathResult","setMathResult","useHotkeys","preventDefault","enableOnTags","enableOnContentEditable","blurInpurOnEnter","blur","open_search","close_search","addEventListener","removeEventListener","perform_search","query_text","newMathResult","mathjs_evaluate","String","t","search_Query","search","handleClose","handleResultClick","index","chosenResult","Modal","onClose","hideBackdrop","BackdropProps","theme","drawer","backdrop","dialog","autoFocus","onFocus","currentTarget","select","searchInput","onKeyDown","thisType","filters","searchResults","searchErrors","blockRow","flexDirection","ViewerAuto","blockRowActions","BlockMenu","flexShrink","file","roleIcons","owner","editor","Edit","viewer","sortableFieldsInfos","defaultSorting","asc","ListView","preselectedTypes","preselectedSorting","preselectedLayout","filteredTypes","setLoadedBlocks","sortedBlockGroups","setSortedBlockGroups","sorting","setSorting","layout","setLayout","isGrid","changeLayout","currentLayout","possibleRoles","setPossibleRoles","getText","fallback_text","toLowerCase","startsWith","sortableFields","sortBlocks","newSortedBlocks","sorting_text","sorting_display_text","matches","exec","toUpperCase","getFirstLetter","localeCompare","ignorePunctuation","numeric","reverse","sortable_field_type","newSortedBlocksWithHeadings","currentHeading","thisLetter","nextLetter","heading","values","thisDateString","nextDateString","changeSorting","oldSorting","toggleSortDirection","loadList","loadedContentBlocks","setTypeFilter","newType","setRoleFilter","newRole","role","gottenBlock","flexWrap","justifyItems","paddingInlineEnd","ArrowUpward","ArrowDownward","paddingInlineStart","FilterList","join","Add","href","backend","location","Login","smallDivider","group","grid_layout","list_layout","isSortHeading","List","rightHeaderActions","CustomEvent","dispatchEvent","Search","root","Helmet","property","app","spine_aligned","dir","contentWrapper","ReactionButton","forBlockId","userReactions","setUserReactions","archiveBlocks","loadUserReactions","loadedUserReactions","reactionFor","log","toggleReaction","reaction","filteredUserReactions","userReactionBlock","reactionButton","ErrorPage","lazy","LocaleSelect","Viewer","loadingTheBlock","loadPage","useParams","slugOrId_to_use","setBlock","contentBlocks","setContentBlocks","possibleLocales","setPossibleLocales","setLocales","handleLocaleChange","newLocale","setError","setAndTrackError","umami","trackEvent","for_slugOrId","loadedBlock","newLoadedBlock","newContentConfigs","ids2load","find","newPossibleLocales","flatMap","thisBlock","short_error_page_title","forceId","pathSuffix","errorName","pronouns","document","rel","click","titleWithRenderedMarkdown","renderInlineMarkdown","contentPreviewText","coverphoto_url","metadata_image_url","coverphotoComponent","maxWidth","src","coverphotoIsSet","contentBlock","Editor","ListWrapper","App","matchesStartpage","useMatch","useLocation","customLocation","setCustomLocation","newPathname","parts","pathname","part","last","pop","idOrSlug","suffix","typesSingular","typesPlural","indexOf","fallback_title","fallback_description","isStartpage","Sidebar","element","process","env","frontend","graphql_uri","client","ApolloClient","uri","cache","InMemoryCache","credentials","defaultOptions","watchQuery","fetchPolicy","errorPolicy","Start","navigator","languages","setUserLocales","currentLocale","setCurrentLocale","savedLocale","localStorage","getItem","systemLocales","language","handleLanguageChange","handleCurrentLocalesChange","change_locale","detail","removeItem","setItem","prefersDarkMode","useMediaQuery","useMemo","createTheme","palette","mode","components","MuiListItemIcon","styleOverrides","MuiListItemText","fontFamily","ApolloProvider","ThemeProvider","anchorOrigin","vertical","horizontal","minWidth","variantSuccess","snackbarClasses","snackbar","success","variantError","variantWarning","warning","variantInfo","info","domRoot","getElementById","onLanguageChange","container","createRoot","render","hexToRGBArray","charAt","rgb","parseInt","substr","getContrastingColor","luma","colorToHex","rgba","cvs","ctx","getContext","fillStyle","fillRect","getImageData","colorToRGBA","idx","imageObj","format","url","colors","colorRGB","contrastingColorRGB","defaultColors","newColor","parsedColor","gql","getBlock_Query","getSelf_Query","getLastModifiedBlocks_Query","getTransmatOptions","transmat","mimetypes","mimetype","hasType","getData","DataBothWays","onTransmit","onReceive","checkEntry","draggable","bothwayRef","unlistenTransmit","addListeners","Transmat","setData","unlistenReceive","isOkay","accept","obs","TransmatObserver","entries","classList","toggle","drag_over","isTarget","drag_active","isActive","observe","disconnect","tabIndex","ViewerTextCard","defaultProps","checked","prefixs","iconProps","CheckBox","CheckBoxOutlineBlank","text_content","ViewerButtonCard","clickable","linkify","colorStyles","ViewerDividerLine","styles","toSimpleIsoString","date","toISOString","ViewerLineAndCard","link","setLink","setPath","newLink","newPath","changedPathSuffix","trim","pathSuffixFull","useBlockTrigger","additionalInfos","importance","description","nbf","Date","exp","from","contentAsPlaintextWithRenderedMarkdown","tags","tag","cardLink","onClickProps","hoverTitlePreviewText","ViewerImageCard","image_url","textAlign","ViewerCodeCard","useLoadBlock","handleLoadBlock","preloaded_block","dragable","setLoadedBlock","loadingBlockRef","getPressedKeys","pressedKeysRef","add","onKeyUp","delete","usePressedKeys","loadBlock","json","movingBlock","block_roles","movingBlock_roles","pressedKeys","everything_updated","has","handleCheckEntry","this_roles","defaultUser","forceRefetch","user","setUser","setLoggedIn","logged_in","self","paperProps","popoverProps","paperPropsRest","maxHeight","elevation","getMD","md","mdit","xhtmlOut","typographer","breaks","use","kbd","renderInline","setMatches","media","matchMedia","listener","LazySidebarContent","SidebarContext","createContext","SidebarProvider","realOpen","oldOpen","Provider","iOS","test","userAgent","isDesktop","SwipeableDrawer","anchor","onOpen","disableBackdropTransition","disableDiscovery","boxSizing","border","PaperProps","SidebarContent","oneColumn","Main","main","sidebarWidth"],"mappings":"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","file":"static/js/main.235740bb.chunk.js","sourcesContent":["import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlocks_Query } from '../graphql/queries'\n\nfunction useLoadBlocks() {\n  const apollo_client = useApolloClient()\n\n  const handleLoadBlocks = useCallback(variables => {\n    return new Promise(resolve => {\n      apollo_client.query({\n        query: getBlocks_Query,\n        variables,\n      })\n        .then(async ({ errors, data }) => {\n          if (Array.isArray(errors) && errors.length > 0) {\n            throw errors\n          } else if (Array.isArray(data.blocks)) {\n            resolve(data.blocks)\n          }else{\n            throw new Error('Unknown error while loading blocks.')\n          }\n        })\n        .catch(async error => {\n          console.error('error', error)\n          resolve([])\n        })\n    })\n  }, [apollo_client])\n\n  return handleLoadBlocks\n}\n\nexport default useLoadBlocks\n","import React, { memo, useState, useEffect } from 'react'\nimport twemoji from 'twemoji'\n\nconst Twemoji = ({ className, emojiClassName = 'emoji', style, emoji = '' }) => {\n  const [html, setHtml] = useState({ __html: '' })\n\n  useEffect(() => {\n    if (typeof emoji === 'string' && emoji.length > 0) {\n      const textWithHtml = twemoji.parse(emoji, {\n        folder: 'svg',\n        ext: '.svg',\n        className: emojiClassName,\n        base: '/public/twemoji/assets/',\n      })\n\n      setHtml({ __html: textWithHtml })\n    } else {\n      setHtml({ __html: '' })\n    }\n  }, [emoji, emojiClassName, setHtml])\n\n  return <span\n    className={className}\n    style={{\n      fontSize: 0,\n      ...style,\n    }}\n    dangerouslySetInnerHTML={html}\n  />\n}\n\nexport default memo(Twemoji)\n","import { useState, useCallback, useEffect } from 'react'\n\nimport classes from './Header.module.css'\n\nimport {\n  Menu as MenuIcon,\n  MoreHoriz as MoreHorizIcon,\n  Home as HomeIcon,\n} from '@mui/icons-material'\n\nimport { Link } from 'react-router-dom'\n\nimport { useSidebarContext } from './Sidebar.js'\nimport ViewerAuto from './view/ViewerAuto.js'\nimport PopoverMenu from './PopoverMenu.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getParentBlocks_Query } from '../graphql/queries' // getBlocks_Query\n\nexport default function Header({ title, block = {}, rightActions, notificationBanner, className }) {\n  const { open, toggleSidebar } = useSidebarContext()\n  const apollo_client = useApolloClient()\n\n  const blockId = block ? block._id : null\n  const parentId = block ? block.parent : null\n\n  const [parentBlocks, setParentBlocks] = useState([])\n  // const [siblingBlocks, setSiblingBlocks] = useState([])\n\n  const loadParentBlocks = useCallback(blockId => {\n    apollo_client.query({\n      query: getParentBlocks_Query,\n      variables: {\n        _id: blockId,\n      },\n    })\n      .then(async ({ data }) => {\n        if (typeof data.error === 'string' || !data.blocks) {\n          console.error(data.error)\n          setParentBlocks([])\n        }else{\n          const parentBlocksSorted = (data.blocks || [])\n            .sort((a, b) => b.computed.sort - a.computed.sort)\n\n          setParentBlocks(parentBlocksSorted)\n        }\n      })\n      .catch(async error => {\n        console.error('error', error)\n        setParentBlocks([])\n      })\n  }, [apollo_client, setParentBlocks])\n\n  // const loadSiblingBlocks = useCallback((parentId, blockId) => {\n  //   apollo_client.query({\n  //     query: getBlocks_Query,\n  //     variables: {\n  //       roots: [blockId],\n  //       types: ['page', 'person', 'redirect'],\n  //       archived: false,\n  //     },\n  //   })\n  //     .then(async ({ data }) => {\n  //       if (typeof data.error === 'string' || !data.blocks) {\n  //         console.error(data.error)\n  //         setSiblingBlocks([])\n  //       }else{\n  //         setSiblingBlocks(\n  //           (data.blocks || [])\n  //             .filter(block => block._id !== blockId)\n  //         )\n  //       }\n  //     })\n  //     .catch(async error => {\n  //       console.error('error', error)\n  //       setSiblingBlocks([])\n  //     })\n  // }, [apollo_client, setSiblingBlocks])\n\n  useEffect(() => {\n    if (blockId) {\n      loadParentBlocks(blockId)\n      // loadSiblingBlocks(parentId, blockId)\n    }\n  }, [blockId, parentId, loadParentBlocks]) // loadSiblingBlocks\n\n  const leftActions = <>\n    <div style={{\n      flexGrow: '1',\n      display: 'flex',\n      alignItems: 'center',\n      height: '32px',\n    }}>\n      {\n        open\n          ? <Link to=\"/\">\n            <button className=\"text hasIcon\" style={{ margin: '0 calc(-2 * var(--basis)) 0 0' }}>\n              <HomeIcon className=\"icon\" />\n            </button>\n          </Link>\n          : <button onClick={toggleSidebar} className=\"text hasIcon\" style={{ margin: '0 calc(-2 * var(--basis)) 0 0' }}>\n            <MenuIcon className=\"icon\" />\n          </button>\n      }\n      <span style={{ margin: 'var(--basis_x2)', opacity: 'var(--alpha)' }}>/</span>\n\n    {\n      blockId\n      && parentBlocks.length > 0\n        ? <>\n          <PopoverMenu\n            trigger={triggerProps => (\n              <button {...triggerProps} className=\"text\" style={{ margin: '0 calc(-2 * var(--basis))' }}>\n                <MoreHorizIcon style={{ verticalAlign: 'middle' }} />\n              </button>\n            )}\n          >\n            <div style={{\n              padding: 'var(--basis_x2)',\n            }}>\n              {\n                parentBlocks\n                .map((block) => {\n                  return <ViewerAuto\n                    key={block._id}\n                    block={block}\n                    size=\"line\"\n                  />\n                })\n              }\n            </div>\n          </PopoverMenu>\n          <span style={{ margin: 'var(--basis_x2)', opacity: 'var(--alpha)' }}>/</span>\n        </>\n        : null\n    }\n\n    <ViewerAuto\n      key={block}\n      block={block}\n      size=\"line\"\n      parentProps={{\n        style: {\n          flexGrow: '0',\n          margin: '0 calc(-2 * var(--basis))',\n        },\n      }}\n    />\n\n    {/*\n      siblingBlocks.length > 0\n        ? <PopoverMenu\n            trigger={triggerProps => (\n              <button {...triggerProps} className=\"text\" style={{ margin: 'calc(-2 * var(--basis))' }}>\n                <span style={{ fontWeight: 'bold' }}>\n                  {title}\n                </span>\n              </button>\n            )}\n          >\n            <div style={{\n              padding: 'var(--basis_x2)',\n            }}>\n              {\n                siblingBlocks\n                .map((block) => {\n                  return <ViewerAuto\n                    key={block._id}\n                    block={block}\n                    size=\"line\"\n                  />\n                })\n              }\n            </div>\n          </PopoverMenu>\n        : <span style={{ fontWeight: 'bold' }}>\n            {title}\n          </span>\n    */}\n    </div>\n  </>\n\n  return <header className={`${classes.header} ${className}`}>\n    <div className={classes.headerBar}>\n      {leftActions}\n      {rightActions}\n    </div>\n    {\n      !!notificationBanner\n        ? <div className={classes.notificationBanner}>{notificationBanner}</div>\n        : null\n    }\n  </header>\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"drag_over\":\"DataTransmat_drag_over__3XVzh\",\"drag_active\":\"DataTransmat_drag_active__2nwCM\"};","import { useCallback } from 'react'\n\nimport { useLocalization } from '../fluent/Localized.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { saveBlock_Mutation } from '../graphql/mutations.js'\n\nimport { useSnackbar } from 'notistack'\n\nfunction removeProperty(obj, prop) {\n  // remove property from objects, arrays and sub-objects\n\n  obj = JSON.parse(JSON.stringify(obj)) // clone object to make everything mutable\n\n  if (obj.hasOwnProperty(prop)) {\n    delete obj[prop]\n  }\n  for (const i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (typeof obj[i] == 'object' && obj[i] !== null) {\n        removeProperty(obj[i], prop)\n      }\n    }\n  }\n\n  return obj\n}\n\nfunction useSaveBlock() {\n  const { getString } = useLocalization()\n\n  const apollo_client = useApolloClient()\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\n\n  const handleSaveBlock = useCallback((initialBlock) => {\n    return new Promise(final_resolve => {\n      let snackbarKey = null\n\n      let newBlock = {...initialBlock}\n      newBlock = removeProperty(newBlock, '__typename')\n      if (newBlock.hasOwnProperty('content') && Array.isArray(newBlock.content)) {\n        newBlock.content = newBlock.content.map(contentConfig => ({\n          blockId: contentConfig.blockId,\n        }))\n      }\n\n      const loadingDataPromise = new Promise(resolve => {\n        apollo_client.mutate({\n          mutation: saveBlock_Mutation,\n          variables: {\n            block: newBlock\n          },\n        })\n          .then(async ({ data }) => {\n            resolve('got-data')\n\n            if (snackbarKey !== null) {\n              closeSnackbar(snackbarKey)\n            }\n\n            if (typeof data.error === 'string') {\n              if (data.error === 'no_edit_permission') {\n                enqueueSnackbar(getString('path_editor_edit_permission_error'), {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 2000,\n                })\n              } else {\n                enqueueSnackbar('' + data.error, {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 2000,\n                })\n              }\n            } else {\n              const block = data.saveBlock\n\n              final_resolve(block)\n\n              enqueueSnackbar(getString('path_editor_status_saved'), {\n                variant: 'success',\n                preventDuplicate: false,\n                autoHideDuration: 2000,\n              })\n            }\n          })\n          .catch(async error => {\n            console.error(error)\n            resolve('got-error')\n\n            if (snackbarKey !== null) {\n              closeSnackbar(snackbarKey)\n            }\n\n            enqueueSnackbar(getString('path_editor_status_error_while_saving', {\n              error: error.message,\n            }), {\n              variant: 'error',\n              preventDuplicate: true,\n              autoHideDuration: 2000,\n            })\n          })\n      })\n\n      // Show a loading-info-snackbar if loading the data takes too long.\n      Promise.race([\n        new Promise(resolve => {\n          setTimeout(() => {\n            resolve('show-loading')\n          }, 300)\n        }),\n        loadingDataPromise,\n      ])\n        .then(response => {\n          if (response === 'show-loading') {\n            snackbarKey = enqueueSnackbar(getString('path_editor_status_started_saving'), {\n              persist: true,\n              preventDuplicate: true,\n            })\n          }\n        })\n        .catch(console.error)\n\n    })\n  }, [\n    enqueueSnackbar,\n    closeSnackbar,\n    apollo_client,\n    getString,\n  ])\n\n  return handleSaveBlock\n}\n\nexport default useSaveBlock\n","import React, { useRef, useCallback } from 'react'\n\nimport {\n  MenuItem,\n  ListSubheader,\n  Paper,\n} from '@mui/material'\n\nimport {\n  ArrowRight as ArrowRightIcon,\n} from '@mui/icons-material'\n\n// INFO: Some code is copied from: https://github.com/azmenak/material-ui-nested-menu-item/blob/master/src/index.tsx\n\nimport useResizeObserver from '@react-hook/resize-observer'\nconst useSize = target => {\n  const mountedRef = React.useRef(false)\n  React.useEffect(() => {\n    mountedRef.current = true\n    return () => {\n      mountedRef.current = false\n    }\n  }, [])\n\n  const [size, setSize] = React.useState()\n\n  React.useLayoutEffect(() => {\n    if (mountedRef.current === true) {\n      setSize(target.current.getBoundingClientRect())\n    }\n  }, [target])\n\n  // Where the magic happens\n  useResizeObserver(target, (entry) => {\n    if (mountedRef.current === true) {\n      setSize(entry.contentRect)\n    }\n  })\n  return size\n}\n\nexport default function SubMenu ({\n  name = '',\n  disabled = false,\n  label = '',\n  triggerProps = {},\n  onToggle = null,\n  open = false,\n  children,\n}) {\n  const childrenRef = useRef(null)\n  const childrenSize = useSize(childrenRef)\n\n  const toggleSubmenu = useCallback(() => {\n    if (disabled !== true && typeof onToggle === 'function') {\n      onToggle({ name })\n    }\n  }, [disabled, onToggle, name])\n\n  let paperStyle = {}\n  if (open === true) {\n    paperStyle = {\n      margin: 'var(--basis)',\n      boxShadow: '0 var(--basis_x0_5) var(--basis_x4) 0 rgba(var(--on-background-rgb), 0.4)',\n      padding: '8px 0',\n      background: 'var(--background-contrast)',\n    }\n  } else {\n    paperStyle = {\n      margin: '0',\n      boxShadow: 'none',\n      background: 'transparent',\n    }\n  }\n\n  return <Paper\n    sx={{\n      color: 'var(--on-background)',\n      overflow: 'hidden',\n      transition: 'padding var(--timing), margin var(--timing), box-shadow var(--timing)',\n      borderRadius: 'var(--basis_x2)',\n      ...paperStyle,\n    }}\n  >\n    {\n      label !== null\n        ? <>\n          <ListSubheader\n            onClick={toggleSubmenu}\n            style={{\n              whiteSpace: 'nowrap',\n              lineHeight: '1',\n              margin: '0',\n              padding: '0',\n              backgroundColor: 'transparent',\n              color: 'var(--on-background)',\n            }}\n          >\n            <MenuItem\n              {...triggerProps}\n              disabled={disabled}\n              className=\"roundMenuItem\"\n              style={{\n                display: 'flex',\n                justifyContent: 'space-between',\n                ...triggerProps.style,\n              }}\n            >\n              <div style={{ display: 'flex' }}>\n                {label}\n              </div>\n\n              <ArrowRightIcon style={{\n                marginRight: '-10px',\n                transition: 'transform var(--timing)',\n                transform: open === true ? 'rotate(90deg)' : '',\n              }} />\n            \n            </MenuItem>\n          </ListSubheader>\n          {open === true ? <div style={{ height: '12px' }}></div> : null}\n        </>\n        : null\n    }\n\n    <div style={{\n      height: childrenSize?.height,\n      overflow: 'hidden',\n      transition: 'height var(--timing)',\n    }}>\n      <div ref={childrenRef}>\n        {open === true ? children : ''}\n      </div>\n    </div>\n  </Paper>\n}\n","import { useCallback, useState } from 'react'\n\nimport {\n  Link,\n  useNavigate,\n} from 'react-router-dom'\n\nimport {\n  MenuItem,\n  Divider,\n  ListItemIcon,\n  ListItemText,\n  ListItem,\n} from '@mui/material'\n\nimport {\n  Archive as ArchiveIcon,\n  Unarchive as UnarchiveIcon,\n\n  Visibility as VisibilityIcon,\n  VisibilityOff as VisibilityOffIcon,\n  // Delete as DeleteIcon,\n  // VerticalAlignTop as VerticalAlignTopIcon,\n  // VerticalAlignBottom as VerticalAlignBottomIcon,\n  Add as AddIcon,\n  RepeatSharp as RepeatIcon,\n  // RemoveCircleSharp as RemoveCircleIcon,\n\n  InsertDriveFileSharp as PageIcon,\n  LinkSharp as RedirectIcon,\n  // PersonSharp as PersonIcon,\n  Crop75Sharp as ButtonIcon,\n  NotesSharp as TextIcon,\n  ImageSharp as ImageIcon,\n  CodeSharp as CodeIcon,\n  Remove as DividerIcon,\n  // CheckBox as CheckboxIcon,\n  WebStoriesSharp as PosterIcon, // WebStories book bookmark ContactPage CropPortrait Layers Note PhotoAlbum Photo ViewCarousel\n  AbcSharp as DefinitionIcon,\n\n  PreviewSharp as ViewIcon,\n  EditSharp as EditIcon,\n\n  FormatSizeSharp as TextStyleIcon,\n  TextFormatSharp as TextDecorationsIcon,\n  PaletteSharp as ColorIcon,\n  CircleSharp as ColorSwatchIcon,\n\n  CheckSharp as SelectedIcon,\n} from '@mui/icons-material'\n\nimport { Localized, withLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nimport useArchiveBlock from '../../hooks/useArchiveBlock.js'\nimport useUser from '../../hooks/useUser.js'\n\nimport PopoverMenu from '../PopoverMenu.js'\nimport SubMenu from '../SubMenu.js'\nimport { AddMenuContent } from './AddMenu.js'\n\nimport { saveBlock_Mutation, moveBlock_Mutation } from '../../graphql/mutations.js'\nimport useMutation from '../../hooks/useMutation.js'\n\nconst typeIcons = {\n  button: <ButtonIcon />,\n  text: <TextIcon />,\n  image: <ImageIcon />,\n  // checkbox: <CheckboxIcon />,\n  code: <CodeIcon />,\n  divider: <DividerIcon />,\n  page: <PageIcon />,\n  redirect: <RedirectIcon />,\n  poster: <PosterIcon />,\n  definition: <DefinitionIcon />,\n}\n\nconst defaultTypeOptions = [\n  'button',\n  'text',\n  'image',\n  // 'checkbox',\n  'code',\n  'divider',\n  'page',\n  'redirect',\n  'poster',\n  'definition',\n]\n\nconst colorOptions = {\n  default: 'var(--on-background)',\n  yellow: 'var(--yellow)',\n  green: 'var(--green)',\n  red: 'var(--red)',\n  blue: 'var(--blue)',\n}\nconst colorOptionsKeys = Object.keys(colorOptions)\nfunction getColor (color) {\n  if (colorOptions.hasOwnProperty(color)) {\n    return colorOptions[color]\n  } else {\n    const {\n      color: renderedColor\n    } = getBlockColor({\n      properties: {\n        color,\n      },\n    })\n\n    if (renderedColor) {\n      return renderedColor\n    }\n  }\n  \n  return color\n}\n\nfunction BlockMenu ({\n  block = {},\n  getString,\n\n  trigger,\n  onToogle,\n\n  saveType,\n  saveProperty,\n  typeOptions = defaultTypeOptions,\n\n  onRemoveRow = null,\n  addRowBefore = null,\n  // addRowAfter = null,\n  onArchivedToggle = null,\n  onReloadContext = null,\n}) {\n  const { loggedIn, userroles } = useUser()\n\n  if (\n    !(\n      block.hasOwnProperty('properties')\n      && typeof block.properties === 'object'\n      && block.properties !== null\n      && !Array.isArray(block.properties)\n    )\n  ) {\n    block.properties = {}\n  }\n\n  const { _id = '', type = '', properties = {}, computed = {} } = block\n  let {\n    active = true,\n    text_style = null,\n    text_decorations = [],\n    color = null,\n  } = properties\n\n  if (!Array.isArray(text_decorations)) {\n    text_decorations = []\n  }\n\n  const {\n    roles = [],\n  } = (computed === null ? {} : computed)\n  const canEdit = loggedIn && (userroles.includes('admin') || roles.includes('owner') || roles.includes('editor'))\n\n  const [archived, setArchived] = useState(properties.archived === true)\n  const archiveBlock = useArchiveBlock()\n\n  // const handleAddRowBefore = useCallback(() => {\n  //\n  //   // const newBlock = {\n  //   //   type,\n  //   // }\n  //\n  //   const newBlockId = ''\n  //\n  //   addRowBefore({\n  //     blockId: newBlockId,\n  //   })\n  // }, [ addRowBefore ])\n\n  const [openSubmenu, setOpenSubmenu] = useState(null)\n  const toggleSubmenu = useCallback((newSubmenuName) => {\n    setOpenSubmenu(oldSubmenuName => {\n      if (oldSubmenuName === newSubmenuName) {\n        return null\n      }\n      return newSubmenuName\n    })\n  }, [])\n\n  const mutationFunction = useMutation()\n  const navigate = useNavigate()\n  const createChildBlock = useCallback(async ({ type }) => {\n    try {\n      if (typeof type === 'string' && type.length > 0) {\n        const { saveBlock: newChildBlockId } = await mutationFunction({\n          mutation: saveBlock_Mutation,\n          variables: {\n            block: { type },\n          },\n        })\n\n        if (newChildBlockId !== null) {\n          await mutationFunction({\n            mutation: moveBlock_Mutation,\n            variables: {\n              movingBlockId: newChildBlockId,\n              newParentId: _id,\n              newIndex: 0,\n            },\n          })\n          if (typeof onReloadContext === 'function') {\n            onReloadContext()\n          }\n          navigate(`/${newChildBlockId}/edit`)\n        }\n      }\n    } catch (error) {\n      console.error(error)\n    }\n  }, [mutationFunction, _id, onReloadContext, navigate])\n\n  const toggleArchiveBlock = useCallback(() => {\n    const newArchived = !archived\n    archiveBlock({ _id: block._id, archive: newArchived })\n      .then(() => {\n        setArchived(newArchived)\n        if (typeof onArchivedToggle === 'function') {\n          onArchivedToggle(newArchived)\n        }\n        if (typeof onReloadContext === 'function') {\n          onReloadContext()\n        }\n      })\n      .catch(console.error)\n  }, [archiveBlock, setArchived, archived, block, onArchivedToggle, onReloadContext])\n\n  const toggleActive = useCallback(() => {\n    if (typeof saveProperty === 'function') {\n      saveProperty('active', !active)\n    }\n  }, [active, saveProperty])\n\n  const metadata = block.metadata || {}\n\n  let {\n    color: renderedColor\n  } = getBlockColor(block)\n\n  if (!renderedColor) {\n    renderedColor = 'transparent'\n  }\n\n  const toggleTextDecoration = useCallback(thisDecoration => {\n    let newTextDecorations = [...new Set(text_decorations)]\n\n    if (text_decorations.includes(thisDecoration)) {\n      newTextDecorations = newTextDecorations.filter(decoration => decoration !== thisDecoration)\n    } else {\n      newTextDecorations.push(thisDecoration)\n    }\n\n    saveProperty('text_decorations', newTextDecorations)\n  }, [text_decorations, saveProperty])\n\n  return <PopoverMenu\n    trigger={trigger}\n    onToogle={onToogle}\n  >\n    {({ open }) => (<div>\n\n      <div style={{ height: '8px' }}></div>\n\n      {\n        (\n          canEdit\n          && typeof saveType === 'function'\n          && Array.isArray(typeOptions)\n          && typeOptions.length > 0\n        )\n        && <>\n          <SubMenu\n            disabled={type === 'person'}\n            name=\"type\"\n            open={openSubmenu === 'type'}\n            onToggle={({ name }) => toggleSubmenu(name)}\n            label={<>\n              <ListItemIcon>\n                <RepeatIcon />\n              </ListItemIcon>\n              <Localized id=\"block_menu_choose_type_label\" />\n            </>}\n          >\n            {\n              typeOptions\n              .map(typeName => (\n                <MenuItem\n                  key={typeName}\n                  selected={typeName === type}\n                  onClick={() => saveType(typeName)}\n                  className=\"roundMenuItem\"\n                >\n                  <ListItemIcon>\n                    {typeIcons[typeName]}\n                  </ListItemIcon>\n                  {getString(`block_menu_type_label_${typeName}`, typeName)}\n                </MenuItem>\n              ))\n            }\n          </SubMenu>\n          <Divider style={{ opacity: 0.2, marginTop: '8px', marginBottom: '8px' }} />\n        </>\n      }\n\n      {\n        (\n          canEdit\n          && typeof saveProperty === 'function'\n        )\n        && <SubMenu\n            name=\"color\"\n            open={openSubmenu === 'color'}\n            onToggle={({ name }) => toggleSubmenu(name)}\n            label={<>\n              <ListItemIcon>\n                <ColorIcon\n                  style={{\n                    color: getColor(color),\n                  }}\n                />\n              </ListItemIcon>\n              <Localized id=\"block_menu_choose_color_label\" />\n            </>}\n          >\n          {\n            colorOptionsKeys\n            .map(thisColor => (\n              <MenuItem\n                key={thisColor}\n                selected={thisColor === 'default' ? color === null : color === thisColor}\n                onClick={() => saveProperty('color', thisColor === 'default' ? null : thisColor)}\n                className=\"roundMenuItem\"\n              >\n                <ListItemIcon>\n                  <ColorSwatchIcon\n                    style={{\n                      color: getColor(thisColor),\n                    }}\n                  />\n                </ListItemIcon>\n                {thisColor}\n              </MenuItem>\n            ))\n          }\n\n          <MenuItem\n            className=\"roundMenuItem\"\n            selected={color !== null && !colorOptionsKeys.includes(color)}\n          >\n            <ListItemIcon>\n              <ColorSwatchIcon\n                style={{\n                  color: renderedColor,\n                }}\n              />\n            </ListItemIcon>\n            <input\n              key={colorOptionsKeys.includes(color) ? color : 'custom'}\n              type=\"text\"\n              placeholder=\"#FFFFFF\"\n              defaultValue={color}\n              onBlur={e => saveProperty('color', e.target.value)}\n              style={{\n                width: '160px',\n                margin: '0 calc(-1 * var(--basis)) 0 0',\n              }}\n            />\n          </MenuItem>\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof saveProperty === 'function'\n          && type === 'text'\n        )\n        && <SubMenu\n          name=\"text_style\"\n          open={openSubmenu === 'text_style'}\n          onToggle={({ name }) => toggleSubmenu(name)}\n          label={<>\n            <ListItemIcon>\n              <TextStyleIcon />\n            </ListItemIcon>\n            <Localized id=\"block_menu_choose_text_style_label\" />\n          </>}\n        >\n          {\n            [\n              // 'h1', // title\n              'h2', // heading\n              'h3', // subheading\n              'body', // body text. This is saved as null.\n              // 'caption',\n            ]\n            .map(thisStyle => (\n              <MenuItem\n                key={thisStyle}\n                selected={thisStyle === 'body' ? text_style === null : text_style === thisStyle}\n                onClick={() => saveProperty('text_style', thisStyle === 'body' ? null : thisStyle)}\n                className=\"roundMenuItem\"\n              >\n                {getString(`block_menu_text_style_label_${thisStyle}`, thisStyle)}\n              </MenuItem>\n            ))\n          }\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof saveProperty === 'function'\n          && type === 'text'\n        )\n        && <SubMenu\n            name=\"text_decorations\"\n            open={openSubmenu === 'text_decorations'}\n            onToggle={({ name }) => toggleSubmenu(name)}\n            label={<>\n              <ListItemIcon>\n                <TextDecorationsIcon />\n              </ListItemIcon>\n              <Localized id=\"block_menu_choose_text_decorations_label\" />\n            </>}\n        >\n          {\n            [\n              'checkbox',\n            ]\n              .map(thisDecoration => {\n                const selected = text_decorations.includes(thisDecoration)\n                return <MenuItem\n                  key={thisDecoration}\n                  selected={selected}\n                  onClick={() => toggleTextDecoration(thisDecoration)}\n                  className=\"roundMenuItem\"\n                >\n                  <ListItemIcon>\n                    {\n                      selected\n                        ? <SelectedIcon />\n                        : <SelectedIcon style={{ opacity: 0 }} />\n                    }\n                  </ListItemIcon>\n                  {getString(`block_menu_text_decoration_label_${thisDecoration}`, thisDecoration)}\n                </MenuItem>\n              })\n          }\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof saveProperty === 'function'\n        )\n        && <Divider style={{opacity: 0.2, marginTop:'8px', marginBottom:'8px'}} />\n      }\n\n      {/*\n        addRowBefore\n        && <MenuItem onClick={handleAddRowBefore}>\n          <ListItemIcon>\n            <VerticalAlignTopIcon />\n          </ListItemIcon>\n          <Localized id=\"block_menu_add_before\" />\n        </MenuItem>\n      */}\n\n      {/*\n        addRowAfter\n        && <MenuItem onClick={addRowAfter}>\n          <ListItemIcon>\n            <VerticalAlignBottomIcon />\n          </ListItemIcon>\n          <Localized id=\"block_menu_add_after\" />\n        </MenuItem>\n      */}\n\n      {\n        false\n        && canEdit\n        && <SubMenu\n          name=\"create_child_block\"\n          open={openSubmenu === 'create_child_block'}\n          onToggle={({ name }) => toggleSubmenu(name)}\n          label={<>\n            <ListItemIcon>\n              <AddIcon />\n            </ListItemIcon>\n            <Localized id=\"block_menu_create_child_block\" />\n          </>}\n        >\n          <AddMenuContent createBlock={createChildBlock} />\n        </SubMenu>\n      }\n\n      {\n        (\n          canEdit\n          && typeof saveProperty === 'function'\n        )\n        && <MenuItem className=\"roundMenuItem\" onClick={toggleActive}>\n          <ListItemIcon>\n            {\n              active\n              ? <VisibilityOffIcon />\n              : <VisibilityIcon />\n            }\n          </ListItemIcon>\n\n          <ListItemText\n            primary={<span>{\n              active\n              ? <Localized id=\"block_menu_hide\" />\n              : <Localized id=\"block_menu_show\" />\n            }</span>}\n            secondary={<span style={{ whiteSpace: 'normal' }}><Localized id=\"block_menu_hide_show_description\" /></span>}\n          />\n          \n        </MenuItem>\n      }\n\n      {\n        (\n          canEdit\n          && typeof onArchivedToggle === 'function'\n        )\n        && <MenuItem className=\"roundMenuItem\" onClick={toggleArchiveBlock}>\n          <ListItemIcon>\n            {\n              archived === true\n              ? <UnarchiveIcon />\n              : <ArchiveIcon />\n            }\n          </ListItemIcon>\n          {\n            archived === true\n            ? <Localized id=\"block_menu_unarchive\" />\n            : <Localized id=\"block_menu_archive\" />\n          }\n        </MenuItem>\n      }\n            \n      {\n        (typeof saveProperty === 'function' || typeof onArchivedToggle === 'function')\n        && <Divider style={{ opacity: 0.2, marginTop: '8px', marginBottom: '8px' }} />\n      }\n\n      {\n        (typeof _id === 'string' && _id !== '')\n        && <>\n          <MenuItem component={Link} to={`/${_id}/view`} className=\"roundMenuItem\" style={{ marginTop: '8px' }}>\n            <ListItemIcon>\n              <EditIcon />\n            </ListItemIcon>\n            <Localized id=\"view_block\" />\n          </MenuItem>\n\n          {\n            canEdit\n            && <MenuItem component={Link} to={`/${_id}/edit`} className=\"roundMenuItem\">\n              <ListItemIcon>\n                <ViewIcon />\n              </ListItemIcon>\n              <Localized id=\"edit_block\" />\n            </MenuItem>\n          }\n\n          <Divider style={{opacity: 0.2, marginTop:'8px', marginBottom:'8px' }} />\n        </>\n      }\n\n      {/*\n      <ListItem sx={{ paddingTop: '0', paddingBottom: '0' }}>\n        <ListItemText\n          primary={<Localized id=\"block_menu_info_created\" />}\n          secondary={(metadata.created || '').replace(/[TZ]/g, ' ')}\n        />\n      </ListItem>\n      */}\n      <ListItem sx={{ paddingTop: '0', paddingBottom: '0' }}>\n        <ListItemText\n          primary={<span><Localized id=\"block_menu_info_modified\" /></span>}\n          secondary={<span>{(metadata.modified || '').replace(/[TZ]/g, ' ')}</span>}\n        />\n      </ListItem>\n      <ListItem sx={{ paddingTop: '0', paddingBottom: '0' }}>\n        <ListItemText\n          primary={<span><Localized id=\"block_menu_info_id\" /></span>}\n          secondary={<span>{_id}</span>}\n        />\n      </ListItem>\n\n    </div>)}\n  </PopoverMenu>\n}\n\nexport default withLocalization(BlockMenu)\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { archiveBlocks_Mutation, unarchiveBlocks_Mutation } from '../graphql/mutations.js'\n\nfunction useArchiveBlock() {\n  const apollo_client = useApolloClient()\n\n  const handleArchiveBlock = useCallback(({ _id, archive }) => {\n    return apollo_client.mutate({\n      mutation: archive ? archiveBlocks_Mutation : unarchiveBlocks_Mutation,\n      variables: { ids: [_id] }\n    })\n  }, [ apollo_client ])\n\n  return handleArchiveBlock\n}\n\nexport function useArchiveBlocks() {\n  const apollo_client = useApolloClient()\n\n  const handleArchiveBlocks = useCallback(({ ids, archive }) => {\n    return apollo_client.mutate({\n      mutation: archive ? archiveBlocks_Mutation : unarchiveBlocks_Mutation,\n      variables: { ids }\n    })\n  }, [apollo_client])\n\n  return handleArchiveBlocks\n}\n\nexport default useArchiveBlock\n","import { useCallback } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\n\nfunction useMutation() {\n  const apollo_client = useApolloClient()\n\n  const handleMutation = useCallback(option => {\n    return new Promise((resolve,reject) => {\n      apollo_client.mutate(option)\n        .then(({ data }) => {\n          if (typeof data.error === 'string') {\n            reject(data.error)\n          } else {\n            resolve(data)\n          }\n        })\n        .catch(reject)\n    })\n  }, [ apollo_client ])\n\n  return handleMutation\n}\n\nexport default useMutation\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__3mObx\",\"headerBar\":\"Header_headerBar__2YU41\",\"notificationBanner\":\"Header_notificationBanner__104SP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"reactionButton\":\"ReactionButton_reactionButton__iHGkG\",\"selected\":\"ReactionButton_selected___YxTx\",\"emoji\":\"ReactionButton_emoji__3d99A\"};","import React from 'react'\nimport {\n  Localized as LocalizedOriginal,\n  // withLocalization,\n} from '@fluent/react'\nimport { negotiateLanguages } from '@fluent/langneg'\n\nimport { FluentContext } from '../../node_modules/@fluent/react/esm/context.js'\nimport fluentBy from './fluentBy.js'\n\nconst Localized = props => (\n  <LocalizedOriginal\n    key={props.id}\n    {...props}\n    elems={{\n      br: <br />,\n      ...props.elems,\n    }}\n  >\n    <React.Fragment>{props.children}</React.Fragment>\n  </LocalizedOriginal>\n)\n\n// A custom withLocalization to have an empty fallback.\n// It is nearly identical to the original.\nfunction withLocalization(Inner) {\n  function WithLocalization(props) {\n    const l10n = React.useContext(FluentContext)\n\n    const getString = (id, args, fallback) => l10n.getString(id, args, fallback || '')\n\n    const fluentByObject = (object, fallback) => {\n      if (!(!!fallback)) {\n        fallback = null\n      }\n\n      if (!!object) {\n        const globalSupportedLocales = l10n.supportedLocales || []\n        const thisSupportedLocales = Object.keys(object).filter(locale => globalSupportedLocales.includes(locale))\n\n        const currentLocales = negotiateLanguages(\n          l10n.userLocales,\n          thisSupportedLocales,\n          { defaultLocale: l10n.defaultLocale }\n        )\n\n        for (const locale of currentLocales) {\n          if (!!object[locale]) {\n            return object[locale]\n          }\n        }\n\n        return fallback\n      }\n\n      return fallback\n    }\n\n    return React.createElement(Inner, { fluentByObject, getString, ...props })\n  }\n  return WithLocalization\n}\n\n\nfunction translateBlock (block, userLocales, fallback) {\n\n  const properties = block.properties || {}\n  \n  let locale = properties.locale || 'en'\n  let text = properties.text || fallback || ''\n\n  if (!userLocales || !Array.isArray(userLocales)) {\n    userLocales = [locale]\n  }\n    \n  let translations = properties.translations || []\n  if (Array.isArray(translations)) {\n    translations = [\n      {\n        locale,\n        text,\n      },\n      ...translations,\n    ]\n\n    const correct_translations = fluentBy.fluentByArray(translations, userLocales, 'locale')\n    if (correct_translations.length > 0) {\n      text = correct_translations[0].text\n    }\n  }\n\n  return text\n}\n\nfunction useLocalization() {\n  const l10n = React.useContext(FluentContext)\n\n  const getString = (id, args, fallback) => l10n.getString(id, args, fallback || ' ')\n  const fluentByAny = (any = [], fallback = '') => fluentBy.fluentByAny(any, l10n.userLocales, fallback)\n\n  return {\n    ...l10n,\n    userLocales: l10n.userLocales || [],\n    getString,\n    fluentByAny,\n    translateBlock,\n  }\n}\n\nexport {\n  negotiateLanguages,\n  withLocalization,\n  Localized,\n  Localized as default,\n  useLocalization,\n}\n\n/*\n\nimport { Localized, withLocalization } from '../Localized/'\n\n<Localized id=\"translation_id\" />\nexport default withLocalization(componentName)\n\n\nimport Localized from '../Localized/'\n<Localized id=\"translation_id\" />\n\nimport { withLocalization } from '@fluent/react'\nexport default withLocalization(componentName)\n\n*/\n","import React, { useEffect, useState } from 'react'\n\n// https://projectfluent.org/play/\n\n// import { LocalizationProvider, Localized } from '@fluent/react' // '@fluent/react/compat'\nimport { ReactLocalization, LocalizationProvider } from '@fluent/react'\nimport { FluentBundle, FluentResource } from '@fluent/bundle'\nimport { negotiateLanguages } from '@fluent/langneg'\n\n\nexport const locales = {\n  de: 'Deutsch (German)',\n  en: 'English',\n  it: 'Italiano (Italian)',\n  se: 'Davvisámegiella (Northern Sámi)',\n  lt: 'Lietuviškai (Lithuanian)',\n\n  fr: 'Français (French)',\n  es: 'Español (Spanish)',\n  nl: 'Dutch (Nederlands)',\n  // pt: 'Português (Portuguese)',\n\n  // pl: 'Polska (Polish)',\n  // ru: 'Pусский (Russian)',\n}\n\nconst _supportedLocales_ = Object.keys(locales)\nconst _defaultLocale_ = 'en'\n\n\nasync function fetchMessages(locale) {\n  const path = await import('../locales/' + locale + '.ftl')\n\n  const response = await fetch(path.default)\n  const messages = await response.text()\n\n  return { [locale]: new FluentResource(messages) }\n}\n\nfunction getDefaultBundles() {\n  const bundle = new FluentBundle('')\n  bundle.addResource(new FluentResource(''))\n  return new ReactLocalization([bundle])\n}\n\nasync function createMessagesGenerator(currentLocales) {\n  const fetched = await Promise.all(\n    currentLocales.map(fetchMessages)\n  )\n  const messages = fetched.reduce(\n    (obj, cur) => Object.assign(obj, cur)\n  )\n\n  return function* generateBundles() {\n    for (const locale of currentLocales) {\n      const bundle = new FluentBundle(locale)\n      bundle.addResource(messages[locale])\n      yield bundle\n    }\n  }\n}\n\nexport function AppLocalizationProvider({ userLocales, children, onLocaleChange }) {\n  const [bundles, setBundles] = useState(getDefaultBundles())\n\n  useEffect(() => {\n    async function loadBundles() {\n      const currentLocales = negotiateLanguages(\n        userLocales,\n        _supportedLocales_,\n        { defaultLocale: _defaultLocale_ }\n      )\n\n      if (!!onLocaleChange) {\n        onLocaleChange(currentLocales)\n      }\n\n      const generateBundles = await createMessagesGenerator(currentLocales)\n\n      const new_bundles = new ReactLocalization(generateBundles())\n      new_bundles.userLocales = userLocales\n      new_bundles.defaultLocale = _defaultLocale_\n      new_bundles.supportedLocales = _supportedLocales_\n      setBundles(new_bundles)\n    }\n    loadBundles()\n  }, [userLocales, onLocaleChange])\n\n  if (!bundles) {\n    // Show a loader.\n    return <div>Loading texts…</div>\n  }\n\n  return <LocalizationProvider l10n={bundles}>\n    {children}\n  </LocalizationProvider>\n}\n\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"App_app__3hbGO\",\"isStartpage\":\"App_isStartpage__1Q6rs\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"Sidebar_main__1MCX5\",\"open\":\"Sidebar_open__gnBQb\"};","const { negotiateLanguages } = require('@fluent/langneg')\n\nfunction fluentByObject(object = {}, userLocales = ['en']){\n  const supportedLocales = Object.keys(object)\n\n  if (supportedLocales.length === 0) {\n    return null\n  }\n\n  const lookupedLocale = negotiateLanguages(\n    userLocales,\n    supportedLocales,\n    {\n      defaultLocale: supportedLocales[0],\n      strategy: 'lookup',\n    }\n  )\n\n  if (lookupedLocale.length === 0) {\n    return null\n  }\n\n  return object[lookupedLocale[0]]\n}\n\nfunction fluentByArray(array = [], userLocales = ['en'], key = 'locale') {\n  const supportedLocales = array.map(item => item[key]).filter(Boolean)\n\n  if (supportedLocales.length === 0) {\n    return null\n  }\n\n  const lookupedLocale = negotiateLanguages(\n    userLocales,\n    supportedLocales,\n    {\n      defaultLocale: supportedLocales[0],\n      strategy: 'lookup',\n    }\n  )\n\n  if (lookupedLocale.length === 0) {\n    return null\n  }\n\n  return array.filter(item => item[key] === lookupedLocale[0])\n}\n\nfunction fluentByAny(any = '', userLocales = ['en'], fallback = '') {\n  if (Array.isArray(any)) {\n    const result = fluentByArray(any, userLocales)\n    if (Array.isArray(result) && result.length > 0) {\n      any = result[0].value\n    }\n  } else if (typeof any === 'object') {\n    any = fluentByObject(any, userLocales)\n  }\n  if (typeof any !== 'string') {\n    any = fallback\n  }\n  return any\n}\n\nmodule.exports = {\n  fluentByObject,\n  fluentByArray,\n  fluentByAny,\n}\n","import { useState, useRef, useEffect, useCallback } from 'react'\n\nimport {\n  Fade,\n  Popper,\n} from '@mui/material'\n\nconst randomString = () => (Math.random() + 1).toString(36).substring(7)\n\nfunction Popover ({\n  trigger,\n  children = () => {},\n  onToogle = () => {},\n  setOpenBlockMenuRef,\n}) {\n  const anchorRef = useRef(null)\n  const [open, setOpen] = useState(false)\n\n  const setOpenExternal = useCallback((newOpen) => {\n    setOpen(newOpen)\n  }, [ setOpen ])\n\n  useEffect(() => {\n    if (!!setOpenBlockMenuRef) {\n      setOpenBlockMenuRef.current = setOpenExternal\n    }\n  }, [ setOpenExternal, setOpenBlockMenuRef ])\n\n  const handlePopoverToggleClick = () => {\n    setOpen((prevOpen) => {\n      onToogle(!prevOpen)\n      return !prevOpen\n    })\n  }\n\n  const closePopover = () => {\n    onToogle(false)\n    setOpen(false)\n  }\n\n  const id = open ? 'popover-'+randomString() : undefined\n\n  return <>\n\n    {trigger(\n      {\n        ref: anchorRef,\n        'aria-describedby': id,\n        onClick: handlePopoverToggleClick,\n        style: {\n          pointerEvents: open ? 'none' : 'all',\n        },\n      }, {\n        isOpen: open,\n      }\n    )}\n\n    <div\n      onClick={closePopover}\n      style={{\n        display: (open ? 'block' : 'none'),\n        position: 'fixed',\n        top: 0,\n        right: 0,\n        bottom: 0,\n        left: 0,\n        zIndex: 1299,\n        cursor: 'pointer',\n      }}\n    />\n\n    <Popper\n      id={id}\n      open={open}\n      anchorEl={anchorRef.current}\n      transition\n      placement=\"bottom-start\"\n      disablePortal={false}\n      modifiers={[\n        {\n          name: 'flip',\n          enabled: true,\n          options: {\n            altBoundary: true,\n            rootBoundary: 'viewport',\n            padding: 8,\n          },\n        },\n      ]}\n      style={{\n        zIndex: 1300,\n      }}\n    >\n      {({ TransitionProps }) => (\n        <Fade {...TransitionProps}>\n          <div>\n          {\n            !!children && typeof children === 'function'\n            ? children({\n              open,\n              style: {\n                transformOrigin: 'top left',\n              },\n              closePopover,\n            })\n            : null\n          }\n          </div>\n        </Fade>\n      )}\n    </Popper>\n\n  </>\n}\n\nexport default Popover\n","\nimport {\n  InsertDriveFileSharp as PageIcon,\n  LinkSharp as RedirectIcon,\n  PersonSharp as PersonIcon, // Face\n  Crop75Sharp as ButtonIcon,\n  NotesSharp as TextIcon,\n  Remove as DividerIcon,\n  CodeSharp as CodeIcon,\n  CheckBoxSharp as CheckboxIcon,\n  // EditSharp as EditIcon,\n  ImageSharp as ImageIcon,\n  WebStoriesSharp as PosterIcon, // WebStories book bookmark ContactPage CropPortrait Layers Note PhotoAlbum Photo ViewCarousel\n  AbcSharp as DefinitionIcon,\n  PublicSharp as WebsiteIcon,\n} from '@mui/icons-material'\n\nimport Twemoji from '../Twemoji.js'\n\nimport { getImageUrl, getBlockColor } from '../../functions.js'\n\nimport classes from './BlockIcon.module.css'\n\nexport default function BlockIcon({\n  block,\n  style = {},\n  className = '',\n  size = 40,\n  ...props\n}) {\n  const type = block?.type || 'page'\n  const properties = block.properties || {}\n\n  let iconComponent = null\n  let isSquareIcon = false\n  const canBeIcon = !('poster image file'.split(' ').includes(type))\n\n  let contentAsPlaintext = block?.computed?.contentAsPlaintext || null\n  const hasContent = typeof contentAsPlaintext === 'string' && contentAsPlaintext.length > 0\n\n  const coverphotoPropertyValue = (\n    type === 'file'\n      ? {\n        type: 'file',\n        fileId: block._id,\n      }\n      : properties?.coverphoto || null\n   )\n  const coverphotoUrl = getImageUrl(coverphotoPropertyValue, { width: size, height: size })\n  const hasCoverphoto = typeof coverphotoUrl === 'string' && coverphotoUrl.length > 1\n\n  if (\n    canBeIcon\n    && properties.hasOwnProperty('icon')\n    && typeof properties.icon === 'object'\n    && properties.icon !== null\n    && !Array.isArray(properties.icon)\n    && properties.icon.hasOwnProperty('type')\n    && typeof properties.icon.type === 'string'\n  ) {\n\n    if (\n      properties.icon.type === 'emoji'\n      && properties.icon.hasOwnProperty('emoji')\n      && typeof properties.icon.emoji === 'string'\n      && properties.icon.emoji.length !== 0\n    ) {\n      iconComponent = <Twemoji\n        {...props}\n        style={style}\n        key={properties.icon.emoji}\n        className={`${classes.icon} ${className}`}\n        emoji={properties.icon.emoji}\n      />\n    }\n\n    if (\n      iconComponent === null\n      && properties.icon.type === 'file'\n      && properties.icon.hasOwnProperty('fileId')\n      && typeof properties.icon.fileId === 'string'\n      && properties.icon.fileId.length !== 0\n    ) {\n      const fileId = properties.icon.fileId\n      iconComponent = <div\n        {...props}\n        className={`${classes.icon} ${isSquareIcon ? classes.square : classes.round} ${className}`}\n        style={{\n          ...style,\n          backgroundImage: `url(${window.domains.storage}download_file/?f=${window.imageFormat || 'jpg'}&w=${size}&h=${size}&id=${encodeURIComponent(fileId)})`\n        }}\n        alt=\"\"\n      />\n    }\n  }\n\n  if (iconComponent === null) {\n    let icon_url = canBeIcon ? getImageUrl(properties.icon, { width: size, height: size }) : null\n\n    if (!icon_url && hasCoverphoto && (!canBeIcon || !hasContent)) {\n      // coverphoto fallback\n      isSquareIcon = true\n      icon_url = coverphotoUrl\n    }\n\n    if (typeof icon_url === 'string' && icon_url.length !== 0) {\n      iconComponent = <div\n        {...props}\n        className={`${classes.icon} ${isSquareIcon ? classes.square : classes.round} ${className}`}\n        style={{\n          ...style,\n          backgroundImage: `url(${icon_url})`,\n          backgroundSize: !canBeIcon ? 'contain' : 'cover',\n        }}\n        alt=\"\"\n      />\n    }\n  }\n\n  if (\n    iconComponent === null\n    && hasContent\n    && !(type === 'poster' || type === 'image')\n  ) {\n    let text = block?.properties?.text || null\n    const hasText = typeof text === 'string' && text.length !== ''\n\n    const {\n      color,\n      contrastingColor,\n    } = getBlockColor(block)\n\n    let lines = []\n\n    if (hasCoverphoto) {\n      lines.push(<div\n        className={classes.coverphoto}\n        // style={{\n        //   backgroundImage: `url(${coverphotoUrl})`,\n        // }}\n      />)\n    }\n\n    if (hasText) {\n      lines.push(<div>{\n        text\n          .replace(/[^\\s]/gm, '█')\n          .replace(/ /gm, '     ')\n      }</div>)\n    }\n\n    if (hasContent) {\n      const maxTextLength = 500\n\n      if (contentAsPlaintext.length > maxTextLength) {\n        contentAsPlaintext = contentAsPlaintext.slice(0, maxTextLength)\n      }\n\n      contentAsPlaintext = contentAsPlaintext\n        .replace(/[^\\s]/gm, '█') // █ ▓ ▒ ░\n        .replace(/ /gm, '     ')\n\n      lines = lines\n        .concat(\n          contentAsPlaintext\n            .split('\\n')\n            .map(line => <div>{line}</div>)\n        )\n    }\n\n    iconComponent = <div\n      {...props}\n      className={`${classes.icon} ${classes.text_document} ${className}`}\n      style={{\n        ...style,\n        background: color,\n        color: contrastingColor,\n      }}\n    >\n      {lines}\n    </div>\n  }\n\n  if (iconComponent === null) {\n    switch (block.type) {\n      case 'button':\n        iconComponent = <ButtonIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'checkbox':\n        iconComponent = <CheckboxIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'divider':\n        iconComponent = <DividerIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'code':\n        iconComponent = <CodeIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'image':\n        iconComponent = <ImageIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'text':\n        iconComponent = <TextIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'person':\n        iconComponent = <PersonIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'redirect':\n        iconComponent = <RedirectIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'website':\n        iconComponent = <WebsiteIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'poster':\n        iconComponent = <PosterIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      case 'definition':\n        iconComponent = <DefinitionIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n        break\n      default:\n        iconComponent = <PageIcon {...props} style={style} className={`${classes.icon} ${className}`} />\n    }\n  }\n\n  return iconComponent\n}\n","import { useState, useCallback, useEffect } from 'react'\n\nfunction MultiButton({ ariaLabel, items, defaultValue, onChange, style = {}, buttonProps = {}, className = '' }) {\n  const [choosen, setChoosen] = useState()\n\n  useEffect(() => setChoosen(defaultValue), [defaultValue, setChoosen])\n\n  const handleClick = useCallback(event => {\n    const newValue = event.target.dataset.value\n    setChoosen(newValue)\n    if (onChange) {\n      onChange(newValue)\n    }\n  }, [setChoosen, onChange])\n\n  return <div\n    aria-label={ariaLabel}\n    className={'buttonRow ' + (className || '')}\n    style={style}\n  >\n    {\n      items.map(item => {\n        const value = item.value\n        const title = item.title\n        const icon = item.icon || null\n        return <button\n          {...buttonProps}\n          key={value}\n          className={`default ${choosen === value ? 'choosen' : ''} ${!!icon ? 'hasIcon' : ''} ${buttonProps?.className || ''}`}\n          onClick={handleClick}\n          data-value={value}\n        >\n          <span style={{ pointerEvents: 'none', display: 'flex', gap: 'var(--basis)' }}>\n            {!!icon ? icon : null}\n            {\n              !!title\n                ? (\n                  typeof title === 'object' // check if it's a component\n                    ? title\n                    : <span style={{verticalAlign: 'middle'}}>{title}</span>\n                )\n                : null\n            }\n          </span>\n        </button>\n      })\n    }\n  </div>\n}\n\nexport default MultiButton\n","import { useCallback } from 'react'\n\nimport { useLocalization } from '../fluent/Localized.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlocksWithContent_Query, checkSlug_Query } from '../graphql/queries'\n\nimport { useSnackbar } from 'notistack'\n\nfunction useLoadPage() {\n  const { getString } = useLocalization()\n\n  const apollo_client = useApolloClient()\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\n\n  const loadBlocks = useCallback(slugOrId => {\n    return new Promise(final_resolve => {\n      if (!slugOrId || slugOrId === '') {\n        final_resolve(null)\n      } else {\n        let preloaded_blocks = []\n        if (\n          typeof window.SERVER_DATA === 'object'\n          && window.SERVER_DATA !== null\n          && !Array.isArray(window.SERVER_DATA)\n        ) {\n          preloaded_blocks = window.SERVER_DATA.preloaded_blocks || []\n        }\n\n        if (!Array.isArray(preloaded_blocks)) {\n          preloaded_blocks = []\n        }\n\n        preloaded_blocks = preloaded_blocks\n          .filter(block => block?._id !== null && (block?._id === slugOrId || block?.properties?.slug === slugOrId))\n\n        if (preloaded_blocks.length > 0) {\n          window.SERVER_DATA = { preloaded_blocks: null }\n          final_resolve(preloaded_blocks)\n        } else {\n          apollo_client.query({\n            query: getBlocksWithContent_Query,\n            variables: {\n              slugs: [slugOrId],\n              ids: [slugOrId].filter(id => id.length === 24), // A very basic check. A mongoid is 24 chars long).But it can still\n            },\n          })\n            .then(({ errors, data }) => {\n              if (Array.isArray(errors)) {\n                final_resolve(null)\n              } else if (Array.isArray(data.blocks) && data.blocks.length > 0) {\n                const loadedBlocks = data.blocks\n                  .filter(block => block?._id !== null)\n\n                  if (loadedBlocks.length > 0) {\n                    final_resolve(loadedBlocks)\n                  } else {\n                    final_resolve(null)\n                  }\n              } else {\n                final_resolve(null)\n              }\n            })\n            .catch(error => {\n              console.error('error', error)\n              final_resolve(null)\n            })\n        }\n      }\n    })\n  }, [apollo_client])\n\n  const loadSlugInfos = useCallback(slug => {\n    return new Promise(final_resolve => {\n      if (!slug || slug === '') {\n        final_resolve(null)\n      } else {\n        apollo_client.query({\n          query: checkSlug_Query,\n          variables: {\n            slug,\n          },\n        })\n          .then(({ errors, data }) => {\n            if (Array.isArray(errors)) {\n              final_resolve(null)\n            } else if (data.block !== null) {\n              final_resolve(data.block)\n            } else {\n              final_resolve(null)\n            }\n          })\n          .catch(error => {\n            console.error('error', error)\n            final_resolve(null)\n          })\n      }\n    })\n  }, [apollo_client])\n\n  const handleLoadPage = useCallback(slugOrId => {\n    return new Promise((final_resolve, final_reject) => {\n      let snackbarKey = null\n\n      if (!slugOrId || slugOrId === '') {\n        final_reject({ code: '404' })\n      } else {\n        const loadingDataPromise = new Promise(async resolve => {\n          let done = false\n\n          if (done === false && typeof slugOrId === 'string' && slugOrId !== '') {\n            const blocks = await loadBlocks(slugOrId)\n            if (Array.isArray(blocks)) {\n              if (blocks.length === 1) {\n                // This gets called for \"/:slug\"\n                // slugOrId is a slug\n                // redirect it accoringly\n                done = true\n                resolve('got-data')\n\n                if (snackbarKey !== null) {\n                  closeSnackbar(snackbarKey)\n                }\n\n                final_resolve(blocks[0])\n              } else if (blocks.length > 1) {\n                done = true\n                resolve('got-error')\n\n                if (snackbarKey !== null) {\n                  closeSnackbar(snackbarKey)\n                }\n\n                final_reject({\n                  code: '300',\n                  blocks,\n                })\n\n                enqueueSnackbar('Error 300: Multiple blocks found..', { // todo: remove me\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 2000,\n                })\n              }\n            }\n          }\n\n          if (\n            done === false\n            && typeof slugOrId === 'string' && slugOrId !== ''\n          ) {\n            const {\n              existsAsSlug = false,\n              existsAsId = false,\n            } = await loadSlugInfos(slugOrId) || {}\n\n            done = true\n            resolve('got-error')\n\n            if (snackbarKey !== null) {\n              closeSnackbar(snackbarKey)\n            }\n\n            if (existsAsId === true || existsAsSlug === true) {\n              // show error page: now permission to view this block\n              final_reject({ code: '403' })\n\n              enqueueSnackbar('Error 403: You are not allowed to view this page.', { // todo: remove me\n                variant: 'error',\n                preventDuplicate: true,\n                autoHideDuration: 2000,\n              })\n            } else {\n              // show error page: the block does not exist\n              final_reject({ code: '404' })\n\n              enqueueSnackbar('Error 404: The page does not exist.', { // todo: remove me\n                variant: 'error',\n                preventDuplicate: true,\n                autoHideDuration: 2000,\n              })\n            }\n          }\n        })\n\n        // Show a loading-info-snackbar if loading the data takes too long.\n        Promise.race([\n          new Promise(resolve => {\n            setTimeout(() => {\n              resolve('show-loading')\n            }, 300)\n          }),\n          loadingDataPromise,\n        ])\n          .then(response => {\n            if (response === 'show-loading') {\n              snackbarKey = enqueueSnackbar(getString('path_editor_status_started_loading'), {\n                persist: true,\n                preventDuplicate: true,\n              })\n            }\n          })\n          .catch(error => console.error)\n      }\n    })\n  }, [\n    loadBlocks,\n    loadSlugInfos,\n    enqueueSnackbar,\n    closeSnackbar,\n    getString,\n  ])\n\n  return handleLoadPage\n}\n\nexport default useLoadPage\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"ViewerAuto_root__1p6KG\"};","\nimport {\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n} from '@mui/material'\n\nimport {\n  InsertDriveFileSharp as PageIcon,\n  LinkSharp as RedirectIcon,\n  PersonSharp as PersonIcon,\n  Crop75Sharp as ButtonIcon,\n  NotesSharp as TextIcon,\n  Remove as DividerIcon,\n  CodeSharp as CodeIcon,\n  CheckBoxSharp as CheckboxIcon,\n  // EditSharp as EditIcon,\n  ImageSharp as ImageIcon,\n  WebStoriesSharp as PosterIcon, // WebStories book bookmark ContactPage CropPortrait Layers Note PhotoAlbum Photo ViewCarousel\n  AbcSharp as DefinitionIcon,\n} from '@mui/icons-material'\n\nimport useUser from '../../hooks/useUser.js'\nimport PopoverMenu from '../PopoverMenu.js'\nimport { Localized } from '../../fluent/Localized.js'\n\nconst blockTypeIcons = {\n  button: <ButtonIcon />,\n  text: <TextIcon />,\n  code: <CodeIcon />,\n  divider: <DividerIcon />,\n  checkbox: <CheckboxIcon />,\n  page: <PageIcon />,\n  person: <PersonIcon />,\n  redirect: <RedirectIcon />,\n  image: <ImageIcon />,\n  poster: <PosterIcon />,\n  definition: <DefinitionIcon />,\n}\n\nconst default_types = [\n  'page',\n  'redirect',\n  // 'poster',\n  'definition',\n]\n\nfunction AddMenuContent({ createBlock, types = default_types, close = null }) {\n  if (!types || !Array.isArray(types)) {\n    types = default_types\n  }\n\n  return <>\n    {\n      types\n        .map(type => (\n          <MenuItem className=\"roundMenuItem\" key={type} onClick={() => createBlock({ type, close })}>\n            <ListItemIcon>\n              {blockTypeIcons[type]}\n            </ListItemIcon>\n            <ListItemText>\n              <Localized id={'block_menu_type_label_'+type} />\n            </ListItemText>\n          </MenuItem>\n        ))\n    }\n  </>\n}\n\nfunction AddMenu ({ trigger, createBlock, types }) {\n  const { loggedIn } = useUser()\n\n  if (loggedIn) {\n    return <PopoverMenu trigger={trigger}>\n      {\n        ({ close }) => <>\n          <div style={{ marginTop: '8px' }}></div>\n          <AddMenuContent createBlock={createBlock} types={types} close={close} />\n        </>\n      }\n    </PopoverMenu>\n  }\n\n  return null\n}\n\nexport {\n  AddMenuContent,\n  AddMenu as default,\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"icon\":\"BlockIcon_icon__1wJFr\",\"square\":\"BlockIcon_square__11KYn\",\"round\":\"BlockIcon_round__1sKzE\",\"text_document\":\"BlockIcon_text_document__3oFZk\",\"coverphoto\":\"BlockIcon_coverphoto__3c0ul\"};","var map = {\n\t\"./de.ftl\": [\n\t\t377,\n\t\t9\n\t],\n\t\"./en.ftl\": [\n\t\t378,\n\t\t10\n\t],\n\t\"./es.ftl\": [\n\t\t379,\n\t\t11\n\t],\n\t\"./fr.ftl\": [\n\t\t380,\n\t\t12\n\t],\n\t\"./it.ftl\": [\n\t\t381,\n\t\t13\n\t],\n\t\"./lt.ftl\": [\n\t\t382,\n\t\t14\n\t],\n\t\"./nl.ftl\": [\n\t\t383,\n\t\t15\n\t],\n\t\"./se.ftl\": [\n\t\t384,\n\t\t16\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 352;\nmodule.exports = webpackAsyncContext;","import { useState, useCallback, useEffect, useRef } from 'react'\n\n// import mexp from 'math-expression-evaluator'\nimport { evaluate as mathjs_evaluate } from 'mathjs'\n\nimport { useHotkeys } from 'react-hotkeys-hook'\n\nimport {\n  Modal\n} from '@material-ui/core'\n\nimport {\n  // Search as SearchIcon,\n\n  InsertDriveFileSharp as PageIcon,\n  // AutoAwesomeSharp as ActionIcon,\n  LinkSharp as RedirectIcon,\n  PersonSharp as PersonIcon,\n  // Crop75Sharp as ButtonIcon,\n  // TitleSharp as HeadlineIcon,\n  // NotesSharp as TextIcon,\n  // Remove as DividerIcon,\n  AbcSharp as DefinitionIcon,\n\n  PublicSharp as WebsiteIcon,\n\n  CloseSharp as CloseIcon,\n\n  MoreVertSharp as BlockMenuIcon,\n\n  ArchiveSharp as ArchiveIcon,\n} from '@mui/icons-material'\n\nimport classes from './SearchBox.module.css'\nimport BlockMenu from './edit/BlockMenu.js'\nimport ViewerAuto from './view/ViewerAuto.js'\nimport MultiButton from './MultiButton.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { search_Query } from '../graphql/queries.js'\nimport { saveBlock_Mutation } from '../graphql/mutations.js'\n\nimport { Localized, useLocalization } from '../fluent/Localized.js'\n\nconst blockTypeIcons = {\n  page: <PageIcon />,\n  person: <PersonIcon />,\n  redirect: <RedirectIcon />,\n  website: <WebsiteIcon />,\n  definition: <DefinitionIcon />,\n}\n\nconst possibleTypes = [\n  'everything',\n  'page',\n  'redirect',\n  'person',\n  'website',\n  'definition'\n]\n\nfunction SearchBox() {\n\n  const { getString } = useLocalization()\n\n  const apollo_client = useApolloClient()\n\n  const [open, setOpen] = useState(false)\n  const [results, setResults] = useState([])\n  const [errors, setErrors] = useState([])\n\n  const queryTextRef = useRef('')\n  const [type, setType] = useState(possibleTypes[0])\n  const [showArchived, setShowArchived] = useState(false)\n\n  const [mathResult, setMathResult] = useState('')\n\n  useHotkeys('cmd+k, ctrl+k', event => {\n    event.preventDefault()\n    setOpen(true)\n  }, {\n    // enableOnTags: ['INPUT', 'SELECT', 'TEXTAREA'],\n    // enableOnContentEditable: true,\n  })\n\n  useHotkeys('esc', event => {\n    event.preventDefault()\n    setOpen(false)\n  }, {\n    enableOnTags: ['INPUT', 'SELECT', 'TEXTAREA'],\n    enableOnContentEditable: true,\n  })\n\n  // useEffect(() => {\n  //   // TODO: load last searchs from cache / or load them from server\n  //   // only save a search when clicked on the item (needs function/hook to the click event)\n  // }, [])\n\n  const blurInpurOnEnter = useCallback(event => {\n    if (event.key === 'Enter') {\n      if (!!event.target) {\n        event.target.blur()\n      }\n    }\n  }, [])\n\n  useEffect(() => {\n    const open_search = () => setOpen(true)\n    const close_search = () => setOpen(false)\n\n    window.addEventListener('open_search', open_search)\n    window.addEventListener('close_search', close_search)\n    return () => {\n      window.removeEventListener('open_search', open_search)\n      window.removeEventListener('close_search', close_search)\n    }\n  }, [setOpen])\n\n  const perform_search = useCallback(async (query_text, type, showArchived) => {\n\n    if (query_text.length > 0) {\n      let newMathResult = ''\n      try {\n        newMathResult = mathjs_evaluate(query_text)\n      } catch (error) {\n        // console.error('math-error', error)\n      }\n      newMathResult = String(newMathResult)\n      if (newMathResult.length > 0) {\n        setMathResult(`${query_text} = ${newMathResult}`)\n      } else {\n        setMathResult('')\n      }\n    } else {\n      setMathResult('')\n    }\n\n    if (query_text.length === 0) {\n      setResults([])\n      setErrors([])\n    } else if (query_text.length < 2) {\n      setResults([])\n      setErrors(['Type more than one characters.'])\n    } else {\n      const variables = {\n        query: query_text,\n        archived: showArchived,\n      }\n      if (\n        typeof type === 'string'\n        && type.length > 0\n        && possibleTypes.includes(type)\n        && type !== 'everything'\n      ) {\n        variables.types = [type]\n      } else {\n        variables.types = possibleTypes.filter(t => t !== 'everything')\n      }\n\n      try {\n        const { errors, data } = await apollo_client.query({\n          query: search_Query,\n          variables,\n        })\n        \n        if (queryTextRef.current === query_text) {\n          if (Array.isArray(errors) && errors.length > 0) {\n            throw errors\n          } else if (Array.isArray(data.blocks)) {\n            const blocks = data.blocks\n              .filter(block => typeof block === 'object' && block !== null && !Array.isArray(block))\n          \n            setResults(blocks)\n            if (blocks.length === 0) {\n              setErrors(['No results found.'])\n            } else {\n              setErrors([])\n            }\n          } else {\n            setErrors(['Unknown error while loading blocks.'])\n          }\n        }\n      } catch (error) {\n        console.error('error', error)\n        if (queryTextRef.current === query_text) {\n          setResults([])\n        }\n      }\n    }\n  }, [apollo_client, setResults, setErrors, setMathResult])\n\n  const search = useCallback(async event => {\n    let query_text = event.target.value || ''\n    if (typeof query_text !== 'string') {\n      query_text = ''\n    }\n    queryTextRef.current = query_text\n\n    perform_search(query_text, type, showArchived)\n  }, [perform_search, type, showArchived])\n\n  useEffect(() => {\n    perform_search(queryTextRef.current, type, showArchived)\n  }, [perform_search, type, showArchived])\n\n  const handleClose = useCallback(() => {\n    setOpen(false)\n  }, [setOpen])\n\n  const handleResultClick = useCallback(async (block, index) => {\n    setOpen(false)\n\n    const newBlock = {\n      type: 'search',\n      properties: {\n        text: queryTextRef.current,\n        // filter: {\n        //   type,\n        //   showArchived,\n        // },\n        chosenResult: {\n          index,\n          blockId: block._id,\n        }\n      }\n    }\n\n    try {\n      await apollo_client.mutate({\n        mutation: saveBlock_Mutation,\n        variables: {\n          block: newBlock,\n        },\n      })\n    } catch (error) {\n      console.error('error', error)\n    }\n  }, [setOpen, apollo_client]) // showArchived, type\n\n  return <Modal\n    open={open}\n    onClose={handleClose}\n    hideBackdrop={true}\n    BackdropProps={{\n      sx: {\n        color: '#fff',\n        zIndex: (theme) => theme.zIndex.drawer + 1,\n      }\n    }}\n  >\n    <>\n      <div className={classes.backdrop} onClick={handleClose}></div>\n\n      <div className={classes.dialog}>\n        <div\n          style={{\n            position: 'sticky',\n            top: 0,\n            zIndex: 2,\n            background: 'var(--background)',\n          }}\n        >\n          <div style={{\n            display: 'flex',\n            alignItems: 'center'\n          }}>\n            <input\n              autoFocus\n              onFocus={e => e.currentTarget.select()} // select the text\n\n              type=\"search\"\n              placeholder={getString('search')}\n              className={classes.searchInput}\n              defaultValue={queryTextRef.current}\n              onChange={search}\n              onKeyDown={blurInpurOnEnter}\n              style={{\n                // borderBottom: (results.length > 0 || errors.length > 0)\n                //   ? 'var(--basis) solid rgba(var(--on-background-rgb), var(--alpha))'\n                //   : '',\n                // boxShadow: (results.length > 0 || errors.length > 0)\n                //   ? '0 var(--basis) rgba(var(--on-background-rgb), var(--alpha))'\n                //   : '',\n              }}\n            />\n            <button\n              className=\"hasIcon\"\n              onClick={handleClose}\n              style={{\n                margin: '0 var(--basis_x2) 0 calc(-4 * var(--basis))'\n              }}\n            >\n              <CloseIcon className=\"icon\" />\n            </button>\n          </div>\n\n          <MultiButton\n            defaultValue={type}\n            items={\n              possibleTypes.map(thisType => ({\n                value: thisType,\n                // title: thisType,\n                title: <Localized id={'block_menu_type_label_plural_' + thisType} />,\n                icon: <span className=\"icon\">\n                  {blockTypeIcons[thisType]}\n                </span>\n              }))\n            }\n            onChange={setType}\n            className={classes.filters}\n            // buttonStyle={{\n            //   flexGrow: 1,\n            //   justifyContent: 'center',\n            // }}\n          />\n\n          {/* <div className={classes.filters}>\n            {possibleTypes.map(thisType =>\n              <button\n                key={thisType}\n                onClick={() => setType(thisType)}\n                className={type === thisType ? 'default hasIcon' : ' hasIcon'}\n              >\n                <span className=\"icon\">\n                  {blockTypeIcons[thisType]}\n                </span>\n                <Localized id={'block_menu_type_label_plural_' + thisType} />\n              </button>\n            )}\n          </div> */}\n        </div>\n\n        <div\n          className={classes.searchResults}\n          style={{\n            display: (\n              (typeof queryTextRef.current === 'string' && queryTextRef.current.length > 1)\n              || (Array.isArray(errors) && errors.length > 0)\n              || (Array.isArray(results) && results.length > 0)\n              ? 'block'\n              : 'none'\n            )\n          }}\n        >\n          {\n            typeof mathResult === 'string' && mathResult.length > 0\n              ? <div className={classes.mathResult}>\n                {mathResult}\n              </div>\n              : null\n          }\n\n          {\n            typeof queryTextRef.current === 'string' && queryTextRef.current.length > 1\n              ? <button\n                onClick={() => setShowArchived(!showArchived)}\n                className={showArchived === true ? 'default hasIcon' : ' hasIcon'}\n                style={{ margin: '0' }}\n              >\n                <span className=\"icon\">\n                  <ArchiveIcon />\n                </span>\n                {\n                  showArchived === true\n                    ? <Localized id=\"filter_menu_showing_archiv\" />\n                    : <Localized id=\"filter_menu_show_archiv\" />\n                }\n              </button>\n            : null\n          }\n\n          {\n            (typeof queryTextRef.current === 'string' && queryTextRef.current.length > 1)\n            && (\n              (Array.isArray(errors) && errors.length > 0)\n              || (Array.isArray(results) && results.length > 0)\n            )\n              ? <hr />\n              : null\n          }\n\n          {\n            Array.isArray(errors) && errors.length > 0\n              ? <div className={classes.searchErrors}>\n                {errors.map(error => <p key={error}>{error}</p>)}\n              </div>\n              : null\n          }\n\n          {\n            Array.isArray(results) && results.length > 0\n              ? <div>\n                {\n                  results\n                    .map((block, index) => <div\n                      key={block._id}\n                      className={classes.blockRow}\n                      style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        flexDirection: 'row',\n                      }}\n                    >\n                      <ViewerAuto\n                        size=\"card\"\n                        block={block}\n                        onClick={() => handleResultClick(block, index)}\n                      />\n\n                      <div className={classes.blockRowActions}>\n                        <BlockMenu\n                          block={block}\n                          trigger={props => (\n                            <button\n                              {...props}\n                              className=\"text hasIcon\"\n                              style={{\n                                margin: '0',\n                                padding: 'var(--basis) 0',\n                                flexShrink: '0',\n                              }}\n                            >\n                              <BlockMenuIcon className=\"icon\" />\n                            </button>\n                          )}\n                        />\n                      </div>\n                    </div>)\n                }\n              </div>\n              : null\n          }\n        </div>\n      </div>\n    </>\n  </Modal>\n}\n\nexport default SearchBox\n","import React, { useCallback, useEffect, useRef, useState } from 'react'\n\nimport { Helmet } from 'react-helmet'\n\nimport { Localized, useLocalization } from '../fluent/Localized.js'\n\nimport Header from '../components/Header.js'\nimport PopoverMenu from '../components/PopoverMenu.js'\nimport BlockMenu from '../components/edit/BlockMenu.js'\nimport ViewerAuto from '../components/view/ViewerAuto.js'\nimport useLoadBlocks from '../hooks/useLoadBlocks.js'\nimport useUser from '../hooks/useUser.js'\nimport useSaveBlock from '../hooks/useSaveBlock.js'\n\nimport { useNavigate } from 'react-router-dom'\n\nimport classes from './List.module.css'\n\nimport {\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  // Divider,\n} from '@mui/material'\n\nimport {\n  Login as LoginIcon,\n  Search as SearchIcon,\n\n  MoreVertSharp as BlockMenuIcon,\n  // ArrowDropDownSharp as ExpandLessIcon,\n  // ArrowRightSharp as ExpandMoreIcon,\n\n  // Replay as RequeryIcon,\n  Add as AddIcon,\n  FilterList as FilterListIcon,\n  // Archive as ArchiveIcon,\n\n  InsertDriveFileSharp as PageIcon,\n  LinkSharp as RedirectIcon,\n  PersonSharp as PersonIcon,\n  // Crop75Sharp as ButtonIcon,\n  // NotesSharp as TextIcon,\n  ImageSharp as ImageIcon,\n  // CodeSharp as CodeIcon,\n  // Remove as DividerIcon,\n  // CheckBox as CheckboxIcon,\n  WebStoriesSharp as PosterIcon, // WebStories book bookmark ContactPage CropPortrait Layers Note PhotoAlbum Photo ViewCarousel\n  AbcSharp as DefinitionIcon,\n  PublicSharp as WebsiteIcon,\n\n  Visibility as ViewerIcon,\n  Edit as EditorIcon,\n  AdminPanelSettings as OwnerIcon,\n  // Lock as NoAccessIcon,\n\n  ArrowUpward as ArrowUpwardIcon,\n  ArrowDownward as ArrowDownwardIcon,\n  // Segment as GroupingIcon,\n\n  ViewStreamSharp as ListLayoutIcon, // ViewStreamSharp ViewListSharp ViewHeadlineSharp\n  GridViewSharp as GridLayoutIcon, // GridViewSharp ViewCompactSharp\n} from '@mui/icons-material'\n\nconst typeIcons = {\n  // button: <ButtonIcon />,\n  // text: <TextIcon />,\n  image: <ImageIcon />,\n  // checkbox: <CheckboxIcon />,\n  // code: <CodeIcon />,\n  // divider: <DividerIcon />,\n  redirect: <RedirectIcon />,\n  page: <PageIcon />,\n  person: <PersonIcon />,\n  poster: <PosterIcon />,\n  definition: <DefinitionIcon />,\n  website: <WebsiteIcon />,\n  file: <ImageIcon />,\n}\nconst possibleTypes = [\n  // 'button',\n  // 'text',\n  'image',\n  // 'checkbox',\n  // 'code',\n  // 'divider',\n  'redirect',\n  'page',\n  'person',\n  'poster',\n  'definition',\n  'website',\n  'file',\n]\n\nconst roleIcons = {\n  owner: <OwnerIcon />,\n  editor: <EditorIcon />,\n  viewer: <ViewerIcon />,\n  // no_access: <NoAccessIcon />,\n}\n\nconst sortableFieldsInfos = {\n  'metadate.modified': {\n    type: 'date',\n  },\n  'properties.text': {\n    type: 'text',\n  },\n  'properties.locale': {\n    type: 'text',\n  },\n}\n\n\nconst defaultSorting = {\n  path: 'metadate.modified',\n  asc: false,\n}\nconst defaultLayout = 'list'\nexport function ListView({\n  preselectedTypes = possibleTypes,\n  preselectedSorting = defaultSorting,\n  preselectedLayout = defaultLayout,\n}) {\n\n  const filteredTypes = preselectedTypes.filter(type => possibleTypes.includes(type))\n  if (filteredTypes.length === 0) {\n    preselectedTypes = possibleTypes\n  } else {\n    preselectedTypes = filteredTypes\n  }\n\n  const { getString, translateBlock, userLocales } = useLocalization()\n  const [loadedBlocks, setLoadedBlocks] = useState([])\n  const [sortedBlockGroups, setSortedBlockGroups] = useState([])\n  const loadBlocks = useLoadBlocks()\n  const [sorting, setSorting] = useState(preselectedSorting)\n  const [layout, setLayout] = useState(preselectedLayout) // 'grid' or 'list'\n  const isGrid = layout === 'grid'\n\n  const filters = useRef({\n    type: preselectedTypes[0],\n    roles: [],\n  })\n  const changeLayout = useCallback(() => {\n    setLayout(currentLayout => currentLayout === 'grid' ? 'list' : 'grid')\n  }, [])\n\n  const { loggedIn } = useUser()\n  const [possibleRoles, setPossibleRoles] = useState([])\n  useEffect(() => {\n    if (loggedIn) {\n      setPossibleRoles(['owner', 'editor', 'viewer'])\n      filters.current.roles = ['owner', 'editor', 'viewer']\n    } else {\n      setPossibleRoles(['viewer'])\n      filters.current.roles = ['viewer']\n    }\n  }, [loggedIn])\n\n  const getFirstLetter = text => {\n    // todo: should i group emojis and special characters in groups or should each letter/emoji stay as their own group?\n\n    const matches = /^(\\u00a9|\\u00ae|[\\u2000-\\u3300]|\\ud83c[\\ud000-\\udfff]|\\ud83d[\\ud000-\\udfff]|\\ud83e[\\ud000-\\udfff]|.)/i.exec(text) // source of the emoji part: https://melvingeorge.me/blog/check-if-string-contain-emojis-javascript\n    if (matches) {\n      return matches[0].toUpperCase()\n    }\n    return ''\n  }\n\n  const getText = useCallback(block => {\n    if (!block) {\n      return ''\n    }\n\n    const fallback_text = block?.properties?.text || block?.properties?.slug || ''\n    const text = translateBlock(block, userLocales, fallback_text)\n\n    if (text.toLowerCase().startsWith('volt ')) {\n      return text.slice(5)\n    }\n    return text\n  }, [translateBlock, userLocales])\n\n  const sortableFields = Object.keys(sortableFieldsInfos)\n  const sortBlocks = useCallback((loadedBlocks) => {\n\n    let newSortedBlocks = loadedBlocks\n      .filter(block => !!block)\n      .map(block => {\n        if (!block.hasOwnProperty('properties')) {\n          block.properties = {}\n        }\n\n        let sorting_text = ''\n        let sorting_display_text = ''\n        if (sorting.path === 'metadate.modified') {\n          sorting_text = block?.metadata?.modified || ''\n          sorting_display_text = sorting_text\n        } else if (sorting.path === 'properties.text') {\n          sorting_text = getText(block) || ''\n          sorting_display_text = getFirstLetter(sorting_text)\n        } else if (sorting.path === 'properties.locale') {\n          sorting_text = String(block?.properties?.locale || 'en').toUpperCase()\n          sorting_display_text = sorting_text\n        }\n\n        return {\n          ...block,\n          sorting_text,\n          sorting_display_text,\n        }\n      })\n      .sort((a, b) => {\n        return a.sorting_text.localeCompare(\n          b.sorting_text,\n          undefined,\n          {\n            ignorePunctuation: false,\n            numeric: false,\n          }\n        )\n      })\n\n    if (sorting.asc === false) {\n      newSortedBlocks = newSortedBlocks.reverse()\n    }\n\n    const sortable_field_type = sortableFieldsInfos[sorting.path].type\n    if (sortable_field_type === 'text') {\n\n      const newSortedBlocksWithHeadings = {}\n\n      // add the days between the blocks\n      if (Array.isArray(newSortedBlocks) && newSortedBlocks.length > 0) {\n        let currentHeading = '???'\n        for (let i = -1; i <= newSortedBlocks.length - 2; i += 1) {\n\n        // const this_block_id = newSortedBlocks[i]?._id || ''\n\n        let thisLetter = ''\n        if (i >= 0 && newSortedBlocks.length >= i) {\n          thisLetter = newSortedBlocks[i]?.sorting_display_text || ''\n        }\n\n        let nextLetter = ''\n        if (i + 1 >= 0 && newSortedBlocks.length >= i + 1) {\n          nextLetter = newSortedBlocks[i + 1]?.sorting_display_text || ''\n        }\n\n        if (i <= newSortedBlocks.length - 2 && (i === -1 || thisLetter !== nextLetter)) {\n          if (nextLetter === '') {\n            // undefined\n            currentHeading = '???'\n            // newSortedBlocksWithHeadings.push({\n            //   _id: '???_' + this_block_id,\n            //   type: 'text',\n            //   properties: {\n            //     text: '???',\n            //     text_style: 'h2',\n            //     locale: 'en',\n            //   },\n            //   isSortHeading: true,\n            // })\n          } else {\n            // letter\n            currentHeading = nextLetter\n            // newSortedBlocksWithHeadings.push({\n            //   _id: nextLetter + '_' + this_block_id,\n            //   type: 'text',\n            //   properties: {\n            //     text: nextLetter,\n            //     text_style: 'h2',\n            //     locale: 'en',\n            //   },\n            //   isSortHeading: true,\n            // })\n          }\n        }\n\n          if (!newSortedBlocksWithHeadings.hasOwnProperty(currentHeading)) {\n            newSortedBlocksWithHeadings[currentHeading] = {\n              heading: currentHeading,\n              blocks: [],\n            }\n          }\n\n          newSortedBlocksWithHeadings[currentHeading].blocks.push(newSortedBlocks[i + 1])\n        }\n      }\n\n      setSortedBlockGroups(Object.values(newSortedBlocksWithHeadings))\n    } else if (sortable_field_type === 'date') {\n\n      const newSortedBlocksWithHeadings = {}\n\n      if (Array.isArray(newSortedBlocks) && newSortedBlocks.length > 0) {\n        // add first letter starting blocks between the blocks\n        let currentHeading = '???'\n        for (let i = -1; i <= newSortedBlocks.length - 2; i += 1) {\n\n        // const this_block_id = newSortedBlocks[i]?._id || ''\n\n        let thisDateString = ''\n        if (i >= 0 && newSortedBlocks.length >= i) {\n          thisDateString = (newSortedBlocks[i]?.metadata?.modified || '').slice(0, 10) // the first 10 letters are the date (YYYY-MM-DD)\n        }\n\n        let nextDateString = ''\n        if (i + 1 >= 0 && newSortedBlocks.length >= i + 1) {\n          nextDateString = (newSortedBlocks[i + 1]?.metadata?.modified || '').slice(0, 10) // the first 10 letters are the date (YYYY-MM-DD)\n        }\n\n        if (i <= newSortedBlocks.length - 2 && (i === -1 || thisDateString !== nextDateString)) {\n          if (nextDateString === '') {\n            // undefined\n            currentHeading = '???'\n            // newSortedBlocksWithHeadings.push({\n            //   _id: '???_' + this_block_id,\n            //   type: 'text',\n            //   properties: {\n            //     text: '???',\n            //     text_style: 'h2',\n            //     locale: 'en',\n            //   },\n            //   isSortHeading: true,\n            // })\n          } else {\n            // letter\n            currentHeading = nextDateString\n            // newSortedBlocksWithHeadings.push({\n            //   _id: nextDateString + '_' + this_block_id,\n            //   type: 'text',\n            //   properties: {\n            //     text: nextDateString,\n            //     text_style: 'h2',\n            //     locale: 'en',\n            //   },\n            //   isSortHeading: true,\n            // })\n          }\n        }\n\n          if (!newSortedBlocksWithHeadings.hasOwnProperty(currentHeading)) {\n            newSortedBlocksWithHeadings[currentHeading] = {\n              heading: currentHeading,\n              blocks: [],\n            }\n          }\n\n        newSortedBlocksWithHeadings[currentHeading].blocks.push(newSortedBlocks[i + 1])\n        }\n      }\n\n      setSortedBlockGroups(Object.values(newSortedBlocksWithHeadings))\n    } else {\n      setSortedBlockGroups(newSortedBlocks)\n    }\n  }, [sorting, setSortedBlockGroups, getText])\n  const changeSorting = useCallback(path => {\n    setSorting(oldSorting => ({\n      ...oldSorting,\n      path,\n    }))\n    sortBlocks(loadedBlocks)\n  }, [loadedBlocks, sortBlocks])\n  const toggleSortDirection = useCallback(() => {\n    setSorting(oldSorting => ({\n      ...oldSorting,\n      asc: !oldSorting.asc,\n    }))\n    sortBlocks(loadedBlocks)\n  }, [loadedBlocks, sortBlocks])\n\n  const loadList = useCallback(async () => {\n    const loadedContentBlocks = await loadBlocks({\n      types: [filters.current.type],\n      roles: filters.current.roles,\n      archived: false,\n    })\n    setLoadedBlocks(loadedContentBlocks)\n    sortBlocks(loadedContentBlocks)\n  }, [loadBlocks, setLoadedBlocks, sortBlocks])\n  useEffect(() => {\n    loadList()\n  }, [loadList])\n\n  const setTypeFilter = useCallback(newType => {\n    filters.current.type = newType\n    loadList()\n  }, [loadList])\n\n  const setRoleFilter = useCallback(newRole => {\n    if (filters.current.roles.includes(newRole)) {\n      filters.current.roles = filters.current.roles.filter(role => role !== newRole)\n    } else {\n      filters.current.roles.push(newRole)\n    }\n    loadList()\n  }, [loadList])\n\n  const saveBlock = useSaveBlock()\n  const navigate = useNavigate()\n  const createBlock = useCallback(({ type }) => {\n    if (typeof type === 'string' && type.length > 0) {\n      saveBlock({\n        type,\n      })\n        .then(gottenBlock => {\n          navigate(`/${gottenBlock._id}/edit`)\n        })\n        .catch(error => {\n          console.error(error)\n        })\n    }\n  }, [saveBlock, navigate])\n\n  return <div style={{\n    margin: 'var(--basis_x2) 0',\n  }}>\n\n    <div style={{\n      display: 'flex',\n      gap: 'var(--basis)',\n      flexWrap: 'wrap',\n      justifyItems: 'flex-start',\n    }}>\n\n      <button\n        className={`${layout === 'list' ? 'default' : 'text'} hasIcon`}\n        style={{\n          width: 'auto',\n          margin: '0 calc(-1 * var(--basis)) 0 0',\n          '--borderRadius': (\n            layout === 'list'\n            ? '0'\n            : 'calc(0.3 * var(--body-font-size)) 0 0 calc(0.3 * var(--body-font-size))'\n          ),\n        }}\n        onClick={changeLayout}\n      >\n        <ListLayoutIcon className=\"icon\" />\n      </button>\n      <button\n        className={`${layout === 'grid' ? 'default' : 'text'} hasIcon`}\n        style={{\n          width: 'auto',\n          margin: '0',\n          '--borderRadius': (\n            layout === 'grid'\n            ? '0'\n            : '0 calc(0.3 * var(--body-font-size)) calc(0.3 * var(--body-font-size)) 0'\n          ),\n        }}\n        onClick={changeLayout}\n      >\n        <GridLayoutIcon className=\"icon\" />\n      </button>\n      \n      <button\n        className=\"text hasIcon\"\n        style={{\n          width: 'auto',\n          margin: '0 calc(-1 * var(--basis)) 0 0',\n          justifyContent: 'flex-start',\n          alignItems: 'center',\n          paddingInlineEnd: 'var(--basis_x0_5)',\n          '--borderRadius': 'calc(0.3 * var(--body-font-size)) 0 0 calc(0.3 * var(--body-font-size))',\n        }}\n        onClick={toggleSortDirection}\n      >\n        {\n          sorting.asc === true\n            ? <ArrowUpwardIcon className=\"icon\" />\n            : <ArrowDownwardIcon className=\"icon\" />\n        }\n      </button>\n\n      <PopoverMenu\n        trigger={triggerProps => (\n          <button\n            {...triggerProps}\n            className=\"text\"\n            style={{\n              width: 'auto',\n              display: 'flex',\n              margin: '0',\n              justifyContent: 'flex-start',\n              alignItems: 'center',\n              paddingInlineStart: 'var(--basis_x0_5)',\n              '--borderRadius': '0 calc(0.3 * var(--body-font-size)) calc(0.3 * var(--body-font-size)) 0',\n            }}\n          >\n            <span style={{ verticalAlign: 'middle' }}>\n              <Localized id={'sort_label_' + sorting.path.replace(/\\./g, '_')} />\n            </span>\n          </button>\n        )}\n      >\n\n        <div style={{ marginTop: '8px' }}></div>\n\n        {\n          sortableFields\n            .map(path => (\n              <MenuItem\n                className=\"roundMenuItem\"\n                key={path}\n                onClick={() => changeSorting(path)}\n                selected={sorting.path === path}\n                sx={{\n                  marginTop: '2px !important',\n                  marginBottom: '2px !important',\n                }}\n              >\n                <ListItemText>\n                  <Localized id={'sort_label_' + path.replace(/\\./g, '_')} />\n                </ListItemText>\n              </MenuItem>\n            ))\n        }\n      </PopoverMenu>\n\n    {\n      preselectedTypes.length > 1 || possibleRoles.length > 1\n        ? <>\n            {\n              preselectedTypes.length > 1\n                ? <PopoverMenu\n                  trigger={triggerProps => (\n                    <button\n                      {...triggerProps}\n                      className=\"text hasIcon\"\n                      style={{\n                        width: 'auto',\n                        flexShrink: '0',\n                        margin: '0',\n                        justifyContent: 'flex-start',\n                      }}\n                    >\n                      <FilterListIcon className=\"icon\" />\n                      <span style={{ verticalAlign: 'middle' }}>\n                        {getString('block_menu_type_label_plural_' + filters.current.type)}\n                      </span>\n                    </button>\n                  )}\n                >\n\n                  <div style={{ marginTop: '8px' }}></div>\n\n                  {\n                    preselectedTypes\n                      .map(type => (\n                        <MenuItem\n                          className=\"roundMenuItem\"\n                          key={type}\n                          onClick={() => setTypeFilter(type)}\n                          selected={filters.current.type === type}\n                          sx={{\n                            marginTop: '2px !important',\n                            marginBottom: '2px !important',\n                          }}\n                        >\n                          <ListItemIcon>\n                            {typeIcons[type]}\n                          </ListItemIcon>\n                          <ListItemText>\n                            <Localized id={'block_menu_type_label_plural_' + type} />\n                          </ListItemText>\n                        </MenuItem>\n                      ))\n                  }\n                </PopoverMenu>\n                : null\n            }\n\n            {\n              possibleRoles.length > 1\n                ? <PopoverMenu\n                  trigger={triggerProps => (\n                    <button\n                      {...triggerProps}\n                      className=\"text hasIcon\"\n                      style={{\n                        width: 'auto',\n                        flexShrink: '0',\n                        margin: '0',\n                        justifyContent: 'flex-start',\n                      }}\n                    >\n                      <FilterListIcon className=\"icon\" />\n                      <span style={{ verticalAlign: 'middle' }}>\n                        {\n                          filters.current.roles.length === 0\n                            ? getString('path_editor_permissions')\n                            : filters.current.roles.map(role => getString('role_' + role)).join(', ')\n                        }\n                      </span>\n                    </button>\n                  )}\n                >\n\n                  <div style={{ marginTop: '8px' }}></div>\n\n                  {\n                    possibleRoles\n                      .map(role => (\n                        <MenuItem\n                          className=\"roundMenuItem\"\n                          key={role}\n                          onClick={() => setRoleFilter(role)}\n                          selected={filters.current.roles.includes(role)}\n                          sx={{\n                            marginTop: '2px !important',\n                            marginBottom: '2px !important',\n                          }}\n                        >\n                          <ListItemIcon>\n                            {roleIcons[role]}\n                          </ListItemIcon>\n                          <ListItemText>\n                            <Localized id={'role_' + role} />\n                          </ListItemText>\n                        </MenuItem>\n                      ))\n                  }\n                </PopoverMenu>\n                : null\n            }\n        </>\n        : null\n    }\n\n    {\n      !['person'].includes(filters.current.type)\n        ? (\n          loggedIn\n            ? <>\n              <button\n                className=\"default green hasIcon\"\n                style={{\n                  width: 'auto',\n                  flexShrink: '0',\n                  margin: '0',\n                  justifyContent: 'flex-start',\n                }}\n                onClick={() => createBlock({ type: filters.current.type })}\n              >\n                <AddIcon className=\"icon\" />\n                <span style={{ verticalAlign: 'middle' }}>\n                  {getString('block_type_new_' + filters.current.type)}\n                </span>\n              </button>\n            </>\n            : <>\n              <a href={`${window.domains.backend}login?redirect_to=${encodeURIComponent(window.location.toString())}`}>\n                <button\n                  className=\"default green hasIcon\"\n                  style={{\n                    flexShrink: '0',\n                    margin: '0',\n                    justifyContent: 'flex-start',\n                  }}\n                >\n                  <LoginIcon className=\"icon\" />\n                  <span style={{ verticalAlign: 'middle' }}>\n                    {getString('needs_login_block_type_new_' + filters.current.type)}\n                  </span>\n                </button>\n              </a>\n            </>\n        )\n        : null\n    }\n\n    </div>\n\n    <hr className={classes.smallDivider} />\n\n    <React.Fragment key={sorting}>\n      {\n        sortedBlockGroups\n        .filter(group => !!group.blocks && Array.isArray(group.blocks) && group.blocks.length > 0)\n        .map(group => (<>\n          <h2 style={{ marginTop: 'var(--basis_x8)' }}>{group.heading}</h2>\n          <div className={isGrid ? classes.grid_layout : classes.list_layout}>\n            {\n              group.blocks\n                .filter(Boolean)\n                .map(block => {\n                  return <div\n                    key={block._id}\n                    style={{\n                      // display: 'flex',\n                      alignItems: isGrid ? 'flex-end' : 'center',\n                      flexDirection: 'row',\n                      height: 'auto',\n                      display: 'inline-flex',\n                    }}\n                    className={classes.blockRow}\n                  >\n                    <ViewerAuto\n                      size={\n                        isGrid\n                          ? 'icon'\n                          : (\n                            block?.type === 'image'\n                              ? 'line'\n                              : 'card'\n                          )\n                      }\n                      block={block}\n                    />\n                    {\n                      block?.isSortHeading === true\n                        ? null\n                        : <div className={classes.blockRowActions}>\n                          <BlockMenu\n                            onReloadContext={loadList}\n                            block={block}\n                            trigger={props => (\n                              <button\n                                {...props}\n                                className={`text hasIcon`}\n                                style={{\n                                  margin: '0',\n                                  padding: 'var(--basis_x0_5) 0',\n                                  flexShrink: '0',\n                                }}\n                              >\n                                <BlockMenuIcon className=\"icon\" />\n                              </button>\n                            )}\n                          />\n                        </div>\n                    }\n                  </div>\n                })\n            }\n          </div>\n        </>))\n      }\n    </React.Fragment>\n  </div>\n}\n\nfunction List({\n  preselectedTypes,\n}) {\n\n  const { getString } = useLocalization()\n\n  const openSearch = () => {\n    const event = new CustomEvent('open_search')\n    window.dispatchEvent(event)\n  }\n\n  const title = getString('list_title')\n  \n  const rightHeaderActions = <>\n    <div className=\"buttonRow\" style={{ whiteSpace: 'nowrap' }}>\n      <button className=\"default hasIcon\" onClick={openSearch} title=\"Search (⌘K / Ctrl+K)\">\n        <SearchIcon className=\"icon\" />\n      </button>\n    </div>\n  </>\n\n  return <div className={classes.root}>\n    <Helmet>\n      <title>{title}</title>\n      <meta name=\"title\" content={title} />\n      <meta name=\"og:title\" content={title} />\n      <meta name=\"twitter:title\" content={title} />\n\n      <meta name=\"description\" content=\"\" />\n      <meta property=\"og:description\" content=\"\" />\n      <meta name=\"twitter:description\" content=\"\" />\n    </Helmet>\n\n    <Header\n      block={{\n        type: 'page',\n        properties: {\n          text: title,\n          slug: 'list',\n          icon: {\n            type: 'emoji',\n            emoji: '🗒'\n          }\n        }\n      }}\n      title={title}\n      rightActions={rightHeaderActions}\n    />\n\n    <div className={`basis_0_2 ${classes.app} ${classes.spine_aligned}`} dir=\"auto\">\n      <main className={`${classes.contentWrapper}`}>\n        <h1\n          dir=\"auto\"\n          style={{\n            whiteSpace: 'pre-wrap',\n          }}\n        >\n          {/* {getString('block_menu_type_label_plural_' + filters.current.type)} */}\n          {title}\n        </h1>\n\n        <div className={classes.items}>\n          <ListView preselectedTypes={preselectedTypes} />\n        </div>\n      </main>\n    </div>\n  </div>\n}\n\nexport default List\n","import React, { useState, useEffect, useCallback } from 'react'\n\nimport Twemoji from '../components/Twemoji.js'\nimport useLoadBlocks from '../hooks/useLoadBlocks.js'\nimport useSaveBlock from '../hooks/useSaveBlock.js'\nimport { useArchiveBlocks } from '../hooks/useArchiveBlock.js'\n\nimport classes from './ReactionButton.module.css'\n\nconst ReactionButton = ({ className = '', style = {}, forBlockId = '' }) => {\n  const defaultReactions = ['⭐️'] // , '💜', '👍', '👎', '📌'\n\n  const [userReactions, setUserReactions] = useState([])\n  const loadBlocks = useLoadBlocks()\n  const saveBlock = useSaveBlock()\n  const archiveBlocks = useArchiveBlocks()\n\n  const loadUserReactions = useCallback(async () => {\n    const loadedUserReactions = (await loadBlocks({\n      types: ['reaction'],\n      roles: ['owner'],\n      archived: false,\n    }))\n      .filter(block => block.properties.reactionFor === forBlockId)\n\n    console.log('loadedUserReactions', loadedUserReactions)\n    setUserReactions(loadedUserReactions)\n  }, [forBlockId, loadBlocks])\n\n  useEffect(() => {\n    if (typeof forBlockId === 'string' && forBlockId.length > 0) {\n      loadUserReactions()\n    }\n  }, [forBlockId, loadUserReactions])\n\n  const toggleReaction = useCallback(reaction => {\n    const filteredUserReactions = userReactions.filter(userReactionBlock => \n      userReactionBlock?.type === 'reaction' &&\n      userReactionBlock?.properties?.icon?.type === 'emoji' &&\n      userReactionBlock?.properties?.icon?.emoji === reaction\n    )\n\n    if (filteredUserReactions.length > 0) {\n      // remove reaction\n      archiveBlocks({\n        ids: filteredUserReactions.map(userReactionBlock => userReactionBlock._id),\n        archive: true,\n      })\n        .then(() => {\n          loadUserReactions()\n        })\n        .catch(error => {\n          console.error('error', error)\n        })\n    } else {\n      // add reaction\n      const newBlock = {\n        type: 'reaction',\n        properties: {\n          icon: {\n            type: 'emoji',\n            emoji: reaction,\n          },\n          reactionFor: forBlockId,\n        }\n      }\n\n      saveBlock(newBlock)\n        .then((data) => {\n          console.log('data', data)\n          loadUserReactions()\n        }).catch(error => {\n          console.error('error', error)\n        })\n    }\n  }, [userReactions, forBlockId, archiveBlocks, saveBlock, loadUserReactions])\n  \n  return <div key={userReactions} className={className} style={style}>\n    {\n      defaultReactions\n        .map(reaction => {\n          const filteredUserReactions = userReactions.filter(userReactionBlock =>\n            userReactionBlock?.type === 'reaction' &&\n            userReactionBlock?.properties?.icon?.type === 'emoji' &&\n            userReactionBlock?.properties?.icon?.emoji === reaction\n          )\n\n          return <button\n            key={reaction}\n            className={`\n              ${classes.reactionButton}\n              ${filteredUserReactions.length > 0 ? classes.selected : ''}\n              ${filteredUserReactions.length > 0 ? 'default' : 'text'}\n              hasIcon\n            `}\n            onClick={() => toggleReaction(reaction)}\n          >\n            <Twemoji className=\"icon\" emojiClassName={classes.emoji} key={reaction} emoji={reaction} />\n          </button>\n        })\n    }\n  </div>\n}\n\nexport default ReactionButton\n","import React, { lazy, Suspense, useRef, useState, useEffect, useCallback } from 'react'\n\nimport {\n  useParams,\n  Link,\n} from 'react-router-dom'\n\nimport { Helmet } from 'react-helmet'\nimport Twemoji from '../components/Twemoji.js'\nimport ReactionButton from '../components/ReactionButton.js'\n\nimport { getImageUrl } from '../functions.js'\n\nimport { Localized, useLocalization } from '../fluent/Localized.js'\nimport useLoadPage from '../hooks/useLoadPage.js'\nimport useLoadBlocks from '../hooks/useLoadBlocks.js'\nimport useUser from '../hooks/useUser.js'\n\nimport Header from '../components/Header.js'\nimport ViewerAuto from '../components/view/ViewerAuto.js'\nimport { ListView } from './List.js'\n\nimport classes from './Viewer.module.css'\n\nimport {\n  EditSharp as EditIcon,\n  Search as SearchIcon,\n  AssessmentSharp as AssessmentIcon,\n} from '@mui/icons-material'\n\nimport { renderInlineMarkdown } from '../markdown.js'\n\nconst ErrorPage = lazy(() => import('../components/ErrorPage.js'))\nconst LocaleSelect = lazy(() => import('../components/edit/LocaleSelect.js'))\n\nfunction Viewer () {\n  const loadingTheBlock = useRef(false)\n  const { getString, translateBlock, userLocales } = useLocalization()\n\n  const { loggedIn } = useUser()\n\n  const loadPage = useLoadPage()\n  const loadBlocks = useLoadBlocks()\n\n  let { id: slugOrId = '' } = useParams()\n\n  let slugOrId_to_use = slugOrId\n\n  if (slugOrId.includes('=')) {\n    const [, id] = slugOrId.split('=')\n    slugOrId_to_use = id\n  }\n\n  const [block, setBlock] = useState({\n    type: 'page',\n    properties: {},\n    content: [],\n  })\n  const properties = block.properties || {}\n  const slug = properties.slug || slugOrId_to_use || ''\n  const [contentBlocks, setContentBlocks] = useState([])\n\n  const [possibleLocales, setPossibleLocales] = useState([])\n  const [locales, setLocales] = useState(properties.locale || userLocales || ['en'])\n  const handleLocaleChange = useCallback((newLocale) => {\n    setLocales([newLocale])\n  }, [ setLocales ])\n\n  const [error, setError] = useState(null)\n\n  const setAndTrackError = useCallback(error => {\n    setError(error)\n\n    if (\n      !!window.umami\n      && typeof error === 'object'\n      && error !== null\n      && error.hasOwnProperty('code')\n      && typeof error.code === 'string'\n    ) {\n      window.umami.trackEvent('E: ' + error.code)\n    }\n  }, [setError])\n\n  const viewStatistics = () => {\n    const a = document.createElement('a')\n    a.href = `https://umami.qiekub.org/share/s0ZHBZbb/volt.link?url=%2F${slug}`\n    a.target = '_blank'\n    a.rel = 'noreferrer'\n    a.click()\n  }\n\n  useEffect(() => {\n    const properties = block.properties || {}\n\n    if (\n      loadingTheBlock.current === false\n      && typeof slugOrId_to_use === 'string'\n      && slugOrId_to_use !== ''\n      && slugOrId_to_use !== block._id\n      && slugOrId_to_use !== properties.slug\n      && (\n        error === null\n        || error.for_slugOrId !== slugOrId_to_use\n      )\n    ) {\n      loadingTheBlock.current = true\n      loadPage(slugOrId_to_use)\n        .then(async loadedBlock => { \n          if (typeof loadedBlock !== 'object' || loadedBlock === null) {\n            setAndTrackError({\n              code: '404',\n              for_slugOrId: slugOrId_to_use,\n            })\n            loadingTheBlock.current = false\n          } else {\n            let newLoadedBlock = loadedBlock\n\n            if (\n              Array.isArray(loadedBlock.content)\n              && loadedBlock.content.length > 0\n            ) {\n              let newContentConfigs = [...loadedBlock.content]\n\n              const ids2load = loadedBlock.content\n                .filter(contentConfig => !contentConfig.hasOwnProperty('block'))\n                .map(contentConfig => contentConfig.blockId)\n\n              let loadedContentBlocks = []\n              if (ids2load.length > 0) {\n                loadedContentBlocks = await loadBlocks({ ids: ids2load })\n              }\n\n              newContentConfigs = newContentConfigs\n                .map(contentConfig => {\n                  if (!contentConfig.hasOwnProperty('block')) {\n                    contentConfig.block = loadedContentBlocks.find(block => block._id === contentConfig.blockId)\n                  }\n                  return contentConfig\n                })\n\n              newLoadedBlock = {\n                ...newLoadedBlock,\n                content: newContentConfigs,\n              }\n            }\n\n            const blocks = (newLoadedBlock.content || [])\n              .map(contentConfig => contentConfig.block)\n\n            const newPossibleLocales = [...new Set(\n              [\n                loadedBlock,\n                ...blocks,\n              ]\n                .filter(Boolean)\n                .flatMap(thisBlock => {\n                  const properties = thisBlock?.properties || {}\n\n                  return [\n                    properties.locale || null,\n                    ...(properties.translations || [])\n                      .filter(t => t.text && t.text.length > 0)\n                      .map(t => t.locale),\n                  ]\n                })\n                .filter(Boolean)\n            )]\n            setPossibleLocales(newPossibleLocales)\n\n            setAndTrackError(null)\n            setBlock(newLoadedBlock)\n            setContentBlocks(blocks)\n            loadingTheBlock.current = false\n          }\n        })\n        .catch(error => {\n          console.error(error)\n          setAndTrackError({\n            ...error,\n            for_slugOrId: slugOrId_to_use,\n          })\n          loadingTheBlock.current = false\n        })\n    }\n  }, [\n    error,\n    slugOrId_to_use,\n    block,\n    block._id,\n    loadPage,\n    setBlock,\n    loadBlocks,\n    setContentBlocks,\n    setPossibleLocales,\n    setAndTrackError,\n  ])\n\n  const openSearch = () => {\n    const event = new CustomEvent('open_search')\n    window.dispatchEvent(event)\n  }\n\n  if (error !== null && error.for_slugOrId === slugOrId_to_use) {\n    const short_error_page_title = 'Error ' + error.code\n    return <div className={classes.viewer}>\n      <Helmet>\n        <title>{short_error_page_title}</title>\n        <meta name=\"title\" content={short_error_page_title} />\n        <meta name=\"og:title\" content={short_error_page_title} />\n        <meta name=\"twitter:title\" content={short_error_page_title} />\n\n        <meta name=\"description\" content=\"\" />\n        <meta property=\"og:description\" content=\"\" />\n        <meta name=\"twitter:description\" content=\"\" />\n\n        <meta property=\"og:image\" content=\"\" />\n        <meta name=\"twitter:image\" content=\"\" />\n\n        <meta property=\"twitter:card\" content=\"summary\" />\n      </Helmet>\n\n      <Header\n        block={{\n          type: 'page',\n          properties: {\n            text: short_error_page_title,\n            icon: {\n              type: 'emoji',\n              emoji: '⚠️'\n            }\n          }\n        }}\n        title=\"Error\"\n        rightActions={null}\n      />\n      <div className={`basis_x1 ${classes.app} ${classes.spine_aligned}`} dir=\"auto\">\n        <main className={`${classes.contentWrapper}`}>\n          {\n            error.code === '300'\n              ? <>\n                <h1>\n                  <Localized id=\"error_300_title\" />\n                </h1>\n                <br />\n                <p>\n                  <Localized id=\"error_300_description\" />\n                </p>\n                <br />\n                {\n                  error.blocks.map(block => <ViewerAuto\n                    key={block._id}\n                    block={block}\n                    forceId={true}\n                    pathSuffix=\"view\"\n                  />)\n                }\n              </>\n              : null\n          }\n          {\n            error.code === '403'\n              ? <ErrorPage errorName=\"no_access\" />\n              : null\n          }\n          {\n            error.code === '404'\n              ? <ErrorPage errorName=\"not_found\" />\n              : null\n          }\n        </main>\n      </div>\n    </div>\n  } else {\n  const type = block.type || null\n\n  const title = translateBlock(block, locales, getString('placeholder_headline_empty'))\n  const coverphoto = properties.coverphoto || {}\n  const pronouns = properties.pronouns || ''\n  \n  const rightHeaderActions = <>\n    <div className=\"buttonRow\" style={{ whiteSpace: 'nowrap' }}>\n\n      {\n        (loggedIn && !!block._id)\n        && <Link to={`/${block._id}/edit`} style={{ marginRight: 'var(--basis_x2)' }}>\n            <button className=\"text hasIcon\">\n              <EditIcon className=\"icon\" />\n              <span className=\"hideOnSmallScreen\" style={{verticalAlign: 'middle'}}><Localized id=\"edit_block\" /></span>\n            </button>\n          </Link>\n      }\n\n      {\n        (loggedIn && !!block._id)\n        && <ReactionButton forBlockId={block._id} style={{ marginRight: 'var(--basis_x2)' }} />\n      }\n\n      {\n        (loggedIn && !!block._id && slug !== '')\n          ? <button className=\"text hasIcon\" onClick={viewStatistics}>\n            <AssessmentIcon className=\"icon\" />\n          </button>\n          : null\n      }\n\n      {\n        possibleLocales.length > 1\n          ? <Suspense>\n              <LocaleSelect\n                onChange={handleLocaleChange}\n                defaultValue={locales[0] || userLocales[0] || 'en'}\n                options={possibleLocales}\n                style={{ marginRight: 'var(--basis_x2)' }}\n              />\n            </Suspense>\n          : null\n      }\n\n      <button className=\"default hasIcon\" onClick={openSearch} title=\"Search (⌘K / Ctrl+K)\">\n        <SearchIcon className=\"icon\" />\n      </button>\n    </div>\n  </>\n\n  const titleWithRenderedMarkdown = {\n    __html: renderInlineMarkdown(title)\n  }\n\n  let contentPreviewText = ''\n  let contentAsPlaintext = block?.computed?.contentAsPlaintext || null\n  if (typeof contentAsPlaintext === 'string' && contentAsPlaintext.length > 0) {\n    const maxTextLength = 200\n    const maxLines = 2\n\n    contentAsPlaintext = contentAsPlaintext\n      .replace(/[\\r\\n]+/g, '\\n') // remove double line breaks\n\n    if (contentAsPlaintext.length > maxTextLength) {\n      contentAsPlaintext = contentAsPlaintext.slice(0, maxTextLength) + '…'\n    }\n\n    contentAsPlaintext = contentAsPlaintext\n      .split('\\n')\n\n    if (contentAsPlaintext.length > maxLines) {\n      contentAsPlaintext = contentAsPlaintext.slice(0, maxLines)\n      contentAsPlaintext.push('…')\n    }\n      \n    contentPreviewText = contentAsPlaintext.join('\\n')\n  }\n\n  const coverphotoPropertyValue = (\n    type === 'file'\n      ? {\n        type: 'file',\n        fileId: block._id,\n      }\n      : coverphoto || null\n  )\n  const coverphoto_url = getImageUrl(coverphotoPropertyValue, { width: 1400, height: 400 })\n  const metadata_image_url = getImageUrl(coverphotoPropertyValue, { width: 1000, height: 1000 })\n\n  let coverphotoComponent = null\n  if (typeof coverphoto_url === 'string' && coverphoto_url.length > 0) {\n    if (type === 'poster' || type === 'image' || type === 'file') {\n      coverphotoComponent = <div style={{\n        width: '1000px',\n        maxWidth: '100%',\n        margin: '0 auto',\n      }}>\n        <img src={coverphoto_url} alt=\"\" style={{ width: '100%', height: 'auto' }} />\n      </div>\n    } else {\n      coverphotoComponent = <div style={{ backgroundImage: `url(${coverphoto_url})` }} className={classes.coverphoto}></div>\n    }\n  }\n\n\n  let iconComponent = null\n\n  if (\n    properties.hasOwnProperty('icon')\n    && typeof properties.icon === 'object'\n    && properties.icon !== null\n    && !Array.isArray(properties.icon)\n    && properties.icon.hasOwnProperty('type')\n    && typeof properties.icon.type === 'string'\n  ) {\n\n    if (\n      properties.icon.type === 'emoji'\n      && properties.icon.hasOwnProperty('emoji')\n      && typeof properties.icon.emoji === 'string'\n      && properties.icon.emoji.length !== 0\n    ) {\n      iconComponent = <Twemoji className={`${classes.icon} ${coverphoto_url === '' ? '' : classes.coverphotoIsSet}`} emoji={properties.icon.emoji} />\n    }\n\n    if (\n      iconComponent === null\n      && properties.icon.type === 'file'\n      && properties.icon.hasOwnProperty('fileId')\n      && typeof properties.icon.fileId === 'string'\n      && properties.icon.fileId.length !== 0\n    ) {\n      const fileId = properties.icon.fileId\n      iconComponent = <div\n        style={{\n          backgroundImage: `url(${window.domains.storage}download_file/?f=${window.imageFormat || 'jpg'}&w=400&h=400&id=${encodeURIComponent(fileId)})`\n        }}\n        className={`${classes.icon} ${coverphoto_url === '' ? '' : classes.coverphotoIsSet}`}\n      ></div>\n    }\n\n    if (iconComponent === null) {\n      let icon_url = getImageUrl(properties.icon, { width: 400, height: 400 })\n      if (typeof icon_url === 'string' && icon_url.length !== 0) {\n        iconComponent = <div\n          style={{\n            backgroundImage: `url(${icon_url})`\n          }}\n          className={`${classes.icon} ${coverphoto_url === '' ? '' : classes.coverphotoIsSet}`}\n        ></div>\n      }\n    }\n  }\n\n  return <div className={classes.viewer}>\n    <Helmet>\n      <title>{title}</title>\n      <meta name=\"title\" content={title} />\n      <meta name=\"og:title\" content={title} />\n      <meta name=\"twitter:title\" content={title} />\n\n      <meta name=\"description\" content={contentPreviewText} />\n      <meta property=\"og:description\" content={contentPreviewText} />\n      <meta name=\"twitter:description\" content={contentPreviewText} />\n\n      <meta property=\"og:image\" content={metadata_image_url} />\n      <meta name=\"twitter:image\" content={metadata_image_url} />\n\n      <meta name=\"twitter:card\" content=\"summary_large_image\" />\n      <meta property=\"twitter:card\" content=\"summary\" />\n\n      <meta property=\"og:url\" content={window.location.href} />\n      <meta property=\"og:type\" content=\"article\" />\n\n      {/* <meta name=\"twitter:site\" content={window.twitterHandle} /> */}\n      {/* <meta name=\"twitter:creator\" content={window.twitterHandle} /> */}\n\n    </Helmet>\n\n    <Header\n      block={block}\n      rightActions={rightHeaderActions}\n    />\n\n    <div className={`basis_0_8 ${classes.app} ${classes.spine_aligned}`} dir=\"auto\">\n      {\n        'page person redirect poster image file'.split(' ').includes(type)\n          ? coverphotoComponent\n          : null\n      }\n      <main className={`${classes.contentWrapper}`}>\n        {\n          'page person redirect'.split(' ').includes(type)\n            ? iconComponent\n            : null\n        }\n        {\n          title !== ''\n          ? <h1\n              dir=\"auto\"\n              dangerouslySetInnerHTML={titleWithRenderedMarkdown}\n              style={{\n                whiteSpace: 'pre-wrap',\n              }}\n            />\n          : null\n        }\n        {\n          type === 'person' && pronouns !== ''\n          ? <p dir=\"auto\">\n            <strong style={{\n              padding: 'var(--basis)',\n              // margin: 'var(--basis_x0_5) calc(-1 * var(--basis))',\n              display: 'inline-block',\n              backgroundColor: 'rgba(var(--on-background-rgb), var(--alpha-less))',\n            }}>\n              {pronouns}\n            </strong>\n          </p>\n          : null\n        }\n\n        <div className={classes.items}>\n          {\n            contentBlocks\n            .filter(block => !!block)\n            .filter(block => block.properties.active !== false)\n            .map(contentBlock => <ViewerAuto\n              key={contentBlock._id}\n              block={contentBlock}\n              locales={locales}\n              size={['page','person','redirect','poster'].includes(contentBlock?.type || '') ? 'line' : 'card'}\n            />)\n          }\n\n          {\n            slug === 'glossary'\n            ? <ListView\n                preselectedTypes={['definition']}\n                preselectedSorting={{\n                  path: 'properties.text',\n                  asc: false,\n                }}\n              />\n            : null\n          }\n        </div>\n      </main>\n    </div>\n  </div>\n  }\n}\n\nexport default Viewer\n","import React, { Suspense, lazy, useState, useEffect } from 'react'\n\nimport classes from './App.module.css'\n\nimport {\n  Routes,\n  Route,\n  useLocation,\n  useMatch,\n  useParams,\n  // useNavigate,\n} from 'react-router-dom'\n\nimport { SidebarProvider, Sidebar, SidebarContent, Main } from '../components/Sidebar.js'\nimport { Helmet } from 'react-helmet'\n\nimport SearchBox from '../components/SearchBox.js'\n\nimport List from './List.js'\nimport Viewer from './Viewer.js'\nconst Editor = lazy(() => import('./Editor.js'))\n\n// function useScrollMemory() {\n//   // const navigate = useNavigate()\n//   const location = useLocation()\n//\n//   const pathRef = useRef(null)\n//\n//   useEffect(() => {\n//     console.log('location', location)\n//     pathRef.current = location.pathname\n//   }, [location])\n//\n//   useEffect(() => {\n//     // Listen for location changes and set the scroll position accordingly.\n//     const setFromHistoryState = state => {\n//       console.log('popstate-state', state)\n//       let scrollY = 0\n//       if (state && state.scrollY) {\n//         scrollY = state.scrollY\n//       }\n//       console.log('A-popstate-scrollY', scrollY)\n//       if (scrollY < 100) {\n//         scrollY = 0\n//       }\n//\n//       console.log('B-popstate-scrollY', scrollY)\n//       window.scrollTo(0, scrollY)\n//       setTimeout(()=>{\n//         window.scrollTo(0, scrollY)\n//       }, 500)\n//     }\n//\n//     setFromHistoryState(window.history.state)\n//     const popstateListener = event => {\n//       if (event.type === 'popstate') {\n//         setFromHistoryState(event.state)\n//       }\n//     }\n//     window.addEventListener('popstate', popstateListener)\n//\n//     const scrollListener = () => {\n//       const newScrollY = window.scrollY\n//       console.log(' ')\n//       console.log('scrollListener-window.history.state', window.history.state)\n//       console.log('scrollListener-newScrollY', newScrollY)\n//       console.log('pathRef.current', pathRef.current)\n//\n//       if (typeof pathRef.current === 'string') {\n//         window.history.replaceState(\n//           {\n//             ...(window.history.state || {}),\n//             scrollY: newScrollY,\n//           },\n//           '',\n//           pathRef.current\n//         )\n//         console.log('window.history.state', window.history.state)\n//\n//         // navigate(pathRef.current, {\n//         //   replace: true,\n//         //   state: {\n//         //     // ...(window.history.state || {}),\n//         //     scrollY: newScrollY,\n//         //   },\n//         // })\n//       }\n//     }\n//     window.addEventListener('scroll', scrollListener)\n//\n//     // Unregister listener when component unmounts.\n//     return () => {\n//       console.log('Unregister')\n//       window.removeEventListener('popstate', popstateListener)\n//       window.removeEventListener('scroll', scrollListener)\n//     }\n//   }, [])\n// }\n\nfunction ListWrapper() {\n  const { type = '' } = useParams()\n  return <List key={type} preselectedTypes={[type]} />\n}\n\nfunction App() {\n  // useScrollMemory()\n\n  const matchesStartpage = useMatch('/')\n  const location = useLocation()\n\n  const [customLocation, setCustomLocation] = useState({})\n\n  useEffect(() => {\n    //    /slug=id/suffix\n    //    /slugOrId/suffix\n\n    let newPathname = ''\n\n    const parts = location.pathname.split('/')\n      .filter(part => part.length > 0)\n\n    if (parts.length > 0) {\n      const last = parts.pop()\n\n      let idOrSlug = last\n      let suffix = 'view'\n\n      if ((last === 'edit' || last === 'view') && parts.length > 0) {\n        suffix = last\n        idOrSlug = parts.pop()      \n      }\n\n      const typesSingular = 'redirect page poster person definition image file'.split(' ')\n      const typesPlural = 'redirects pages posters people definitions images files'.split(' ')\n\n      if (idOrSlug === 'list' || idOrSlug === 'map' || idOrSlug === 'places') {\n        newPathname = `/${idOrSlug}`\n      } else if (typesSingular.includes(idOrSlug)) {\n        newPathname = `/list/${idOrSlug}`\n      } else if (typesPlural.includes(idOrSlug)) {\n        const index = typesPlural.indexOf(idOrSlug)\n        const type = typesSingular[index]\n        newPathname = `/list/${type}`\n      } else {\n        newPathname = `/${idOrSlug}/${suffix}`\n      }\n\n      if (idOrSlug === 'search') {\n        window.dispatchEvent(new CustomEvent('open_search'))\n      }\n    }\n\n    if (customLocation.pathname !== newPathname) {\n      // TODO: save scroll position\n\n      setCustomLocation({\n        pathname: newPathname,\n      })\n    }\n  }, [ location, customLocation, setCustomLocation ])\n\n  const fallback_title = 'VoltLink'\n  const fallback_description = 'VoltLink is an information-hub about Volt Europa.'\n\n  return (<>\n    <div className={`${classes.app} ${matchesStartpage ? classes.isStartpage : ''}`}>\n      <SidebarProvider>\n        {\n          matchesStartpage\n          ? null\n          : <Sidebar />\n        }\n        <Main>\n          <SearchBox />\n          \n          <Routes location={customLocation}>\n            <Route path=\"/list\" element={<List />} />\n            <Route path=\"/list/:type\" element={<ListWrapper />} />\n            <Route path=\"/:id/view\" element={<Viewer />} />\n            <Route path=\"/:id/edit\" element={\n              <Suspense>\n                <Editor />\n              </Suspense>\n            } />\n            <Route path=\"/\" element={<>\n              <Helmet>\n                <title>{fallback_title}</title>\n                <meta name=\"title\" content={fallback_title} />\n                <meta name=\"og:title\" content={fallback_title} />\n                <meta name=\"twitter:title\" content={fallback_title} />\n\n                <meta name=\"description\" content={fallback_description} />\n                <meta name=\"og:description\" content={fallback_description} />\n                <meta name=\"twitter:description\" content={fallback_description} />\n              </Helmet>\n\n              <SidebarContent />\n            </>} />\n          </Routes>\n        </Main>\n      </SidebarProvider>\n    </div>\n  </>)\n}\n\nexport default App\n","import React, { useState, useEffect, useCallback } from 'react'\nimport { createRoot } from 'react-dom/client'\n\nimport './index.css'\n\nimport snackbarClasses from './Snackbar.module.css'\n\nimport App from './pages/App.js'\n// import reportWebVitals from './reportWebVitals'\nimport { BrowserRouter as Router } from 'react-router-dom'\n\nimport 'intl-pluralrules'\nimport { AppLocalizationProvider, locales } from './fluent/l10n.js'\n// import { TranslatedInputProvider } from './components/edit/TranslatedInput.js'\n\nimport useMediaQuery from '@mui/material/useMediaQuery'\nimport { createTheme, ThemeProvider } from '@mui/material/styles'\n\nimport { SnackbarProvider } from 'notistack'\n\nimport {\n  ApolloClient,\n  InMemoryCache,\n  ApolloProvider,\n} from '@apollo/client'\n\nwindow.process = {} // BUGFIX for CRA4 error-page after hot-reloading.\n\nwindow.env = 'prod' // dev / prod\nwindow.domains = {\n  frontend: 'https://volt.link/',\n  backend: 'https://api.volt.link/',\n  storage: 'https://storage.volt.link/',\n  // frontend: 'http://localhost:4003/',\n  // backend: 'http://localhost:4004/',\n  // storage: 'http://localhost:4006/',\n}\n\nwindow.graphql_uri = window.domains.backend + 'graphql/v1/'\n\nconst client = new ApolloClient({\n  uri: window.graphql_uri,\n  cache: new InMemoryCache(),\n  credentials: 'include',\n  defaultOptions: {\n    watchQuery: {\n      // fetchPolicy: 'cache-and-network',\n      fetchPolicy: 'no-cache',\n      errorPolicy: 'ignore',\n    },\n    query: {\n      fetchPolicy: 'no-cache',\n      errorPolicy: 'all',\n    },\n  },\n})\n\n// client\n//   .query({\n//     query: gql`\n//       query GetRates {\n//         rates(currency: \"USD\") {\n//           currency\n//         }\n//       }\n//     `\n//   })\n//   .then(result => console.info(result));\n\nfunction Start() {\n  const [userLocales, setUserLocales] = useState(navigator.languages)\n  const [currentLocale, setCurrentLocale] = useState(null)\n\n  useEffect(() => {\n    // get saved locale from localStorage\n    const savedLocale = window.localStorage.getItem('locale') || null\n    if (typeof savedLocale === 'string' && savedLocale !== '') {\n      setUserLocales([savedLocale])\n    } else {\n      setUserLocales(navigator.languages)\n    }\n  }, [setUserLocales])\n\n  useEffect(() => {\n    if (!!window.umami) {\n      let systemLocales = navigator.languages\n      if (!!systemLocales || Array.isArray(systemLocales)) {\n        for (let locale of systemLocales) {\n          locale = locale.toLowerCase() // Not really correct but the system locales sadly don't conform to the standard.\n\n          const language = locale.split('-')[0]\n          if (typeof language === 'string' && language !== '') {\n            window.umami.trackEvent('L: ' + language) // Log just the language.\n          }\n        }\n      }\n    }\n  }, [])\n\n  const handleLanguageChange = useCallback(event => {\n    setUserLocales([event.target.dataset.locale])\n  }, [setUserLocales])\n\n  const handleCurrentLocalesChange = useCallback(currentLocales => {\n    setCurrentLocale(currentLocales.length > 0 ? currentLocales[0] : '')\n  }, [setCurrentLocale])\n\n  useEffect(() => {\n    const change_locale = event => {\n      const detail = event.detail || {}\n      const newLocale = detail.locale || null\n\n      if (newLocale === null) {\n        if (!!userLocales && Array.isArray(userLocales) && userLocales.length > 0) { // check that userLocales is not an empty array\n          setUserLocales(navigator.languages)\n          window.localStorage.removeItem('locale')\n        }\n      } else {\n        setUserLocales([newLocale])\n        window.localStorage.setItem('locale', newLocale)\n      }\n    }\n\n    window.addEventListener('change_locale', change_locale)\n    return () => {\n      window.removeEventListener('change_locale', change_locale)\n    }\n  }, [userLocales, setUserLocales])\n\n\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)')\n\n  const theme = React.useMemo(\n    () =>\n      createTheme({\n        palette: {\n          mode: prefersDarkMode ? 'dark' : 'light',\n        },\n        components: {\n          MuiListItemIcon: {\n            styleOverrides: {\n              root: {\n                color: 'inherit',\n              },\n            },\n          },\n          MuiListItemText: {\n            styleOverrides: {\n              primary: {\n                fontFamily: \"'Ubuntu', 'Noto Kufi Arabic', 'Geeza Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif\",\n                // fontWeight: 'bold',\n              },\n            },\n          },\n        },\n      }),\n    [prefersDarkMode],\n  )\n\n  return <>\n  <div\n    id=\"react-notification\"\n    key=\"react-notification\"\n    style={{zIndex: '10000'}}\n  ></div>\n\n  <AppLocalizationProvider\n    key=\"AppLocalizationProvider\"\n    userLocales={userLocales}\n    onLocaleChange={handleCurrentLocalesChange}\n  >\n    <ApolloProvider client={client}>\n      <ThemeProvider theme={theme}>\n        <SnackbarProvider\n          anchorOrigin={{\n            vertical: 'bottom',\n            horizontal: 'right',\n          }}\n          style={{ minWidth: 'unset' }}\n          classes={{\n            variantSuccess: `${snackbarClasses.snackbar} ${snackbarClasses.success}`,\n            variantError: `${snackbarClasses.snackbar} ${snackbarClasses.error}`,\n            variantWarning: `${snackbarClasses.snackbar} ${snackbarClasses.warning}`,\n            variantInfo: `${snackbarClasses.snackbar} ${snackbarClasses.info}`,\n          }}\n          domRoot={document.getElementById('react-notification')}\n        >\n          {/* <TranslatedInputProvider> */}\n            <Router>\n              <App locales={locales} currentLocale={currentLocale} onLanguageChange={handleLanguageChange} />\n            </Router>\n          {/* </TranslatedInputProvider> */}\n        </SnackbarProvider>\n      </ThemeProvider>\n    </ApolloProvider>\n  </AppLocalizationProvider>\n  </>\n}\n\nconst container = document.getElementById('root')\nconst root = createRoot(container)\nroot.render(<Start />)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.info))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals()\n","function getImageUrl(imageObj, options) {\n  const {\n    width = null,\n    height = null,\n    format = window.imageFormat || 'jpg',\n  } = options || {}\n\n  if (\n    typeof imageObj === 'object'\n    && imageObj !== null\n    && !Array.isArray(imageObj)\n  ) {\n    if (imageObj.type === 'url' && !!imageObj.url) {\n      return `${window.domains.storage}download_url/?f=${format}&w=${width}&h=${height}&url=${encodeURIComponent(imageObj.url || '')}`\n    } else if (imageObj.type === 'file' && !!imageObj.fileId) {\n      return `${window.domains.storage}download_file/?f=${format}&w=${width}&h=${height}&id=${encodeURIComponent(imageObj.fileId || '')}`\n    }\n  }\n\n  return ''\n}\n\n\nfunction hexToRGBArray(color) {\n  if (color.startsWith('#')) {\n    color = color.substring(1)\n  }\n\n  if (color.length === 3) {\n    color = color.charAt(0) + color.charAt(0) + color.charAt(1) + color.charAt(1) + color.charAt(2) + color.charAt(2);\n  } else if (color.length !== 6) {\n    throw(new Error('Invalid hex color: ' + color));\n  }\n\n  let rgb = [];\n  for (var i = 0; i <= 2; i++) {\n    rgb[i] = parseInt(color.substr(i * 2, 2), 16);\n  }\n\n  return rgb;\n}\nfunction luma(color) { \n  // color can be a hex string or an array of RGB values 0-255\n  const rgb = (typeof color === 'string') ? hexToRGBArray(color) : color;\n  return (0.2126 * rgb[0]) + (0.7152 * rgb[1]) + (0.0722 * rgb[2]); // SMPTE C, Rec. 709 weightings\n}\nfunction getContrastingColor(color) {\n  // source: https://stackoverflow.com/questions/635022/calculating-contrasting-colours-in-javascript\n  // exact answer: https://stackoverflow.com/a/6511606/2387277\n  // example: https://jsfiddle.net/thomasrosen/9njo6t7s/20/\n  \n  return (luma(color) >= 165) ? '000' : 'fff';\n}\n\n\n\n// function randomHexColor () {\n//   let color = ''\n//   for (let i = 0; i < 6; i++){\n//     const random = Math.random()\n//     const bit = (random * 16) | 0\n//     color += (bit).toString(16)\n//   }\n//   return '#'+color\n// }\n\n\n\nfunction colorToRGBA(color) {\n  // source: https://stackoverflow.com/questions/1573053/javascript-function-to-convert-color-names-to-hex-codes\n  // source: https://stackoverflow.com/a/24390910/2387277\n\n  // Returns the color as an array of [r, g, b, a] -- all range from 0 - 255\n  // color must be a valid canvas fillStyle. This will cover most anything\n  // you'd want to use.\n  // Examples:\n  // colorToRGBA('red')  # [255, 0, 0, 255]\n  // colorToRGBA('#f00') # [255, 0, 0, 255]\n  var cvs, ctx;\n  cvs = document.createElement('canvas');\n  cvs.height = 1;\n  cvs.width = 1;\n  ctx = cvs.getContext('2d');\n  ctx.fillStyle = color;\n  ctx.fillRect(0, 0, 1, 1);\n  return ctx.getImageData(0, 0, 1, 1).data;\n}\nfunction byteToHex(num) {\n    // Turns a number (0-255) into a 2-character hex number (00-ff)\n    return ('0'+num.toString(16)).slice(-2);\n}\nfunction colorToHex(color) {\n    // Convert any CSS color to a hex representation\n    // Examples:\n    // colorToHex('red')            # '#ff0000'\n    // colorToHex('rgb(255, 0, 0)') # '#ff0000'\n    var rgba, hex;\n    rgba = colorToRGBA(color);\n    hex = [0,1,2].map(\n        function(idx) { return byteToHex(rgba[idx]); }\n        ).join('');\n    return \"#\"+hex;\n}\n\n\n\nfunction getBlockColor(block = {}) {\n  const colors = {\n    color: null,\n    colorRGB: null,\n    contrastingColor: null,\n    contrastingColorRGB: null,\n  }\n\n  block.properties = block.properties || {}\n\n  if (block.hasOwnProperty('properties') && block.properties.hasOwnProperty('color') && !!block.properties.color) {\n    const defaultColors = ['purple', 'red', 'green', 'blue', 'yellow']\n    let newColor = block.properties.color\n\n    if (defaultColors.includes(newColor)) {\n      colors.color = `var(--${newColor})`\n      colors.colorRGB = `var(--${newColor}-rgb)`\n      colors.contrastingColor = `var(--on-${newColor})`\n      colors.contrastingColorRGB = `var(--on-${newColor}-rgb)`\n    } else {\n      if (newColor.startsWith('#')) {\n        if (newColor.length !== 4 && newColor.length !== 7) {\n          newColor = null\n        }\n      } else {\n        const parsedColor = colorToHex(newColor)\n        if (parsedColor === '#000000' && newColor !== 'black') {\n          newColor = null\n        } else {\n          newColor = parsedColor\n        }\n      }\n\n      if (newColor) {\n        colors.color = newColor\n        const colorRGB = hexToRGBArray(newColor)\n        colors.colorRGB = colorRGB.join(', ')\n        colors.contrastingColor = '#'+getContrastingColor(newColor)\n        colors.contrastingColorRGB = hexToRGBArray(colors.contrastingColor)\n      }\n    }\n  }\n\n  return colors\n}\n\nmodule.exports = {\n  getImageUrl,\n  getBlockColor,\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"Viewer_app__1_jMF\",\"spine_aligned\":\"Viewer_spine_aligned__2mJuq\",\"items\":\"Viewer_items__2FgjF\",\"coverphoto\":\"Viewer_coverphoto__16R-U\",\"icon\":\"Viewer_icon__219E5\",\"coverphotoIsSet\":\"Viewer_coverphotoIsSet__26PSP\",\"contentWrapper\":\"Viewer_contentWrapper__1HLN8\",\"type_p\":\"Viewer_type_p__O5DZS\",\"viewer\":\"Viewer_viewer__JHrvB\"};","import { gql } from '@apollo/client'\n\nexport const saveBlock_Mutation = gql`\n  mutation saveBlock ($block: InputBlock!) {\n    saveBlock (block: $block) {\n\t\t  _id\n\t\t  type\n\t\t  properties\n\t\t  content {\n        blockId\n        block {\n          _id\n          type\n          properties\n          content {\n            blockId\n          }\n          parent\n          metadata {\n            modified\n            modified_by\n          }\n          permissions\n          computed {\n            roles\n            inherited_block_permissions\n          }\n        }\n      }\n\t\t  parent\n\t\t  metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n      }\n    }\n  }\n`\n\nexport const archiveBlocks_Mutation = gql`\n  mutation archiveBlocks ($ids: [ObjectID]!) {\n    archiveBlocks (ids: $ids)\n  }\n`\n\nexport const unarchiveBlocks_Mutation = gql`\n  mutation unarchiveBlocks ($ids: [ObjectID]!) {\n    unarchiveBlocks (ids: $ids)\n  }\n`\n\nexport const moveBlock_Mutation = gql`\n  mutation moveBlock ($movingBlockId: ObjectID!, $newParentId: ObjectID!, $newIndex: Int!) {\n    moveBlock(movingBlockId: $movingBlockId, newParentId: $newParentId, newIndex: $newIndex)\n  }\n`\n\nexport const setCursor_Mutation = gql`\n  mutation setCursor ($cursor: InputCursor!) {\n    setCursor(cursor: $cursor)\n  }\n`\n\nexport const removeCursor_Mutation = gql`\n  mutation removeCursor ($type: CursorType!, $blockId: ObjectID!, $propertyName: String) {\n    removeCursor(type: $type, blockId: $blockId, propertyName: $propertyName)\n  }\n`\n","import { gql } from '@apollo/client'\n\nexport const getBlock_Query = gql`\n  query getBlock ($_id: ObjectID!) {\n    block (_id: $_id) {\n\t\t  _id\n\t\t  type\n\t\t  properties\n\t\t  content {\n        blockId\n        block {\n          _id\n          type\n          properties\n          content {\n            blockId\n          }\n          parent\n          metadata {\n            modified\n            modified_by\n          }\n          permissions\n          computed {\n            roles\n            inherited_block_permissions\n\t\t\t\t    # contentAsPlaintextPerBlock\n\t\t\t\t    # contentAsMarkdownPerBlock\n\t\t\t\t    contentAsPlaintext\n\t\t\t\t    # contentAsMarkdown\n          }\n        }\n      }\n\t\t  parent\n\t\t  metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n\t\t\t\t# contentAsPlaintextPerBlock\n\t\t\t\t# contentAsMarkdownPerBlock\n\t\t\t\tcontentAsPlaintext\n\t\t\t\t# contentAsMarkdown\n      }\n    }\n  }\n`\n\nexport const getBlocks_Query = gql`\n  query getBlocks ($ids: [ObjectID], $slugs: [String], $types: [String], $archived: Boolean, $roots: [ObjectID], $roles: [String]) {\n    blocks (ids: $ids, slugs: $slugs, types: $types, archived: $archived, roots: $roots, roles: $roles) {\n      _id\n      type\n      properties\n      content {\n        blockId\n      }\n      parent\n      metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n\t\t\t\t# contentAsPlaintextPerBlock\n\t\t\t\t# contentAsMarkdownPerBlock\n\t\t\t\tcontentAsPlaintext\n\t\t\t\t# contentAsMarkdown\n      }\n    }\n  }\n`\n\nexport const getBlocksWithContent_Query = gql`\n  query getBlocks ($ids: [ObjectID], $slugs: [String], $types: [String], $archived: Boolean, $roots: [ObjectID] $roles: [String]) {\n    blocks (ids: $ids, slugs: $slugs, types: $types, archived: $archived, roots: $roots, roles: $roles) {\n\t\t  _id\n\t\t  type\n\t\t  properties\n\t\t  content {\n        blockId\n        block {\n          _id\n          type\n          properties\n          content {\n            blockId\n          }\n          parent\n          metadata {\n            modified\n            modified_by\n          }\n          permissions\n          computed {\n            roles\n            inherited_block_permissions\n\t\t\t\t    # contentAsPlaintextPerBlock\n\t\t\t\t    # contentAsMarkdownPerBlock\n\t\t\t\t    contentAsPlaintext\n\t\t\t\t    # contentAsMarkdown\n          }\n        }\n      }\n\t\t  parent\n\t\t  metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n\t\t\t\t# contentAsPlaintextPerBlock\n\t\t\t\t# contentAsMarkdownPerBlock\n\t\t\t\tcontentAsPlaintext\n\t\t\t\t# contentAsMarkdown\n      }\n    }\n  }\n`\n\nexport const getBlockBySlug_Query = gql`\n  query getBlockBySlug ($slug: String!) {\n    block: blockBySlug (slug: $slug) {\n\t\t  _id\n\t\t  type\n\t\t  properties\n\t\t  content {\n        blockId\n        block {\n          _id\n          type\n          properties\n          content {\n            blockId\n          }\n          parent\n          metadata {\n            modified\n            modified_by\n          }\n          permissions\n          computed {\n            roles\n            inherited_block_permissions\n\t\t\t\t    # contentAsPlaintextPerBlock\n\t\t\t\t    # contentAsMarkdownPerBlock\n\t\t\t\t    contentAsPlaintext\n\t\t\t\t    # contentAsMarkdown\n          }\n        }\n      }\n\t\t  parent\n\t\t  metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n\t\t\t\t# contentAsPlaintextPerBlock\n\t\t\t\t# contentAsMarkdownPerBlock\n\t\t\t\tcontentAsPlaintext\n\t\t\t\t# contentAsMarkdown\n      }\n    }\n  }\n`\n\nexport const getSelf_Query = gql`\n  query getSelf {\n    self {\n\t\t  logged_in\n\t\t  user\n\t\t  blockId\n      userroles\n    }\n  }\n`\n\nexport const getSiblingBlocks_Query = gql`\n  query getSiblingBlocks ($_id: ObjectID!, $types: [String]) {\n    blocks: siblingBlocks (_id: $_id, types: $types) {\n      _id\n      type\n      properties\n    }\n  }\n`\n\nexport const getParentBlocks_Query = gql`\n  query getParentBlocks ($_id: ObjectID!) {\n    blocks: parentBlocks (_id: $_id) {\n      _id\n      type\n      properties\n      computed {\n        sort\n        # roles\n        # inherited_block_permissions\n\t\t\t\t# contentAsPlaintextPerBlock\n\t\t\t\t# contentAsMarkdownPerBlock\n\t\t\t\t# contentAsPlaintext\n\t\t\t\t# contentAsMarkdown\n      }\n    }\n  }\n`\n\nexport const blockMatchesRoles_Query = gql`\n  query blockMatchesRoles ($_id: ObjectID!, $roles: [String]) {\n    blockMatchesRoles (_id: $_id, roles: $roles)\n  }\n`\n\nexport const checkSlug_Query = gql`\n  query checkSlug ($slug: String!) {\n    checkSlug (slug: $slug) {\n      isOkay\n      errors\n      existsAsSlug\n      existsAsId\n    }\n  }\n`\n\nexport const search_Query = gql`\n  query search ($query: String!, $types: [String], $archived: Boolean) {\n    blocks: search (query: $query, types: $types, archived: $archived) {\n      _id\n      type\n      properties\n      content {\n        blockId\n      }\n      parent\n      metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n\t\t\t\t# contentAsPlaintextPerBlock\n\t\t\t\t# contentAsMarkdownPerBlock\n\t\t\t\tcontentAsPlaintext\n\t\t\t\t# contentAsMarkdown\n      }\n    }\n  }\n`\n\nexport const getLastModifiedBlocks_Query = gql`\n  query getLastModifiedBlocks ($first: Int, $types: [String], $archived: Boolean) {\n    lastModifiedBlocks (first: $first, types: $types, archived: $archived) {\n    \t_id\n      type\n      properties\n      metadata {\n        modified\n        modified_by\n      }\n      permissions\n      computed {\n        roles\n        inherited_block_permissions\n\t\t\t\tcontentAsPlaintext\n      }\n    }\n  }\n`\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"List_root__HV2hJ\",\"app\":\"List_app__osHkL\",\"spine_aligned\":\"List_spine_aligned__1_f4u\",\"items\":\"List_items__29a1C\",\"contentWrapper\":\"List_contentWrapper__1H5GD\",\"type_p\":\"List_type_p__V70Yn\",\"blockRow\":\"List_blockRow__2h-9h\",\"blockRowActions\":\"List_blockRowActions__O3oX6\",\"smallDivider\":\"List_smallDivider__12mlJ\",\"grid_layout\":\"List_grid_layout__1CpOq\",\"list_layout\":\"List_list_layout__7zKtm\"};","import { useRef, useEffect } from 'react'\n\nimport { Transmat, addListeners, TransmatObserver } from 'transmat'\n\nimport classes from './DataTransmat.module.css'\n\nfunction getTransmatOptions(transmat, mimetypes) {\n  let data = {}\n  for (const mimetype of mimetypes) {\n    if (transmat.hasType(mimetype)) {\n      if (mimetype === 'application/json') {\n        data[mimetype] = JSON.parse(transmat.getData(mimetype))\n      } else {\n        data[mimetype] = transmat.getData(mimetype)\n      }\n    }\n  }\n\n  const options = {\n    data,\n    transmat,\n  }\n\n  return options\n}\n\nexport function DataReceiver({ onReceive, style, className, children, checkEntry, mimetypes = ['application/json'] }){\n  const receiverRef = useRef(null)\n\n  useEffect(() => {\n    const unlisten = addListeners(receiverRef.current, 'receive', event => {\n      const transmat = new Transmat(event)\n      const options = getTransmatOptions(transmat, mimetypes)\n      \n      let isOkay = false\n      if (typeof checkEntry === 'function') {\n        isOkay = checkEntry(options)\n      }\n\n      if (isOkay && transmat.accept()) {\n        if (typeof onReceive === 'function') {\n          onReceive(options)\n        }\n        event.preventDefault()\n      }\n    })\n\n    const obs = new TransmatObserver(entries => {\n      for (const entry of entries) {\n        const transmat = new Transmat(entry.event)\n\n        const options = getTransmatOptions(transmat, mimetypes)\n      \n        let isOkay = false\n        if (typeof checkEntry === 'function') {\n          isOkay = checkEntry(options)\n        }\n\n        if (isOkay) {\n          entry.target.classList.toggle(classes.drag_over, entry.isTarget)\n          entry.target.classList.toggle(classes.drag_active, entry.isActive)\n        }\n      }\n    })\n    obs.observe(receiverRef.current)\n\n    return () => {\n      unlisten()\n      obs.disconnect()\n    }\n  }, [ onReceive, checkEntry, mimetypes ])\n\n  return <div ref={receiverRef} style={style} className={className}>\n    {children}\n  </div>\n}\n\nexport function DataTransmiter({ onTransmit, draggable, style, className, children }){\n  const transmiterRef = useRef(null)\n\n  useEffect(() => {\n    return addListeners(transmiterRef.current, 'transmit', async event => {\n      const transmat = new Transmat(event)\n      if (typeof onTransmit === 'function') {\n        const options = await onTransmit(transmat)\n        if (\n          typeof options === 'object'\n          && options !== null\n          && !Array.isArray(options.data)\n          && typeof options.data === 'object'\n          && options.data !== null\n        ) {\n          transmat.setData(options.data)\n          // transmat.setData({\n          //   'text/plain': 'Hello world!',\n          //   'text/html': '<h1>Hello world!</h1>',\n          //   'text/uri-list': 'http://example.com',\n          //   'application/json': {foo:'bar'},\n          // })\n        }\n      }\n    })\n  }, [ onTransmit ])\n\n  return <div ref={transmiterRef} style={style} className={className} draggable={draggable ? 'true' : 'false'} tabIndex=\"0\">\n    {children}\n  </div>\n}\n\nexport function DataBothWays({ onTransmit, onReceive, checkEntry, draggable, style, className, children, mimetypes = ['application/json'] }){\n  const bothwayRef = useRef(null)\n\n  useEffect(() => {\n    const unlistenTransmit = addListeners(bothwayRef.current, 'transmit', async event => {\n      const transmat = new Transmat(event)\n\n      if (typeof onTransmit === 'function') {\n        const options = await onTransmit(transmat)\n        if (\n          typeof options === 'object'\n          && options !== null\n          && !Array.isArray(options.data)\n          && typeof options.data === 'object'\n          && options.data !== null\n        ) {\n          transmat.setData(options.data)\n          // transmat.setData({\n          //   'text/plain': 'Hello world!',\n          //   'text/html': '<h1>Hello world!</h1>',\n          //   'text/uri-list': 'http://example.com',\n          //   'application/json': {foo:'bar'},\n          // })\n        }\n      }\n    })\n\n    const unlistenReceive = addListeners(bothwayRef.current, 'receive', event => {\n      const transmat = new Transmat(event)\n      const options = getTransmatOptions(transmat, mimetypes)\n      \n      let isOkay = false\n      if (typeof checkEntry === 'function') {\n        isOkay = checkEntry(options)\n      }\n\n      if (true && transmat.accept()) { // accept everything so wrong stuff like images does not get displayed in the browser\n        if (isOkay) {\n          if (typeof onReceive === 'function') {\n            onReceive(options)\n          }\n        }\n        event.preventDefault()\n      }\n    })\n\n    const obs = new TransmatObserver(entries => {\n      for (const entry of entries) {\n        const transmat = new Transmat(entry.event)\n        const options = getTransmatOptions(transmat, mimetypes)\n\n        let isOkay = false\n        if (typeof checkEntry === 'function') {\n          isOkay = checkEntry(options)\n        }\n\n        if (isOkay) {\n          entry.target.classList.toggle(classes.drag_over, entry.isTarget)\n          entry.target.classList.toggle(classes.drag_active, entry.isActive)\n        }\n      }\n    })\n    obs.observe(bothwayRef.current)\n\n    return () => {\n      unlistenTransmit()\n      unlistenReceive()\n      obs.disconnect()\n    }\n  }, [ onTransmit, onReceive, checkEntry, mimetypes ])\n\n  return <div\n    ref={bothwayRef}\n    style={style}\n    className={className}\n    draggable={draggable ? 'true' : 'false'}\n    tabIndex=\"0\"\n  >\n    {children}\n  </div>\n}\n\n// Examples:\n//\n// <DataTransmiter\n//   draggable={true}\n//   style={{\n//     width: '100%',\n//     height: '200px',\n//     backgroundColor: 'blue',\n//   }}\n//   onTransmit={() => ({\n//     'text/plain': 'Hello world!',\n//     'text/html': '<h1>Hello world!</h1>',\n//     'text/uri-list': 'http://example.com',\n//     'application/json': {foo:'bar'},\n//   })}\n// >\n//   DataTransmiter\n// </DataTransmiter>\n//\n// <DataReceiver\n//   style={{\n//     width: '100%',\n//     height: '200px',\n//     backgroundColor: 'red',\n//   }}\n//   onReceive={data => console.info('received', data)}\n// >\n//   DataReceiver\n// </DataReceiver>\n","import { useState, useEffect } from 'react'\n\nimport { renderInlineMarkdown } from '../../markdown.js'\nimport { useLocalization } from '../../fluent/Localized.js'\n\nimport { getBlockColor } from '../../functions.js'\n\nimport {\n  CheckBox as CheckBoxIcon,\n  CheckBoxOutlineBlank as CheckBoxOutlineBlankIcon,\n} from '@mui/icons-material'\n\nfunction ViewerTextCard ({ block, style, locales }) {\n  const [html, setHtml] = useState({ __html: '' })\n\n  const { translateBlock } = useLocalization()\n  const text = translateBlock(block, locales, '')\n\n  useEffect(() => {\n    const textWithHtml = renderInlineMarkdown(text)\n    setHtml({ __html: textWithHtml })\n  }, [text, setHtml])\n  \n  const defaultProps = {\n    dir: 'auto',\n    style: {\n      whiteSpace: 'pre-wrap',\n      display: 'flex',\n      ...style,\n    },\n  }\n\n  const {\n    color,\n  } = getBlockColor(block)\n  if (color) {\n    defaultProps.style.color = color\n  }\n\n  let text_style = 'body'\n  if (block.properties.hasOwnProperty('text_style')) {\n    text_style = block.properties.text_style\n  }\n\n\n  const {\n    text_decorations = [],\n    checked,\n  } = (block || {}).properties || {}\n\n  const prefixs = []\n  if (text_decorations.includes('checkbox')) {\n    const iconProps = {\n      key: 'checkbox',\n      style: {\n        margin: 'var(--basis_x0_2) var(--basis) 0 0',\n        height: 'var(--prefix-icon-size)',\n        width: 'var(--prefix-icon-size)',\n      }\n    }\n\n    if (checked) {\n      prefixs.push(<CheckBoxIcon {...iconProps} />)\n    } else {\n      prefixs.push(<CheckBoxOutlineBlankIcon {...iconProps} />)\n    }\n  }\n\n  const text_content = <span dangerouslySetInnerHTML={html}></span>\n\n\n\n  let component = null\n  switch (text_style) {\n    case 'h1':\n      component = <a href={`#${block._id}`} id={block._id}>\n        <h1\n          {...defaultProps}\n        >\n          {prefixs}\n          {text_content}\n        </h1>\n      </a>\n      break\n    case 'h2':\n      component = <a href={`#${block._id}`} id={block._id}>\n        <h2\n          {...defaultProps}\n          id={block._id}\n        >\n          {prefixs}\n          {text_content}\n        </h2>\n      </a>\n      break\n    case 'h3':\n      component = <a href={`#${block._id}`} id={block._id}>\n        <h3\n          {...defaultProps}\n          id={block._id}\n        >\n          {prefixs}\n          {text_content}\n        </h3>\n      </a>\n      break\n    case 'caption':\n      component = <caption\n        {...defaultProps}\n      >\n        {prefixs}\n        {text_content}\n      </caption>\n      break\n    default: // body\n      component = <p\n        {...defaultProps}\n      >\n        {prefixs}\n        {text_content}\n      </p>\n  }\n\n  return <div style={{\n    display: 'flex',\n  }}>\n    {component}\n  </div>\n}\n\nexport default ViewerTextCard\n","import { useState, useEffect } from 'react'\n\nimport { renderInlineMarkdown } from '../../markdown.js'\nimport { useLocalization } from '../../fluent/Localized.js'\nimport { getBlockColor } from '../../functions.js'\n\nfunction ViewerButtonCard({ block, clickable = true, locales }) {\n  const [html, setHtml] = useState({ __html: '' })\n\n  const { getString, translateBlock } = useLocalization()\n  const text = translateBlock(block, locales, getString('placeholder_headline_empty'))\n\n  useEffect(() => {\n    const textWithHtml = renderInlineMarkdown(text, { linkify: false })\n    setHtml({ __html: textWithHtml })\n  }, [text, setHtml])\n\n  let url = ''\n  if (\n    block\n    && block.properties\n    && block.properties.url\n  ) {\n    url = block.properties.url\n  }\n\n  const {\n    color,\n    contrastingColor,\n  } = getBlockColor(block)\n\n  const colorStyles = {}\n  if (color) {\n    colorStyles['--button-background'] = color\n    colorStyles['--button-color'] = contrastingColor\n  }\n\n  if (clickable === true && typeof url === 'string' && url.length > 0) {\n    return <a\n        href={url}\n        {...(\n        url.startsWith(window.domains.frontend)\n          ? {}\n          : { target: '_blank', rel: 'noopener noreferrer' }\n        )}\n      >\n      <button\n        dir=\"auto\"\n        dangerouslySetInnerHTML={html}\n        className=\"default square\"\n        style={{\n          margin: '0',\n          whiteSpace: 'pre-wrap',\n          ...colorStyles,\n        }}\n      ></button>\n    </a>\n  }\n\n  return <button\n    dir=\"auto\"\n    dangerouslySetInnerHTML={html}\n    disabled=\"disabled\"\n    className=\"default square\"\n    style={{\n      margin: '0',\n      whiteSpace: 'pre-wrap',\n      ...colorStyles,\n    }}\n  ></button>\n}\n\nexport default ViewerButtonCard\n","import { getBlockColor } from '../../functions.js'\n\nexport default function ViewerDividerLine ({ block }) {\n  const {\n    color,\n  } = getBlockColor(block)\n\n  const styles = {}\n  if (color) {\n    styles['--on-background'] = color\n  }\n\n  return <hr style={styles} />\n}\n","import { useLocalization } from '../../fluent/Localized.js'\n\nimport { getBlockColor } from '../../functions.js'\nimport useBlockTrigger from '../../hooks/useBlockTrigger.js'\n\nimport { Link } from 'react-router-dom'\n\nimport classes from './ViewerLineAndCard.module.css'\nimport BlockIcon from './BlockIcon.js'\n\nimport { renderInlineMarkdown } from '../../markdown.js'\n\nfunction toSimpleIsoString(date) {\n  let simpleIsoString = date.toISOString()\n    .replace('T', ' ')\n    .replace(/(:[^:]*?)$/, '')\n\n  return simpleIsoString\n}\n\nfunction ViewerLineAndCard({\n  block,\n  clickable = true,\n  onClick,\n  locales,\n  forceId,\n  pathSuffix,\n  size = 'line',\n}) {\n  const { getString, translateBlock, userLocales } = useLocalization()\n\n  const type = block?.type || 'unknown'\n  const properties = block.properties || {}\n  const slug = properties.slug || ''\n\n  const { link, path } = useBlockTrigger({ block, forceId, pathSuffix })\n\n  let title = translateBlock(block, locales || userLocales, '')\n\n  let additionalInfos = []\n  if (type === 'page' || type === 'redirect' || type === 'person') {\n    if (title === '' && typeof slug === 'string' && slug !== '') {\n      additionalInfos.push(<div importance=\"less\" key=\"slug\">{'/' + slug}</div>)\n    }\n  } else if (type === 'website') {\n    if (properties.hasOwnProperty('url') && typeof properties.url === 'string' && properties.url.length > 0) {\n      additionalInfos.push(<div key=\"url\" style={{ fontSize: 'calc(0.6 * var(--body-font-size))', margin: 'var(--basis_x0_5) 0' }}><em>{properties.url}</em></div>)\n    }\n    if (properties.hasOwnProperty('description') && typeof properties.description === 'string' && properties.description.length > 0) {\n      additionalInfos.push(<div importance=\"less\" key=\"description\">{properties.description}</div>)\n    }\n  } else if (type === 'apikey') {\n    if (properties.hasOwnProperty('nbf') && properties.hasOwnProperty('exp')) {\n      // display date range of validity\n      const nbf = new Date(properties.nbf)\n      const exp = new Date(properties.exp)\n      additionalInfos.push(<div key=\"nbf_and_exp\">{getString('apikey_validity', { from: toSimpleIsoString(nbf), to: toSimpleIsoString(exp) })}</div>)\n    } else if (properties.hasOwnProperty('nbf')) {\n      // display start date of validity\n      const nbf = new Date(properties.nbf)\n      additionalInfos.push(<div key=\"nbf\">{getString('apikey_validity_from', { from: toSimpleIsoString(nbf) })}</div>)\n    } else if (properties.hasOwnProperty('exp')) {\n      // display end date of validity\n      const exp = new Date(properties.exp)\n      additionalInfos.push(<div key=\"exp\">{getString('apikey_validity_to', { to: toSimpleIsoString(exp) })}</div>)\n    }\n  }\n  \n  let contentPreviewText = null\n  if (size !== 'icon' && (type === 'page' || type === 'person' || type === 'poster' || type === 'definition')) {\n    let contentAsPlaintext = block?.computed?.contentAsPlaintext || null\n\n    if (typeof contentAsPlaintext === 'string' && contentAsPlaintext.length > 0) {\n      const maxTextLength = 200\n      const maxLines = 2\n\n      contentAsPlaintext = contentAsPlaintext\n        .replace(/[\\r\\n]+/g, '\\n') // remove double line breaks\n\n      if (contentAsPlaintext.length > maxTextLength) {\n        contentAsPlaintext = contentAsPlaintext.slice(0, maxTextLength) + '…'\n      }\n\n      contentAsPlaintext = contentAsPlaintext\n        .split('\\n')\n\n      if (contentAsPlaintext.length > maxLines) {\n        contentAsPlaintext = contentAsPlaintext.slice(0, maxLines)\n        contentAsPlaintext.push('…')\n      }\n\n      contentPreviewText = contentAsPlaintext.join('\\n')\n\n      const contentAsPlaintextWithRenderedMarkdown = {\n        __html: renderInlineMarkdown(contentAsPlaintext.join('\\n'))\n      }\n\n      additionalInfos.push(<div\n        key=\"contentAsPlaintext\"\n        importance=\"more\"\n        dir=\"auto\"\n        dangerouslySetInnerHTML={contentAsPlaintextWithRenderedMarkdown}\n        style={{\n          whiteSpace: 'pre-wrap',\n        }}\n      ></div>)\n    }\n  }\n\n  if (type === 'website') {\n    if (properties.hasOwnProperty('tags') && Array.isArray(properties.tags)) {\n      const tags = [...new Set(properties.tags)] // remove duplicats\n        .filter(tag => typeof tag === 'string' && tag.length > 0) // only keep strings\n        .map(tag => <span className={classes.tag} key={tag}>{tag}</span>) // display nicely\n\n      additionalInfos.push(<div key=\"tags\" style={{ margin: 'var(--basis_x0_5) calc(-1 * var(--basis_x0_5))' }}>{tags}</div>)\n    }\n  }\n\n  if (title === '' && additionalInfos.length === 0) {\n    title = getString('placeholder_headline_empty')\n  }\n\n  if (size === 'line') {\n    if (title !== '') {\n      additionalInfos = []\n    } else if (additionalInfos.length === 0) {\n      additionalInfos = [additionalInfos[0]]\n    }\n  }\n\n  const content = <>\n    <BlockIcon\n      className={classes.icon}\n      block={block}\n      size={size === 'icon' ? 140 : 40}\n    />\n    <div className={classes.content}>\n      <div dir=\"auto\" className={classes.title}>\n        {title}\n      </div>\n      {\n        additionalInfos.length > 0\n          ? <div dir=\"auto\" className={classes.additionalInfos}>\n            {additionalInfos}\n          </div>\n          : null\n      }\n    </div>\n  </>\n\n\n\n  let cardLink = path || link\n\n  const {\n    color = 'inherit',\n    colorRGB = '--on-background-rgb',\n  } = getBlockColor(block)\n\n  const onClickProps = {}\n  if (typeof onClick === 'function') {\n    onClickProps.onClick = onClick\n  }\n\n  let hoverTitlePreviewText = ''\n  if (\n    typeof title === 'string' && title !== '' &&\n    typeof contentPreviewText === 'string' && contentPreviewText !== ''\n  ) {\n    hoverTitlePreviewText = `${title}\\n\\n${contentPreviewText}`\n  } else if (typeof title === 'string' && title !== '') {\n    hoverTitlePreviewText = title\n  } else if (typeof contentPreviewText === 'string' && contentPreviewText !== '') {\n    hoverTitlePreviewText = contentPreviewText\n  }\n  \n  if (clickable === true && typeof cardLink === 'string' && cardLink.length > 0) {\n    if (cardLink.includes(':')) {\n      return <a\n        href={cardLink}\n        target=\"_blank\" rel=\"noreferrer\"\n        title={hoverTitlePreviewText}\n        data-size={size}\n        className={`clickable_card ${classes.root}`}\n        style={{\n          cursor: 'pointer',\n          color,\n          '--on-background-rgb': colorRGB,\n        }}\n        {...onClickProps}\n      >\n        {content}\n      </a>\n    } else {\n      return <Link\n        to={cardLink}\n        title={hoverTitlePreviewText}\n        data-size={size}\n        className={`clickable_card ${classes.root}`}\n        style={{\n          cursor: 'pointer',\n          color,\n          '--on-background-rgb': colorRGB,\n        }}\n        {...onClickProps}\n      >\n        {content}\n      </Link>\n    }\n  }\n\n  return <div\n    title={hoverTitlePreviewText}\n    data-size={size}\n    className={`clickable_card ${classes.root}`}\n    style={{\n      cursor: 'auto',\n      color,\n      '--on-background-rgb': colorRGB,\n    }}\n    {...onClickProps}\n  >\n    {content}\n  </div>\n}\n\nexport default ViewerLineAndCard\n","import { useState, useEffect } from 'react' // useCallback\n// import { useNavigate } from 'react-router-dom'\n\nexport default function useBlockTrigger({ block = null, forceId = false, pathSuffix = '' }) {\n  const [link, setLink] = useState(null)\n  const [path, setPath] = useState(null)\n  // const [onClick, setOnClick] = useState(null)\n\n  // let navigate = useNavigate()\n\n  useEffect(() => {\n    let newLink = null\n    let newPath = null\n    // let newOnClick = null\n\n    let changedPathSuffix = pathSuffix.trim().toLowerCase()\n    if (changedPathSuffix === 'view') {\n      changedPathSuffix = ''\n    }\n\n    let pathSuffixFull = changedPathSuffix\n    if (pathSuffixFull.length > 0) {\n      pathSuffixFull = `/${pathSuffixFull}`\n    }\n\n\n    if (block !== null) {\n      const blockId = block._id\n      const type = block.type\n      const properties = block.properties || {}\n      const slug = properties.slug || ''\n      const url = properties.url || ''\n\n      if (\n        type === 'website'\n        && typeof url === 'string'\n        && url.length > 0\n        && changedPathSuffix === '' // empty path suffix means that we are in the view page\n      ) {\n        newLink = url\n        newPath = null\n        // newOnClick = () => window.open(newLink, '_blank')\n      } else if (\n        type === 'redirect'\n        && typeof url === 'string'\n        && url.length > 0\n        && changedPathSuffix === '' // empty path suffix means that we are in the view page\n      ) {\n        if (slug.length > 0) {\n          if (forceId === true) {\n            newLink = `${window.domains.frontend}${slug}=${blockId}${pathSuffixFull}`\n          } else {\n            newLink = `${window.domains.frontend}${slug}${pathSuffixFull}`\n          }\n        } else {\n          newLink = `${window.domains.frontend}${blockId}${pathSuffixFull}`\n        }\n        newPath = null\n        // newOnClick = () => window.open(newLink, '_blank')\n      } else if (\n        typeof slug === 'string'\n        && slug.length > 0\n      ) {\n        if (forceId === true) {\n          newLink = `${window.domains.frontend}${slug}=${blockId}${pathSuffixFull}`\n          newPath = `/${slug}=${blockId}${pathSuffixFull}`\n        } else {\n          newLink = `${window.domains.frontend}${slug}${pathSuffixFull}`\n          newPath = `/${slug}${pathSuffixFull}`\n        }\n        // newOnClick = () => navigate(newPath)\n      } else {\n        newLink = `${window.domains.frontend}${blockId}${pathSuffixFull}`\n        newPath = `/${blockId}${pathSuffixFull}`\n        // newOnClick = () => navigate(newPath)\n      }\n    }\n\n    setLink(newLink)\n    setPath(newPath)\n    // setOnClick(newOnClick)\n  }, [block, forceId, pathSuffix, setLink, setPath]) // setOnClick, navigate\n\n  return { link, path } // onClick\n}\n","import { useState, useEffect } from 'react'\n\nimport { renderInlineMarkdown } from '../../markdown.js'\nimport { useLocalization } from '../../fluent/Localized.js'\n\nfunction ViewerImageCard({ block, locales }) {\n  const [html, setHtml] = useState({ __html: '' })\n\n  const { translateBlock } = useLocalization()\n  const text = translateBlock(block, locales, '')\n\n  useEffect(() => {\n    const textWithHtml = renderInlineMarkdown(text, { linkify: false })\n    setHtml({ __html: textWithHtml })\n  }, [text, setHtml])\n\n  let image_url = ''\n  if (\n    block\n    && block.properties\n    && block.properties.coverphoto\n    && block.properties.coverphoto.type\n  ) {\n    if (block.properties.coverphoto.type === 'url') {\n      if (typeof block.properties.coverphoto.url === 'string' && block.properties.coverphoto.url.length > 0) {\n        image_url = `${window.domains.storage}download_url?f=${window.imageFormat || 'jpg'}&w=1000&h=1000&url=${encodeURIComponent(block.properties.coverphoto.url)}`\n      }\n    } else if (block.properties.coverphoto.type === 'file') {\n      if (typeof block.properties.coverphoto.fileId === 'string' && block.properties.coverphoto.fileId.length > 0) {\n        image_url = `${window.domains.storage}download_file/?f=${window.imageFormat || 'jpg'}&w=1000&h=1000&id=${encodeURIComponent(block.properties.coverphoto.fileId)}`\n      }\n    }\n  }\n\n  if (image_url !== '') {\n    return <div>\n      <img\n        src={image_url}\n        alt={text}\n        title={text}\n        style={{\n          maxWidth: '100%',\n          margin: '0 auto',\n          display: 'block',\n          boxShadow: 'inset 0 0 0 1px rgba(var(--on-background-rgb), var(--alpha-less))',\n        }}\n      />\n      <div\n        dir=\"auto\"\n        dangerouslySetInnerHTML={html}\n        className=\"type_caption\"\n        style={{\n          textAlign: 'center',\n          marginTop: 'var(--basis_x0_5)',\n        }}\n      />\n    </div>\n  }\n\n  return null\n}\n\nexport default ViewerImageCard\n","import { useState, useEffect } from 'react'\n\nfunction ViewerCodeCard({ block, style }) {\n  const [html, setHtml] = useState({ __html: '' })\n\n  useEffect(() => {\n    setHtml({ __html: block.properties.text })\n  }, [block.properties.text, setHtml])\n\n  return <div style={style} dangerouslySetInnerHTML={html}></div>\n}\n\nexport default ViewerCodeCard\n","import { useCallback } from 'react'\n\nimport { useLocalization } from '../fluent/Localized.js'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getBlock_Query } from '../graphql/queries'\n\nimport { useSnackbar } from 'notistack'\n\nfunction useLoadBlock() {\n  const { getString } = useLocalization()\n\n  const apollo_client = useApolloClient()\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\n\n  const handleLoadBlock = useCallback(_id => {\n    return new Promise(final_resolve => {\n    let snackbarKey = null\n\n    if (!_id || _id === '') {\n      final_resolve({\n        type: 'text',\n      })\n    } else {\n      const loadingDataPromise = new Promise(resolve => {\n        let preloaded_block = null\n        if (\n          typeof window.SERVER_DATA === 'object'\n          && window.SERVER_DATA !== null\n          && !Array.isArray(window.SERVER_DATA)\n        ) {\n          preloaded_block = window.SERVER_DATA.preloaded_block || null\n        }\n\n        if (\n          typeof preloaded_block === 'object'\n          && preloaded_block !== null\n          && preloaded_block.hasOwnProperty('_id')\n          && preloaded_block._id === _id\n        ) {\n          window.SERVER_DATA = { preloaded_block: null }\n          resolve('got-preloaded-data')\n          final_resolve(preloaded_block)\n        } else {\n          apollo_client.query({\n            query: getBlock_Query,\n            variables: {\n              _id,\n            },\n          })\n            .then(async ({ errors, data }) => {\n              resolve('got-data')\n\n              if (snackbarKey !== null) {\n                closeSnackbar(snackbarKey)\n              }\n\n              if (Array.isArray(errors)) {\n                enqueueSnackbar(errors.map(e => e.message).join('\\n'), {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 5000,\n                })\n                final_resolve(null)\n              } else if (data.block === null) {\n                enqueueSnackbar(`Could not load the content.`, {\n                  variant: 'error',\n                  preventDuplicate: true,\n                  autoHideDuration: 5000,\n                })\n                final_resolve(null)\n              } else {\n                const loadedBlock = data.block\n                final_resolve(loadedBlock)\n              }\n            })\n            .catch(async error => {\n              console.error('error', error)\n              resolve('got-error')\n\n              if (snackbarKey !== null) {\n                closeSnackbar(snackbarKey)\n              }\n\n              enqueueSnackbar('[could not load data] ' + error.message, {\n                variant: 'error',\n                preventDuplicate: true,\n                autoHideDuration: 2000,\n              })\n            })\n        }\n      })\n\n      // Show a loading-info-snackbar if loading the data takes too long.\n      Promise.race([\n        new Promise(resolve => {\n          setTimeout(() => {\n            resolve('show-loading')\n          }, 300)\n        }),\n        loadingDataPromise,\n      ])\n        .then(response => {\n          if (response === 'show-loading') {\n            snackbarKey = enqueueSnackbar(getString('path_editor_status_started_loading'), {\n              persist: true,\n              preventDuplicate: true,\n            })\n          }\n        })\n        .catch(error => console.error)\n    }\n    })\n  }, [\n    enqueueSnackbar,\n    closeSnackbar,\n    apollo_client,\n    getString,\n  ])\n\n  return handleLoadBlock\n}\n\nexport default useLoadBlock\n","import React, { useState, useEffect, useRef, useCallback } from 'react'\n\nimport { DataBothWays } from '../DataTransmat.js'\n\nimport ViewerTextCard from './ViewerTextCard.js'\nimport ViewerButtonCard from './ViewerButtonCard.js'\nimport ViewerDividerLine from './ViewerDividerLine.js'\nimport ViewerLineAndCard from './ViewerLineAndCard.js'\nimport ViewerImageCard from './ViewerImageCard.js'\nimport ViewerCodeCard from './ViewerCodeCard.js'\n\nimport classes from './ViewerAuto.module.css'\n\nimport { moveBlock_Mutation, saveBlock_Mutation } from '../../graphql/mutations.js'\nimport useMutation from '../../hooks/useMutation.js'\nimport useLoadBlock from '../../hooks/useLoadBlock.js'\nimport useUser from '../../hooks/useUser.js'\n\nfunction usePressedKeys({ keys = [] }) { // keys needs to lowercase\n  const pressedKeysRef = useRef(new Set())\n\n  useEffect(() => {\n    function onKeyDown(event) {\n      const key = event.key.toLowerCase()\n      if (keys.includes(key)) {\n        pressedKeysRef.current.add(key)\n      }\n    }\n    function onKeyUp(event) {\n      const key = event.key.toLowerCase()\n      pressedKeysRef.current.delete(key)\n    }\n\n    window.addEventListener('keydown', onKeyDown)\n    window.addEventListener('keyup', onKeyUp)\n\n    return () => {\n      window.removeEventListener('keydown', onKeyDown)\n      window.removeEventListener('keyup', onKeyUp)\n    }\n  }, [keys])\n\n  const getPressedKeys = () => pressedKeysRef.current // returns a Set !!!\n\n  return { getPressedKeys }\n}\n\nfunction removeProperty(obj, prop) {\n  // remove property from objects, arrays and sub-objects\n\n  obj = JSON.parse(JSON.stringify(obj)) // clone object to make everything mutable\n\n  if (obj.hasOwnProperty(prop)) {\n    delete obj[prop]\n  }\n  for (const i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (typeof obj[i] == 'object' && obj[i] !== null) {\n        removeProperty(obj[i], prop)\n      }\n    }\n  }\n\n  return obj\n}\n\nfunction ViewerAuto ({\n  blockId = null,\n  block = {},\n  clickable = true,\n  size = 'line',\n  dragable = false,\n  parentProps = {},\n  ...props\n}) {\n  let component = null\n\n  const [loadedBlock, setLoadedBlock] = useState(block || {})\n  const loadingBlockRef = useRef(false)\n\n  const { userroles } = useUser()\n  const { getPressedKeys } = usePressedKeys({ keys: ['shift'] }) // returns a Set !!!\n\n  const loadBlock = useLoadBlock()\n\n  useEffect(() => {\n    if (JSON.stringify(block) !== JSON.stringify(loadedBlock)) {\n      if (!block) {\n        setLoadedBlock({})\n      } else {\n        setLoadedBlock(block)\n      }\n    }\n  }, [loadedBlock, block])\n\n  useEffect(() => {\n    if (\n      !!blockId\n      && (!loadedBlock.hasOwnProperty('_id') || blockId !== loadedBlock._id)\n      && loadingBlockRef.current === false\n    ) {\n      loadingBlockRef.current = true\n\n      loadBlock(blockId)\n        .then(async loadedBlock => {\n          if (typeof loadedBlock !== 'object' || loadedBlock === null) {\n            throw new Error('ViewerAuto: loadBlock returned no object')\n          } else {\n            if (loadedBlock.type !== null) {\n              setLoadedBlock(loadedBlock)\n            }\n          }\n          loadingBlockRef.current = false\n        })\n        .catch(error => {\n          console.error(error)\n          loadingBlockRef.current = false\n        })\n    }\n  }, [blockId, loadedBlock, loadBlock, setLoadedBlock])\n\n  const type = loadedBlock.type || null\n\n  switch (type) {\n    case 'text':\n      if (size === 'card') {\n        component = <ViewerTextCard key={loadedBlock._id} block={loadedBlock} {...props} />\n      } else {\n        component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      }\n      break\n    case 'button':\n      if (size === 'card') {\n        component = <ViewerButtonCard key={loadedBlock._id} block={loadedBlock} {...props} />\n      } else {\n        component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      }\n      break\n    case 'divider':\n      if (size === 'card') {\n        component = <ViewerDividerLine key={loadedBlock._id} block={loadedBlock} {...props} />\n        // todo change the naming from ViewerDividerLine to ViewerDividerCard\n      } else {\n        component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      }\n      break\n    case 'page':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'person':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'redirect':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'website':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'apikey':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'poster':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'definition':\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      break\n    case 'image':\n      if (size === 'card') {\n        component = <ViewerImageCard key={loadedBlock._id} block={loadedBlock} {...props} />\n      } else {\n        component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      }\n      break\n    case 'code':\n      if (size === 'card') {\n        component = <ViewerCodeCard key={loadedBlock._id} block={loadedBlock} {...props} />\n      } else {\n        component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      }\n      break\n    default:\n      component = <ViewerLineAndCard key={loadedBlock._id} block={loadedBlock} size={size} {...props} />\n      // component = null // JSON.stringify(loadedBlock) // <ViewerTextCard key={loadedBlock._id} block={loadedBlock} {...props} />\n  }\n\n  const mutationFunction = useMutation()\n\n  const onReceive = useCallback(async ({ data = {} }) => {\n    const {\n      'application/json': json\n    } = data || {}\n\n    if (typeof json === 'object' && json !== null) {\n      let movingBlock = json\n\n      movingBlock = removeProperty(movingBlock, '__typename')\n\n      const block_roles = loadedBlock.computed.roles || []\n      const movingBlock_roles = movingBlock.computed.roles || []\n\n      if (\n        movingBlock._id !== loadedBlock._id\n        && (\n          userroles.includes('admin')\n          || (\n            ( block_roles.includes('editor') || block_roles.includes('owner') )\n            && ( movingBlock_roles.includes('editor') || movingBlock_roles.includes('owner') )\n          )\n        )\n      ) {\n        const pressedKeys = getPressedKeys()\n        // TODO: handle alt-key to duplicate block (child-blocks also need to be duplicated)\n        // if (pressedKeys.has('alt')) {\n        //   // duplicate block\n        //   delete movingBlock._id\n        //   const save_result = await mutationFunction({\n        //     mutation: saveBlock_Mutation,\n        //     variables: {\n        //       block: movingBlock,\n        //     },\n        //   })\n        //\n        //   movingBlock._id = save_result.saveBlock\n        // }\n\n        let everything_updated = false\n\n        try {\n          await mutationFunction({\n            mutation: moveBlock_Mutation,\n            variables: {\n              movingBlockId: movingBlock._id,\n              newParentId: loadedBlock._id,\n              newIndex: 0,\n            },\n          })\n        \n          if (pressedKeys.has('shift')) {\n            // auto hide the block        \n            await mutationFunction({\n              mutation: saveBlock_Mutation,\n              variables: {\n                block: {\n                  _id: movingBlock._id,\n                  properties: {\n                    'active': false,\n                  },\n                },\n              },\n            })\n          }\n        \n          everything_updated = true\n        } catch (error) {\n          console.error(error)\n        }\n      \n        if (everything_updated) {\n          console.log('TODO reload sidebar')\n          // TODO: reload sidebar\n        }\n      }\n    } \n  }, [mutationFunction, loadedBlock, getPressedKeys, userroles])\n\n  const handleCheckEntry = useCallback(({ data = {} }) => {\n    const {\n      'application/json': json\n    } = data || {}\n\n    let isOkay = false\n\n    if (\n      typeof json === 'object'\n      && json !== null\n      && json.hasOwnProperty('computed')\n      && json.computed.hasOwnProperty('roles')\n    ) {\n      const this_roles = json.computed.roles || []\n      if (userroles.includes('admin') || this_roles.includes('editor') || this_roles.includes('owner')) {\n        isOkay = true\n      }\n    }\n\n    return isOkay\n  }, [userroles])\n\n  return <DataBothWays\n    key={loadedBlock._id}\n    draggable={dragable}\n    className={classes.root}\n    onTransmit={() => ({\n      data: {\n        'text/plain': loadedBlock.properties.text || '',\n        // 'text/html': '<h1>Hello world!</h1>',\n        // 'text/uri-list': 'http://example.com',\n        'application/json': loadedBlock,\n      }\n    })}\n    onReceive={onReceive}\n    checkEntry={handleCheckEntry}\n    {...parentProps}\n  >\n    {component}\n  </DataBothWays>\n}\n\nexport default ViewerAuto\n","import { useState, useEffect, useRef } from 'react'\n\nimport { useApolloClient } from '@apollo/client'\nimport { getSelf_Query } from '../graphql/queries'\n\nconst defaultUser = {\n  userroles: [],\n}\n\nexport default function useUser(forceRefetch = false) {\n  const mountedRef = useRef(false)\n  useEffect(() => {\n    mountedRef.current = true\n    return () => {\n      mountedRef.current = false\n    }\n  }, [])\n\n  const [user, setUser] = useState(defaultUser)\n  const [loggedIn, setLoggedIn] = useState(false)\n\n  const apollo_client = useApolloClient()\n\n  useEffect(() => {\n    if (forceRefetch !== true && window.hasOwnProperty('user')) {\n      setUser({\n        ...window.user,\n        userroles: window.user.userroles || [],\n      })\n      setLoggedIn(window.user.logged_in)\n    } else {\n      apollo_client.query({\n        query: getSelf_Query,\n      })\n        .then(async ({ data }) => {\n          if (mountedRef.current === true) {\n            if (data.hasOwnProperty('self') && data.self !== null) {\n              window.user = data.self\n              setUser({\n                ...data.self,\n                userroles: data.self.userroles || [],\n              })\n              setLoggedIn(data.self.logged_in)\n            } else {\n              setUser(defaultUser)\n              setLoggedIn(false)\n            }\n          }\n        })\n        .catch(error => {\n          console.error(error)\n          if (mountedRef.current === true) {\n            setUser(defaultUser)\n            setLoggedIn(false)\n          }\n        })\n    }\n  }, [forceRefetch, setUser, setLoggedIn, apollo_client])\n\n  return {\n    ...user,\n    loggedIn,\n  }\n}\n","import {\n  Paper,\n  MenuList,\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  Divider,\n} from '@mui/material'\n\nimport {\n  Close as CloseIcon,\n} from '@mui/icons-material'\n\nimport { Localized } from '../fluent/Localized.js'\n\nimport Popover from './Popover.js'\n\nexport default function PopoverMenu ({\n  trigger,\n  children,\n  onToogle,\n  paperProps = {},\n}) {\n  return <Popover\n    trigger={trigger}\n    onToogle={onToogle}\n  >\n    {({closePopover, open, ...popoverProps}) => {\n      const {\n        sx = {},\n        ...paperPropsRest\n      } = paperProps || {}\n\n      return (\n        <Paper\n          {...popoverProps}\n          sx={{\n            maxWidth: 380,\n            // height: 325,\n            maxHeight: 'calc(100vh - 32px)',\n            overflow: 'auto',\n            background: 'var(--background-contrast)',\n            color: 'var(--on-background)',\n            borderRadius: 'var(--basis_x2)',\n            ...sx,\n          }}\n          elevation={8}\n          {...paperPropsRest}\n        >\n          <MenuList\n            autoFocus={true}\n            style={{\n              width: '100%',\n              maxWidth: '100%',\n              marginTop: '-8px',\n            }}\n          >\n            <div>\n\n              {typeof children === 'function' ? children({ isOpen: open, close: closePopover }) : children}\n\n              <Divider style={{opacity: 0.2, marginBottom:'8px'}}  />\n\n              <MenuItem className=\"roundMenuItem\" onClick={closePopover}>\n                <ListItemIcon>\n                  <CloseIcon />\n                </ListItemIcon>\n                <ListItemText>\n                  <Localized id=\"block_menu_close_menu\" />\n                </ListItemText>\n              </MenuItem>\n\n            </div>\n          </MenuList>\n        </Paper>\n    )}}\n  </Popover>\n}\n","import mdit from 'markdown-it'\nimport kbd from 'markdown-it-kbd'\nimport emoji from 'markdown-it-emoji'\nimport twemoji from 'twemoji'\n\nfunction getMD(options){\n  // var hljs = require('highlight.js') // https://highlightjs.org/\n  const md = mdit({\n    html: false,\n    xhtmlOut: false,\n    linkify: true,\n    typographer: true,\n    breaks: false,\n    // highlight: function (str, lang) {\n    //   const language_obj = hljs.getLanguage(lang)\n    //   if (lang && language_obj) {\n    //     const language = language_obj.aliases[0]\n    //     return '<pre class=\"hljs language-'+language+'\"><code>' +\n    //       hljs.highlight(str, { language, ignoreIllegals: true }).value +\n    //     '</code></pre>';\n    //   } else {\n    //     const html = hljs.highlightAuto(str, { ignoreIllegals: true })\n    //     return '<pre class=\"hljs language-'+html.language+'\"><code>' +\n    //       html.value +\n    //     '</code></pre>';\n    //   }\n\n    //   return '<pre class=\"hljs\"><code>' + md.utils.escapeHtml(str) + '</code></pre>';\n    // }\n    ...options,\n  })\n\n  // md.disable([ 'heading', 'heading', 'lheading', 'paragraph', 'image' ])\n  md.use(kbd)\n  md.use(emoji)\n\n  return md\n}\n\nfunction renderInlineMarkdown(text, options = {}){\n  text = text || ''\n  // text = text.replace(/\\n/g, '<br>')\n  // text = text.replace(/\\t/g, '&emsp;')\n\n  text = text\n  .replace(/\\(TM\\)/gi, '™')\n  .replace(/\\(SM\\)/gi, '℠')\n  .replace(/\\(C\\)/gi, '©')\n  .replace(/\\(R\\)/gi, '®')\n\n  const md = getMD(options)\n  text = md.renderInline(text)\n\n  text = twemoji.parse(text, {\n    folder: 'svg',\n    ext: '.svg',\n    base: '/public/twemoji/assets/',\n    // callback: function(icon, options, variant) {\n    //   switch ( icon ) {\n    //     case 'a9':      // © copyright\n    //     case 'ae':      // ® registered trademark\n    //     case '2122':    // ™ trademark\n    //       return false\n    //     default:\n    //       return ''.concat(options.base, options.size, '/', icon, options.ext)\n    //   }\n    // }\n  })\n    \n  return text\n}\n\nexport {\n  renderInlineMarkdown,\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"SearchBox_dialog__1znAI\",\"backdrop\":\"SearchBox_backdrop__2e5Wz\",\"inputWrapper\":\"SearchBox_inputWrapper__24CrI\",\"input\":\"SearchBox_input__1qb9w\",\"actions\":\"SearchBox_actions__4Zrwb\",\"searchInput\":\"SearchBox_searchInput__3M4FI\",\"filters\":\"SearchBox_filters__1axwa\",\"searchResults\":\"SearchBox_searchResults__3ySIT\",\"searchErrors\":\"SearchBox_searchErrors__1Q8W1\",\"mathResult\":\"SearchBox_mathResult__YFSbr\",\"blockRow\":\"SearchBox_blockRow__13jhD\",\"blockRowActions\":\"SearchBox_blockRowActions__1FRMH\",\"fakeHover\":\"SearchBox_fakeHover__30G2t\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"snackbar\":\"Snackbar_snackbar__119_w\",\"default\":\"Snackbar_default__31-eU\",\"success\":\"Snackbar_success__zvTW8\",\"error\":\"Snackbar_error__3XeD6\",\"warning\":\"Snackbar_warning__2CBXt\",\"info\":\"Snackbar_info__EuVSN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"ViewerLineAndCard_content__1lFI-\",\"title\":\"ViewerLineAndCard_title__2hfbo\",\"additionalInfos\":\"ViewerLineAndCard_additionalInfos__2CGI1\",\"tag\":\"ViewerLineAndCard_tag__XiCzV\",\"root\":\"ViewerLineAndCard_root__2LObL\",\"icon\":\"ViewerLineAndCard_icon__1XBJZ\"};","import { useState, useEffect } from \"react\";\n\nconst useMediaQuery = (query) => {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    if (media.matches !== matches) {\n      setMatches(media.matches);\n    }\n    const listener = () => setMatches(media.matches);\n    window.addEventListener(\"resize\", listener);\n    return () => window.removeEventListener(\"resize\", listener);\n  }, [matches, query]);\n\n  return matches;\n}\n\nexport default useMediaQuery;\n","import React, {\n  Suspense,\n  lazy,\n  useState,\n  useCallback,\n  createContext,\n  useContext,\n} from 'react'\n\nimport {\n  SwipeableDrawer,\n} from '@mui/material'\n\nimport { useMatch } from 'react-router-dom'\n\nimport useMediaQuery from '../hooks/useMediaQuery.js'\n\nimport classes from './Sidebar.module.css'\n\nconst LazySidebarContent = lazy(() => import('./SidebarContent.js'))\n\nconst SidebarContext = createContext({})\n\nfunction useSidebarContext() {\n  return useContext(SidebarContext)\n}\n\nfunction SidebarProvider({ children }) {\n  const [open, setOpen] = useState(false)\n\n  const matchesStartpage = useMatch('/')\n  const realOpen = matchesStartpage ? false : open\n\n  const toggleSidebar = useCallback(() => {\n    setOpen(oldOpen => !oldOpen)\n  }, [ setOpen ])\n\n  return (\n    <SidebarContext.Provider value={{\n      open: realOpen,\n      setOpen,\n      toggleSidebar,\n    }}>\n      {children}\n    </SidebarContext.Provider>\n  )\n}\n\nconst sidebarWidth = 320\n\nfunction Sidebar() {\n  const { open, toggleSidebar } = useSidebarContext()\n\n  const iOS = (typeof navigator !== 'undefined' && /iPad|iPhone|iPod/.test(navigator.userAgent))\n  const isDesktop = useMediaQuery('(min-width: 960px)')\n\n  if (open) {\n    return <SwipeableDrawer\n      variant={isDesktop ? 'permanent' : 'temporary'}\n      anchor=\"left\"\n      open={open}\n      onOpen={toggleSidebar}\n      onClose={toggleSidebar}\n      disableBackdropTransition={!iOS}\n      disableDiscovery={iOS}\n      sx={{\n        width: sidebarWidth,\n        flexShrink: 0,\n        [`& .MuiDrawer-paper`]: {\n          width: sidebarWidth,\n          boxSizing: 'border-box',\n          backgroundColor: 'var(--background-contrast)',\n          color: 'var(--on-background)',\n          border: 'none',\n        },\n      }}\n      PaperProps={{\n        sx: {\n          background: 'var(--background-contrast)',\n          color: 'var(--on-background)',\n        }\n      }}\n    >\n      <Suspense>\n        <SidebarContent oneColumn={true} />\n      </Suspense>\n    </SwipeableDrawer>\n  }\n\n  return null\n}\n\nfunction SidebarContent({ oneColumn = false }) {\n  return <Suspense>\n    <LazySidebarContent oneColumn={oneColumn} />\n  </Suspense>\n}\nfunction Main({ children }) {\n  const { open } = useSidebarContext()\n\n  return <main\n    className={`${classes.main} ${open ? classes.open : ''}`}\n    style={{\n      '--sidebarWidth': sidebarWidth+'px',\n    }}\n  >\n    {children}\n  </main>\n}\n\nexport {\n  SidebarContext,\n  useSidebarContext,\n  SidebarProvider,\n  SidebarContent,\n  Sidebar,\n  Main,\n}\n\n/*\n      <Drawer\n        variant={isDesktop ? 'permanent' : ''}\n        anchor=\"left\"\n        open={open}\n        sx={{\n          width: drawerWidth,\n          flexShrink: 0,\n          [`& .MuiDrawer-paper`]: {\n            width: drawerWidth,\n            boxSizing: 'border-box',\n            backgroundColor: 'var(--background)',\n            color: 'var(--on-background)',\n          },\n        }}\n        PaperProps={{\n          sx: {\n            background: 'var(--background-contrast)',\n            color: 'var(--on-background)',\n          }\n        }}\n      >\n        <Sidebar />\n      </Drawer>\n      */\n"],"sourceRoot":""}